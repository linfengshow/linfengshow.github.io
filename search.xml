<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>åˆ©ç”¨RequestRateLimiterå®ç°ç®€å•é™æµ</title>
      <link href="/2024/04/06/%E5%88%A9%E7%94%A8RequestRateLimiter%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E9%99%90%E6%B5%81/"/>
      <url>/2024/04/06/%E5%88%A9%E7%94%A8RequestRateLimiter%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E9%99%90%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<p>è‡ªå·±åšçš„å¾®æœåŠ¡ç½‘ç«™ä»Šå¤©ç»ˆäºç®—æ˜¯ä¸Šçº¿äº†ï¼ˆå†…éƒ¨æµ‹è¯•ï¼‰ï¼Œè™½ç„¶æ˜¯å†…éƒ¨æµ‹è¯•ï¼Œä½†åœ¨ä¸Šçº¿ä¹‹å‰è¿˜æ˜¯è€ƒè™‘åšäº†ä¸€ä¸‹gatewayç½‘å…³çš„é™æµï¼Œæ‹…å¿ƒç¾¤ä¼—é‡Œé¢æœ‰åäººğŸ</p><h2 id="åˆ©ç”¨RequestRateLimiterå®ç°ç®€å•é™æµ"><a href="#åˆ©ç”¨RequestRateLimiterå®ç°ç®€å•é™æµ" class="headerlink" title="åˆ©ç”¨RequestRateLimiterå®ç°ç®€å•é™æµ"></a>åˆ©ç”¨RequestRateLimiterå®ç°ç®€å•é™æµ</h2><p>RequestRateLimiteræ˜¯gatewayè‡ªå¸¦çš„ è¿‡æ»¤å™¨ã€‚</p><p>RequestRateLimiter è¿‡æ»¤å™¨å¯ä»¥åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•å®ç°è¯·æ±‚é™æµã€‚å…¶å…·ä½“åŸç†å¦‚ä¸‹ï¼š</p><ol><li><p><strong>åˆ›å»ºä»¤ç‰Œæ¡¶</strong>ï¼šåœ¨ RequestRateLimiter è¿‡æ»¤å™¨åˆå§‹åŒ–æ—¶ï¼Œä¼šè¯»å–é…ç½®å‚æ•°åˆ›å»ºå¯¹åº”çš„ä»¤ç‰Œæ¡¶ã€‚</p></li><li><p><strong>ç”Ÿæˆä»¤ç‰Œ</strong>ï¼šå½“æ–°çš„è¯·æ±‚åˆ°è¾¾ RequestRateLimiter è¿‡æ»¤å™¨æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥ä»¤ç‰Œæ¡¶ä¸­æ˜¯å¦æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œã€‚å¦‚æœæœ‰ï¼Œåˆ™ä»ä»¤ç‰Œæ¡¶ä¸­ç§»é™¤ä¸€ä¸ªä»¤ç‰Œï¼›å¦åˆ™è¯·æ±‚è¢«æ‹’ç»ã€‚</p></li><li><p><strong>é™åˆ¶è¿æ¥æ•°</strong>ï¼šåœ¨è¶…å‡ºæœ€å¤§è¿æ¥æ•°ä¹‹åä¼šåœ¨é˜Ÿåˆ—é‡Œç­‰å¾…ã€‚</p></li><li><p><strong>è®¡æ—¶æ›´æ–°ä»¤ç‰Œæ¡¶å¤§å°</strong>ï¼šRequestRateLimiter è¿‡æ»¤å™¨ä¼šå®šæœŸè®¡æ—¶æ›´æ–°ä»¤ç‰Œæ¡¶çš„å¤§å°ï¼Œç¡®ä¿è®©è¿›å…¥çš„è¯·æ±‚æœ‰æœºä¼šå¾—åˆ°æ‰§è¡Œï¼ŒåŒæ—¶é˜²æ­¢æ¶æ„æ”»å‡»æˆ–è€…ç³»ç»Ÿæ•…éšœå¯¼è‡´æœåŠ¡å™¨è´Ÿè½½è¿‡é‡ã€‚</p></li></ol><p>åœ¨ä½¿ç”¨ RequestRateLimiter è¿‡æ»¤å™¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®å‚æ•° <code>replenishRate</code> å’Œ <code>burstCapacity</code> æ¥æ§åˆ¶ä»¤ç‰Œæ¡¶çš„å¡«å……é€Ÿç‡å’Œå®¹é‡ï¼Œç„¶åå°†å…¶ä¸ç‰¹å®šçš„è·¯ç”±æˆ–æœåŠ¡è¿›è¡Œç»‘å®šï¼Œä»¥å®ç°å¯¹ç‰¹å®šæ¥å£çš„é™æµæ•ˆæœã€‚</p><blockquote><p>èµ„æ–™æ¥æºâ€”â€”çŸ¥ä¹ç”¨æˆ·ï¼šè‹æ ¼æ‹‰æ²¡æœ‰åº•</p></blockquote><h2 id="å®ç°æµç¨‹"><a href="#å®ç°æµç¨‹" class="headerlink" title="å®ç°æµç¨‹"></a>å®ç°æµç¨‹</h2><ol><li><p>å¼•å…¥redisä¾èµ–å¹¶é…ç½®è¿æ¥ä¿¡æ¯<br>RequestRateLimiter ä¸€èˆ¬ä¼šä¾èµ– ReactiveStringRedisTemplate, è€Œå®ƒåˆä¾èµ–åˆ° ReactiveRedisConnectionFactory çš„å®ç°ç±»LettuceConnectionFactory</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis-reactive<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>å®ç°é™æµç­–ç•¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2024/4/6 10:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestRateLimiterResolver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> KeyResolver <span class="title function_">ipKeyResolver</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        ipé™æµ</span></span><br><span class="line">        <span class="keyword">return</span> exchange -&gt; Mono.just(</span><br><span class="line">                exchange.getRequest()</span><br><span class="line">                        .getHeaders()</span><br><span class="line">                        .getFirst(<span class="string">&quot;X-Forwarded-For&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> KeyResolver <span class="title function_">pathKeyResolver</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        æ ¹æ®è¯·æ±‚è·¯å¾„é™æµ</span></span><br><span class="line">        <span class="keyword">return</span> exchange -&gt; Mono.just(</span><br><span class="line">                exchange.getRequest()</span><br><span class="line">                        .getPath()</span><br><span class="line">                        .toString()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤å™¨æ¥å—ä¸€ä¸ªå¯é€‰çš„keyResolverå‚æ•°å’Œç‰¹å®šäºé€Ÿç‡é™åˆ¶å™¨çš„å‚æ•°ã€‚è¯¥å‚æ•°çš„ä½œç”¨å°±æ˜¯ç”¨æ¥æ ¹æ®ä½ è®¾å®šçš„è§„åˆ™ç”Ÿæˆkeyï¼Œæ¯”å¦‚åœ¨redisä¸­ä½¿ç”¨ä»€ä¹ˆkeyã€‚</p></li><li><p>é…ç½®é™æµ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- id: subject # è·¯ç”±ID åˆ·é¢˜æ¨¡å—</span><br><span class="line">  uri: lb:<span class="comment">//al-club-subject</span></span><br><span class="line">  predicates:</span><br><span class="line">    - Path=/subject<span class="comment">/**</span></span><br><span class="line"><span class="comment">  filters:</span></span><br><span class="line"><span class="comment">    - StripPrefix=1</span></span><br><span class="line"><span class="comment">    - name: RequestRateLimiter</span></span><br><span class="line"><span class="comment">      args:</span></span><br><span class="line"><span class="comment">        #                ä»¤ç‰Œæ¡¶å¡«å……é€Ÿç‡</span></span><br><span class="line"><span class="comment">        redis-rate-limiter.replenishRate: 50</span></span><br><span class="line"><span class="comment">        #                ä»¤ç‰Œæ¡¶ä¸Šé™</span></span><br><span class="line"><span class="comment">        redis-rate-limiter.burstCapacity: 50</span></span><br><span class="line"><span class="comment">        #                è·å–Beanå¯¹è±¡</span></span><br><span class="line"><span class="comment">        key-resolver: &quot;#&#123;<span class="doctag">@pathKeyResolver</span>&#125;&quot;</span></span><br></pre></td></tr></table></figure><p> â€œ#{@pathKeyResolver}â€æ˜¯ä¸€ä¸ªSpELè¡¨è¾¾å¼ï¼Œå®ƒå¼•ç”¨äº†ä¸€ä¸ªåä¸ºuserKeyResolverçš„bean,ä¹Ÿå°±æ˜¯æˆ‘ä»¬åˆšåˆšå®šä¹‰çš„KeyResolverï¼Œè¿™æ ·å°±å¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„é™æµã€‚</p></li></ol><h2 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h2><p>ä¿®æ”¹nacosä¸Šçš„é…ç½®ï¼Œæ”¹å°ä¸€ç‚¹ï¼Œæ–¹ä¾¿æ¼”ç¤º</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202404061331628.png" alt="image-20240406133127520"></p><p>è¿›è¡Œä¸€æ¬¡å°å°çš„å‹æµ‹ï¼ˆè½¯ä»¶æ˜¯apifoxï¼‰</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202404061332732.png" alt="image-20240406133252695"></p><p>ç»“æœ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202404061334077.png" alt="image-20240406133445017"></p><p>å¯ä»¥çœ‹åˆ°é™æµæˆåŠŸï¼Œå¤±è´¥è¯·æ±‚çš„é”™è¯¯ç ä¸º429ï¼Œä»£è¡¨Too many Requests</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> gateway </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redissonå®ç°å¯é‡å…¥é”åŸç†</title>
      <link href="/2024/03/06/Redisson%E5%AE%9E%E7%8E%B0%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81%E5%8E%9F%E7%90%86/"/>
      <url>/2024/03/06/Redisson%E5%AE%9E%E7%8E%B0%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="Redissonå®ç°å¯é‡å…¥é”åŸç†"><a href="#Redissonå®ç°å¯é‡å…¥é”åŸç†" class="headerlink" title="Redissonå®ç°å¯é‡å…¥é”åŸç†"></a>Redissonå®ç°å¯é‡å…¥é”åŸç†</h1><p>Redissonåº•å±‚å®ç°åˆ†å¸ƒå¼é”æ˜¯é‡‡ç”¨hashç»“æ„å­˜å‚¨é”ï¼Œ</p><p>å…¶ä¸­Keyä»£è¡¨é”åï¼Œä¹Ÿæ˜¯ä¸€æŠŠé”çš„å”¯ä¸€æ ‡è¯†ï¼Œkeyå­˜åœ¨è¯´æ˜æ­¤æ—¶è¿™æŠŠé”å·²ç»è¢«æŒæœ‰äº†</p><p>Valueä¸­çš„keyæŒ‰ç…§id + â€œï¼šâ€ + threadIdå‘½åï¼Œä½œä¸ºå½“Keyä¸€è‡´æ—¶ï¼Œå³æœ‰çº¿ç¨‹æƒ³è·å–åŒä¸€æŠŠé”æ—¶ï¼Œåˆ†è¾¨æ˜¯å¦æ˜¯å½“å‰é”çš„è¿›ç¨‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™åŠ é”å¤±è´¥</p><p>Valueä¸­çš„å°valueä½œä¸ºé”çš„è®¡æ•°å™¨ï¼Œæ¯æ¬¡çº¿ç¨‹è·å–é”ï¼Œåˆ™åŠ 1ï¼Œé‡Šæ”¾é”å°±å‡1ï¼Œåªæœ‰åŒä¸€çº¿ç¨‹ä¸­æ‰å¯ä»¥é‡å…¥åŒä¸€æŠŠé”ï¼Œæ¯é‡å…¥ä¸€æ¬¡ï¼Œvalueå°±è®¡æ•°ä¸€æ¬¡</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403061547872.jpg"></p><p>ä¸‹é¢æ˜¯åŠ é”çš„luaè„šæœ¬ä»£ç </p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;if (redis.call(&#x27;exists&#x27;, KEYS[1]) == 0) then &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;hset&#x27;, KEYS[1], ARGV[2], 1); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;return nil; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;end; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;if (redis.call(&#x27;hexists&#x27;, KEYS[1], ARGV[2]) == 1) then &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;hincrby&#x27;, KEYS[1], ARGV[2], 1); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;return nil; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;end; &quot;</span> +</span><br><span class="line">              <span class="string">&quot;return redis.call(&#x27;pttl&#x27;, KEYS[1]);&quot;</span></span><br></pre></td></tr></table></figure><p>å‚æ•°æœ‰ä¸‰ä¸ªï¼š</p><p><strong>KEYS[1] ï¼š é”åç§°</strong></p><p><strong>ARGV[1]ï¼š  é”å¤±æ•ˆæ—¶é—´</strong></p><p><strong>ARGV[2]ï¼š  id + â€œ:â€ + threadId; é”çš„å°key</strong></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒå…ˆåˆ¤æ–­é”æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ç›´æ¥è·å–é”ï¼Œå°†ä¼ å…¥çš„ä¿¡æ¯ä»¥hashçš„å½¢å¼å­˜å…¥ã€‚</p><p>è‹¥é”å­˜åœ¨ï¼Œåˆ™å–å…¶ä¸­çš„threadIdï¼Œä¸ä¼ å…¥çš„threadidå¯¹æ¯”ï¼Œä¸€è‡´åˆ™å¦è®¡æ•°å™¨åŠ 1ä»£è¡¨é‡å…¥è¯¥é”ä¸€æ¬¡</p><p>è‹¥æ¯”å¯¹å¤±è´¥ï¼Œè¿”å›nil</p><p>é‡Šæ”¾é”é€»è¾‘å’ŒåŠ é”ç±»ä¼¼</p><p>å‚æ•°æœ‰ä¸‰ä¸ªï¼š</p><p><strong>KEYS[1] ï¼š é”åç§°</strong></p><p><strong>ARGV[1]ï¼šçº¿ç¨‹å”¯ä¸€æ ‡è¯†</strong></p><p><strong>ARGV[2]ï¼š  é”çš„è‡ªåŠ¨é‡Šæ”¾æ—¶é—´</strong></p><p>é¦–å…ˆåˆ¤æ–­æ˜¯å¦æ˜¯è‡ªå·±çš„é”ï¼Œä¸æ˜¯åˆ™è¿”å›nil</p><p>æ˜¯è‡ªå·±çš„åˆ™å°†è®¡æ•°å™¨å‡1</p><p>ç„¶ååˆ¤æ–­è®¡æ•°å™¨æ˜¯å¦å¤§äº0ï¼Œæ˜¯åˆ™æ›´æ–°é”çš„é‡Šæ”¾æ—¶é—´</p><p>ä¸æ˜¯åˆ™è¯´æ˜å·²ç»æ²¡æœ‰æ“ä½œåœ¨æŒæœ‰é”äº†ï¼Œåˆ™æ ¹æ®keyåˆ é™¤é”</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Resourceå’ŒAutowiredåŒºåˆ«</title>
      <link href="/2024/03/02/Resource%E5%92%8CAutowired%E5%8C%BA%E5%88%AB/"/>
      <url>/2024/03/02/Resource%E5%92%8CAutowired%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="Resourceå’Œ-AutowiredåŒºåˆ«"><a href="#Resourceå’Œ-AutowiredåŒºåˆ«" class="headerlink" title="@Resourceå’Œ@AutowiredåŒºåˆ«"></a>@Resourceå’Œ@AutowiredåŒºåˆ«</h1><p>@Resourceå’Œ@Autowiredéƒ½æ˜¯ç”¨æ¥åšä¾èµ–æ³¨å…¥çš„ï¼Œä½†ä»–ä»¬å­˜åœ¨å‡ ç‚¹ä¸åŒï¼š</p><h2 id="1-æ¥æºä¸åŒ"><a href="#1-æ¥æºä¸åŒ" class="headerlink" title="1.æ¥æºä¸åŒ"></a>1.æ¥æºä¸åŒ</h2><p>@Resourceæ¥æºäºJavaå®šä¹‰çš„æ³¨è§£ï¼Œæ¥è‡ªäºJSR-250</p><p>@Autowiredæ¥è‡ªäºSpringå®šä¹‰çš„æ³¨è§£</p><h2 id="2-æ”¯æŒå‚æ•°ä¸åŒ"><a href="#2-æ”¯æŒå‚æ•°ä¸åŒ" class="headerlink" title="2.æ”¯æŒå‚æ•°ä¸åŒ"></a>2.æ”¯æŒå‚æ•°ä¸åŒ</h2><p>@Resource æ”¯æŒä¸ƒä¸ªå‚æ•°</p><blockquote><ul><li>nameï¼šèµ„æºçš„JNDIåç§°ã€‚åœ¨springçš„æ³¨å…¥æ—¶ï¼ŒæŒ‡å®šbeançš„å”¯ä¸€æ ‡è¯†ã€‚</li><li>typeï¼šæŒ‡å®šbeançš„ç±»å‹ã€‚</li><li>lookup:å¼•ç”¨æŒ‡å‘çš„èµ„æºçš„åç§°ã€‚å®ƒå¯ä»¥ä½¿ç”¨å…¨å±€JNDIåç§°é“¾æ¥åˆ°ä»»ä½•å…¼å®¹çš„èµ„æºã€‚</li><li>authenticationType:æŒ‡å®šèµ„æºçš„èº«ä»½éªŒè¯ç±»å‹ã€‚å®ƒåªèƒ½ä¸ºä»»ä½•å—æ”¯æŒç±»å‹çš„è¿æ¥å·¥å‚çš„èµ„æºæŒ‡å®šæ­¤é€‰é¡¹ï¼Œè€Œä¸èƒ½ä¸ºå…¶ä»–ç±»å‹çš„èµ„æºæŒ‡å®šæ­¤é€‰é¡¹ã€‚</li><li>shareableï¼šæŒ‡å®šæ­¤èµ„æºæ˜¯å¦å¯ä»¥åœ¨æ­¤ç»„ä»¶å’Œå…¶ä»–ç»„ä»¶ä¹‹é—´å…±äº«ã€‚</li><li>mappedNameï¼šæŒ‡å®šèµ„æºçš„æ˜ å°„åç§°ã€‚</li><li>descriptionï¼šæŒ‡å®šèµ„æºçš„æè¿°ã€‚</li></ul></blockquote><p>@Autowired ä»…æ”¯æŒä¸€ä¸ªå‚æ•°requied</p><h2 id="3-ä¾èµ–æŸ¥æ‰¾é¡ºåºä¸åŒ"><a href="#3-ä¾èµ–æŸ¥æ‰¾é¡ºåºä¸åŒ" class="headerlink" title="3.ä¾èµ–æŸ¥æ‰¾é¡ºåºä¸åŒ"></a>3.ä¾èµ–æŸ¥æ‰¾é¡ºåºä¸åŒ</h2><p>@Resourceå…ˆæ ¹æ®nameæŸ¥æ‰¾å¯¹è±¡ï¼Œå¦‚æœé€šè¿‡nameæ‰¾ä¸åˆ°ï¼Œåˆ™é€šè¿‡ç±»å‹æŸ¥æ‰¾</p><p>@Autowiredå’ŒResourceç›¸åï¼Œå³å…ˆæŸ¥æ‰¾ç±»å‹ï¼Œå†æŸ¥æ‰¾name</p><h2 id="4-æ³¨å…¥è§„åˆ™ä¸åŒ"><a href="#4-æ³¨å…¥è§„åˆ™ä¸åŒ" class="headerlink" title="4.æ³¨å…¥è§„åˆ™ä¸åŒ"></a>4.æ³¨å…¥è§„åˆ™ä¸åŒ</h2><p>@Autowiredæ”¯æŒï¼šå±æ€§æ³¨å…¥ï¼Œæ„é€ æ–¹æ³•æ³¨å…¥ï¼ŒSetteræ³¨å…¥</p><p>@Resourceåªæ”¯æŒï¼šå±æ€§æ³¨å…¥ï¼ŒSetteræ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//å±æ€§æ³¨å…¥  </span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•æ³¨å…¥</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserController</span><span class="params">(UserService userService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Setter æ³¨å…¥</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserService</span><span class="params">(UserService userService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-ç¼–è¯‘å™¨æŠ¥é”™"><a href="#5-ç¼–è¯‘å™¨æŠ¥é”™" class="headerlink" title="5.ç¼–è¯‘å™¨æŠ¥é”™"></a>5.ç¼–è¯‘å™¨æŠ¥é”™</h2><p>@Autowiredç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼ˆä¸å½±å“è¿è¡Œï¼‰</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403030002530.png" alt="image-20240303000251494"></p><p>@Resourceä¸å­˜åœ¨æŠ¥é”™</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403030003619.png" alt="image-20240303000321589"></p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxæ€ä¹ˆè§£å†³è·¨åŸŸé—®é¢˜</title>
      <link href="/2024/03/02/Nginx%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/"/>
      <url>/2024/03/02/Nginx%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="Nginxæ˜¯æ€ä¹ˆè§£å†³è·¨åŸŸé—®é¢˜çš„"><a href="#Nginxæ˜¯æ€ä¹ˆè§£å†³è·¨åŸŸé—®é¢˜çš„" class="headerlink" title="Nginxæ˜¯æ€ä¹ˆè§£å†³è·¨åŸŸé—®é¢˜çš„"></a>Nginxæ˜¯æ€ä¹ˆè§£å†³è·¨åŸŸé—®é¢˜çš„</h1><p>è·¨åŸŸé—®é¢˜ï¼š</p><p>å…·ä½“æ¥è¯´æ˜¯æµè§ˆå™¨å¦‚æœå‘ä¸€ä¸ªåœ°å€ä¸åŒï¼Œæˆ–è€…ç«¯å£å·ä¸åŒçš„é“¾æ¥å‘é€è¯·æ±‚ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šç¦æ­¢è¿™ç§è¯·æ±‚ã€‚</p><p>Nginxè§£å†³è·¨åŸŸé—®é¢˜ï¼Œä¸»è¦çš„æ–¹æ³•æ˜¯åå‘ä»£ç†ï¼Œä½•ä¸ºæ­£å‘ä»£ç†ï¼Œä½•ä¸ºåå‘ä»£ç†ï¼Ÿ</p><p>æ­£å‘ä»£ç†ï¼š<br>æ­£å‘ä»£ç†ä»£ç†å®¢æˆ·ç«¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è®¿é—®æŸä¸ªç½‘ç«™ï¼Œä½†æ˜¯è¯¥ç½‘ç«™æ— æ³•ç›´æ¥è®¿é—®ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸä¸ªæœåŠ¡å™¨çš„æ­£å‘ä»£ç†ï¼Œæ¥é—´æ¥è®¿é—®è¯¥ç½‘ç«™ï¼Œå…¶ä¸­æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯VPN</p><p>åå‘ä»£ç†ï¼š<br>åå‘ä»£ç†ä»£ç†æœåŠ¡å™¨ï¼Œå³ä½ æƒ³è¦è®¿é—®ç½‘ç«™Aï¼Œä½†ç½‘ç«™Aå®é™…ä¸Šä¼šè·³è½¬åˆ°ç½‘ç«™Bï¼Œä½†æ˜¯ç”¨æˆ·å¹¶ä¸æ¸…æ¥šï¼Œç”¨æˆ·åªè®¤ä¸ºè‡ªå·±è®¿é—®äº†ç½‘ç«™Aï¼Œè¿™å°±å¯ä»¥ç§°ç½‘ç«™Aåå‘ä»£ç†äº†ç½‘ç«™Bã€‚</p><p>å…¶å®ä¸ä»…ä»…æ˜¯ç”¨æˆ·ä¸çŸ¥é“è‡ªå·±è®¿é—®çš„æ˜¯ç½‘ç«™Bï¼Œæµè§ˆå™¨ä¹Ÿå¯Ÿè§‰ä¸åˆ°ï¼Œåœ¨æµè§ˆå™¨çš„è§†è§’é‡Œï¼Œå®ƒæ˜¯å¯¹è‡ªå·±çš„IPå’Œç«¯å£å‘é€äº†è¯·æ±‚ï¼Œè¿™æ ·å¹¶ä¸ä¼šè¿åæµè§ˆå™¨çš„è·¨åŸŸè§„åˆ™ï¼Œç„¶è€Œå®é™…ä¸Šå‘é€çš„è¯·æ±‚éƒ½è¢«è½¬å‘åˆ°çœŸæ­£çš„åç«¯æœåŠ¡å™¨ä¸Šçš„äº†ï¼Œè·¨åŸŸé—®é¢˜å°±è¿™æ ·è§£å†³äº†ã€‚</p><h1 id="é™„ä¸Šnginxåå‘ä»£ç†çš„é…ç½®"><a href="#é™„ä¸Šnginxåå‘ä»£ç†çš„é…ç½®" class="headerlink" title="é™„ä¸Šnginxåå‘ä»£ç†çš„é…ç½®"></a>é™„ä¸Šnginxåå‘ä»£ç†çš„é…ç½®</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/json;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    </span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       8082;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        # æŒ‡å®šå‰ç«¯é¡¹ç›®æ‰€åœ¨çš„ä½ç½®</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html/hmdp;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        location /api &#123;  </span><br><span class="line">            default_type  application/json;</span><br><span class="line">            #internal;  </span><br><span class="line">            keepalive_timeout   30s;  </span><br><span class="line">            keepalive_requests  1000;  </span><br><span class="line">            #æ”¯æŒkeep-alive  </span><br><span class="line">            proxy_http_version 1.1;  </span><br><span class="line">            rewrite /api(/.*) $1 break;  </span><br><span class="line">            proxy_pass_request_headers on;</span><br><span class="line">            #more_clear_input_headers Accept-Encoding;  </span><br><span class="line">            proxy_next_upstream error timeout;  </span><br><span class="line">            proxy_pass http://127.0.0.1:8081;</span><br><span class="line">            #proxy_pass http://backend;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        server 127.0.0.1:8081 max_fails=5 fail_timeout=10s weight=1;</span><br><span class="line">        #server 127.0.0.1:8082 max_fails=5 fail_timeout=10s weight=1;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Session,Cookie,Jwt,Filter,InterceptoråŒºåˆ«</title>
      <link href="/2024/03/02/Session-Cookie-Jwt-Filter-Interceptor%E5%8C%BA%E5%88%AB/"/>
      <url>/2024/03/02/Session-Cookie-Jwt-Filter-Interceptor%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="Cookieï¼ŒSessionï¼ŒJWT"><a href="#Cookieï¼ŒSessionï¼ŒJWT" class="headerlink" title="Cookieï¼ŒSessionï¼ŒJWT"></a>Cookieï¼ŒSessionï¼ŒJWT</h1><p>ä¸‰è€…æ™®ééƒ½æ˜¯ç”¨æ¥åšç™»å½•éªŒè¯çš„ï¼š</p><h2 id="cookieï¼šå®¢æˆ·ç«¯ä¼šè¯è·Ÿè¸ª"><a href="#cookieï¼šå®¢æˆ·ç«¯ä¼šè¯è·Ÿè¸ª" class="headerlink" title="cookieï¼šå®¢æˆ·ç«¯ä¼šè¯è·Ÿè¸ª"></a>cookieï¼šå®¢æˆ·ç«¯ä¼šè¯è·Ÿè¸ª</h2><p>ç™»å½•æˆåŠŸåä¼šåœ¨æµè§ˆå™¨å­˜ä¸€ä¸ªcookieï¼ŒæœåŠ¡ç«¯æ£€æŸ¥è¯·æ±‚ä¸­æ˜¯å¦å­˜åœ¨cookieï¼Œä»¥æ­¤æ¥åšç™»å½•éªŒè¯</p><p>ç¼ºç‚¹ï¼š<br>ç§»åŠ¨ç«¯æ— æ³•ä½¿ç”¨ï¼Œä¸å®‰å…¨ï¼ˆå¯èƒ½è¢«çªƒå–â€”â€”XSSï¼‰ï¼Œä¸èƒ½è·¨åŸŸ</p><h2 id="Sessionï¼šæœåŠ¡ç«¯ä¼šè¯è·Ÿè¸ª"><a href="#Sessionï¼šæœåŠ¡ç«¯ä¼šè¯è·Ÿè¸ª" class="headerlink" title="Sessionï¼šæœåŠ¡ç«¯ä¼šè¯è·Ÿè¸ª"></a>Sessionï¼šæœåŠ¡ç«¯ä¼šè¯è·Ÿè¸ª</h2><p>æœåŠ¡ç«¯å­˜å‚¨ç”¨æˆ·ç™»å½•ä¿¡æ¯</p><p>ç¼ºç‚¹ï¼š</p><p>é›†ç¾¤ç¯å¢ƒä¸‹æ— æ³•ä½¿ç”¨</p><p>å­˜åœ¨å’Œcooikeä¸€æ ·çš„ç¼ºç‚¹</p><h2 id="JWTï¼šä»¤ç‰Œ"><a href="#JWTï¼šä»¤ç‰Œ" class="headerlink" title="JWTï¼šä»¤ç‰Œ"></a>JWTï¼šä»¤ç‰Œ</h2><p>ç™»å½•æˆåŠŸç”Ÿæˆä»¤ç‰Œï¼Œå®¢æˆ·ç«¯å­˜æ”¾ä»¤ç‰Œï¼Œæ¯æ¬¡è¯·æ±‚æ—¶åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ä»¤ç‰Œï¼Œå®‰å…¨ç³»æ•°è¾ƒé«˜ï¼Œæ— æ³•è¢«ç¯¡æ”¹</p><h1 id="Filterï¼ŒInterceptor"><a href="#Filterï¼ŒInterceptor" class="headerlink" title="Filterï¼ŒInterceptor"></a>Filterï¼ŒInterceptor</h1><p>Interceptoræ‹¦æˆªå™¨ï¼š</p><p>ç”±Springæ¡†æ¶æä¾›ï¼Œæ˜¯ä¸€ç§åŠ¨æ€æ‹¦æˆªæ–¹æ³•çš„æœºåˆ¶</p><p>filter è¿‡æ»¤å™¨ï¼š</p><p>javawebä¸‰å¤§ç»„ä»¶ï¼ˆservlet,filter,listenerï¼‰ä¹‹ä¸€,å¯ä»¥æ‹¦æˆªå¯¹èµ„æºçš„è¯·æ±‚ï¼Œä¸€èˆ¬å®Œæˆä¸€äº›é€šç”¨æ“ä½œ</p><p>ä¸¤è€…åŒºåˆ«ï¼š</p><p>1.æ¥å£è§„èŒƒä¸åŒï¼šè¿‡æ»¤å™¨éœ€è¦å®ç°Filteræ¥å£ï¼Œæ‹¦æˆªå™¨éœ€è¦å®ç°HandlerInterceptoræ¥å£</p><p>2.æ‹¦æˆªèŒƒå›´ä¸åŒï¼šfilterä¼šæ‹¦æˆªæ‰€æœ‰å¯¹èµ„æºçš„è¯·æ±‚ï¼Œinterceptoråªä¼šæ‹¦æˆªå¯¹Springç¯å¢ƒä¸­çš„èµ„æºçš„è¯·æ±‚</p><p>s</p>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaåç«¯å¸¸ç”¨æ“ä½œæ±‡æ€»</title>
      <link href="/2024/03/02/java%E5%90%8E%E7%AB%AF%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E6%B1%87%E6%80%BB/"/>
      <url>/2024/03/02/java%E5%90%8E%E7%AB%AF%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E6%B1%87%E6%80%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="åç«¯ç™¾å®ç®±"><a href="#åç«¯ç™¾å®ç®±" class="headerlink" title="åç«¯ç™¾å®ç®±"></a>åç«¯ç™¾å®ç®±</h1><h1 id="éšæœºç”ŸæˆéªŒè¯ç "><a href="#éšæœºç”ŸæˆéªŒè¯ç " class="headerlink" title="éšæœºç”ŸæˆéªŒè¯ç "></a>éšæœºç”ŸæˆéªŒè¯ç </h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        è°ƒç”¨hutoolçš„å·¥å…·ï¼Œéšæœºç”Ÿæˆ6ä½éªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span>  <span class="operator">=</span> RandomUtil.randomNumbers(<span class="number">6</span>);</span><br></pre></td></tr></table></figure><h1 id="éªŒè¯æ‰‹æœºå·ï¼Œé‚®ç®±ç­‰æ˜¯å¦åˆæ³•çš„æ­£åˆ™è¡¨è¾¾å¼"><a href="#éªŒè¯æ‰‹æœºå·ï¼Œé‚®ç®±ç­‰æ˜¯å¦åˆæ³•çš„æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="éªŒè¯æ‰‹æœºå·ï¼Œé‚®ç®±ç­‰æ˜¯å¦åˆæ³•çš„æ­£åˆ™è¡¨è¾¾å¼"></a>éªŒè¯æ‰‹æœºå·ï¼Œé‚®ç®±ç­‰æ˜¯å¦åˆæ³•çš„æ­£åˆ™è¡¨è¾¾å¼</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰‹æœºå·æ­£åˆ™</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PHONE_REGEX</span> <span class="operator">=</span> <span class="string">&quot;^1([38][0-9]|4[579]|5[0-3,5-9]|6[6]|7[0135678]|9[89])\\d&#123;8&#125;$&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é‚®ç®±æ­£åˆ™</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EMAIL_REGEX</span> <span class="operator">=</span> <span class="string">&quot;^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯†ç æ­£åˆ™ã€‚4~32ä½çš„å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASSWORD_REGEX</span> <span class="operator">=</span> <span class="string">&quot;^\\w&#123;4,32&#125;$&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éªŒè¯ç æ­£åˆ™, 6ä½æ•°å­—æˆ–å­—æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">VERIFY_CODE_REGEX</span> <span class="operator">=</span> <span class="string">&quot;^[a-zA-Z\\d]&#123;6&#125;$&quot;</span>;</span><br></pre></td></tr></table></figure><h1 id="æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼çš„éªŒè¯æ–¹æ³•"><a href="#æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼çš„éªŒè¯æ–¹æ³•" class="headerlink" title="æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼çš„éªŒè¯æ–¹æ³•"></a>æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼çš„éªŒè¯æ–¹æ³•</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">mismatch</span><span class="params">(String str, String regex)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isBlank(str)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> !str.matches(regex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="éSpringç»„ä»¶å¦‚ä½•æ³¨å…¥ä¾èµ–"><a href="#éSpringç»„ä»¶å¦‚ä½•æ³¨å…¥ä¾èµ–" class="headerlink" title="éSpringç»„ä»¶å¦‚ä½•æ³¨å…¥ä¾èµ–"></a>éSpringç»„ä»¶å¦‚ä½•æ³¨å…¥ä¾èµ–</h1><p>æ³•ä¸€ï¼š</p><p>æ­£å¸¸æ³¨å…¥ï¼Œåœ¨è°ƒç”¨æ—¶ç”¨å¸¦æœ‰@Beançš„æ–¹æ³•è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> LoginInterceptor <span class="title function_">authenticationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³•äºŒï¼š</p><p>æ„é€ å™¨æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">LoginInterceptor</span><span class="params">(StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨Springç¯å¢ƒä¸­è°ƒç”¨å¹¶ä¼ å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>(stringRedisTemplate))</span><br></pre></td></tr></table></figure><h1 id="Rediså·¥å…·ç±»å°è£…"><a href="#Rediså·¥å…·ç±»å°è£…" class="headerlink" title="Rediså·¥å…·ç±»å°è£…"></a>Rediså·¥å…·ç±»å°è£…</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CacheClient</span><span class="params">(StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>: å°è£…ç¼“å­˜å­˜å‚¨å·¥å…·</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [key, value, time, unit]</span></span><br><span class="line"><span class="comment">         * é”®ï¼Œå€¼ï¼Œæ—¶é—´ï¼Œæ—¶é—´å•ä½</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> void</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> JSONUtil.toJsonStr(value);</span><br><span class="line"></span><br><span class="line">        stringRedisTemplate.opsForValue().set(key,data,time,unit);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWithLogicalExpire</span><span class="params">(String key,Object value,Long time,TimeUnit unit)</span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>: åˆ©ç”¨é€»è¾‘æ—¶é—´å­˜å‚¨ï¼Œé˜²æ­¢ç¼“å­˜å‡»ç©¿</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [key, value, time, unit]</span></span><br><span class="line"><span class="comment">         * é”®ï¼Œå€¼ï¼Œæ—¶é—´ï¼Œæ—¶é—´å•ä½</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> void</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        è¿™é‡Œå­˜æ”¾çš„valueåº”è¯¥æ˜¯åŒåŒ…ä¸‹RedisDataç±»</span></span><br><span class="line">        <span class="type">RedisData</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisData</span>();</span><br><span class="line">        data.setData(value);</span><br><span class="line">        data.setExpireTime(LocalDateTime.now().plusSeconds(unit.toSeconds(time)));</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonStr</span> <span class="operator">=</span> JSONUtil.toJsonStr(data);</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key,jsonStr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;R,ID&gt; R <span class="title function_">queryWithPassThrough</span><span class="params">(String keyPrefix, ID id, Class&lt;R&gt; type ,Function&lt;ID,R&gt; dbFallback,Long time,TimeUnit unit)</span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>: è¯»æ•°æ®å¹¶é˜²æ­¢ç¼“å­˜ç©¿é€</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [key, id, type, dbFallback,time,unit]</span></span><br><span class="line"><span class="comment">         * é”®ï¼ŒæŸ¥è¯¢idï¼Œè½¬æ¢ç±»å‹ï¼Œæ•°æ®åº“æŸ¥è¯¢æ–¹æ³•ï¼Œè¿‡æœŸæ—¶é—´ï¼Œæ—¶é—´ç±»å‹</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> R</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isNotBlank(json))&#123;</span><br><span class="line"><span class="comment">//            å‘½ä¸­ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="type">R</span> <span class="variable">bean</span> <span class="operator">=</span> JSONUtil.toBean(json, type);</span><br><span class="line">            <span class="keyword">return</span> bean;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(json != <span class="literal">null</span>)&#123;</span><br><span class="line"><span class="comment">//            å‘½ä¸­ç©ºæ•°æ®</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        æ²¡å‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> dbFallback.apply(id);</span><br><span class="line">        <span class="keyword">if</span>(r == <span class="literal">null</span>)&#123;</span><br><span class="line"><span class="comment">//            å­˜å…¥ç©ºæ•°æ®</span></span><br><span class="line">            stringRedisTemplate.opsForValue().set(key,<span class="string">&quot;&quot;</span>,RedisConstants.CACHE_NULL_TTL,TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æœªå‘½ä¸­ï¼Œå†…å­˜å­˜å…¥ç©ºæ•°æ®&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        å­˜å…¥ç¼“å­˜</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(key,JSONUtil.toJsonStr(r),time,unit);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">CACHE_REBUILD_EXECUTOR</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;R,ID&gt; R <span class="title function_">queryWithLogicalExpire</span><span class="params">(String keyPrefix, ID id, Class&lt;R&gt; type ,Function&lt;ID,R&gt; dbFallback,Long time,TimeUnit unit)</span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@Description</span>: è¯»æ•°æ®å¹¶é˜²æ­¢ç¼“å­˜å‡»ç©¿</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@Params</span>: [key, id, type, dbFallback,time,unit]</span></span><br><span class="line"><span class="comment">         * é”®ï¼ŒæŸ¥è¯¢idï¼Œè½¬æ¢ç±»å‹ï¼Œæ•°æ®åº“æŸ¥è¯¢æ–¹æ³•ï¼Œè¿‡æœŸæ—¶é—´ï¼Œæ—¶é—´ç±»å‹</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@Return</span> R</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isBlank(json))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        å‘½ä¸­ï¼Œåˆ™è½¬æ¢</span></span><br><span class="line">        <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> JSONUtil.toBean(json, RedisData.class);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">data</span> <span class="operator">=</span> redisData.getData();</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> JSONUtil.toBean((JSONObject) data, type);</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">expireTime</span> <span class="operator">=</span> redisData.getExpireTime();</span><br><span class="line">        <span class="keyword">if</span>(expireTime.isAfter(LocalDateTime.now()))&#123;</span><br><span class="line"><span class="comment">//            æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span>  r;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        è¿‡æœŸäº†ï¼Œåˆ™è°ƒç”¨çº¿ç¨‹ï¼Œæ›´æ–°ç¼“å­˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> RedisConstants.LOCK_SHOP_KEY + id;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(isLock)&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//            äºŒæ¬¡éªŒè¯,é˜²æ­¢é‡å¤é‡å»º</span></span><br><span class="line"><span class="comment">//            json = redisTemplate.opsForValue().get(key);</span></span><br><span class="line"><span class="comment">//            if(StrUtil.isBlank(json))&#123;</span></span><br><span class="line"><span class="comment">//                return null;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">////        å‘½ä¸­ï¼Œåˆ™è½¬æ¢</span></span><br><span class="line"><span class="comment">//            redisData = JSONUtil.toBean(json, RedisData.class);</span></span><br><span class="line"><span class="comment">//            data = redisData.getData();</span></span><br><span class="line"><span class="comment">//            R reR = JSONUtil.toBean((JSONObject) data, type);</span></span><br><span class="line"><span class="comment">//            expireTime = redisData.getExpireTime();</span></span><br><span class="line"><span class="comment">//            if(expireTime.isAfter(LocalDateTime.now()))&#123;</span></span><br><span class="line"><span class="comment">////            æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›</span></span><br><span class="line"><span class="comment">//                return  reR;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//            éªŒè¯å¤±è´¥ï¼Œç”³è¯·çº¿ç¨‹ï¼Œé‡å»ºç¼“å­˜</span></span><br><span class="line">            CACHE_REBUILD_EXECUTOR.submit(() -&gt;&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line"><span class="comment">//                    é‡å»ºç¼“å­˜</span></span><br><span class="line"><span class="comment">//                    æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">                    <span class="type">R</span> <span class="variable">r1</span> <span class="operator">=</span> dbFallback.apply(id);</span><br><span class="line"><span class="comment">//                    å†™å…¥ç¼“å­˜</span></span><br><span class="line">                    <span class="built_in">this</span>.setWithLogicalExpire(key,r1,time,unit);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line"><span class="comment">//                    é‡Šæ”¾é”</span></span><br><span class="line">                    unLock(key);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        è¿”å›æ—§æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(String key)</span>&#123;</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">b</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="string">&quot;1&quot;</span>, LOCK_SHOP_TTL, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BooleanUtil.isTrue(b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    é‡Šæ”¾äº’æ–¥é”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unLock</span><span class="params">(String key)</span>&#123;</span><br><span class="line">        stringRedisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CACHE_KEY_SEPARATOR</span> <span class="operator">=</span> <span class="string">&quot;.&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ„å»ºç¼“å­˜key</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">buildKey</span><span class="params">(String... strObjs)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Stream.of(strObjs).collect(Collectors.joining(CACHE_KEY_SEPARATOR));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ˜¯å¦å­˜åœ¨key</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">exist</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ é™¤key</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">del</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.delete(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * set(ä¸å¸¦è¿‡æœŸ)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">    redisTemplate.opsForValue().set(key, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * set(å¸¦è¿‡æœŸ)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">setNx</span><span class="params">(String key, String value, Long time, TimeUnit timeUnit)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.opsForValue().setIfAbsent(key, value, time, timeUnit);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–stringç±»å‹ç¼“å­˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (String) redisTemplate.opsForValue().get(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Boolean <span class="title function_">zAdd</span><span class="params">(String key, String value, Long score)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.opsForZSet().add(key, value, Double.valueOf(String.valueOf(score)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Long <span class="title function_">countZset</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.opsForZSet().size(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Set&lt;String&gt; <span class="title function_">rangeZset</span><span class="params">(String key, <span class="type">long</span> start, <span class="type">long</span> end)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.opsForZSet().range(key, start, end);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Long <span class="title function_">removeZset</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.opsForZSet().remove(key, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeZsetList</span><span class="params">(String key, Set&lt;String&gt; value)</span> &#123;</span><br><span class="line">    value.stream().forEach((val) -&gt; redisTemplate.opsForZSet().remove(key, val));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Double <span class="title function_">score</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.opsForZSet().score(key, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Set&lt;String&gt; <span class="title function_">rangeByScore</span><span class="params">(String key, <span class="type">long</span> start, <span class="type">long</span> end)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.opsForZSet().rangeByScore(key, Double.valueOf(String.valueOf(start)), Double.valueOf(String.valueOf(end)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">addScore</span><span class="params">(String key, Object obj, <span class="type">double</span> score)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.opsForZSet().incrementScore(key, obj, score);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">rank</span><span class="params">(String key, Object obj)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.opsForZSet().rank(key, obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ•°æ®åº“å¯†ç åŠ å¯†"><a href="#æ•°æ®åº“å¯†ç åŠ å¯†" class="headerlink" title="æ•°æ®åº“å¯†ç åŠ å¯†"></a>æ•°æ®åº“å¯†ç åŠ å¯†</h1><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">mEp5QZ5jrCO/G4PI+/K1C8jK9k8IzR3tr/R5TyLsGxE4dlkFcQs/UdVG/JKKnqVGG94F0dDC2w/SnFHP2CL39Q==</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql:/***?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=true</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="comment">#    druidé…ç½®</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">60000</span></span><br><span class="line">      <span class="attr">stat-view-servlet:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/druid/*</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">admin</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">stat:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">log-slow-sql:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">slow-sql-millis:</span> <span class="number">2000</span></span><br><span class="line">        <span class="attr">wall:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">config:</span></span><br><span class="line">        <span class="comment"># å¼€å¯é…ç½®</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">connection-properties:</span> <span class="string">config.decrypt=true;config.decrypt.key=$&#123;publicKey&#125;;</span> <span class="comment">#å¯†ç è§£å¯†</span></span><br><span class="line">  <span class="attr">publicKey:</span> <span class="string">MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAKhxct4yqOKXCvJO4NuTqhiszWmFVS+I6Zo6r2eqAqa2nQo4MniASZ3hvILYTi5v3o+jTxKchknMK6KXDUGtLhECAwEAAQ==</span>    </span><br></pre></td></tr></table></figure><p>ä¸è¿‡è¿™æ ·ç”±äºpublicKeyï¼ˆå…¬é’¥ï¼‰æ˜¯ç›´æ¥æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­çš„ï¼Œæ‰€ä»¥å®é™…è¿˜å¯èƒ½éœ€è¦å°†publicKeyå­˜åˆ°æŸä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œæˆ–è€…æ‰‹åŠ¨è¾“å…¥ã€‚</p><p>åŠ å¯†ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidEncryptUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String PRIVATEKEY;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String PUBLICKEY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String[] keyPair = ConfigTools.genKeyPair(<span class="number">512</span>);</span><br><span class="line">            PRIVATEKEY = keyPair[<span class="number">0</span>];</span><br><span class="line">            PUBLICKEY = keyPair[<span class="number">1</span>];</span><br><span class="line">            log.debug(<span class="string">&quot;private: &#123;&#125; public: &#123;&#125;&quot;</span>,PRIVATEKEY,PUBLICKEY);</span><br><span class="line"><span class="comment">//            System.out.println(&quot;private:&quot; + PRIVATEKEY + &quot;public: &quot; + PUBLICKEY);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchProviderException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encrypt</span><span class="params">(String plainText)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="comment">//        åŠ å¯†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">encrypt</span> <span class="operator">=</span> ConfigTools.encrypt(PRIVATEKEY, plainText);</span><br><span class="line">        log.debug(<span class="string">&quot;åŠ å¯†åï¼š&#123;&#125;&quot;</span>,encrypt);</span><br><span class="line"><span class="comment">//        System.out.println(&quot;åŠ å¯†åï¼š&quot; + encrypt);</span></span><br><span class="line">        <span class="keyword">return</span> encrypt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decrypt</span><span class="params">(String publicKey, String encryptText)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="comment">//        è§£å¯†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">decrypt</span> <span class="operator">=</span> ConfigTools.decrypt(publicKey, encryptText);</span><br><span class="line">        log.debug(<span class="string">&quot;è§£å¯†å: &#123;&#125;&quot;</span>,decrypt);</span><br><span class="line">        <span class="keyword">return</span> decrypt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="comment">//        è·å¾—åŠ å¯†åçš„ä»£ç ï¼Œä»¥åŠè§£ç å…¬é’¥</span></span><br><span class="line">        encrypt(<span class="string">&quot;****&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç»Ÿä¸€è¿”å›ç±»Result"><a href="#ç»Ÿä¸€è¿”å›ç±»Result" class="headerlink" title="ç»Ÿä¸€è¿”å›ç±»Result"></a>ç»Ÿä¸€è¿”å›ç±»Result</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">ok</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">        result.setSuccess(<span class="literal">true</span>);</span><br><span class="line">        result.setCode(ResultCodeEnums.SUCCESS.code);</span><br><span class="line">        result.setMessage(ResultCodeEnums.SUCCESS.desc);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result <span class="title function_">ok</span><span class="params">(T data)</span>&#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">        result.setSuccess(<span class="literal">true</span>);</span><br><span class="line">        result.setCode(ResultCodeEnums.SUCCESS.code);</span><br><span class="line">        result.setMessage(ResultCodeEnums.SUCCESS.desc);</span><br><span class="line">        result.setData(data);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">fail</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">        result.setSuccess(<span class="literal">false</span>);</span><br><span class="line">        result.setCode(ResultCodeEnums.FAIL.code);</span><br><span class="line">        result.setMessage(ResultCodeEnums.FAIL.desc);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result <span class="title function_">fail</span><span class="params">(T data)</span>&#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">        result.setSuccess(<span class="literal">false</span>);</span><br><span class="line">        result.setCode(ResultCodeEnums.FAIL.code);</span><br><span class="line">        result.setMessage(ResultCodeEnums.FAIL.desc);</span><br><span class="line">        result.setData(data);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>codeæšä¸¾ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ResultCodeEnums</span> &#123;</span><br><span class="line">    SUCCESS(<span class="number">200</span>,<span class="string">&quot;æˆåŠŸ&quot;</span>),</span><br><span class="line">    FAIL(<span class="number">500</span>,<span class="string">&quot;å¤±è´¥&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">public</span> String desc;</span><br><span class="line"></span><br><span class="line">    ResultCodeEnums(<span class="type">int</span> code,String desc)&#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResultCodeEnums <span class="title function_">GetEnumByCode</span><span class="params">(<span class="type">int</span> code)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(ResultCodeEnums resultCodeEnums : ResultCodeEnums.values())&#123;</span><br><span class="line">            <span class="keyword">if</span>(resultCodeEnums.code == code)&#123;</span><br><span class="line">                <span class="keyword">return</span> resultCodeEnums;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="log4jæ—¥å¿—é…ç½®æ–‡ä»¶"><a href="#log4jæ—¥å¿—é…ç½®æ–‡ä»¶" class="headerlink" title="log4jæ—¥å¿—é…ç½®æ–‡ä»¶"></a>log4jæ—¥å¿—é…ç½®æ–‡ä»¶</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Configurationåé¢çš„statusï¼Œè¿™ä¸ªç”¨äºè®¾ç½®log4j2è‡ªèº«å†…éƒ¨çš„ä¿¡æ¯è¾“å‡ºï¼Œå¯ä»¥ä¸è®¾ç½®ï¼Œå½“è®¾ç½®æˆtraceæ—¶ï¼Œä½ ä¼šçœ‹åˆ°log4j2å†…éƒ¨å„ç§è¯¦ç»†è¾“å‡º--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--monitorIntervalï¼šLog4jèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹ä¿®æ”¹é…ç½® æ–‡ä»¶å’Œé‡æ–°é…ç½®æœ¬èº«ï¼Œè®¾ç½®é—´éš”ç§’æ•°--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">status</span>=<span class="string">&quot;INFO&quot;</span> <span class="attr">monitorInterval</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¿—çº§åˆ«ä»¥åŠä¼˜å…ˆçº§æ’åº: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å˜é‡é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ ¼å¼åŒ–è¾“å‡ºï¼š%dateè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦ %msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- %logger&#123;36&#125; è¡¨ç¤º Logger åå­—æœ€é•¿36ä¸ªå­—ç¬¦ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_PATTERN&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%date&#123;HH:mm:ss.SSS&#125; %X&#123;PFTID&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å®šä¹‰æ—¥å¿—å­˜å‚¨çš„è·¯å¾„ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;FILE_PATH&quot;</span> <span class="attr">value</span>=<span class="string">&quot;../log&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;FILE_NAME&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jcClub.log&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--https://logging.apache.org/log4j/2.x/manual/appenders.html--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">console</span> <span class="attr">name</span>=<span class="string">&quot;Console&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--è¾“å‡ºæ—¥å¿—çš„æ ¼å¼--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;$&#123;LOG_PATTERN&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ§åˆ¶å°åªè¾“å‡ºlevelåŠå…¶ä»¥ä¸Šçº§åˆ«çš„ä¿¡æ¯ï¼ˆonMatchï¼‰ï¼Œå…¶ä»–çš„ç›´æ¥æ‹’ç»ï¼ˆonMismatchï¼‰--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;ACCEPT&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">console</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--æ–‡ä»¶ä¼šæ‰“å°å‡ºæ‰€æœ‰ä¿¡æ¯ï¼Œè¿™ä¸ªlogæ¯æ¬¡è¿è¡Œç¨‹åºä¼šè‡ªåŠ¨æ¸…ç©ºï¼Œç”±appendå±æ€§å†³å®šï¼Œé€‚åˆä¸´æ—¶æµ‹è¯•ç”¨--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">File</span> <span class="attr">name</span>=<span class="string">&quot;fileLog&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;FILE_PATH&#125;/temp.log&quot;</span> <span class="attr">append</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;$&#123;LOG_PATTERN&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">File</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- è¿™ä¸ªä¼šæ‰“å°å‡ºæ‰€æœ‰çš„infoåŠä»¥ä¸‹çº§åˆ«çš„ä¿¡æ¯ï¼Œæ¯æ¬¡å¤§å°è¶…è¿‡sizeï¼Œåˆ™è¿™sizeå¤§å°çš„æ—¥å¿—ä¼šè‡ªåŠ¨å­˜å…¥æŒ‰å¹´ä»½-æœˆä»½å»ºç«‹çš„æ–‡ä»¶å¤¹ä¸‹é¢å¹¶è¿›è¡Œå‹ç¼©ï¼Œä½œä¸ºå­˜æ¡£--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;RollingFileInfo&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;FILE_PATH&#125;/info.log&quot;</span> <span class="attr">filePattern</span>=<span class="string">&quot;$&#123;FILE_PATH&#125;/$&#123;FILE_NAME&#125;-INFO-%d&#123;yyyy-MM-dd&#125;_%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ§åˆ¶å°åªè¾“å‡ºlevelåŠä»¥ä¸Šçº§åˆ«çš„ä¿¡æ¯ï¼ˆonMatchï¼‰ï¼Œå…¶ä»–çš„ç›´æ¥æ‹’ç»ï¼ˆonMismatchï¼‰--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;ACCEPT&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;$&#123;LOG_PATTERN&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--intervalå±æ€§ç”¨æ¥æŒ‡å®šå¤šä¹…æ»šåŠ¨ä¸€æ¬¡ï¼Œé»˜è®¤æ˜¯1 hour--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;10MB&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- DefaultRolloverStrategyå±æ€§å¦‚ä¸è®¾ç½®ï¼Œåˆ™é»˜è®¤ä¸ºæœ€å¤šåŒä¸€æ–‡ä»¶å¤¹ä¸‹7ä¸ªæ–‡ä»¶å¼€å§‹è¦†ç›–--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">&quot;15&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- è¿™ä¸ªä¼šæ‰“å°å‡ºæ‰€æœ‰çš„warnåŠä»¥ä¸‹çº§åˆ«çš„ä¿¡æ¯ï¼Œæ¯æ¬¡å¤§å°è¶…è¿‡sizeï¼Œåˆ™è¿™sizeå¤§å°çš„æ—¥å¿—ä¼šè‡ªåŠ¨å­˜å…¥æŒ‰å¹´ä»½-æœˆä»½å»ºç«‹çš„æ–‡ä»¶å¤¹ä¸‹é¢å¹¶è¿›è¡Œå‹ç¼©ï¼Œä½œä¸ºå­˜æ¡£--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;RollingFileWarn&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;FILE_PATH&#125;/warn.log&quot;</span> <span class="attr">filePattern</span>=<span class="string">&quot;$&#123;FILE_PATH&#125;/$&#123;FILE_NAME&#125;-WARN-%d&#123;yyyy-MM-dd&#125;_%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ§åˆ¶å°åªè¾“å‡ºlevelåŠä»¥ä¸Šçº§åˆ«çš„ä¿¡æ¯ï¼ˆonMatchï¼‰ï¼Œå…¶ä»–çš„ç›´æ¥æ‹’ç»ï¼ˆonMismatchï¼‰--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;warn&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;ACCEPT&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;$&#123;LOG_PATTERN&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--intervalå±æ€§ç”¨æ¥æŒ‡å®šå¤šä¹…æ»šåŠ¨ä¸€æ¬¡ï¼Œé»˜è®¤æ˜¯1 hour--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;10MB&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- DefaultRolloverStrategyå±æ€§å¦‚ä¸è®¾ç½®ï¼Œåˆ™é»˜è®¤ä¸ºæœ€å¤šåŒä¸€æ–‡ä»¶å¤¹ä¸‹7ä¸ªæ–‡ä»¶å¼€å§‹è¦†ç›–--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">&quot;15&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- è¿™ä¸ªä¼šæ‰“å°å‡ºæ‰€æœ‰çš„erroråŠä»¥ä¸‹çº§åˆ«çš„ä¿¡æ¯ï¼Œæ¯æ¬¡å¤§å°è¶…è¿‡sizeï¼Œåˆ™è¿™sizeå¤§å°çš„æ—¥å¿—ä¼šè‡ªåŠ¨å­˜å…¥æŒ‰å¹´ä»½-æœˆä»½å»ºç«‹çš„æ–‡ä»¶å¤¹ä¸‹é¢å¹¶è¿›è¡Œå‹ç¼©ï¼Œä½œä¸ºå­˜æ¡£--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;RollingFileError&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;FILE_PATH&#125;/error.log&quot;</span> <span class="attr">filePattern</span>=<span class="string">&quot;$&#123;FILE_PATH&#125;/$&#123;FILE_NAME&#125;-ERROR-%d&#123;yyyy-MM-dd&#125;_%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ§åˆ¶å°åªè¾“å‡ºlevelåŠä»¥ä¸Šçº§åˆ«çš„ä¿¡æ¯ï¼ˆonMatchï¼‰ï¼Œå…¶ä»–çš„ç›´æ¥æ‹’ç»ï¼ˆonMismatchï¼‰--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">&quot;error&quot;</span> <span class="attr">onMatch</span>=<span class="string">&quot;ACCEPT&quot;</span> <span class="attr">onMismatch</span>=<span class="string">&quot;DENY&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;$&#123;LOG_PATTERN&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--intervalå±æ€§ç”¨æ¥æŒ‡å®šå¤šä¹…æ»šåŠ¨ä¸€æ¬¡ï¼Œé»˜è®¤æ˜¯1 hour--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;10MB&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- DefaultRolloverStrategyå±æ€§å¦‚ä¸è®¾ç½®ï¼Œåˆ™é»˜è®¤ä¸ºæœ€å¤šåŒä¸€æ–‡ä»¶å¤¹ä¸‹7ä¸ªæ–‡ä»¶å¼€å§‹è¦†ç›–--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">&quot;15&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--LoggerèŠ‚ç‚¹ç”¨æ¥å•ç‹¬æŒ‡å®šæ—¥å¿—çš„å½¢å¼ï¼Œæ¯”å¦‚è¦ä¸ºæŒ‡å®šåŒ…ä¸‹çš„classæŒ‡å®šä¸åŒçš„æ—¥å¿—çº§åˆ«ç­‰ã€‚--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç„¶åå®šä¹‰loggersï¼Œåªæœ‰å®šä¹‰äº†loggerå¹¶å¼•å…¥çš„appenderï¼Œappenderæ‰ä¼šç”Ÿæ•ˆ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;RollingFileInfo&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;RollingFileWarn&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;RollingFileError&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;fileLog&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="åˆ†é¡µå¤„ç†å°è£…ç±»"><a href="#åˆ†é¡µå¤„ç†å°è£…ç±»" class="headerlink" title="åˆ†é¡µå¤„ç†å°è£…ç±»"></a>åˆ†é¡µå¤„ç†å°è£…ç±»</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageResult</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">total</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">totalPages</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; result = Collections.emptyList();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRecords</span><span class="params">(List&lt;T&gt; result)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.result = result;</span><br><span class="line">        <span class="keyword">if</span>(result != <span class="literal">null</span> &amp;&amp; result.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            setTotal(result.size());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTotal</span><span class="params">(<span class="type">int</span> total)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.total = total;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.pageSize &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">this</span>.totalPages = total / <span class="built_in">this</span>.pageSize + (total % <span class="built_in">this</span>.pageSize == <span class="number">0</span>?<span class="number">0</span>:<span class="number">1</span> );</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.totalPages = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.start = (<span class="built_in">this</span>.pageSize &gt; <span class="number">0</span>?(<span class="built_in">this</span>.pageNo - <span class="number">1</span>) * <span class="built_in">this</span>.pageSize : <span class="number">0</span>) + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">this</span>.end = (<span class="built_in">this</span>.start - <span class="number">1</span> + <span class="built_in">this</span>.pageSize * (<span class="built_in">this</span>.pageNo &gt; <span class="number">0</span> ? <span class="number">1</span>:<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å‰äººæ ½æ ‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> å®æˆ˜ç»éªŒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rediså®æˆ˜</title>
      <link href="/2024/03/02/redis%E5%AE%9E%E6%88%98/"/>
      <url>/2024/03/02/redis%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<h1 id="Redisé¡¹ç›®å®æˆ˜"><a href="#Redisé¡¹ç›®å®æˆ˜" class="headerlink" title="Redisé¡¹ç›®å®æˆ˜"></a>Redisé¡¹ç›®å®æˆ˜</h1><h1 id="çŸ­ä¿¡éªŒè¯ç "><a href="#çŸ­ä¿¡éªŒè¯ç " class="headerlink" title="çŸ­ä¿¡éªŒè¯ç "></a>çŸ­ä¿¡éªŒè¯ç </h1><h2 id="å‘é€éªŒè¯ç "><a href="#å‘é€éªŒè¯ç " class="headerlink" title="å‘é€éªŒè¯ç "></a>å‘é€éªŒè¯ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€æ‰‹æœºéªŒè¯ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;code&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">sendCode</span><span class="params">(<span class="meta">@RequestParam(&quot;phone&quot;)</span> String phone, HttpSession session)</span> &#123;</span><br><span class="line">        <span class="comment">// TODO å‘é€çŸ­ä¿¡éªŒè¯ç å¹¶ä¿å­˜éªŒè¯ç </span></span><br><span class="line"><span class="comment">//        éªŒè¯æ‰‹æœºå·æ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isPhoneInvalid</span> <span class="operator">=</span> RegexUtils.isPhoneInvalid(phone);</span><br><span class="line">        <span class="keyword">if</span>(isPhoneInvalid)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;è¯·è¾“å…¥æ­£ç¡®æ‰‹æœºå·&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        è·å–code,å¹¶ä¿å­˜session</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> userService.getCode(phone);</span><br><span class="line">        session.setAttribute(phone,code);</span><br><span class="line"><span class="comment">//        æ¨¡æ‹Ÿå‘é€éªŒè¯ç </span></span><br><span class="line">        log.debug(<span class="string">&quot;éªŒè¯ç ï¼š&#123;&#125;&quot;</span>,code);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">(String phone)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [phone]</span></span><br><span class="line"><span class="comment">         * ç™»å½•çš„æ‰‹æœºå·</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> java.lang.String</span></span><br><span class="line"><span class="comment">         * ç”Ÿæˆçš„éªŒè¯ç </span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"><span class="comment">//        è°ƒç”¨hutoolçš„å·¥å…·ï¼Œéšæœºç”Ÿæˆ6ä½éªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span>  <span class="operator">=</span> RandomUtil.randomNumbers(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="æ ¡éªŒéªŒè¯ç "><a href="#æ ¡éªŒéªŒè¯ç " class="headerlink" title="æ ¡éªŒéªŒè¯ç "></a>æ ¡éªŒéªŒè¯ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç™»å½•åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> loginForm ç™»å½•å‚æ•°ï¼ŒåŒ…å«æ‰‹æœºå·ã€éªŒè¯ç ï¼›æˆ–è€…æ‰‹æœºå·ã€å¯†ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginFormDTO loginForm, HttpSession session)</span>&#123;</span><br><span class="line">    <span class="comment">// TODO å®ç°ç™»å½•åŠŸèƒ½</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> userService.login(loginForm,session);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [loginForm, session]</span></span><br><span class="line"><span class="comment">         * å‰ç«¯ä¼ å…¥çš„ç™»å½•ä¿¡æ¯ï¼Œè¿˜æœ‰æœåŠ¡ç«¯ä¿å­˜çš„session</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> java.lang.String</span></span><br><span class="line"><span class="comment">         * è¿”å›ä¿¡æ¯</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"><span class="comment">//        è·å–sessionå¹¶æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> loginForm.getPhone();</span><br><span class="line">        <span class="comment">//        è·å–sessionä¸­çš„code</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">code</span> <span class="operator">=</span> session.getAttribute(phone);</span><br><span class="line">        <span class="keyword">if</span>(code == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·ä¸ä¸€è‡´&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            code = code.toString();</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        è·å–å‰ç«¯è¾“å…¥çš„éªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">inCode</span> <span class="operator">=</span> loginForm.getCode();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!inCode.equals(code))&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;éªŒè¯ç æœ‰è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(User::getPhone,phone);</span><br><span class="line">        <span class="type">User</span> <span class="variable">one</span> <span class="operator">=</span> iUserService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(one == <span class="literal">null</span>)&#123;</span><br><span class="line"><span class="comment">//            ä¸å­˜åœ¨åˆ™åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            user.setPhone(phone);</span><br><span class="line"><span class="comment">//            è®¾ç½®æ˜µç§°</span></span><br><span class="line">            user.setNickName(USER_NICK_NAME_PREFIX + RandomUtil.randomString(<span class="number">10</span>));</span><br><span class="line">            iUserService.save(user);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//            do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//            ä¿å­˜session</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> iUserService.getOne(queryWrapper);</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>(u.getId(), u.getNickName(), u.getIcon());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;user&quot;</span>,userDTO);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="ç™»å½•æ‹¦æˆªå™¨"><a href="#ç™»å½•æ‹¦æˆªå™¨" class="headerlink" title="ç™»å½•æ‹¦æˆªå™¨"></a>ç™»å½•æ‹¦æˆªå™¨</h1><h2 id="æ–°å»ºæ‹¦æˆªå™¨ç±»"><a href="#æ–°å»ºæ‹¦æˆªå™¨ç±»" class="headerlink" title="æ–°å»ºæ‹¦æˆªå™¨ç±»"></a>æ–°å»ºæ‹¦æˆªå™¨ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœè¯·æ±‚ä¸æ˜¯æ˜ å°„åˆ°æ–¹æ³•ç›´æ¥é€šè¿‡</span></span><br><span class="line">        <span class="keyword">if</span>(!(handler <span class="keyword">instanceof</span> HandlerMethod))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        è·å–session</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"><span class="comment">//        ä»sessionè·å¾—ç”¨æˆ·</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line"><span class="comment">//            ä¸å­˜åœ¨ï¼Œç›´æ¥æ‹¦æˆª</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;è¯·å…ˆç™»å½•ï¼&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//        å­˜åœ¨åˆ™ä¿å­˜åˆ°ç”¨æˆ·è¿›ç¨‹</span></span><br><span class="line">            UserHolder.saveUser((User)user);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»sessionä¸­è·å–ç™»å½•ä¿¡æ¯ï¼Œå¦‚æœå·²ç™»å½•åˆ™sessionä¸­ä¼šå­˜åœ¨user</p><h2 id="é…ç½®æ‹¦æˆªå™¨"><a href="#é…ç½®æ‹¦æˆªå™¨" class="headerlink" title="é…ç½®æ‹¦æˆªå™¨"></a>é…ç½®æ‹¦æˆªå™¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                .excludePathPatterns(</span><br><span class="line">                    <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/login&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;shop-type/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/upload/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/voucher/**&quot;</span></span><br><span class="line">                );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="é›†ç¾¤sessionå…±äº«é—®é¢˜"><a href="#é›†ç¾¤sessionå…±äº«é—®é¢˜" class="headerlink" title="é›†ç¾¤sessionå…±äº«é—®é¢˜"></a>é›†ç¾¤sessionå…±äº«é—®é¢˜</h1><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>å½“å¤„åœ¨é›†ç¾¤é¡¹ç›®ä¸­æ—¶ä¼šå‡ºç°ä¸‹é¢è¿™ç§æƒ…å†µï¼š<br>å½“æˆåŠŸè®¿é—®è´Ÿè´£ç™»å½•åŠŸèƒ½çš„æœåŠ¡å™¨æ—¶ï¼ŒæˆåŠŸå°†sessionä¿å­˜åœ¨è¯¥æœåŠ¡å™¨ã€‚ä½†åœ¨è®¿é—®å…¶ä»–åŠŸèƒ½æ—¶ï¼Œç”±äºæ‰€å¤„æœåŠ¡å™¨ä¸åŒï¼Œç›®æ ‡æœåŠ¡å™¨å¹¶æ²¡æœ‰ä¿å­˜äº†æˆ‘ä»¬ç™»å½•ä¿¡æ¯çš„sessionï¼Œæˆ‘ä»¬ä¼šè¢«æ‹¦æˆªå™¨æœæ–­â€œè¸¢â€ä¸‹çº¿ï¼Œä½†è¦è®©æˆ‘ä»¬æ¯ä¸ªæœåŠ¡å™¨éƒ½ç™»å½•ä¸€æ¬¡ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚</p><p>è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨radisä½œä¸ºä¸€ä¸ªå…¬å…±çš„æ•°æ®åº“</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403022321833.png" alt="image-20240302232148785"></p><h2 id="redisä»£æ›¿session"><a href="#redisä»£æ›¿session" class="headerlink" title="redisä»£æ›¿session"></a>redisä»£æ›¿session</h2><p>å°†ç™»å½•ä¿¡æ¯å­˜åˆ°redisï¼Œè¿™æ ·è¯·æ±‚æ¯ä¸ªæœåŠ¡å™¨çš„èµ„æºæ—¶ï¼Œåªéœ€è¦è®¿é—®redisæœåŠ¡å™¨æ ¹æ®keyè·å–ä¿¡æ¯ï¼Œå°±å¯ä»¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        è·å–code,å¹¶ä¿å­˜session</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> userService.getCode(phone);</span><br><span class="line"><span class="comment">//        ä¿å­˜sessionåˆ°redisï¼Œkeyæ˜¯å‰ç¼€åŠ ç”µè¯å·ç çš„å½¢å¼ï¼ŒåŠ å‰ç¼€æ˜¯ä¸ºäº†é˜²æ­¢ä¸åŒä¸šåŠ¡ä¹‹é—´å¯èƒ½é€ æˆè¦†ç›–ï¼Œ</span></span><br><span class="line"><span class="comment">//        è¿‡æœŸæ—¶é—´è¿˜æœ‰å‰ç¼€éƒ½æ˜¯ä½¿ç”¨å¸¸é‡ï¼Œå¾ˆä¼˜é›…</span></span><br><span class="line">        redisTemplate.opsForValue().set(LOGIN_CODE_KEY + phone,code,LOGIN_CODE_TTL, TimeUnit.MINUTES);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [loginForm, session]</span></span><br><span class="line"><span class="comment">         * å‰ç«¯ä¼ å…¥çš„ç™»å½•ä¿¡æ¯ï¼Œè¿˜æœ‰æœåŠ¡ç«¯ä¿å­˜çš„session</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> java.lang.String</span></span><br><span class="line"><span class="comment">         * è¿”å›ä¿¡æ¯</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"><span class="comment">////        è·å–sessionå¹¶æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line"><span class="comment">//        String phone = loginForm.getPhone();</span></span><br><span class="line"><span class="comment">//        //        è·å–sessionä¸­çš„code</span></span><br><span class="line"><span class="comment">//        Object code = session.getAttribute(phone);</span></span><br><span class="line"><span class="comment">//       è·å–æ‰‹æœºå·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> loginForm.getPhone();</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> redisTemplate.opsForValue().get(LOGIN_CODE_KEY + phone);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        é€šè¿‡radisè·å–code</span></span><br><span class="line">        <span class="keyword">if</span>(code == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·ä¸ä¸€è‡´&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        è·å–å‰ç«¯è¾“å…¥çš„éªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">inCode</span> <span class="operator">=</span> loginForm.getCode();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!inCode.equals(code))&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;éªŒè¯ç æœ‰è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(User::getPhone,phone);</span><br><span class="line">        <span class="type">User</span> <span class="variable">one</span> <span class="operator">=</span> iUserService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(one == <span class="literal">null</span>)&#123;</span><br><span class="line"><span class="comment">//            ä¸å­˜åœ¨åˆ™åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            user.setPhone(phone);</span><br><span class="line"><span class="comment">//            è®¾ç½®æ˜µç§°</span></span><br><span class="line">            user.setNickName(USER_NICK_NAME_PREFIX + RandomUtil.randomString(<span class="number">10</span>));</span><br><span class="line">            iUserService.save(user);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//            do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//            ä¿å­˜session</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> iUserService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        UserDTO userDTO = new UserDTO(u.getId(), u.getNickName(), u.getIcon());</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(u,UserDTO.class);</span><br><span class="line"><span class="comment">//        session.setAttribute(&quot;user&quot;,userDTO);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        ç”Ÿæˆéšæœºtokenï¼Œä½œä¸ºä»¤ç‰Œï¼Œè¿˜æœ‰redisä¸­çš„key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> UUID.randomUUID().toString(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">tokenkey</span> <span class="operator">=</span> LOGIN_USER_KEY + token; <span class="comment">//ä¹Ÿä½¿ç”¨å¸¸é‡æ‹¼è£…çš„æ–¹å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        å°†å¯¹è±¡è½¬ä¸ºmapæ ¼å¼</span></span><br><span class="line">        Map&lt;String, Object&gt; map = BeanUtil.beanToMap(userDTO);</span><br><span class="line"><span class="comment">//      å°†mapä¸­çš„å€¼å…¨å˜string,å¦åˆ™åœ¨ä½¿ç”¨stringrediså­˜å‚¨æ—¶ä¼šæŠ¥ç±»å‹è½¬æ¢é”™è¯¯</span></span><br><span class="line">        map.forEach((key, value) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != value) map.put(key, String.valueOf(value));</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="comment">//        å­˜å‚¨åˆ°redis</span></span><br><span class="line">        redisTemplate.opsForHash().putAll(tokenkey,map);</span><br><span class="line"><span class="comment">//        è®¾ç½®æœ‰æ•ˆæœŸ</span></span><br><span class="line">        redisTemplate.expire(tokenkey,LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        tokenè¿”å›å‰ç«¯ï¼Œä½œä¸ºä»¤ç‰Œ</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(token);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªå‘ï¼Œç”±äºæˆ‘ä»¬ç”¨çš„æ˜¯StringRedisTemplateï¼Œåœ¨å­˜å‚¨éstringæ—¶ä¼šè‡ªåŠ¨è½¬æ¢ï¼Œè¿™æ—¶å¯èƒ½ä¼šå‡ºç°è½¬æ¢é”™è¯¯ï¼ˆLongæ— æ³•è½¬æ¢ä¸ºStringï¼‰,å› æ­¤éœ€è¦æå‰å¯¹mapå¤„ç†ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//      å°†mapä¸­çš„å€¼å…¨å˜string,å¦åˆ™åœ¨ä½¿ç”¨stringrediså­˜å‚¨æ—¶ä¼šæŠ¥ç±»å‹è½¬æ¢é”™è¯¯</span></span><br><span class="line">        map.forEach((key, value) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != value) map.put(key, String.valueOf(value));</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><h2 id="æ‹¦æˆªå™¨ç™»å½•éªŒè¯"><a href="#æ‹¦æˆªå™¨ç™»å½•éªŒè¯" class="headerlink" title="æ‹¦æˆªå™¨ç™»å½•éªŒè¯"></a>æ‹¦æˆªå™¨ç™»å½•éªŒè¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        è·å–token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isBlank(token))&#123;</span><br><span class="line"><span class="comment">//            tokenä¸å­˜åœ¨ï¼Œè¯´æ˜æœªç™»å½•</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æœªæºå¸¦token&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        åŸºäºtokenï¼Œè·å–redisä¸­çš„æ•°æ®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> LOGIN_USER_KEY + token;</span><br><span class="line">        Map&lt;Object, Object&gt; user = redisTemplate.opsForHash().entries(key);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//            è½¬æ¢mapä¸ºå¯¹è±¡ï¼Œç„¶åå­˜å‚¨</span></span><br><span class="line">            <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(user, <span class="keyword">new</span> <span class="title class_">UserDTO</span>(), <span class="literal">false</span>);</span><br><span class="line">            <span class="comment">//        å­˜åœ¨åˆ™ä¿å­˜åˆ°ç”¨æˆ·è¿›ç¨‹</span></span><br><span class="line">            log.debug(userDTO.toString());</span><br><span class="line">            UserHolder.saveUser(userDTO);</span><br><span class="line"><span class="comment">//        é‡ç½®æœ‰æ•ˆæœŸ</span></span><br><span class="line">            redisTemplate.expire(key,<span class="number">36000L</span>, TimeUnit.MINUTES);</span><br></pre></td></tr></table></figure><h2 id="ä¼˜åŒ–æ‹¦æˆªå™¨"><a href="#ä¼˜åŒ–æ‹¦æˆªå™¨" class="headerlink" title="ä¼˜åŒ–æ‹¦æˆªå™¨"></a>ä¼˜åŒ–æ‹¦æˆªå™¨</h2><p>ç›®å‰æˆ‘ä»¬çš„æ‹¦æˆªå™¨åªå¯¹éä¸€äº›éœ€è¦ç™»å½•æ ¡éªŒçš„ç½‘é¡µè¿›è¡Œæ‹¦æˆªï¼ŒåŒæ—¶å»¶é•¿ä»–ä»¬tokençš„æœ‰æ•ˆæ—¶é—´ï¼Œä½†æ˜¯å¦‚æœå‡ºç°ç”¨æˆ·ä¸€ç›´è®¿é—®ä¸€äº›ä¸éœ€è¦æ ¡éªŒçš„ï¼Œé‚£å°±ä¸€ç›´æ²¡æœ‰è¿›è¡Œæ‹¦æˆªå¹¶å»¶é•¿æœ‰æ•ˆæœŸã€‚å…¶å®å»¶é•¿tokençš„æœ‰æ•ˆæœŸåº”è¯¥æ˜¯ç”¨æˆ·æ¯æ¬¡è®¿é—®éƒ½è¦å»¶é•¿ï¼Œä¸è®ºè®¿é—®çš„æ˜¯ä»€ä¹ˆèµ„æºï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å†åŠ ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œç”¨æ¥æ‹¦æˆªå…¨éƒ¨è¯·æ±‚ï¼Œå¹¶åœ¨è¿™ä¸ªæ‹¦æˆªå™¨é‡Œé¢å»¶é•¿tokenæœ‰æ•ˆæœŸï¼Œè€Œåœ¨loginæ‹¦æˆªå™¨ä¸­åªè¿›è¡Œç™»å½•æ ¡éªŒã€‚</p><p>æ‹¦æˆªå™¨ä¸€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefreshTokenInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœè¯·æ±‚ä¸æ˜¯æ˜ å°„åˆ°æ–¹æ³•ç›´æ¥é€šè¿‡</span></span><br><span class="line">        <span class="keyword">if</span>(!(handler <span class="keyword">instanceof</span> HandlerMethod))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        è·å–token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isBlank(token))&#123;</span><br><span class="line"><span class="comment">//            tokenä¸å­˜åœ¨ï¼Œè¯´æ˜æœªç™»å½•</span></span><br><span class="line"><span class="comment">//            throw new RuntimeException(&quot;æœªæºå¸¦token&quot;);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        åŸºäºtokenï¼Œè·å–redisä¸­çš„æ•°æ®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> LOGIN_USER_KEY + token;</span><br><span class="line">        Map&lt;Object, Object&gt; user = redisTemplate.opsForHash().entries(key);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(user.isEmpty())&#123;</span><br><span class="line"><span class="comment">//            ä¸å­˜åœ¨ï¼Œç›´æ¥æ‹¦æˆª</span></span><br><span class="line"><span class="comment">//            throw new RuntimeException(&quot;è¯·å…ˆç™»å½•ï¼&quot;);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//            è½¬æ¢mapä¸ºå¯¹è±¡ï¼Œç„¶åå­˜å‚¨</span></span><br><span class="line">            <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(user, <span class="keyword">new</span> <span class="title class_">UserDTO</span>(), <span class="literal">false</span>);</span><br><span class="line">            <span class="comment">//        å­˜åœ¨åˆ™ä¿å­˜åˆ°ç”¨æˆ·è¿›ç¨‹</span></span><br><span class="line">            log.debug(userDTO.toString());</span><br><span class="line">            UserHolder.saveUser(userDTO);</span><br><span class="line"><span class="comment">//        é‡ç½®æœ‰æ•ˆæœŸ</span></span><br><span class="line">            redisTemplate.expire(key,<span class="number">36000L</span>, TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹¦æˆªå™¨äºŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    public LoginInterceptor(StringRedisTemplate redisTemplate) &#123;</span></span><br><span class="line"><span class="comment">//        this.redisTemplate = redisTemplate;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœè¯·æ±‚ä¸æ˜¯æ˜ å°„åˆ°æ–¹æ³•ç›´æ¥é€šè¿‡</span></span><br><span class="line">        <span class="keyword">if</span>(!(handler <span class="keyword">instanceof</span> HandlerMethod))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(UserHolder.getUser() == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;è¯·å…ˆç™»å½•&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°åŠ å…¥çš„æ‹¦æˆªå™¨æ²¡æœ‰æ‹¦æˆªåŠŸèƒ½ï¼Œä½†é€šè¿‡é€»è¾‘åˆ¤æ–­å‡ºæœªç™»å½•ï¼Œåˆ™ä¸ä¼šå‘UserHandleä¸­æ·»åŠ ç”¨æˆ·è¿›ç¨‹ï¼Œè¿™æ ·å¦‚æœç”¨æˆ·è¦éæ³•è®¿é—®ä¸€äº›éœ€è¦ç™»å½•éªŒè¯å¾—åœ°å€ï¼Œé‚£ä¹ˆä¼šåœ¨ç¬¬äºŒä¸ªæ‹¦æˆªå™¨è¢«æ‹¦ä¸‹ï¼Œå¦‚æœç”¨æˆ·æœ¬èº«å°±è¦è®¿é—®ä¸€äº›ä¸éœ€è¦éªŒè¯çš„ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨æ”¾è¡Œåï¼Œå¹¶ä¸ä¼šè¿›å…¥ç¬¬äºŒä¸ªæ‹¦æˆªå™¨ï¼ˆå› ä¸ºç¬¬äºŒä¸ªæ‹¦æˆªå™¨è§„å®šäº†æ‹¦æˆªåœ°å€ï¼‰</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403031359129.png" alt="image-20240303135930012"></p><h1 id="åŠ å…¥redisç¼“å­˜"><a href="#åŠ å…¥redisç¼“å­˜" class="headerlink" title="åŠ å…¥redisç¼“å­˜"></a>åŠ å…¥redisç¼“å­˜</h1><p>æ‰‹åŠ¨å®ç°ç¼“å­˜æ— éå°±æ˜¯ä»¥ä¸‹å‡ ç‚¹æ­¥éª¤ï¼š</p><ol><li>æ ¹æ®keyæŸ¥è¯¢ç¼“å­˜</li><li>å¦‚æœç¼“å­˜ä¸­å­˜åœ¨æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›</li><li>ä¸å­˜åœ¨åˆ™åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢</li><li>æŸ¥è¯¢ä¸åˆ°å°±æŠ¥é”™</li><li>æŸ¥è¯¢åˆ°ä¿¡æ¯åˆ™ä¿å­˜åˆ°redis</li><li>è¿”å›æ•°æ®</li></ol><h2 id="åº—é“ºä¿¡æ¯ç¼“å­˜"><a href="#åº—é“ºä¿¡æ¯ç¼“å­˜" class="headerlink" title="åº—é“ºä¿¡æ¯ç¼“å­˜"></a>åº—é“ºä¿¡æ¯ç¼“å­˜</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> Shop <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CACHE_SHOP_KEY + id;</span><br><span class="line"><span class="comment">//        æŸ¥è¯¢åº—é“ºç¼“å­˜</span></span><br><span class="line">        Map&lt;Object, Object&gt; map = redisTemplate.opsForHash().entries(key);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!map.isEmpty())&#123;</span><br><span class="line">            <span class="comment">//        å‘½ä¸­åˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(map, <span class="keyword">new</span> <span class="title class_">Shop</span>(), <span class="literal">false</span>);</span><br><span class="line">            <span class="keyword">return</span> shop;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> getById(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(shop ==  <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//        æ•°æ®åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›é”™è¯¯</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åº—é“ºä¿¡æ¯æœ‰è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        å°†æ•°æ®ä¿å­˜åˆ°ç¼“å­˜</span></span><br><span class="line">        Map&lt;String, Object&gt; mapshop = BeanUtil.beanToMap(shop);</span><br><span class="line">        mapshop.forEach((k,value) -&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != value) mapshop.put(k, String.valueOf(value));</span><br><span class="line">        &#125;);</span><br><span class="line">        redisTemplate.opsForHash().putAll(key,mapshop);</span><br><span class="line">        redisTemplate.expire(key,CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line"><span class="comment">//        è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> shop;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å®ç°ç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´"><a href="#å®ç°ç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´" class="headerlink" title="å®ç°ç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´"></a>å®ç°ç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´</h2><p>ç®€å•å®ç°ï¼š<br>åœ¨è¿›è¡Œæ›´æ–°æ•°æ®åº“æ“ä½œæ—¶ï¼Œåœ¨æ•°æ®åº“æ›´æ–°åå°±åˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œè¿™æ ·åœ¨ä¸‹æ¬¡è®¿é—®æ—¶ä¼šå°†æ–°çš„æ•°æ®æ”¾å…¥ç¼“å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Shop shop)</span> &#123;</span><br><span class="line"></span><br><span class="line">    updateById(shop);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> shop.getId();</span><br><span class="line"></span><br><span class="line">    redisTemplate.delete(CACHE_SHOP_KEY + id);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¼“å­˜çƒ­ç‚¹é—®é¢˜"><a href="#ç¼“å­˜çƒ­ç‚¹é—®é¢˜" class="headerlink" title="ç¼“å­˜çƒ­ç‚¹é—®é¢˜"></a>ç¼“å­˜çƒ­ç‚¹é—®é¢˜</h1><h2 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h2><p>å½“ç”¨æˆ·æŸ¥è¯¢ä¸€ä¸ªä¸ä¼šå­˜åœ¨çš„æ•°æ®ï¼Œæ¯”å¦‚nullï¼Œé‚£è¯¥è¯·æ±‚ä¸€å®šä¼šç»•è¿‡redisç„¶åç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå½“è¿™æ ·çš„è¯·æ±‚è¶³å¤Ÿå¤šæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®åº“å´©æºƒã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆä¸€ï¼šç¼“å­˜ç©ºå¯¹è±¡"><a href="#è§£å†³æ–¹æ¡ˆä¸€ï¼šç¼“å­˜ç©ºå¯¹è±¡" class="headerlink" title="è§£å†³æ–¹æ¡ˆä¸€ï¼šç¼“å­˜ç©ºå¯¹è±¡"></a>è§£å†³æ–¹æ¡ˆä¸€ï¼šç¼“å­˜ç©ºå¯¹è±¡</h3><p>å³å½“åœ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾ä¸€ä¸ªä¸ºnullçš„å¯¹è±¡æ—¶ï¼Œæ•°æ®åº“è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œç„¶åå°†æ­¤ç©ºå¯¹è±¡å­˜å…¥ç¼“å­˜ï¼Œè¿™æ ·çŸ­æœŸå†…å†æ”¶åˆ°ç±»ä¼¼è¯·æ±‚æ—¶ï¼Œå°±ä¼šåœ¨ç¼“å­˜ä¸­å‘½ä¸­ã€‚</p><p>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç»´æŠ¤æ–¹ä¾¿</p><p>ç¼ºç‚¹ï¼šé¢å¤–å†…å­˜æ¶ˆè€—ï¼Œå¯èƒ½é€ æˆçŸ­æœŸçš„ä¸ä¸€è‡´</p><h3 id="è§£å†³æ–¹æ¡ˆäºŒï¼šå¸ƒéš†è¿‡æ»¤"><a href="#è§£å†³æ–¹æ¡ˆäºŒï¼šå¸ƒéš†è¿‡æ»¤" class="headerlink" title="è§£å†³æ–¹æ¡ˆäºŒï¼šå¸ƒéš†è¿‡æ»¤"></a>è§£å†³æ–¹æ¡ˆäºŒï¼šå¸ƒéš†è¿‡æ»¤</h3><p>å³åœ¨å®¢æˆ·ç«¯å’Œç¼“å­˜ä¹‹é—´åŠ ä¸€å±‚è¿‡æ»¤å™¨ï¼Œç”¨ä»¥æ‹¦æˆªæ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„æ•°æ®ï¼Œå®ƒæ˜¯åŸºäºæŸç§å“ˆå¸Œç®—æ³•å°†æ•°æ®åº“ä¸­çš„æ•°æ®å­˜åœ¨ä¸å¦å­˜å‚¨ä¸­ã€‚</p><p>ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨å°‘ï¼Œæ²¡æœ‰å¤šä½™key</p><p>ç¼ºç‚¹ï¼šå®ç°è¾ƒä¸ºå¤æ‚ï¼Œä¸”å­˜åœ¨è¯¯åˆ¤</p><h2 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h2><p>ç¼“å­˜é›ªå´©æŒ‡çš„æ˜¯åœ¨çŸ­æ—¶é—´å†…ï¼Œå¤§é‡çš„ç¼“å­˜å¤±æ•ˆæˆ–è€…æ˜¯rediså®•æœºï¼Œå¯¼è‡´å¤§é‡çš„è¯·æ±‚ç›´æ¥åˆ°è¾¾æ•°æ®åº“ï¼Œå¸¦æ¥å·¨å¤§å‹åŠ›</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>ç»™ä¸åŒçš„keyæ·»åŠ ä¸åŒçš„æœ‰æ•ˆæ—¶é—´</li><li>ä½¿ç”¨redisé›†ç¾¤</li><li>ç¼“å­˜ä¸šåŠ¡é™çº§ç­–ç•¥ï¼šå°±æ˜¯å½“å‘ç”Ÿäº‹æ•…æ—¶ï¼Œå¯ä»¥é™åˆ¶è¯·æ±‚æ•°é‡æˆ–è€…å¹²è„†æ‹’ç»è¯·æ±‚ï¼Œä»¥æ­¤æ¥ä¿æŠ¤æ•°æ®åº“ã€‚</li><li>å¤šçº§ç¼“å­˜</li></ol><h2 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h2><p>åˆç§°çƒ­ç‚¹Keyé—®é¢˜ï¼Œæ˜¯ä¸€ä¸ªè¢«é«˜å¹¶å‘è®¿é—®å¹¶ä¸”ç¼“å­˜é‡å»ºä¸šåŠ¡è¾ƒå¤æ‚çš„keyå¤±æ•ˆäº†ã€‚</p><h3 id="æ–¹æ¡ˆä¸€ï¼šäº’æ–¥é”"><a href="#æ–¹æ¡ˆä¸€ï¼šäº’æ–¥é”" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šäº’æ–¥é”"></a>æ–¹æ¡ˆä¸€ï¼šäº’æ–¥é”</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403031907423.png" alt="image-20240303190741313"></p><p>å³å½“å‘ç”Ÿç¼“å­˜æœªå‘½ä¸­çš„æƒ…å†µæ—¶ï¼Œç¬¬ä¸€ä¸ªå‘ç°çš„è¿›ç¨‹è¯·æ±‚åˆ°äº’æ–¥é”ï¼Œç„¶åè¿›è¡Œç¼“å­˜é‡å»ºï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¦‚æœæœ‰å…¶ä»–è¯·æ±‚åˆ°æ¥ä¹Ÿæƒ³é‡å»ºè¿›ç¨‹ï¼Œç”±äºäº’æ–¥é”çš„åŸå› ï¼Œåæ¥çš„è¿›ç¨‹åªèƒ½è¿›è¡Œå¾ªç¯ç­‰å¾…ã€‚</p><p>ä¼˜ç‚¹ï¼šçœå†…å­˜ï¼Œä¿è¯ä¸€è‡´æ€§ï¼Œå®ç°ç®€å•</p><p>ç¼ºç‚¹ï¼šçº¿ç¨‹ç­‰å¾…ï¼Œæ€§èƒ½å—å½±å“ï¼Œæœ‰æ­»é”é£é™©</p><h3 id="æ–¹æ¡ˆäºŒï¼šé€»è¾‘è¿‡æœŸ"><a href="#æ–¹æ¡ˆäºŒï¼šé€»è¾‘è¿‡æœŸ" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šé€»è¾‘è¿‡æœŸ"></a>æ–¹æ¡ˆäºŒï¼šé€»è¾‘è¿‡æœŸ</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403031910567.png" alt="image-20240303191038492"></p><p>é¦–å…ˆè¿™ç§æ–¹æ³•ä¸ä¼šå‡ºç°ç¼“å­˜å‡»ç©¿çš„é—®é¢˜ï¼Œå› ä¸ºç¼“å­˜ä¸ä¼šè‡ªåŠ¨é”€æ¯ï¼Œæ‰€ä»¥é™¤äº†ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œå…¶ä»–ä¸€å®šä¼šå‘½ä¸­ã€‚å½“è¯·æ±‚æ—¶å‘ç°éœ€è¦çš„æ•°æ®å·²ç»è¿‡æœŸï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹ä¼šè·å¾—äº’æ–¥é”å¹¶è°ƒç”¨ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹æ¥æ›´æ–°ç¼“å­˜ï¼Œè¿™æ ·è‡ªå·±ä¹Ÿæ— éœ€ç­‰å¾…ï¼Œç›´æ¥è¿”å›æ—§çš„æ•°æ®ã€‚ï¼ˆç±»ä¼¼äºæŠ¢ç¥¨æ—¶ï¼Œè™½ç„¶ç”¨æˆ·è¿˜èƒ½çœ‹åˆ°æœ‰ç¥¨ï¼Œä½†æ˜¯å®é™…ä¸Šå·²ç»æ²¡ç¥¨äº†ï¼Œç”¨æˆ·çœ‹åˆ°çš„æ˜¯æ—§æ•°æ®ï¼‰</p><p>ä¼˜ç‚¹ï¼šæ€§èƒ½å¥½</p><p>ç¼ºç‚¹ï¼šä¸ä¿è¯ä¸€è‡´æ€§ï¼Œæœ‰é¢å¤–å†…å­˜æ¶ˆè€—ï¼Œå®ç°è¾ƒå¤æ‚</p><h2 id="ç¼“å­˜å‡»ç©¿æ¡ˆä¾‹"><a href="#ç¼“å­˜å‡»ç©¿æ¡ˆä¾‹" class="headerlink" title="ç¼“å­˜å‡»ç©¿æ¡ˆä¾‹"></a>ç¼“å­˜å‡»ç©¿æ¡ˆä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> Shop <span class="title function_">hcjc</span><span class="params">(Long id)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CACHE_SHOP_KEY + id;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lock_key</span> <span class="operator">=</span> LOCK_SHOP_KEY + id;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">t</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">while</span>(t)&#123;</span><br><span class="line"><span class="comment">//      æ­»å¾ªç¯ç­‰å¾…</span></span><br><span class="line"><span class="comment">//        æŸ¥è¯¢åº—é“ºç¼“å­˜</span></span><br><span class="line">                Map&lt;Object, Object&gt; map = redisTemplate.opsForHash().entries(key);</span><br><span class="line"></span><br><span class="line"><span class="comment">//            if(map == null)&#123;</span></span><br><span class="line"><span class="comment">//                throw new RuntimeException(&quot;å‘½ä¸­ç©ºæ•°æ®&quot;);</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(!map.isEmpty())&#123;</span><br><span class="line">                    <span class="comment">//        å‘½ä¸­åˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">                    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(map, <span class="keyword">new</span> <span class="title class_">Shop</span>(), <span class="literal">false</span>);</span><br><span class="line">                    <span class="keyword">return</span> shop;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="comment">//        æœªå‘½ä¸­ï¼Œåˆ™è·å–äº’æ–¥é”</span></span><br><span class="line"></span><br><span class="line">                <span class="type">boolean</span> <span class="variable">tag</span> <span class="operator">=</span> tryLock(lock_key);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(!tag)&#123;</span><br><span class="line"><span class="comment">//            è·å–äº’æ–¥é”å¤±è´¥ï¼Œä¼‘çœ ä¸€æ®µæ—¶é—´ï¼Œå¾ªç¯ç­‰å¾…</span></span><br><span class="line">                    Thread.sleep(<span class="number">50</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    t = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//        äºŒæ¬¡éªŒè¯</span></span><br><span class="line">            <span class="comment">//        æŸ¥è¯¢åº—é“ºç¼“å­˜</span></span><br><span class="line">            Map&lt;Object, Object&gt; map = redisTemplate.opsForHash().entries(key);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        if(map.isEmpty())&#123;</span></span><br><span class="line"><span class="comment">//            throw new RuntimeException(&quot;å‘½ä¸­ç©ºæ•°æ®&quot;);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!map.isEmpty())&#123;</span><br><span class="line">                <span class="comment">//        å‘½ä¸­åˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">                <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(map, <span class="keyword">new</span> <span class="title class_">Shop</span>(), <span class="literal">false</span>);</span><br><span class="line">                <span class="keyword">return</span> shop;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> getById(id);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(shop ==  <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//        æ•°æ®åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›é”™è¯¯</span></span><br><span class="line">                redisTemplate.opsForValue().set(key,<span class="literal">null</span>,CACHE_NULL_TTL,TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åº—é“ºä¿¡æ¯æœ‰è¯¯&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//        å°†æ•°æ®ä¿å­˜åˆ°ç¼“å­˜</span></span><br><span class="line">            Map&lt;String, Object&gt; mapshop = BeanUtil.beanToMap(shop);</span><br><span class="line">            mapshop.forEach((k,value) -&gt;&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> != value) mapshop.put(k, String.valueOf(value));</span><br><span class="line">            &#125;);</span><br><span class="line">            redisTemplate.opsForHash().putAll(key,mapshop);</span><br><span class="line">            redisTemplate.expire(key,CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line"><span class="comment">//        è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span> shop;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            unLock(lock_key);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="ç§’æ€ä¸šåŠ¡"><a href="#ç§’æ€ä¸šåŠ¡" class="headerlink" title="ç§’æ€ä¸šåŠ¡"></a>ç§’æ€ä¸šåŠ¡</h1><h2 id="å”¯ä¸€ID"><a href="#å”¯ä¸€ID" class="headerlink" title="å”¯ä¸€ID"></a>å”¯ä¸€ID</h2><p>Redisè‡ªå¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisIdWorker</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"><span class="comment">//  å¼€å§‹æ—¶é—´æˆ³</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">BEGIN_TIMESTAMP</span> <span class="operator">=</span> <span class="number">1640995200L</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    åºåˆ—å·ä½æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">COUNT_BITS</span> <span class="operator">=</span> <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">nextId</span><span class="params">(String keyPrefix)</span>&#123;</span><br><span class="line"><span class="comment">//        ç”Ÿæˆæ—¶é—´æˆ³</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="type">long</span> <span class="variable">nowSecond</span> <span class="operator">=</span> now.toEpochSecond(ZoneOffset.UTC);</span><br><span class="line">        <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> nowSecond - BEGIN_TIMESTAMP;</span><br><span class="line"><span class="comment">//        ç”Ÿæˆåºåˆ—å·</span></span><br><span class="line"><span class="comment">//          è·å–å½“å‰æ—¥æœŸï¼Œä½œä¸ºåºåˆ—å·çš„ä¸€éƒ¨åˆ†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy:MM:dd&quot;</span>));</span><br><span class="line"><span class="comment">//          è‡ªå¢é•¿</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().increment(<span class="string">&quot;icr:&quot;</span> + keyPrefix + <span class="string">&quot;:&quot;</span> + date);</span><br><span class="line"><span class="comment">//        æ‹¼æ¥è¿”å›</span></span><br><span class="line"><span class="comment">//        é‡‡ç”¨æ—¶é—´æˆ³å·¦ç§»åºåˆ—å·ä½æ•°ï¼Œç„¶åç”¨åºåˆ—å·å’Œæ—¶é—´æˆ³æˆ–è¿ç®—</span></span><br><span class="line">        <span class="keyword">return</span> timestamp &lt;&lt; COUNT_BITS | count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®ç°åŸºæœ¬ä¸‹å•åŠŸèƒ½"><a href="#å®ç°åŸºæœ¬ä¸‹å•åŠŸèƒ½" class="headerlink" title="å®ç°åŸºæœ¬ä¸‹å•åŠŸèƒ½"></a>å®ç°åŸºæœ¬ä¸‹å•åŠŸèƒ½</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ISeckillVoucherService iSeckillVoucherService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisIdWorker redisIdWorker;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>: ä¼˜æƒ å·ç§’æ€</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [voucherId]</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> com.hmdp.dto.Result</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> iSeckillVoucherService.getById(voucherId);</span><br><span class="line">        <span class="keyword">if</span>(voucher == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ä¼˜æƒ åˆ¸ä¸å­˜åœ¨!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//      åˆ¤æ–­æ˜¯å¦å¤„äºç§’æ€æ—¶é—´æ®µ</span></span><br><span class="line">        <span class="keyword">if</span>(voucher.getBeginTime().isAfter(LocalDateTime.now()))&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€æœªå¼€å§‹&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(voucher.getEndTime().isBefore(LocalDateTime.now()))&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//      åˆ¤æ–­æ˜¯å¦å”®ç©º</span></span><br><span class="line">        <span class="keyword">if</span>(voucher.getStock() &lt; <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¼˜æƒ åŠµä¸è¶³&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//      ä¼˜æƒ åˆ¸æ•°é‡å‡1</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> iSeckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>)</span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!success)&#123;</span><br><span class="line"><span class="comment">//            å‡1å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¼˜æƒ åˆ¸ä¸è¶³&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//      åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line"><span class="comment">//      è·å¾—å”¯ä¸€ID</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">order_id</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        voucherOrder.setId(order_id); <span class="comment">// è®¢å•idæ¥è‡ªidWorkerç”Ÿæˆå”¯ä¸€ID</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId); <span class="comment">// ä¼˜æƒ åˆ¸idæ¥è‡ªä¼ å…¥çš„id</span></span><br><span class="line">        voucherOrder.setUserId(UserHolder.getUser().getId()); <span class="comment">// useridæ¥è‡ªç”¨æˆ·è¿›ç¨‹</span></span><br><span class="line"><span class="comment">//        ä¿å­˜order</span></span><br><span class="line">        save(voucherOrder);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.ok(order_id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="è§£å†³è¶…å–é—®é¢˜"><a href="#è§£å†³è¶…å–é—®é¢˜" class="headerlink" title="è§£å†³è¶…å–é—®é¢˜"></a>è§£å†³è¶…å–é—®é¢˜</h2><p>ä¹è§‚é”ï¼šåœ¨æ›´æ–°æ—¶åˆ¤æ–­æ˜¯å¦æœ‰çº¿ç¨‹ä¹Ÿä¿®æ”¹äº†æ•°æ®</p><p>æ–¹æ³•ä¸€ï¼šç‰ˆæœ¬å·æ³•</p><p>ç»™æ•°æ®åº“ä¸­çš„æ•°æ®æ·»åŠ ç‰ˆæœ¬å­—æ®µï¼Œè¦ä¿®æ”¹æ•°æ®åº“æ—¶ï¼Œå…ˆæŸ¥è¯¢ç‰ˆæœ¬å·ï¼Œç„¶ååœ¨ä¿®æ”¹æ•°æ®åº“æ—¶ï¼Œå¯¹æ¯”æ­¤æ—¶çš„ç‰ˆæœ¬å·å’Œæ•°æ®åº“é‡Œçš„ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œä¸€è‡´å†è¿›è¡Œä¿®æ”¹ã€‚</p><p>æ–¹æ³•äºŒï¼šCASæ³•</p><p>åˆ©ç”¨åº“å­˜æ•°é‡ä½œä¸ºç‰ˆæœ¬å·ï¼Œåªè¦åœ¨æ¯æ¬¡æ›´æ–°æ—¶åˆ¤æ–­stockæ˜¯å¦å¤§äº0å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>: ä¼˜æƒ å·ç§’æ€</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [voucherId]</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> com.hmdp.dto.Result</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> iSeckillVoucherService.getById(voucherId);</span><br><span class="line">        <span class="keyword">if</span>(voucher == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ä¼˜æƒ åˆ¸ä¸å­˜åœ¨!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">stock</span> <span class="operator">=</span> voucher.getStock();</span><br><span class="line"><span class="comment">//      åˆ¤æ–­æ˜¯å¦å¤„äºç§’æ€æ—¶é—´æ®µ</span></span><br><span class="line">        <span class="keyword">if</span>(voucher.getBeginTime().isAfter(LocalDateTime.now()))&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€æœªå¼€å§‹&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(voucher.getEndTime().isBefore(LocalDateTime.now()))&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//      åˆ¤æ–­æ˜¯å¦å”®ç©º</span></span><br><span class="line">        <span class="keyword">if</span>(stock &lt; <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¼˜æƒ åŠµä¸è¶³&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//      ä¼˜æƒ åˆ¸æ•°é‡å‡1</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> iSeckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>)</span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId)</span><br><span class="line">                .gt(<span class="string">&quot;stock&quot;</span>,<span class="number">0</span>)</span><br><span class="line">                .update();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!success)&#123;</span><br><span class="line"><span class="comment">//            å‡1å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¼˜æƒ åˆ¸ä¸è¶³&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//      åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line"><span class="comment">//      è·å¾—å”¯ä¸€ID</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">order_id</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        voucherOrder.setId(order_id); <span class="comment">// è®¢å•idæ¥è‡ªidWorkerç”Ÿæˆå”¯ä¸€ID</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId); <span class="comment">// ä¼˜æƒ åˆ¸idæ¥è‡ªä¼ å…¥çš„id</span></span><br><span class="line">        voucherOrder.setUserId(UserHolder.getUser().getId()); <span class="comment">// useridæ¥è‡ªç”¨æˆ·è¿›ç¨‹</span></span><br><span class="line"><span class="comment">//        ä¿å­˜order</span></span><br><span class="line">        save(voucherOrder);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.ok(order_id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å•æœºé™åˆ¶è´­ä¹°"><a href="#å•æœºé™åˆ¶è´­ä¹°" class="headerlink" title="å•æœºé™åˆ¶è´­ä¹°"></a>å•æœºé™åˆ¶è´­ä¹°</h2><p>å®ç°ä¸€äººä¸€å•ï¼Œæœ€ç®€å•çš„æ€è·¯æ˜¯æ¯æ¬¡ä¸‹å•ä¹‹å‰å…ˆåˆ¤æ–­è®¢å•è¡¨é‡Œæ˜¯å¦å·²ç»å­˜åœ¨è¯¥ç”¨æˆ·çš„è®¢å•ï¼Œä½†æ˜¯è¿™æ ·æ— æ³•è§£å†³å¹¶å‘é—®é¢˜ã€‚</p><p>ä¹è§‚é”æ— æ³•åˆ¤æ–­è¯¥åœ¨ä½•æ—¶è¿›è¡Œåˆ¤æ–­æ˜¯å¦åŠ é”ï¼Œåªèƒ½é€‰æ‹©æ‚²è§‚é”ï¼Œå³åœ¨è¿›è¡Œä¸‹å•æ“ä½œæ—¶ï¼Œå°±æ ¹æ®ç™»å½•ç”¨æˆ·çš„idè¿›è¡ŒåŠ é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line"><span class="keyword">synchronized</span> (id.toString().intern())&#123;</span><br><span class="line">    <span class="type">IVoucherOrderService</span> <span class="variable">o</span> <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">    <span class="keyword">return</span> o.createVoucherOrder(voucherId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p> synchronized (id.toString().intern()) æ ¹æ®ç”¨æˆ·idä½œä¸ºåŠ é”çš„å‚æ•°ï¼Œæ­¤å¤„æœ‰ç»†èŠ‚ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨toStringï¼Œå› ä¸ºtoStringçš„åº•å±‚åœ¨æ¯æ¬¡è®¿é—®id.toStringéƒ½æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œè€Œintern()æ–¹æ³•ä¼šç›´æ¥ä»å¸¸é‡æ± é‡Œå–å€¼ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°Stringã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">createVoucherOrder</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, id).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;è¯·å‹¿é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//      ä¼˜æƒ åˆ¸æ•°é‡å‡1</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> iSeckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>)</span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId)</span><br><span class="line">                .gt(<span class="string">&quot;stock&quot;</span>,<span class="number">0</span>)</span><br><span class="line">                .update();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!success)&#123;</span><br><span class="line"><span class="comment">//            å‡1å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¼˜æƒ åˆ¸ä¸è¶³&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//      åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line"><span class="comment">//      è·å¾—å”¯ä¸€ID</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">order_id</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        voucherOrder.setId(order_id); <span class="comment">// è®¢å•idæ¥è‡ªidWorkerç”Ÿæˆå”¯ä¸€ID</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId); <span class="comment">// ä¼˜æƒ åˆ¸idæ¥è‡ªä¼ å…¥çš„id</span></span><br><span class="line">        voucherOrder.setUserId(id); <span class="comment">// useridæ¥è‡ªç”¨æˆ·è¿›ç¨‹</span></span><br><span class="line"><span class="comment">//        ä¿å­˜order</span></span><br><span class="line">        save(voucherOrder);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.ok(order_id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>æŠŠä¸‹å•ä¸šåŠ¡å°è£…æˆä¸€ä¸ªæ–¹æ³•ï¼Œæ–¹ä¾¿è¿›è¡ŒåŠ é”</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAspectJAutoProxy(exposeProxy = true)</span></span><br></pre></td></tr></table></figure><p>å¯¼å…¥æ–°çš„ä¾èµ–ï¼Œå¹¶åœ¨å¯åŠ¨ç±»é»˜è®¤å¯åŠ¨</p><h2 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h2><p>åˆ†å¸ƒå¼é”æ»¡è¶³åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿæˆ–è€…é›†ç¾¤ç³»ç»Ÿä¸‹å¤šè¿›ç¨‹å¯è§ä¸”äº’æ–¥çš„é”</p><p>ä¸»æµåšæ³•æ˜¯åˆ©ç”¨redisçš„setnxå‘½ä»¤ï¼Œsetnxä½œç”¨ç®€å•è¯´å°±æ˜¯å½“keyä¸å­˜åœ¨æ—¶æ‰å¯ä»¥setæˆåŠŸï¼Œè‹¥keyå·²å­˜åœ¨åˆ™å¤±è´¥ï¼Œè¿™æ ·åœ¨å¹¶å‘è¯·æ±‚é”æ—¶ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªè¯·æ±‚çš„æ‰èƒ½æˆåŠŸï¼Œé‡Šæ”¾é”æ—¶åªéœ€è¦åˆ é™¤è¿™æ¡keyå³å¯ï¼Œå®‰å…¨æ€§å¯ä»¥é€šè¿‡è®¾ç½®å…¶è¿‡æœŸæ—¶é—´æ¥ä¿è¯å®‰å…¨</p><blockquote><p>setnx [key] [value]</p><p>set [key] [value] EX [seconds] NX  &#x2F;&#x2F;åŸå­æ“ä½œ,è®¾ç½®é”çš„åŒæ—¶è®¾ç½®æ—¶é—´ï¼Œé˜²æ­¢å› ä¸ºå®•æœºå¯¼è‡´é”ä¸é‡Šæ”¾</p></blockquote><blockquote><p>æˆåŠŸåŠ é”è¿”å›1ï¼Œå¤±è´¥è¿”å›0</p></blockquote><h3 id="åˆ†å¸ƒå¼é”å®ç°å¤šçº¿ç¨‹é™åˆ¶è´­ä¹°"><a href="#åˆ†å¸ƒå¼é”å®ç°å¤šçº¿ç¨‹é™åˆ¶è´­ä¹°" class="headerlink" title="åˆ†å¸ƒå¼é”å®ç°å¤šçº¿ç¨‹é™åˆ¶è´­ä¹°"></a>åˆ†å¸ƒå¼é”å®ç°å¤šçº¿ç¨‹é™åˆ¶è´­ä¹°</h3><p>é”æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ILock</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span>: æ­¤ä¹ƒè·å–åˆ†å¸ƒå¼é”çš„æ¥å£</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Params</span>:</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    è·å–é”</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeSec)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    é‡Šæ”¾é”</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unLock</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†å¸ƒå¼é”ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleRedisLock</span> <span class="keyword">implements</span> <span class="title class_">ILock</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="comment">//    é”å‰ç¼€</span></span><br><span class="line"><span class="comment">//    é”å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LOCK_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;Lock:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SimpleRedisLock</span><span class="params">(StringRedisTemplate stringRedisTemplate, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeSec)</span> &#123;</span><br><span class="line"><span class="comment">//      è·å–å½“å‰è¿›ç¨‹id</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> Thread.currentThread().getId();</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">success</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(LOCK_PREFIX + name, id + <span class="string">&quot;&quot;</span>, timeSec, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BooleanUtil.isTrue(success);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unLock</span><span class="params">()</span> &#123;</span><br><span class="line">        stringRedisTemplate.delete(LOCK_PREFIX + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åŸæ¥çš„åŠ é”é€»è¾‘ï¼Œæ”¹ç”¨åˆ†å¸ƒå¼é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        è·å–é”</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock(<span class="number">120</span>);</span><br><span class="line">        <span class="keyword">if</span>(!isLock)&#123;</span><br><span class="line"><span class="comment">//            å–é”å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;æœåŠ¡å™¨é”™è¯¯,è¯·é‡è¯•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">IVoucherOrderService</span> <span class="variable">o</span> <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">            <span class="keyword">return</span> o.createVoucherOrder(voucherId);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="comment">//            ä¸‡ä¸€æœ‰å¼‚å¸¸ï¼Œå¯ä»¥è‡ªåŠ¨é‡Šæ”¾é”</span></span><br><span class="line">            lock.unLock();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>ä»ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœè·å–é”å¤±è´¥ï¼Œä¼šè¿”å›æœåŠ¡å™¨é”™è¯¯ï¼Œåªè¦è¿”å›è¿™æ¡ä¿¡æ¯ï¼Œå°±å¯ä»¥ç¡®è®¤æˆ‘ä»¬çš„åˆ†å¸ƒå¼é”åŠŸèƒ½æ˜¯æ­£å¸¸çš„ã€‚</p><h3 id="åˆ†å¸ƒå¼é”æµ‹è¯•"><a href="#åˆ†å¸ƒå¼é”æµ‹è¯•" class="headerlink" title="åˆ†å¸ƒå¼é”æµ‹è¯•"></a>åˆ†å¸ƒå¼é”æµ‹è¯•</h3><p>é¦–å…ˆåœ¨å¯åŠ¨ä¸¤ä¸ªæœåŠ¡ç«¯ï¼Œè®°å¾—è§£å†³ä¸€ä¸‹ç«¯å£å†²çª</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403061125114.png" alt="image-20240306112545976"></p><p>åˆ©ç”¨apifoxå¹¶å‘æ‰§è¡Œä¸¤æ¡ä¸‹å•æ“ä½œï¼Œç”¨æˆ·çš„tokenä¿æŒä¸€è‡´ä»£è¡¨åŒä¸€ç”¨æˆ·</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403061126649.png" alt="image-20240306112654582"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403061127377.png" alt="image-20240306112713310"></p><p>è¿è¡Œæµ‹è¯•</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403061129167.png" alt="image-20240306112915074"></p><p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæˆåŠŸä¸€ä¸ªå¤±è´¥ï¼Œå¤±è´¥è¯·æ±‚çš„ä¿¡æ¯ä¸º</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403061130257.png" alt="image-20240306113013190"></p><p>æˆåŠŸè¯·æ±‚è‡ªç„¶å°±æ˜¯è®¢å•å·äº†</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403061130523.png" alt="image-20240306113040465"></p><p>æ•°æ®åº“çš„è®¢å•ä¹Ÿåªå¢åŠ äº†ä¸€æ¡ï¼Œæµ‹è¯•æˆåŠŸ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403061131027.png" alt="image-20240306113122958"></p><h3 id="è§£å†³é”è¯¯åˆ é—®é¢˜"><a href="#è§£å†³é”è¯¯åˆ é—®é¢˜" class="headerlink" title="è§£å†³é”è¯¯åˆ é—®é¢˜"></a>è§£å†³é”è¯¯åˆ é—®é¢˜</h3><p>è§£å†³æ–¹æ³•æ˜¯æ¯æŠŠé”é‡Œé¢çš„valueéƒ½æ·»åŠ ä¸€æ®µuuidï¼Œç„¶ååœ¨åˆ é™¤å‰åˆ¤æ–­æ˜¯å¦æ˜¯è‡ªå·±çš„é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ID_PREFIX</span> <span class="operator">=</span> UUID.randomUUID().toString(<span class="literal">true</span>);</span><br><span class="line"><span class="type">Boolean</span> <span class="variable">success</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(LOCK_PREFIX + name, id, timeSec, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unLock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//      è·å–å½“å‰è¿›ç¨‹id</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> ID_PREFIX + Thread.currentThread().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(LOCK_PREFIX + name);</span><br><span class="line">    <span class="keyword">if</span>(id.equals(s))&#123;</span><br><span class="line">        stringRedisTemplate.delete(LOCK_PREFIX + name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£å†³åˆ é”æ“ä½œéåŸå­æ€§é—®é¢˜ï¼ˆluaè„šæœ¬ï¼‰"><a href="#è§£å†³åˆ é”æ“ä½œéåŸå­æ€§é—®é¢˜ï¼ˆluaè„šæœ¬ï¼‰" class="headerlink" title="è§£å†³åˆ é”æ“ä½œéåŸå­æ€§é—®é¢˜ï¼ˆluaè„šæœ¬ï¼‰"></a>è§£å†³åˆ é”æ“ä½œéåŸå­æ€§é—®é¢˜ï¼ˆluaè„šæœ¬ï¼‰</h3><p>ä¹‹å‰çš„é‡Šæ”¾é”é€»è¾‘ä¸å®‰å…¨ï¼Œå¦‚æœå‘ç”Ÿé˜»å¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯¯åˆ ï¼Œå› æ­¤æœ€å¥½æ˜¯å°†è§£é”æ“ä½œæ•´åˆæˆä¸€ä¸ªåŸå­æ“ä½œ</p><p>redisæ‰§è¡Œä¸€ä¸ªluaè„šæœ¬</p><p>è„šæœ¬å†…å®¹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è·å–é”ä¸­çš„value</span></span><br><span class="line"><span class="keyword">local</span> id = redis.call(<span class="string">&#x27;get&#x27;</span>,KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="comment">-- æ¯”è¾ƒè¯¥idå’Œä¼ å…¥idæ˜¯å¦ä¸€è‡´ï¼Œä¸€è‡´åˆ™åˆ é™¤</span></span><br><span class="line"><span class="keyword">if</span>(id == ARGV[<span class="number">1</span>]) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- é‡Šæ”¾é”</span></span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">&#x27;del&#x27;</span>,KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>æ”¹è¿›ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    redisè„šæœ¬</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Long&gt; UNLOCK_SCRIPT;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line"><span class="comment">//        é™æ€ä»£ç å—ï¼Œéšç±»ä¸€èµ·åŠ è½½æ‰§è¡Œ,é˜²æ­¢æµªè´¹IOèµ„æº</span></span><br><span class="line">        UNLOCK_SCRIPT = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">        UNLOCK_SCRIPT.setLocation(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;delLock.lua&quot;</span>));</span><br><span class="line">        UNLOCK_SCRIPT.setResultType(Long.class);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unLock</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        è°ƒç”¨redisè„šæœ¬</span></span><br><span class="line">        stringRedisTemplate.execute(</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                * <span class="doctag">@Description</span>: æ‰§è¡Œredisè„šæœ¬</span></span><br><span class="line"><span class="comment">                * <span class="doctag">@Params</span>: [è„šæœ¬å¯¹è±¡ï¼Œkeysï¼ˆCollectionï¼‰ï¼Œargs]</span></span><br><span class="line"><span class="comment">                * <span class="doctag">@Return</span> void</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                UNLOCK_SCRIPT,</span><br><span class="line">                Collections.singletonList(LOCK_PREFIX + name),</span><br><span class="line">                ID_PREFIX + Thread.currentThread().getId()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="Redisson"><a href="#Redisson" class="headerlink" title="Redisson"></a>Redisson</h2><blockquote><p>Redissonæ˜¯ä¸€ä¸ªåœ¨Redisçš„åŸºç¡€ä¸Šå®ç°çš„Javaé©»å†…å­˜æ•°æ®ç½‘æ ¼ï¼ˆIn-Memory Data Gridï¼‰ã€‚å®ƒä¸ä»…æä¾›äº†ä¸€ç³»åˆ—çš„åˆ†å¸ƒå¼çš„Javaå¸¸ç”¨å¯¹è±¡ï¼Œè¿˜æä¾›äº†è®¸å¤šåˆ†å¸ƒå¼æœåŠ¡ã€‚å…¶ä¸­åŒ…æ‹¬(BitSet, Set, Multimap, SortedSet, Map, List, Queue, BlockingQueue, Deque, BlockingDeque, Semaphore, Lock, AtomicLong, CountDownLatch, Publish &#x2F; Subscribe, Bloom filter, Remote service, Spring cache, Executor service, Live Object service, Scheduler service) Redissonæä¾›äº†ä½¿ç”¨Redisçš„æœ€ç®€å•å’Œæœ€ä¾¿æ·çš„æ–¹æ³•ã€‚Redissonçš„å®—æ—¨æ˜¯ä¿ƒè¿›ä½¿ç”¨è€…å¯¹Redisçš„å…³æ³¨åˆ†ç¦»ï¼ˆSeparation of Concernï¼‰ï¼Œä»è€Œè®©ä½¿ç”¨è€…èƒ½å¤Ÿå°†ç²¾åŠ›æ›´é›†ä¸­åœ°æ”¾åœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ä¸Šã€‚</p></blockquote><p>ç®€è€Œè¨€ä¹‹ï¼Œredissonä¸­æä¾›äº†å¾ˆå¤šå®ç”¨çš„æ–¹æ³•ï¼Œå¯ä»¥ç®€åŒ–å¼€å‘ã€‚</p><h3 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h3><p>pomï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.19.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®Redisson</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Redisson é…ç½®</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedissonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedissonClient <span class="title function_">redissonClient</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        é…ç½®</span></span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        config.useSingleServer().setAddress(<span class="string">&quot;redis://127.0.0.1:6379&quot;</span>);</span><br><span class="line"><span class="comment">//        åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> Redisson.create(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨Redissonè·å–é”"><a href="#åˆ©ç”¨Redissonè·å–é”" class="headerlink" title="åˆ©ç”¨Redissonè·å–é”"></a>åˆ©ç”¨Redissonè·å–é”</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;lock:order:&quot;</span> + id);</span><br><span class="line"><span class="comment">//        è·å–é”</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock();</span><br></pre></td></tr></table></figure><blockquote><p>redissonClient.getLock é‡Œé¢æ˜¯é”çš„åå­—</p><p>lock.tryLock() å‚æ•°åˆ†åˆ«å¯ä»¥æ˜¯ï¼šé”çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆå¦‚æœè·å–ä¸åˆ°é”ï¼ŒæœŸé—´ä¼šé‡è¯•ï¼Œé”çš„æœ€å¤§æŒç»­æ—¶é—´ï¼ˆé»˜è®¤30ï¼‰ï¼ŒæŒç»­æ—¶é—´ç±»å‹ï¼ˆé»˜è®¤ç§’ï¼‰ï¼‰</p></blockquote><p>æ–¹ä¾¿å¿«æ·åœ°å®ç°çº¿ç¨‹å®‰å…¨</p><h1 id="ç§’æ€ä¸šåŠ¡ä¼˜åŒ–"><a href="#ç§’æ€ä¸šåŠ¡ä¼˜åŒ–" class="headerlink" title="ç§’æ€ä¸šåŠ¡ä¼˜åŒ–"></a>ç§’æ€ä¸šåŠ¡ä¼˜åŒ–</h1><p>ç›®å‰æˆ‘ä»¬çš„ç§’æ€ä¸šåŠ¡ç”±äºæ•´ä½“æ˜¯ä¸²è¡Œæ¨¡å¼ï¼Œå…¶ä¸­åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰ä¸‹å•èµ„æ ¼è¿™ä¸€éƒ¨åˆ†å…¶å®è€—æ—¶æ¯”è¾ƒå°‘ï¼Œç”¨æ—¶æ¯”è¾ƒé•¿çš„æ˜¯ä¹‹åçš„æ•°æ®åº“æ“ä½œï¼ŒåŒ…æ‹¬åŠ é”ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ€è€ƒï¼Œå¦‚æœå°†åé¢çš„æ•°æ®åº“æ“ä½œæ‹†åˆ†å‡ºæ¥ï¼Œå•ç‹¬åˆ©ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å®ç°ï¼Œè¿™æ ·å½“æˆ‘ä»¬åˆ¤æ–­ç”¨æˆ·æœ‰ä¸‹å•èµ„æ ¼æ—¶ï¼Œç›´æ¥â€œé€šçŸ¥â€è¯¥çº¿ç¨‹è®©ä»–æ‰§è¡Œï¼Œè¿™æ ·æ€§èƒ½å°±æé«˜äº†</p><h2 id="å°†ä¼˜æƒ åˆ¸ä¿¡æ¯å­˜å…¥redis"><a href="#å°†ä¼˜æƒ åˆ¸ä¿¡æ¯å­˜å…¥redis" class="headerlink" title="å°†ä¼˜æƒ åˆ¸ä¿¡æ¯å­˜å…¥redis"></a>å°†ä¼˜æƒ åˆ¸ä¿¡æ¯å­˜å…¥redis</h2><p>å¦‚æœæƒ³è¿›ä¸€æ­¥æé«˜åˆ¤æ–­ç”¨æˆ·ä¸‹å•èµ„æ ¼è¿™ä¸€æ­¥çš„æ•ˆç‡ï¼Œé‚£ä¹ˆä¹Ÿåº”è¯¥å‡å°‘æ•°æ®åº“æœç´¢ï¼Œå¦‚æœæ˜¯è¿›è¡Œredisç¼“å­˜æ“ä½œï¼Œé‚£ä¹ˆæ•ˆç‡æ¯”èµ·æ•°æ®åº“ï¼Œè‚¯å®šæ˜¯è¦é«˜å¾ˆå¤šçš„</p><p>æ–°å¢ä¼˜æƒ åˆ¸çš„åŒæ—¶ï¼Œå°†ä¼˜æƒ åˆ¸ä¿¡æ¯åŠ å…¥ç¼“å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSeckillVoucher</span><span class="params">(Voucher voucher)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¿å­˜ä¼˜æƒ åˆ¸</span></span><br><span class="line">        save(voucher);</span><br><span class="line">        <span class="comment">// ä¿å­˜ç§’æ€ä¿¡æ¯</span></span><br><span class="line">        <span class="type">SeckillVoucher</span> <span class="variable">seckillVoucher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SeckillVoucher</span>();</span><br><span class="line">        seckillVoucher.setVoucherId(voucher.getId());</span><br><span class="line">        seckillVoucher.setStock(voucher.getStock());</span><br><span class="line">        seckillVoucher.setBeginTime(voucher.getBeginTime());</span><br><span class="line">        seckillVoucher.setEndTime(voucher.getEndTime());</span><br><span class="line">        seckillVoucherService.save(seckillVoucher);</span><br><span class="line">        </span><br><span class="line"><span class="comment">//        ä¼˜æƒ åŠµä¿¡æ¯ä¿å­˜åˆ°ç¼“å­˜ï¼Œæ–¹ä¾¿ä¹‹åè¿›è¡Œèµ„æ ¼éªŒè¯</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucher.getId(),voucher.getStock().toString());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="redisæ¶ˆæ¯é˜Ÿåˆ—å®ç°å¼‚æ­¥ç§’æ€"><a href="#redisæ¶ˆæ¯é˜Ÿåˆ—å®ç°å¼‚æ­¥ç§’æ€" class="headerlink" title="redisæ¶ˆæ¯é˜Ÿåˆ—å®ç°å¼‚æ­¥ç§’æ€"></a>redisæ¶ˆæ¯é˜Ÿåˆ—å®ç°å¼‚æ­¥ç§’æ€</h2><h2 id="åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ç»„"><a href="#åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ç»„" class="headerlink" title="åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ç»„"></a>åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ç»„</h2><p>åˆ›å»ºæ¶ˆè´¹è€…ç»„ï¼š<br><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202403062011693.png" alt="image-20240306201108622"><br>keyï¼šé˜Ÿåˆ—åç§°<br>groupNameï¼šæ¶ˆè´¹è€…ç»„åç§°<br>IDï¼šèµ·å§‹IDæ ‡ç¤ºï¼Œ$ä»£è¡¨é˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªæ¶ˆæ¯ï¼Œ0åˆ™ä»£è¡¨é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªæ¶ˆæ¯<br>MKSTREAMï¼šé˜Ÿåˆ—ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»ºé˜Ÿåˆ—</p><p> <strong>åˆ é™¤æŒ‡å®šçš„æ¶ˆè´¹è€…ç»„</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP DESTORY key groupName</span><br></pre></td></tr></table></figure><p> <strong>ç»™æŒ‡å®šçš„æ¶ˆè´¹è€…ç»„æ·»åŠ æ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP CREATECONSUMER key groupname consumername</span><br></pre></td></tr></table></figure><p> <strong>åˆ é™¤æ¶ˆè´¹è€…ç»„ä¸­çš„æŒ‡å®šæ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP DELCONSUMER key groupname consumername</span><br></pre></td></tr></table></figure><p>ä»æ¶ˆè´¹è€…ç»„è¯»å–æ¶ˆæ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] ID [ID ...]</span><br></pre></td></tr></table></figure><ul><li>groupï¼šæ¶ˆè´¹ç»„åç§°</li><li>consumerï¼šæ¶ˆè´¹è€…åç§°ï¼Œå¦‚æœæ¶ˆè´¹è€…ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…</li><li>countï¼šæœ¬æ¬¡æŸ¥è¯¢çš„æœ€å¤§æ•°é‡</li><li>BLOCK millisecondsï¼šå½“æ²¡æœ‰æ¶ˆæ¯æ—¶æœ€é•¿ç­‰å¾…æ—¶é—´</li><li>NOACKï¼šæ— éœ€æ‰‹åŠ¨ACKï¼Œè·å–åˆ°æ¶ˆæ¯åè‡ªåŠ¨ç¡®è®¤</li><li>STREAMS keyï¼šæŒ‡å®šé˜Ÿåˆ—åç§°</li><li>IDï¼šè·å–æ¶ˆæ¯çš„èµ·å§‹IDï¼š</li></ul><p>â€œ&gt;â€ï¼šä»ä¸‹ä¸€ä¸ªæœªæ¶ˆè´¹çš„æ¶ˆæ¯å¼€å§‹<br>å…¶å®ƒï¼šæ ¹æ®æŒ‡å®šidä»pending-listä¸­è·å–å·²æ¶ˆè´¹ä½†æœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚0ï¼Œæ˜¯ä»pending-listä¸­çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯å¼€å§‹</p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p> åˆ›å»ºçº¿ç¨‹æ± ï¼Œç”¨äºå­˜æ”¾å¤„ç†æ¶ˆæ¯çš„çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    çº¿ç¨‹æ± </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">SECKILL_ORDER_EXECUTOR</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        SECKILL_ORDER_EXECUTOR.submit(<span class="keyword">new</span> <span class="title class_">VoucherOrderHandler</span>());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆæ¯å¤„ç†çº¿ç¨‹ï¼Œçº¿ç¨‹é‡Œæ­»å¾ªç¯è¯»å–æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå› ä¸ºä¼šå µå¡ï¼Œæ‰€ä»¥ä¸å¿…æ‹…å¿ƒèµ„æºæ¶ˆè€—</p><p>é€»è¾‘æ­¥éª¤</p><ol><li>stringRedisTemplate.opsForStream().read è¯»å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</li><li>åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™è¯´æ˜å¤„ç†å®Œæ¯•</li><li>ä¸ä¸ºç©ºåˆ™è·å–valueï¼š read.get(0) .getValue();</li><li>è°ƒç”¨BeanUtil.fillBeanWithMapå°†valueå°è£…ä¸ºå¯¹è±¡ï¼Œæ­¤å¤„ä¸ºè®¢å•å¯¹è±¡</li><li>è®¢å•å¯¹è±¡ä¿å­˜æ•°æ®åº“</li><li>è°ƒç”¨opsForStream().acknowledge ç¡®è®¤æ¶ˆæ¯ï¼Œå°†æ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­å–å‡º</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    è®¢å•å¤„ç†çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;streams.orders&quot;</span>;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line"><span class="comment">//                    è·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯</span></span><br><span class="line">                    List&lt;MapRecord&lt;String, Object, Object&gt;&gt; read = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                            Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                            StreamReadOptions.empty().count(<span class="number">1</span>).block(Duration.ofSeconds(<span class="number">2</span>)),</span><br><span class="line">                            StreamOffset.create(queueName, ReadOffset.lastConsumed())</span><br><span class="line">                    );</span><br><span class="line"><span class="comment">//                    åˆ¤æ–­æ˜¯å¦è·å–æˆåŠŸ</span></span><br><span class="line">                    <span class="keyword">if</span>(read == <span class="literal">null</span> || read.isEmpty())&#123;</span><br><span class="line">                        <span class="comment">//                    è·å–å¤±è´¥ï¼Œè¯´æ˜æ²¡å¾…å¤„ç†æ¶ˆæ¯äº†ï¼Œç»§ç»­ä¸‹æ¬¡å¾ªç¯</span></span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//                    è·å–æˆåŠŸæ‰§è¡Œä¸‹å•ä¸šåŠ¡</span></span><br><span class="line">                    MapRecord&lt;String, Object, Object&gt; record = read.get(<span class="number">0</span>);</span><br><span class="line">                    Map&lt;Object, Object&gt; value = record.getValue();</span><br><span class="line">                    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(value, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line"><span class="comment">//                    ä¸‹å•</span></span><br><span class="line">                    handleVoucherOrder(voucherOrder);</span><br><span class="line"><span class="comment">//                    ACKç¡®è®¤</span></span><br><span class="line">                    stringRedisTemplate.opsForStream().acknowledge(queueName,<span class="string">&quot;g1&quot;</span>,record.getId());</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å¤„ç†é”™è¯¯è®¢å•&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®ç°äº†å¼‚æ­¥æ›´æ–°</p><h1 id="æ¢åº—éƒ¨åˆ†"><a href="#æ¢åº—éƒ¨åˆ†" class="headerlink" title="æ¢åº—éƒ¨åˆ†"></a>æ¢åº—éƒ¨åˆ†</h1><h2 id="æ¢åº—ç¬”è®°å±•ç¤º"><a href="#æ¢åº—ç¬”è®°å±•ç¤º" class="headerlink" title="æ¢åº—ç¬”è®°å±•ç¤º"></a>æ¢åº—ç¬”è®°å±•ç¤º</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">queryBlogById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>: æ ¹æ®idæŸ¥è¯¢blog</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [id]</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> com.hmdp.dto.Result</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> getById(id);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> blog.getUserId();</span><br><span class="line"><span class="comment">//      æŸ¥è¯¢åšæ–‡å‘å¸ƒè€…çš„ä¿¡æ¯</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line"></span><br><span class="line">        blog.setName(user.getNickName());</span><br><span class="line">        blog.setIcon(user.getIcon());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.ok(blog);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨Blogå¦å¤–å°è£…äº†ä¸‰ä¸ªå±æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·å›¾æ ‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> String icon;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·å§“å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ˜¯å¦ç‚¹èµè¿‡äº†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> Boolean isLike;</span><br></pre></td></tr></table></figure><p>ç”¨æ¥åœ¨å‰ç«¯å±•ç¤ºå‘å¸ƒè€…çš„ç›¸å…³ä¿¡æ¯</p><h2 id="ç‚¹èµåŠŸèƒ½"><a href="#ç‚¹èµåŠŸèƒ½" class="headerlink" title="ç‚¹èµåŠŸèƒ½"></a>ç‚¹èµåŠŸèƒ½</h2><p>åŸºç¡€çš„é€»è¾‘å°±æ˜¯ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰ç‚¹èµè¿™ç¯‡æ–‡ç« ï¼Œé‚£å°±æ‰§è¡Œç‚¹èµä¸šåŠ¡ï¼Œå¦‚æœå·²ç»ç‚¹è¿‡é‚£å°±æ‰§è¡Œå–æ¶ˆç‚¹èµï¼Œè¿™ä¸¤ä¸ªä¸šåŠ¡æ—¶ä¸¤ä¸ªç›¸åçš„è¿‡ç¨‹ã€‚å…¶ä¸­è¦å®ç°çš„é‡ç‚¹å°±æ˜¯æ€ä¹ˆåˆ¤æ–­ç”¨æˆ·å·²ç»ç‚¹èµè¿‡äº†ã€‚</p><p>æ­¤å¤„ä½¿ç”¨redisç¼“å­˜ï¼Œåˆ©ç”¨setç»“æ„ï¼Œä»¥blogidä¸ºkeyï¼Œç”¨æˆ·idä¸ºvalueï¼Œè¿™æ ·æ¯æ¬¡åªéœ€è¦æ ¹æ®blogidåˆ¤æ–­ç”¨æˆ·æ˜¯å¦åœ¨å…¶ä¸­ï¼Œå³å¯åˆ¤æ–­æ˜¯å¦ç‚¹èµã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">likeBlog</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"><span class="comment">//        è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> user.getId();</span><br><span class="line"><span class="comment">//        åˆ©ç”¨redisåˆ¤æ–­æ˜¯å¦å·²ç‚¹èµ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstants.BLOG_LIKED_KEY + id;</span><br><span class="line"><span class="comment">//        Boolean b = stringRedisTemplate.opsForSet().isMember(key, userId.toString());</span></span><br><span class="line"><span class="comment">//        boolean isLiked = BooleanUtil.isTrue(b);</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLiked</span> <span class="operator">=</span> isLiked(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!isLiked)&#123;</span><br><span class="line">            <span class="comment">//        æœªç‚¹èµï¼Œåˆ™æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked + 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">            <span class="keyword">if</span>(success)&#123;</span><br><span class="line">                <span class="comment">//        æ›´æ–°redis</span></span><br><span class="line">                stringRedisTemplate.opsForSet().add(key,userId.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//        å·²ç‚¹èµåˆ™å–æ¶ˆç‚¹èµ</span></span><br><span class="line"><span class="comment">//        æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked - 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>,id).update();</span><br><span class="line">            <span class="keyword">if</span>(success)&#123;</span><br><span class="line">                <span class="comment">//        ç§»é™¤redis set</span></span><br><span class="line">                stringRedisTemplate.opsForSet().remove(key,userId.toString());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isLiked</span><span class="params">(Long blogId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line"></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">b</span> <span class="operator">=</span> stringRedisTemplate.opsForSet().isMember(RedisConstants.BLOG_LIKED_KEY + blogId, userId.toString());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BooleanUtil.isTrue(b);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨sortedSetå­˜å‚¨ç‚¹èµä¿¡æ¯"><a href="#åˆ©ç”¨sortedSetå­˜å‚¨ç‚¹èµä¿¡æ¯" class="headerlink" title="åˆ©ç”¨sortedSetå­˜å‚¨ç‚¹èµä¿¡æ¯"></a>åˆ©ç”¨sortedSetå­˜å‚¨ç‚¹èµä¿¡æ¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">likeBlog</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"><span class="comment">//        è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> user.getId();</span><br><span class="line"><span class="comment">//        åˆ©ç”¨redisåˆ¤æ–­æ˜¯å¦å·²ç‚¹èµ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstants.BLOG_LIKED_KEY + id;</span><br><span class="line"><span class="comment">//        Boolean b = stringRedisTemplate.opsForSet().isMember(key, userId.toString());</span></span><br><span class="line"><span class="comment">//        boolean isLiked = BooleanUtil.isTrue(b);</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLiked</span> <span class="operator">=</span> isLiked(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!isLiked)&#123;</span><br><span class="line">            <span class="comment">//        æœªç‚¹èµï¼Œåˆ™æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked + 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">            <span class="keyword">if</span>(success)&#123;</span><br><span class="line">                <span class="comment">//        æ›´æ–°redis</span></span><br><span class="line">                stringRedisTemplate.opsForZSet().add(key,userId.toString(),System.currentTimeMillis());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//        å·²ç‚¹èµåˆ™å–æ¶ˆç‚¹èµ</span></span><br><span class="line"><span class="comment">//        æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked - 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>,id).update();</span><br><span class="line">            <span class="keyword">if</span>(success)&#123;</span><br><span class="line">                <span class="comment">//        ç§»é™¤redis set</span></span><br><span class="line">                stringRedisTemplate.opsForSet().remove(key,userId.toString());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isLiked</span><span class="params">(Long blogId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line"></span><br><span class="line">        <span class="type">Double</span> <span class="variable">score</span> <span class="operator">=</span> stringRedisTemplate.opsForZSet().score(RedisConstants.BLOG_LIKED_KEY + blogId, userId.toString());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> score != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="è·å–ç‚¹èµåˆ—è¡¨"><a href="#è·å–ç‚¹èµåˆ—è¡¨" class="headerlink" title="è·å–ç‚¹èµåˆ—è¡¨"></a>è·å–ç‚¹èµåˆ—è¡¨</h2><ol><li>åˆ©ç”¨rangeå–å‰5æ¡ç”¨æˆ·id</li><li>æŠŠå–å‡ºæ¥çš„ç”¨æˆ·idçš„stringé›†åˆå˜ä¸ºlongé›†åˆ</li><li>è°ƒç”¨listbyidsè·å¾—ç”¨æˆ·é›†åˆ</li><li>å°†ç”¨æˆ·é›†åˆè½¬ä¸ºuserdto</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">getLikeList</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        æ ¹æ®blogidè·å¾—ç‚¹èµç”¨æˆ·çš„idé›†åˆ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstants.BLOG_LIKED_KEY + id;</span><br><span class="line">        Set&lt;String&gt; range = stringRedisTemplate.opsForZSet().range(key, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(range == <span class="literal">null</span> || range.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//      è·å–ç‚¹èµç”¨æˆ·å‰5</span></span><br><span class="line">        List&lt;Long&gt; ids = range.stream().map(Long::valueOf).collect(Collectors.toList());</span><br><span class="line">        List&lt;User&gt; users = userService.listByIds(ids);</span><br><span class="line"><span class="comment">//        å°†ç”¨æˆ·é›†åˆè½¬ä¸ºuserdtoé›†åˆ</span></span><br><span class="line">        List&lt;UserDTO&gt; list = users.stream().map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.ok(list);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å…³æ³¨å–å…³ä¸åˆ¤æ–­æ˜¯å¦å…³æ³¨"><a href="#å…³æ³¨å–å…³ä¸åˆ¤æ–­æ˜¯å¦å…³æ³¨" class="headerlink" title="å…³æ³¨å–å…³ä¸åˆ¤æ–­æ˜¯å¦å…³æ³¨"></a>å…³æ³¨å–å…³ä¸åˆ¤æ–­æ˜¯å¦å…³æ³¨</h2><p>è¿™ä¸€éƒ¨åˆ†æœ‰ç‚¹ç®€å•ï¼Œä¸åšè§£é‡Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/follow&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FollowController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IFollowService iFollowService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;/&#123;isFollow&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long followed,<span class="meta">@PathVariable(&quot;isFollow&quot;)</span> <span class="type">boolean</span> isFollow )</span>&#123;</span><br><span class="line">        iFollowService.follow(followed,isFollow);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/or/not/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">isFollow</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long writerId)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(iFollowService.isFollow(writerId));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FollowServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;FollowMapper, Follow&gt; <span class="keyword">implements</span> <span class="title class_">IFollowService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">follow</span><span class="params">(Long followed, <span class="type">boolean</span> isFollow)</span> &#123;</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;è¯·å…ˆç™»å½•ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> user.getId();</span><br><span class="line"><span class="comment">//        å…³æ³¨</span></span><br><span class="line">        <span class="keyword">if</span>(isFollow)&#123;</span><br><span class="line">            <span class="type">Follow</span> <span class="variable">follow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Follow</span>();</span><br><span class="line">            follow.setUserId(userId);</span><br><span class="line">            follow.setFollowUserId(followed);</span><br><span class="line"><span class="comment">//            ä¿å­˜</span></span><br><span class="line">            save(follow);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//            å–å…³</span></span><br><span class="line">            QueryWrapper&lt;Follow&gt; followQueryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">            followQueryWrapper.eq(<span class="string">&quot;user_id&quot;</span>,userId);</span><br><span class="line">            followQueryWrapper.eq(<span class="string">&quot;follow_user_id&quot;</span>,followed);</span><br><span class="line"></span><br><span class="line">            remove(followQueryWrapper);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFollow</span><span class="params">(Long writerId)</span> &#123;</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> user.getId();</span><br><span class="line"></span><br><span class="line">        QueryWrapper&lt;Follow&gt; followQueryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        followQueryWrapper.eq(<span class="string">&quot;user_id&quot;</span>,userId);</span><br><span class="line">        followQueryWrapper.eq(<span class="string">&quot;follow_user_id&quot;</span>,writerId);</span><br><span class="line"></span><br><span class="line">        <span class="type">Follow</span> <span class="variable">one</span> <span class="operator">=</span> getOne(followQueryWrapper);</span><br><span class="line">        <span class="keyword">return</span> one != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è·å–ä»–äººä¸»é¡µä¿¡æ¯"><a href="#è·å–ä»–äººä¸»é¡µä¿¡æ¯" class="headerlink" title="è·å–ä»–äººä¸»é¡µä¿¡æ¯"></a>è·å–ä»–äººä¸»é¡µä¿¡æ¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getOtherInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long otherId)</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(otherId);</span><br><span class="line">    <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result.ok(userDTO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®å®æˆ˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> Redis </tag>
            
            <tag> é¡¹ç›®å®æˆ˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JWTåŸºç¡€æ•™å­¦</title>
      <link href="/2024/02/24/JWT%E5%9F%BA%E7%A1%80%E6%95%99%E5%AD%A6/"/>
      <url>/2024/02/24/JWT%E5%9F%BA%E7%A1%80%E6%95%99%E5%AD%A6/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>JWTå…¨ç§°JSON WEB TOKENSï¼Œæ˜¯å½“ä¸‹éå¸¸æµè¡Œçš„è·¨åŸŸèº«ä»½éªŒè¯æ–¹æ³•ã€‚ä¼ ç»Ÿçš„èº«ä»½éªŒè¯éœ€è¦æœåŠ¡ç«¯å°†ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯”å¦‚ç™»å½•ä¿¡æ¯å­˜å…¥sessionï¼Œç„¶ååœ¨ç”¨æˆ·æƒ³è¦è®¿é—®åç«¯æœåŠ¡æ—¶ï¼Œé€šè¿‡æ¯”å¯¹ç”¨æˆ·çš„ç™»å½•çŠ¶æ€å’Œsessionä¸­çš„æ•°æ®æ¥è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä½†è¿™ç§æ–¹å¼åœ¨åˆ†å¸ƒå¼ä¸­å°±æ˜¾å¾—å¾ˆéº»çƒ¦äº†ï¼ŒJWT å¯ä»¥è·¨åŸŸä¼ è¾“ï¼Œé€‚ç”¨äºå¾®æœåŠ¡ã€APIç½‘å…³ç­‰åœºæ™¯ï¼Œå› ä¸ºå®ƒåœ¨å®¢æˆ·ç«¯å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œå‡è½»äº†æœåŠ¡å™¨çš„å†…å­˜å‹åŠ›</p><h1 id="JWTçš„ç»„æˆ"><a href="#JWTçš„ç»„æˆ" class="headerlink" title="JWTçš„ç»„æˆ"></a>JWTçš„ç»„æˆ</h1><p>JWTæ•´ä½“ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šHeaderã€Payloadã€Signature</p><h2 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h2><p>Headeré€šå¸¸ç”±ä»¤ç‰Œçš„ç±»å‹å’ŒåŠ å¯†çš„ç®—æ³•ç»„æˆ,ä¾‹å¦‚ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h2><p>è¿™éƒ¨åˆ†ä¸»è¦æ˜¯è®°å½•æˆ‘ä»¬æ‰€å­˜å‚¨çš„ç®€å•ä¸”ä¸é‡è¦çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼šç”¨æˆ·åï¼Œè¿‡æœŸæ—¶é—´ï¼Œç”¨æˆ·idç­‰ç­‰ï¼Œæ³¨æ„payloadä¸­çš„æ•°æ®ä¸º<strong>å…¬å¼€</strong>çš„ï¼Œä¸èƒ½åœ¨é‡Œé¢å­˜æ”¾æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚password</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1234567890&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;John Doe&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;admin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h2><p>ç­¾åé‡Œæ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼ŒHeaderçš„Base64ç¼–ç ï¼ŒPayloadçš„Base64ç¼–ç ï¼Œè¿˜æœ‰secretï¼Œç„¶åé€šè¿‡æŒ‡å®šçš„åŠ å¯†æ–¹å¼ï¼Œä¾‹å¦‚HS256ï¼Œè¿›è¡ŒåŠ å¯†åå¾—å‡ºçš„å­—ç¬¦ä¸²</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">  base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> +</span><br><span class="line">  base64UrlEncode(payload)<span class="punctuation">,</span></span><br><span class="line">  secret)</span><br></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†æ˜¯jwtä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><p>1.éªŒè¯è¯¥Tokenåœ¨å‘é€è¿‡ç¨‹ä¸­æ˜¯å¦è¢«ä¿®æ”¹ </p><blockquote><p>å› ä¸ºtokenä¸­å­˜åœ¨secretï¼Œæ˜¯æˆ‘ä»¬æŒ‡å®šçš„å¯†é’¥ï¼Œè¯¥å¯†é’¥ä¿å­˜åœ¨æœåŠ¡ç«¯ä¸”ä¸ä¼šå‘ç”¨æˆ·å…¬å¼€ï¼Œè¿™æ ·æ ¹æ®è¯·æ±‚tokenä¸­çš„secretå°±èƒ½åˆ¤æ–­æ˜¯å¦æœ‰è¢«ä¿®æ”¹</p></blockquote><p>2.éªŒè¯ç­¾å‘äººçš„èº«ä»½</p><blockquote><p>ç¬¬äºŒä¸ªåŠŸèƒ½æ˜¯æ˜¯ä»ç¬¬ä¸€ä¸ªåŠŸèƒ½ä¸­ä½“ç°å‡ºæ¥çš„ï¼Œå› ä¸ºåªæœ‰è‡ªå·±æ‰çŸ¥é“è‡ªå·±çš„token</p></blockquote><p>åœ¨è®¡ç®—å‡ºç­¾åå“ˆå¸Œåï¼ŒJWTå¤´ï¼ˆHeaderï¼‰ï¼Œæœ‰æ•ˆè½½è·ï¼ˆPayloadï¼‰å’Œç­¾åå“ˆå¸Œï¼ˆSignatureï¼‰çš„ä¸‰ä¸ªéƒ¨åˆ†ç»„åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ç”¨â€.â€åˆ†éš”ï¼Œå°±æ„æˆæ•´ä¸ªJWTå¯¹è±¡ã€‚</p><h1 id="JWTä½¿ç”¨é€»è¾‘"><a href="#JWTä½¿ç”¨é€»è¾‘" class="headerlink" title="JWTä½¿ç”¨é€»è¾‘"></a>JWTä½¿ç”¨é€»è¾‘</h1><ol><li>ç”¨æˆ·å‘é€ç™»å½•è¯·æ±‚ï¼Œå°†ç”¨æˆ·åå’Œå¯†ç ä¼ å…¥åç«¯</li><li>åç«¯æ¥æ”¶åæ ¸å¯¹è´¦å·å¯†ç æ— è¯¯ï¼Œåˆ™æ ¹æ®è§„åˆ™ç”Ÿæˆjwt token</li><li>åç«¯å°†ç”Ÿæˆçš„tokenè¿”å›ç»™å‰ç«¯ï¼Œå‰ç«¯ä¿å­˜åœ¨æœ¬åœ°å¦‚localStorageæˆ–sessionStorageï¼Œé€€å‡ºç™»å½•æ—¶åˆ é™¤å³å¯</li><li>å‰ç«¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å°†JWTæ”¾å…¥HTTP Headerä¸­çš„Authorizationä½ã€‚(è§£å†³XSSå’ŒXSRFé—®é¢˜)</li><li>åç«¯æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œå¦‚å­˜åœ¨éªŒè¯JWTçš„æœ‰æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œæ£€æŸ¥ç­¾åæ˜¯å¦æ­£ç¡®ï¼›æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸï¼›æ£€æŸ¥Tokençš„æ¥æ”¶æ–¹æ˜¯å¦æ˜¯è‡ªå·±(å¯é€‰)ã€‚</li><li>éªŒè¯é€šè¿‡ååç«¯ä½¿ç”¨JWTä¸­åŒ…å«çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œå…¶ä»–é€»è¾‘æ“ä½œï¼Œè¿”å›ç›¸åº”ç»“æœã€‚</li></ol><h1 id="å…·ä½“ä½¿ç”¨ç¤ºä¾‹"><a href="#å…·ä½“ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="å…·ä½“ä½¿ç”¨ç¤ºä¾‹"></a>å…·ä½“ä½¿ç”¨ç¤ºä¾‹</h1><h2 id="å¯¼å…¥ä¾èµ–"><a href="#å¯¼å…¥ä¾èµ–" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºTokenUtilsç±»ç”¨æ¥æ”¾ç½®å¸¸ç”¨æ–¹æ³•"><a href="#åˆ›å»ºTokenUtilsç±»ç”¨æ¥æ”¾ç½®å¸¸ç”¨æ–¹æ³•" class="headerlink" title="åˆ›å»ºTokenUtilsç±»ç”¨æ¥æ”¾ç½®å¸¸ç”¨æ–¹æ³•"></a>åˆ›å»ºTokenUtilsç±»ç”¨æ¥æ”¾ç½®å¸¸ç”¨æ–¹æ³•</h2><h3 id="è·å–token"><a href="#è·å–token" class="headerlink" title="è·å–token"></a>è·å–token</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tokenä¸€å¤©åè¿‡æœŸ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">EXPIRE_TIME</span> <span class="operator">=</span> <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">genToken</span><span class="params">(String username,String secret)</span>&#123;</span><br><span class="line">    <span class="comment">//ç°åœ¨ç³»ç»Ÿçš„æ—¶é—´ + ä¸€å¤©</span></span><br><span class="line">    <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + EXPIRE_TIME);</span><br><span class="line">    <span class="comment">//å¯¹å¯†ç è¿›è¡ŒåŠ å¯†</span></span><br><span class="line">    <span class="type">Algorithm</span> <span class="variable">algorithm</span> <span class="operator">=</span> Algorithm.HMAC256(secret);</span><br><span class="line">    <span class="comment">// é™„å¸¦usernameä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">return</span> JWT.create()</span><br><span class="line">            .withClaim(<span class="string">&quot;username&quot;</span>, username)</span><br><span class="line">            .withExpiresAt(date)</span><br><span class="line">            .sign(algorithm);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºæ‹¦æˆªå™¨"><a href="#åˆ›å»ºæ‹¦æˆªå™¨" class="headerlink" title="åˆ›å»ºæ‹¦æˆªå™¨"></a>åˆ›å»ºæ‹¦æˆªå™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtFilter</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä» http è¯·æ±‚å¤´ä¸­å–å‡º token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="comment">// å¦‚æœè¯·æ±‚ä¸æ˜¯æ˜ å°„åˆ°æ–¹æ³•ç›´æ¥é€šè¿‡</span></span><br><span class="line">        <span class="keyword">if</span>(!(handler <span class="keyword">instanceof</span> HandlerMethod))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (token != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> TokenUtils.getUserNameByToken(request);</span><br><span class="line">            <span class="comment">// è¿™è¾¹æ‹¿åˆ°çš„ ç”¨æˆ·å åº”è¯¥å»æ•°æ®åº“æŸ¥è¯¢è·å¾—å¯†ç ï¼Œç®€ç•¥ï¼Œæ­¥éª¤åœ¨serviceç›´æ¥è·å–å¯†ç </span></span><br><span class="line">            LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            queryWrapper.eq(StringUtils.isNotEmpty(username),User::getName,username);</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> TokenUtils.verify(token,username,user.getPassword());</span><br><span class="line">            <span class="keyword">if</span>(result)&#123;</span><br><span class="line">                log.info(<span class="string">&quot;é€šè¿‡æ‹¦æˆªå™¨&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServiceException</span>(Constants.CODE_401,<span class="string">&quot;tokenè®¤è¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ‹¦æˆªå™¨"><a href="#é…ç½®æ‹¦æˆªå™¨" class="headerlink" title="é…ç½®æ‹¦æˆªå™¨"></a>é…ç½®æ‹¦æˆªå™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123; <span class="comment">//ä¸€å®šè¦é€šè¿‡beanæ³¨å…¥ï¼Œä¸èƒ½new </span></span><br><span class="line">        registry.addInterceptor(authenticationInterceptor())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/user/login&quot;</span>, <span class="string">&quot;/user/register&quot;</span>, <span class="string">&quot;**/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> JwtFilter <span class="title function_">authenticationInterceptor</span><span class="params">()</span> &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JwtFilter</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å½“å‰ç«¯çš„è¯·æ±‚å‘é€è¿‡æ¥æ—¶é¦–å…ˆä¼šè¢«æ‹¦æˆªï¼Œä»ä¸­å–å‡ºtokenï¼Œå¦‚æœæ²¡æœ‰tokenåˆ™è¯´æ˜æœªç™»å½•ï¼Œè¿”å›æœªç™»å½•çš„é”™è¯¯ä¿¡æ¯ã€‚æœ‰tokenåˆ™éªŒè¯tokenä¸­çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦è¢«ç¯¡æ”¹è¿‡ï¼ŒéªŒè¯é€šè¿‡åï¼Œæ‹¦æˆªå™¨æ”¾è¡Œï¼Œå‰ç«¯èƒ½æ­£å¸¸æ”¶åˆ°åç«¯è¿”å›çš„æ•°æ®ã€‚</p><p>jwtçš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯æœåŠ¡ç«¯ä¸ä¿å­˜ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œè€Œæ˜¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶éªŒè¯ç”¨æˆ·å‘é€çš„tokenï¼Œtokené¦–æ¬¡äº¤ç»™ç”¨æˆ·ï¼Œç”¨æˆ·å¯ä»¥å°†å…¶ä¿å­˜åœ¨localstorageä¸­ï¼Œç„¶ååœ¨æ¯æ¬¡è¯·æ±‚å¤´ä¸­æ·»åŠ tokenï¼Œåç«¯æ”¶åˆ°å¹¶éªŒè¯æ­£ç¡®åå³å¯å¼€å§‹æ­£å¸¸çš„ä¸šåŠ¡é€»è¾‘ï¼Œå…¶ä¸­è¿”å›ç»™ç”¨æˆ·çš„tokenå¯ä»¥åœ¨ç”¨æˆ·ç™»å½•æˆåŠŸæ—¶ä¸€å¹¶è¿”å›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Res&lt;User&gt; <span class="title function_">Login</span><span class="params">(<span class="meta">@RequestBody</span> UserDto user, HttpServletRequest request)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> user.getUsername();</span><br><span class="line">        log.info(<span class="string">&quot;ç”¨æˆ·&#123;&#125;æ­£åœ¨ç™»å½•&quot;</span>,userName);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> DigestUtils.md5DigestAsHex(user.getPassword().getBytes());</span><br><span class="line"><span class="comment">//        HttpSession session = request.getSession();</span></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(User::getName,userName);</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">one</span> <span class="operator">=</span> userService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(one == <span class="literal">null</span>)&#123;</span><br><span class="line">            log.error(<span class="string">&quot;ç™»å½•å¤±è´¥ï¼Œç”¨æˆ·åä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Res.error(<span class="string">&quot;ç”¨æˆ·åä¸å­˜åœ¨,è¯·å…ˆæ³¨å†Œ!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(password.equals(one.getPassword()))&#123;</span><br><span class="line"><span class="comment">//            session.setAttribute(&quot;user&quot;,one.getId());</span></span><br><span class="line">            log.info(<span class="string">&quot;ç™»å½•æˆåŠŸ&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            log.error(<span class="string">&quot;å¯†ç é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">            log.info(<span class="string">&quot;ä¼ å…¥ï¼š&#123;&#125;ï¼Œæ­£ç¡®ï¼š&#123;&#125;&quot;</span>,password,one.getPassword());</span><br><span class="line">            <span class="keyword">return</span> Res.error(<span class="string">&quot;å¯†ç é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> TokenUtils.genToken(userName, password);</span><br><span class="line">        Res&lt;User&gt; res = Res.success(one);</span><br><span class="line">        res.setToken(token);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="å‰ç«¯åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ token"><a href="#å‰ç«¯åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ token" class="headerlink" title="å‰ç«¯åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ token"></a>å‰ç«¯åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ token</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// request æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment">// å¯ä»¥è‡ªè¯·æ±‚å‘é€å‰å¯¹è¯·æ±‚åšä¸€äº›å¤„ç†</span></span><br><span class="line"><span class="comment">// æ¯”å¦‚ç»Ÿä¸€åŠ tokenï¼Œå¯¹è¯·æ±‚å‚æ•°ç»Ÿä¸€åŠ å¯†</span></span><br><span class="line">request.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">headers</span>[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json;charset=utf-8&#x27;</span>;</span><br><span class="line">    <span class="keyword">let</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(token != <span class="literal">null</span>)&#123;</span><br><span class="line">        config.<span class="property">headers</span>[<span class="string">&#x27;token&#x27;</span>] = token;  <span class="comment">// è®¾ç½®è¯·æ±‚å¤´</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">&#125;, <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202402251717236.png" alt="image-20240225171711158"></p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„ç”Ÿæ´»ï¼ˆä¸€ï¼‰</title>
      <link href="/2024/02/18/%E6%88%91%E7%9A%84%E7%94%9F%E6%B4%BB%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2024/02/18/%E6%88%91%E7%9A%84%E7%94%9F%E6%B4%BB%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>ä»å¼€å§‹åšåšå®¢ä¹Ÿä¸€å¹´å¤šäº†ï¼ŒæœŸé—´æˆ‘ä¸€ç›´å°†åšå®¢ä½œä¸ºä¸€ä¸ªå¯ä»¥ä¼˜é›…åœ°ï¼ˆç›¸è¾ƒäºç›´æ¥çœ‹markdownï¼‰å¤ä¹ æˆ‘çš„å­¦ä¹ ç¬”è®°çš„å¹³å°ï¼Œä½†æ˜¯æ€æ¥æƒ³å»ï¼Œä¸€ä¸ªåšå®¢å¥½åƒä¸è¯¥å¦‚æ­¤æ¯ç‡¥æ— å‘³ï¼Œä¸€ä¸ªæ­£å¸¸çš„åšå®¢è²Œä¼¼åº”è¯¥æä¾›ä¸€ä¸ªä¸“é—¨çš„æ¿å—ï¼Œä¾›ä½œè€…ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ï¼‰å‘å‘ç‰¢éªšï¼Œéšä¾¿çèŠç‚¹æ—¥å¸¸ï¼Œæˆ–è€…ç¢ç¢å¿µä¸€äº›å°ç ´äº‹ï¼Œè¿™æ ·æ—¥åå¦‚æœåšå®¢èƒ½åšå¤§åšå¼ºï¼Œæœ‰æ›´å¤šäººæ¥çœ‹æˆ‘çš„ç¬”è®°ï¼Œå¬æˆ‘å‘å‘ç‰¢éªšï¼Œæˆ–è€…åœ¨è¯„è®ºåŒºå¯¹æˆ‘å‘å‘ç‰¢éªšï¼Œè¿™æƒ³å¿…æ¯”ä¸€ä¸ªé“ºå¤©ç›–åœ°æ˜¯å­¦ä¹ èµ„æ–™çš„ç½‘ç«™è¦æœ‰è¶£å¾—å¤šã€‚</p><p>â€‹â€”â€”â€”â€”â€”â€”lf 2024.2.18</p>]]></content>
      
      
      <categories>
          
          <category> éšä¾¿èŠèŠ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éšä¾¿ </tag>
            
            <tag> æ—¥å¸¸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®æœåŠ¡å…¥é—¨å­¦ä¹ ï¼ˆäºŒï¼‰</title>
      <link href="/2023/12/27/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2023/12/27/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Elasticsearchåˆ†å¸ƒå¼æœç´¢ä»‹ç»"><a href="#Elasticsearchåˆ†å¸ƒå¼æœç´¢ä»‹ç»" class="headerlink" title="Elasticsearchåˆ†å¸ƒå¼æœç´¢ä»‹ç»"></a>Elasticsearchåˆ†å¸ƒå¼æœç´¢ä»‹ç»</h1><blockquote><p>éƒ¨åˆ†èµ„æ–™æ¥è‡ªä¸é»‘é©¬ç¨‹åºå‘˜å…¬å¼€è¯¾ç¨‹</p></blockquote><h2 id="ä½•ä¸ºElasticsearch"><a href="#ä½•ä¸ºElasticsearch" class="headerlink" title="ä½•ä¸ºElasticsearch"></a>ä½•ä¸ºElasticsearch</h2><p>elasticsearchç»“åˆkibanaã€Logstashã€Beatsï¼Œä¹Ÿå°±æ˜¯elastic stackï¼ˆELKï¼‰ã€‚è¢«å¹¿æ³›åº”ç”¨åœ¨æ—¥å¿—æ•°æ®åˆ†æã€å®æ—¶ç›‘æ§ç­‰é¢†åŸŸï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312271434935.png" alt="image-20210720194008781"></p><p>è€Œelasticsearchæ˜¯elastic stackçš„æ ¸å¿ƒï¼Œè´Ÿè´£å­˜å‚¨ã€æœç´¢ã€åˆ†ææ•°æ®ã€‚</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312271434958.png" alt="image-20210720194230265"></p><h3 id="å€’æ’ç´¢å¼•"><a href="#å€’æ’ç´¢å¼•" class="headerlink" title="å€’æ’ç´¢å¼•"></a>å€’æ’ç´¢å¼•</h3><p>å€’æ’ç´¢å¼•ä¸­æœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼š</p><ul><li>æ–‡æ¡£ï¼ˆ<code>Document</code>ï¼‰ï¼šç”¨æ¥æœç´¢çš„æ•°æ®ï¼Œå…¶ä¸­çš„æ¯ä¸€æ¡æ•°æ®å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ã€‚ä¾‹å¦‚ä¸€ä¸ªç½‘é¡µã€ä¸€ä¸ªå•†å“ä¿¡æ¯</li><li>è¯æ¡ï¼ˆ<code>Term</code>ï¼‰ï¼šå¯¹æ–‡æ¡£æ•°æ®æˆ–ç”¨æˆ·æœç´¢æ•°æ®ï¼Œåˆ©ç”¨æŸç§ç®—æ³•åˆ†è¯ï¼Œå¾—åˆ°çš„å…·å¤‡å«ä¹‰çš„è¯è¯­å°±æ˜¯è¯æ¡ã€‚ä¾‹å¦‚ï¼šæˆ‘æ˜¯ä¸­å›½äººï¼Œå°±å¯ä»¥åˆ†ä¸ºï¼šæˆ‘ã€æ˜¯ã€ä¸­å›½äººã€ä¸­å›½ã€å›½äººè¿™æ ·çš„å‡ ä¸ªè¯æ¡</li></ul><p><strong>åˆ›å»ºå€’æ’ç´¢å¼•</strong>æ˜¯å¯¹æ­£å‘ç´¢å¼•çš„ä¸€ç§ç‰¹æ®Šå¤„ç†ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å°†æ¯ä¸€ä¸ªæ–‡æ¡£çš„æ•°æ®åˆ©ç”¨ç®—æ³•åˆ†è¯ï¼Œå¾—åˆ°ä¸€ä¸ªä¸ªè¯æ¡</li><li>åˆ›å»ºè¡¨ï¼Œæ¯è¡Œæ•°æ®åŒ…æ‹¬è¯æ¡ã€è¯æ¡æ‰€åœ¨æ–‡æ¡£idã€ä½ç½®ç­‰ä¿¡æ¯</li><li>å› ä¸ºè¯æ¡å”¯ä¸€æ€§ï¼Œå¯ä»¥ç»™è¯æ¡åˆ›å»ºç´¢å¼•ï¼Œä¾‹å¦‚hashè¡¨ç»“æ„ç´¢å¼•</li></ul><p>å¦‚å›¾ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312271445813.png" alt="image-20210720200457207"></p><p>å€’æ’ç´¢å¼•çš„<strong>æœç´¢æµç¨‹</strong>å¦‚ä¸‹ï¼ˆä»¥æœç´¢â€åä¸ºæ‰‹æœºâ€ä¸ºä¾‹ï¼‰ï¼š</p><p>1ï¼‰ç”¨æˆ·è¾“å…¥æ¡ä»¶<code>&quot;åä¸ºæ‰‹æœº&quot;</code>è¿›è¡Œæœç´¢ã€‚</p><p>2ï¼‰å¯¹ç”¨æˆ·è¾“å…¥å†…å®¹<strong>åˆ†è¯</strong>ï¼Œå¾—åˆ°è¯æ¡ï¼š<code>åä¸º</code>ã€<code>æ‰‹æœº</code>ã€‚</p><p>3ï¼‰æ‹¿ç€è¯æ¡åœ¨å€’æ’ç´¢å¼•ä¸­æŸ¥æ‰¾ï¼Œå¯ä»¥å¾—åˆ°åŒ…å«è¯æ¡çš„æ–‡æ¡£idï¼š1ã€2ã€3ã€‚</p><p>4ï¼‰æ‹¿ç€æ–‡æ¡£idåˆ°æ­£å‘ç´¢å¼•ä¸­æŸ¥æ‰¾å…·ä½“æ–‡æ¡£ã€‚</p><p>å¦‚å›¾ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312271445808.png" alt="image-20210720201115192"></p><p>è™½ç„¶è¦å…ˆæŸ¥è¯¢å€’æ’ç´¢å¼•ï¼Œå†æŸ¥è¯¢å€’æ’ç´¢å¼•ï¼Œä½†æ˜¯æ— è®ºæ˜¯è¯æ¡ã€è¿˜æ˜¯æ–‡æ¡£idéƒ½å»ºç«‹äº†ç´¢å¼•ï¼ŒæŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«ï¼æ— éœ€å…¨è¡¨æ‰«æã€‚</p><p>å€’æ’ç´¢å¼•å°±æ˜¯æŒ‰ç…§å…³é”®è¯å®šä¹‰æ–‡æ¡£ï¼ˆæ•°æ®ï¼‰id</p><h3 id="Mysqlå’ŒEsæ¦‚å¿µå¯¹æ¯”"><a href="#Mysqlå’ŒEsæ¦‚å¿µå¯¹æ¯”" class="headerlink" title="Mysqlå’ŒEsæ¦‚å¿µå¯¹æ¯”"></a>Mysqlå’ŒEsæ¦‚å¿µå¯¹æ¯”</h3><p>Esåœ¨å­˜å‚¨æ•°æ®ï¼ˆæ–‡æ¡£ï¼‰æ—¶ï¼Œå…¶å­˜å‚¨å½¢å¼ä¸ºjsonå‹</p><table><thead><tr><th><strong>MySQL</strong></th><th><strong>Elasticsearch</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>Table</td><td>Index</td><td>ç´¢å¼•(index)ï¼Œå°±æ˜¯æ–‡æ¡£çš„é›†åˆï¼Œç±»ä¼¼æ•°æ®åº“çš„è¡¨(table)</td></tr><tr><td>Row</td><td>Document</td><td>æ–‡æ¡£ï¼ˆDocumentï¼‰ï¼Œå°±æ˜¯ä¸€æ¡æ¡çš„æ•°æ®ï¼Œç±»ä¼¼æ•°æ®åº“ä¸­çš„è¡Œï¼ˆRowï¼‰ï¼Œæ–‡æ¡£éƒ½æ˜¯JSONæ ¼å¼</td></tr><tr><td>Column</td><td>Field</td><td>å­—æ®µï¼ˆFieldï¼‰ï¼Œå°±æ˜¯JSONæ–‡æ¡£ä¸­çš„å­—æ®µï¼Œç±»ä¼¼æ•°æ®åº“ä¸­çš„åˆ—ï¼ˆColumnï¼‰</td></tr><tr><td>Schema</td><td>Mapping</td><td>Mappingï¼ˆæ˜ å°„ï¼‰æ˜¯ç´¢å¼•ä¸­æ–‡æ¡£çš„çº¦æŸï¼Œä¾‹å¦‚å­—æ®µç±»å‹çº¦æŸã€‚ç±»ä¼¼æ•°æ®åº“çš„è¡¨ç»“æ„ï¼ˆSchemaï¼‰</td></tr><tr><td>SQL</td><td>DSL</td><td>DSLæ˜¯elasticsearchæä¾›çš„JSONé£æ ¼çš„è¯·æ±‚è¯­å¥ï¼Œç”¨æ¥æ“ä½œelasticsearchï¼Œå®ç°CRUD</td></tr></tbody></table><h2 id="å®‰è£…ESå’ŒKibana"><a href="#å®‰è£…ESå’ŒKibana" class="headerlink" title="å®‰è£…ESå’ŒKibana"></a>å®‰è£…ESå’ŒKibana</h2><p>å®‰è£…è¿‡ç¨‹ç½‘ä¸Šæœ‰å¾ˆå¤šï¼Œæ­¤å¤„ä¸å¤šåšèµ˜è¿°ï¼Œåˆ©ç”¨dockerå®¹å™¨å¯ä»¥å¾ˆå®¹æ˜“æ„å»ºã€‚</p><p>dockerå¯åŠ¨å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name es  -e <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span>  -e <span class="string">&quot;discovery.type=single-node&quot;</span> -v es-data:/usr/share/elasticsearch/data  -v es-plugins:/usr/share/elasticsearch/plugins  --privileged  --network es-net   -p 9200:9200   -p 9300:9300 elasticsearch:7.12.1</span><br></pre></td></tr></table></figure><p>è®¿é—®é»˜è®¤ç«¯å£9200å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„æ ·å­</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312271518647.png" alt="image-20231227151810464"></p><p>Kibanaå¯åŠ¨å‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name kibana -e ELASTICSEARCH_HOSTS=http://es:9200 --network=es-net -p 5601:5601  kibana:7.12.1</span><br></pre></td></tr></table></figure><p>æ³¨æ„kibanaç‰ˆæœ¬è¦å’Œesç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œç„¶åè¦åœ¨kibanaä¸­æŒ‡å®šesç«¯å£</p><p>å®‰è£…å¹¶å¯åŠ¨kinabaåå°±å¯ä»¥æ‰“å¼€ä»–çš„å¯è§†åŒ–é¡µé¢</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312271523515.png" alt="image-20231227152329445"></p><h2 id="æŸ¥çœ‹åˆ†è¯å™¨"><a href="#æŸ¥çœ‹åˆ†è¯å™¨" class="headerlink" title="æŸ¥çœ‹åˆ†è¯å™¨"></a>æŸ¥çœ‹åˆ†è¯å™¨</h2><p>ä½¿ç”¨Kibanaè‡ªå¸¦çš„å·¥å…·å¯ä»¥å‘é€DSLè¯·æ±‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æˆ‘æ˜¯æ—å³°æˆ‘çˆ±ç©åŸç¥&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chinese&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°åˆ†è¯ç»“æœ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312271533036.png" alt="image-20231227153308991"></p><p>æ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬ä¸­æ–‡çš„åˆ†è¯è§„åˆ™</p><h2 id="å®‰è£…IKåˆ†è¯å™¨"><a href="#å®‰è£…IKåˆ†è¯å™¨" class="headerlink" title="å®‰è£…IKåˆ†è¯å™¨"></a>å®‰è£…IKåˆ†è¯å™¨</h2><p>å¯ä»¥é€‰æ‹©åœ¨çº¿å®‰è£…ï¼Œæˆ–è€…æ˜¯ç¦»çº¿ä¸‹è½½å¥½åè‡ªå·±æ‰¾åˆ°esæ’ä»¶ç›®å½•ï¼Œç»™ä»–å¡è¿›å»</p><p>åœ¨çº¿ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥å®¹å™¨å†…éƒ¨</span></span><br><span class="line">docker exec -it elasticsearch /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨çº¿ä¸‹è½½å¹¶å®‰è£…</span></span><br><span class="line">./bin/elasticsearch-plugin  install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é€€å‡º</span></span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é‡å¯å®¹å™¨</span></span><br><span class="line">docker restart elasticsearch</span><br></pre></td></tr></table></figure><p>ç¦»çº¿ï¼š</p><p>å®‰è£…æ’ä»¶éœ€è¦çŸ¥é“elasticsearchçš„pluginsç›®å½•ä½ç½®ï¼Œè€Œæˆ‘ä»¬ç”¨äº†æ•°æ®å·æŒ‚è½½ï¼Œå› æ­¤éœ€è¦æŸ¥çœ‹elasticsearchçš„æ•°æ®å·ç›®å½•ï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume inspect es-plugins</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºç»“æœï¼š</p><pre><code>&#123;    &quot;CreatedAt&quot;: &quot;2023-12-27T15:12:44+08:00&quot;,    &quot;Driver&quot;: &quot;local&quot;,    &quot;Labels&quot;: null,    &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/es-plugins/_data&quot;,    &quot;Name&quot;: &quot;es-plugins&quot;,    &quot;Options&quot;: null,    &quot;Scope&quot;: &quot;local&quot;&#125;</code></pre><p>ç„¶åè¿›å…¥åˆ°æ‰€ç»™çš„ç›®å½•ä¸­ï¼Œå°†ä¸‹è½½å¹¶è§£å‹å¥½çš„IKæ–‡ä»¶æ”¾è¿›å»å³å¯</p><p>ç°åœ¨å†å›å»éªŒè¯ä¸€ä¸‹åˆ†è¯ç»“æœ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ—å³°çˆ±ç©æ¸¸æˆ&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ikåˆ†è¯å™¨æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p><ul><li><p><code>ik_smart</code>ï¼šæœ€å°‘åˆ‡åˆ†</p></li><li><p><code>ik_max_word</code>ï¼šæœ€ç»†åˆ‡åˆ†</p></li></ul><p>ik_smartï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312271543763.png" alt="image-20231227154345716"></p><p>ik_max_wordï¼š<br><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312271544493.png" alt="image-20231227154410448"></p><h2 id="åˆ†è¯å™¨æ‰©å±•"><a href="#åˆ†è¯å™¨æ‰©å±•" class="headerlink" title="åˆ†è¯å™¨æ‰©å±•"></a>åˆ†è¯å™¨æ‰©å±•</h2><p>æ‰¾åˆ°ik&#x2F;config&#x2F;IKAnalyzer.cfg.xmlï¼Œåœ¨å…¶ä¸­æ·»åŠ æˆ‘ä»¬æ‰©å±•çš„ext.dicå’Œæ‹¦æˆªè¯stopword.dic</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">&lt;comment&gt;IK Analyzer æ‰©å±•é…ç½®&lt;/comment&gt;</span><br><span class="line">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ --&gt;</span><br><span class="line">&lt;entry key=&quot;ext_dict&quot;&gt;ext.dic&lt;/entry&gt;</span><br><span class="line"> &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span><br><span class="line">&lt;entry key=&quot;ext_stopwords&quot;&gt;stopwords.dic&lt;/entry&gt;</span><br><span class="line">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•å­—å…¸ --&gt;</span><br><span class="line">&lt;!-- &lt;entry key=&quot;remote_ext_dict&quot;&gt;words_location&lt;/entry&gt; --&gt;</span><br><span class="line">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span><br><span class="line">&lt;!-- &lt;entry key=&quot;remote_ext_stopwords&quot;&gt;words_location&lt;/entry&gt; --&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªext.dicå’Œstopwords.dicéœ€è¦è‡ªå·±é…ç½®</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>ext.dic:</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312271600505.png" alt="image-20231227160051426"></p><p>stopword.dic:</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312271603454.png" alt="image-20231227160311420"></p><p>é…ç½®å®Œæˆåé‡å¯ï¼Œç„¶åå›kibanaè¯•è¯•</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æˆ‘æ˜¯æ—å³°æˆ‘çˆ±ç©åŸç¥çˆ±åƒå¥¥åˆ©ç»™&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312271607701.png" alt="image-20231227160714658" style="zoom: 67%;" /><p>å®Œç¾</p><h1 id="ç´¢å¼•åº“æ“ä½œ"><a href="#ç´¢å¼•åº“æ“ä½œ" class="headerlink" title="ç´¢å¼•åº“æ“ä½œ"></a>ç´¢å¼•åº“æ“ä½œ</h1><h2 id="å¸¸è§mappingç±»å‹"><a href="#å¸¸è§mappingç±»å‹" class="headerlink" title="å¸¸è§mappingç±»å‹"></a>å¸¸è§mappingç±»å‹</h2><p>mappingæ˜¯å¯¹ç´¢å¼•åº“ä¸­æ–‡æ¡£çš„çº¦æŸï¼Œå¸¸è§çš„mappingå±æ€§åŒ…æ‹¬ï¼š</p><ul><li>typeï¼šå­—æ®µæ•°æ®ç±»å‹ï¼Œå¸¸è§çš„ç®€å•ç±»å‹æœ‰ï¼š<ul><li>å­—ç¬¦ä¸²ï¼štextï¼ˆå¯åˆ†è¯çš„æ–‡æœ¬ï¼‰ã€keywordï¼ˆç²¾ç¡®å€¼ï¼Œä¾‹å¦‚ï¼šå“ç‰Œã€å›½å®¶ã€ipåœ°å€ï¼‰</li><li>æ•°å€¼ï¼šlongã€integerã€shortã€byteã€doubleã€floatã€</li><li>å¸ƒå°”ï¼šboolean</li><li>æ—¥æœŸï¼šdate</li><li>å¯¹è±¡ï¼šobject</li></ul></li><li>indexï¼šæ˜¯å¦åˆ›å»ºç´¢å¼•ï¼Œé»˜è®¤ä¸ºtrue</li><li>analyzerï¼šä½¿ç”¨å“ªç§åˆ†è¯å™¨</li><li>propertiesï¼šè¯¥å­—æ®µçš„å­å­—æ®µ</li></ul><h2 id="åˆ›å»ºç´¢å¼•åº“è¯­æ³•"><a href="#åˆ›å»ºç´¢å¼•åº“è¯­æ³•" class="headerlink" title="åˆ›å»ºç´¢å¼•åº“è¯­æ³•"></a>åˆ›å»ºç´¢å¼•åº“è¯­æ³•</h2><p>ä¸¾ä¾‹</p><ul><li>è¯·æ±‚æ–¹å¼ï¼šPUT</li><li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;ç´¢å¼•åº“åï¼Œå¯ä»¥è‡ªå®šä¹‰</li><li>è¯·æ±‚å‚æ•°ï¼šmappingæ˜ å°„</li><li>properties: å­—æ®µ</li></ul><p>æ ¼å¼ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PUTÂ /ç´¢å¼•åº“åç§°</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;å­—æ®µå&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;å­—æ®µå2&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;false&quot;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;å­—æ®µå3&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;å­å­—æ®µ&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;keyword&quot;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// ...ç•¥</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">PUT /test01</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;object&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;firstname&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;lastname&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ä»‹ç»</p><blockquote><p>infoï¼šå­—ç¬¦ä¸²ç±»å‹ï¼Œå¯åˆ†å‰²ï¼Œåˆ†è¯å™¨æ˜¯ik_smart,é»˜è®¤å¯æœç´¢ï¼ˆindexä¸ºtrueï¼‰</p><p>emailï¼šå…³é”®è¯ç±»å‹ï¼Œä¸å¯åˆ†å‰²ï¼Œä¸æœç´¢</p><p>nameï¼šå¯¹è±¡ç±»å‹ï¼Œå­˜æ”¾å­—æ®µï¼Œé»˜è®¤å¯æœç´¢</p></blockquote><h2 id="æŸ¥è¯¢ï¼Œåˆ é™¤ï¼Œä¿®æ”¹åº“"><a href="#æŸ¥è¯¢ï¼Œåˆ é™¤ï¼Œä¿®æ”¹åº“" class="headerlink" title="æŸ¥è¯¢ï¼Œåˆ é™¤ï¼Œä¿®æ”¹åº“"></a>æŸ¥è¯¢ï¼Œåˆ é™¤ï¼Œä¿®æ”¹åº“</h2><p>ç´¢å¼•åº“çš„æ“ä½œå®Œå…¨ç¬¦åˆrestfulé£æ ¼ï¼Œå³è·å–ä¸ºgetï¼Œåˆ›å»ºputï¼ˆè¿™ä¸ªå¥½åƒä¸å¤ªç¬¦åˆï¼‰ï¼Œåˆ é™¤ deleteï¼Œç´¢å¼•åº“ä¸å…è®¸ç›´æ¥ä¿®æ”¹å­—æ®µï¼Œåªå…è®¸æ·»åŠ å­—æ®µ</p><p>æŸ¥è¯¢ï¼š<br>ä»putæ”¹ä¸ºget</p><blockquote><p>GET &#x2F;test01</p></blockquote><p>åˆ é™¤</p><blockquote><p>DELETE &#x2F;test01</p></blockquote><p>ä¿®æ”¹(æ·»åŠ ageå­—æ®µ)</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /test01/_mapping</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å†é€šè¿‡getæŸ¥è¯¢</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test01&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;aliases&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;email&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;info&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;analyzer&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;properties&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;firstname&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lastname&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><h1 id="æ–‡æ¡£æ“ä½œ"><a href="#æ–‡æ¡£æ“ä½œ" class="headerlink" title="æ–‡æ¡£æ“ä½œ"></a>æ–‡æ¡£æ“ä½œ</h1><h2 id="æ·»åŠ -post"><a href="#æ·»åŠ -post" class="headerlink" title="æ·»åŠ (post)"></a>æ·»åŠ (post)</h2><p>è¯­æ³•ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POSTÂ /ç´¢å¼•åº“å/_doc/æ–‡æ¡£id</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;å­—æ®µ1&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å€¼1&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;å­—æ®µ2&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å€¼2&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;å­—æ®µ3&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;å­å±æ€§1&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å€¼3&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;å­å±æ€§2&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å€¼4&quot;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST /test01/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="string">&quot;21&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;info&quot;</span><span class="punctuation">:</span><span class="string">&quot;å®‰ç†è®¡ç§‘æ—å³°&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;firstname&quot;</span><span class="punctuation">:</span><span class="string">&quot;æ—&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lastname&quot;</span><span class="punctuation">:</span><span class="string">&quot;å³°&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;827498@qq.com&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸€å®šä¸è¦æ¼â€ï¼Œâ€œ</p><h2 id="æŸ¥è¯¢ï¼ˆgetï¼‰"><a href="#æŸ¥è¯¢ï¼ˆgetï¼‰" class="headerlink" title="æŸ¥è¯¢ï¼ˆgetï¼‰"></a>æŸ¥è¯¢ï¼ˆgetï¼‰</h2><blockquote><p>GET &#x2F;test01&#x2F;_doc&#x2F;1</p></blockquote><p>ç»“æœ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;test01&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;found&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;21&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;info&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;å®‰ç†è®¡ç§‘æ—å³°&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;firstname&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;æ—&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;lastname&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;å³°&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;827498@qq.com&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹-put-x2F-post"><a href="#ä¿®æ”¹-put-x2F-post" class="headerlink" title="ä¿®æ”¹(put&#x2F;post)"></a>ä¿®æ”¹(put&#x2F;post)</h2><p>ä¿®æ”¹æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>å…¨é‡ä¿®æ”¹ï¼šç›´æ¥è¦†ç›–åŸæ¥çš„æ–‡æ¡£(put)</li><li>å¢é‡ä¿®æ”¹ï¼šä¿®æ”¹æ–‡æ¡£ä¸­çš„éƒ¨åˆ†å­—æ®µ(post)</li></ul><h3 id="å…¨é‡ä¿®æ”¹"><a href="#å…¨é‡ä¿®æ”¹" class="headerlink" title="å…¨é‡ä¿®æ”¹"></a>å…¨é‡ä¿®æ”¹</h3><p>å…¨é‡ä¿®æ”¹æ˜¯è¦†ç›–åŸæ¥çš„æ–‡æ¡£ï¼Œå…¶æœ¬è´¨æ˜¯ï¼š</p><ul><li>æ ¹æ®æŒ‡å®šçš„idåˆ é™¤æ–‡æ¡£</li><li>æ–°å¢ä¸€ä¸ªç›¸åŒidçš„æ–‡æ¡£</li></ul><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœæ ¹æ®idåˆ é™¤æ—¶ï¼Œidä¸å­˜åœ¨ï¼Œç¬¬äºŒæ­¥çš„æ–°å¢ä¹Ÿä¼šæ‰§è¡Œï¼Œä¹Ÿå°±ä»ä¿®æ”¹å˜æˆäº†æ–°å¢æ“ä½œäº†ã€‚</p><p><strong>è¯­æ³•ï¼š</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUTÂ /<span class="punctuation">&#123;</span>ç´¢å¼•åº“å<span class="punctuation">&#125;</span>/_doc/æ–‡æ¡£id</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;å­—æ®µ1&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å€¼1&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;å­—æ®µ2&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å€¼2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// ... ç•¥</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¢é‡ä¿®æ”¹"><a href="#å¢é‡ä¿®æ”¹" class="headerlink" title="å¢é‡ä¿®æ”¹"></a>å¢é‡ä¿®æ”¹</h3><p>å¢é‡ä¿®æ”¹æ˜¯åªä¿®æ”¹æŒ‡å®šidåŒ¹é…çš„æ–‡æ¡£ä¸­çš„éƒ¨åˆ†å­—æ®µã€‚</p><p><strong>è¯­æ³•ï¼š</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POSTÂ /<span class="punctuation">&#123;</span>ç´¢å¼•åº“å<span class="punctuation">&#125;</span>/_update/æ–‡æ¡£id</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;å­—æ®µå&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;æ–°çš„å€¼&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>å®ä¾‹ï¼š</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">post /test01/_update/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">25</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å†æŸ¥çœ‹ä¸€ä¸‹ç»“æœ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;test01&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;found&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="number">25</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;info&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;å®‰ç†è®¡ç§‘æ—å³°&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;firstname&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;æ—&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;lastname&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;å³°&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;827498@qq.com&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ageæˆåŠŸä¿®æ”¹ï¼Œä¸”ç‰ˆæœ¬å·åŠ 1ï¼ˆè‡ªå¸¦ç‰ˆæœ¬æ§åˆ¶ï¼‰</p><h2 id="psï¼šå…¶å®ä¸Šé¢çš„æ²¡ä»€ä¹ˆç”¨ï¼Œå› ä¸ºæˆ‘ä»¬æœ€ç»ˆè‚¯å®šæ˜¯è¦ç”¨javaæ§åˆ¶DSL"><a href="#psï¼šå…¶å®ä¸Šé¢çš„æ²¡ä»€ä¹ˆç”¨ï¼Œå› ä¸ºæˆ‘ä»¬æœ€ç»ˆè‚¯å®šæ˜¯è¦ç”¨javaæ§åˆ¶DSL" class="headerlink" title="psï¼šå…¶å®ä¸Šé¢çš„æ²¡ä»€ä¹ˆç”¨ï¼Œå› ä¸ºæˆ‘ä»¬æœ€ç»ˆè‚¯å®šæ˜¯è¦ç”¨javaæ§åˆ¶DSL"></a>psï¼šå…¶å®ä¸Šé¢çš„æ²¡ä»€ä¹ˆç”¨ï¼Œå› ä¸ºæˆ‘ä»¬æœ€ç»ˆè‚¯å®šæ˜¯è¦ç”¨javaæ§åˆ¶DSL</h2><h1 id="RestClientæ“ä½œç´¢å¼•åº“"><a href="#RestClientæ“ä½œç´¢å¼•åº“" class="headerlink" title="RestClientæ“ä½œç´¢å¼•åº“"></a>RestClientæ“ä½œç´¢å¼•åº“</h1><h2 id="ä½¿ç”¨RestClinet"><a href="#ä½¿ç”¨RestClinet" class="headerlink" title="ä½¿ç”¨RestClinet"></a>ä½¿ç”¨RestClinet</h2><p>å¼•å…¥esä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">elasticsearch.version</span>&gt;</span>7.12.1<span class="tag">&lt;/<span class="name">elasticsearch.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--        es--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–RestClientå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelTest</span> &#123;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//    æ‰€æœ‰ä¸šåŠ¡éƒ½éœ€è¦è¯¥å¯¹è±¡ï¼Œå› æ­¤ç›´æ¥æ”¾åˆ°ç±»ä¸­</span></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    åˆå§‹åŒ–client</span></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.client = <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">                HttpHost.create(<span class="string">&quot;http://192.168.10.128:9200&quot;</span>)</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    å…³é—­client</span></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºç´¢å¼•åº“"><a href="#åˆ›å»ºç´¢å¼•åº“" class="headerlink" title="åˆ›å»ºç´¢å¼•åº“"></a>åˆ›å»ºç´¢å¼•åº“</h2><ul><li>1ï¼‰åˆ›å»ºRequestå¯¹è±¡ã€‚å› ä¸ºæ˜¯åˆ›å»ºç´¢å¼•åº“çš„æ“ä½œï¼Œå› æ­¤Requestæ˜¯CreateIndexRequestã€‚</li><li>2ï¼‰æ·»åŠ è¯·æ±‚å‚æ•°ï¼Œå…¶å®å°±æ˜¯DSLçš„JSONå‚æ•°éƒ¨åˆ†ã€‚å› ä¸ºjsonå­—ç¬¦ä¸²å¾ˆé•¿ï¼Œè¿™é‡Œæ˜¯å®šä¹‰äº†é™æ€å­—ç¬¦ä¸²å¸¸é‡MAPPING_TEMPLATEï¼Œè®©ä»£ç çœ‹èµ·æ¥æ›´åŠ ä¼˜é›…ã€‚</li><li>3ï¼‰å‘é€è¯·æ±‚ï¼Œclient.indices()æ–¹æ³•çš„è¿”å›å€¼æ˜¯IndicesClientç±»å‹ï¼Œå°è£…äº†æ‰€æœ‰ä¸ç´¢å¼•åº“æ“ä½œæœ‰å…³çš„æ–¹æ³•ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">creatIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">CreateIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line"></span><br><span class="line">    request.source(MAPPING_TEMPLATE, XContentType.JSON);</span><br><span class="line"></span><br><span class="line">    client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å¤„çš„MAPPING_TEMPLATEä½œä¸ºä¸€ä¸ªé™æ€å˜é‡æ”¾åœ¨åˆ«å¤„äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">hotel_json</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MAPPING_TEMPLATE</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;  \&quot;mappings\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    \&quot;properties\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;id\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;name\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;text\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;address\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;index\&quot;: false\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;price\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;score\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;brand\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;city\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;starName\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;business\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;location\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;geo_point\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;pic\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;index\&quot;: false\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;all\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;text\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;  &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›åˆ°æµè§ˆå™¨ç¡®è®¤ä¸€ä¸‹ï¼Œå‘ç°æˆåŠŸåˆ›å»ºindex</p><h2 id="åˆ é™¤ç´¢å¼•åº“"><a href="#åˆ é™¤ç´¢å¼•åº“" class="headerlink" title="åˆ é™¤ç´¢å¼•åº“"></a>åˆ é™¤ç´¢å¼•åº“</h2><p>ä¸¾ä¸€åä¸‰ï¼Œåˆ é™¤ç´¢å¼•åº“æ— éå°±æ˜¯æŠŠåˆ›å»ºè¯·æ±‚è½¬å˜ä¸ºåˆ é™¤è¯·æ±‚ï¼Œä¸”é™¤äº†åº“åä¸éœ€è¦å…¶ä»–å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">DeleteIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line"></span><br><span class="line">    client.indices().delete(request,RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿”å›æµè§ˆå™¨æµ‹è¯•ï¼Œåˆ é™¤æˆåŠŸ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312302256455.png" alt="image-20231230225601384"></p><h2 id="åˆ¤æ–­æ˜¯å¦å­˜åœ¨"><a href="#åˆ¤æ–­æ˜¯å¦å­˜åœ¨" class="headerlink" title="åˆ¤æ–­æ˜¯å¦å­˜åœ¨"></a>åˆ¤æ–­æ˜¯å¦å­˜åœ¨</h2><p>ä½¿ç”¨getè¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testExistsHotelIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºRequestå¯¹è±¡</span></span><br><span class="line">    <span class="type">GetIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 3.è¾“å‡º</span></span><br><span class="line">    System.err.println(exists ? <span class="string">&quot;ç´¢å¼•åº“å·²ç»å­˜åœ¨ï¼&quot;</span> : <span class="string">&quot;ç´¢å¼•åº“ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¾€ç´¢å¼•åº“é‡Œæ·»åŠ æ•°æ®"><a href="#å¾€ç´¢å¼•åº“é‡Œæ·»åŠ æ•°æ®" class="headerlink" title="å¾€ç´¢å¼•åº“é‡Œæ·»åŠ æ•°æ®"></a>å¾€ç´¢å¼•åº“é‡Œæ·»åŠ æ•°æ®</h2><p>æ³¨æ„å¦‚æœæ˜¯ç´¢å¼•åº“æ“ä½œï¼Œé‚£è°ƒç”¨çš„æ˜¯clientçš„indicesï¼Œå¦‚æœæ˜¯æ–‡æ¡£æ“ä½œï¼Œåˆ™è°ƒç”¨çš„æ˜¯client.index</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">AddHotelTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//        è·å–æ•°æ®åº“æ•°æ®</span></span><br><span class="line">        <span class="type">Hotel</span> <span class="variable">hotel</span> <span class="operator">=</span> hotelService.getById(<span class="number">36934L</span>);</span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDoc</span>(hotel);</span><br><span class="line"><span class="comment">//        åˆ›å»ºè¯·æ±‚å¯¹è±¡</span></span><br><span class="line">        <span class="type">IndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;hotel&quot;</span>).id(hotel.getId().toString());</span><br><span class="line"><span class="comment">//        å°†æŸ¥è¯¢å‡ºæ¥çš„å†…å®¹ä½œä¸ºsourceèµ‹å€¼ç»™è¯·æ±‚</span></span><br><span class="line"><span class="comment">//        æ­¤å¤„è°ƒç”¨fastJsonçš„æ–¹æ³•ï¼Œå¯ä»¥å°†å¯¹è±¡å¿«é€Ÿè½¬æ¢ä¸ºjsonæ ¼å¼</span></span><br><span class="line">        request.source(JSON.toJSONString(hotelDoc), XContentType.JSON);</span><br><span class="line"><span class="comment">//        è°ƒç”¨clientæ–¹æ³•add</span></span><br><span class="line">        client.index(request, RequestOptions.DEFAULT);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å›ç½‘é¡µé‰´å®šä¸€ä¸‹ï¼Œç¡®å®æ²¡é—®é¢˜</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312302334411.png" alt="image-20231230233408321"></p><h2 id="æŒ‰idè·å–ç´¢å¼•åº“ä¸­çš„å€¼"><a href="#æŒ‰idè·å–ç´¢å¼•åº“ä¸­çš„å€¼" class="headerlink" title="æŒ‰idè·å–ç´¢å¼•åº“ä¸­çš„å€¼"></a>æŒ‰idè·å–ç´¢å¼•åº“ä¸­çš„å€¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getHotelByIdTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//        æ„é€ è¯·æ±‚</span></span><br><span class="line">        <span class="type">GetRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>(<span class="string">&quot;hotel&quot;</span>, <span class="string">&quot;36934&quot;</span>);</span><br><span class="line"><span class="comment">//        è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">        <span class="type">GetResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.get(request, RequestOptions.DEFAULT);</span><br><span class="line"><span class="comment">//        è·å–è¿”å›å¯¹è±¡ä¸­çš„sourceå‚æ•°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">hotel</span> <span class="operator">=</span> response.getSourceAsString();</span><br><span class="line"></span><br><span class="line">        System.out.println(hotel);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312302341045.png" alt="image-20231230234114954"></p><h2 id="æ›´æ–°æ–‡æ¡£æ•°æ®"><a href="#æ›´æ–°æ–‡æ¡£æ•°æ®" class="headerlink" title="æ›´æ–°æ–‡æ¡£æ•°æ®"></a>æ›´æ–°æ–‡æ¡£æ•°æ®</h2><p>ä¹‹å‰æœ‰è¯´æ›´æ–°æ–‡æ¡£å­˜åœ¨ä¸¤ç§å½¢å¼ï¼Œä¸€æ˜¯ç›´æ¥åˆ é™¤åŸæ¥çš„ï¼Œé‡æ–°åŠ å…¥ä¸€æ¡æ–°çš„ã€‚äºŒæ˜¯åœ¨åŸæ¥çš„åŸºç¡€ä¸Šä¿®æ”¹</p><p>æ­¤å¤„æ¼”ç¤ºç¬¬äºŒç§</p><p>è°ƒç”¨çš„æ˜¯clientçš„updateæ–¹æ³•ï¼Œupdateå¿…ç„¶è¦æä¾›è¦ä¿®æ”¹çš„é”®è¿˜æœ‰ä»–çš„æ–°å€¼ï¼Œè¿™äº›éƒ½æ”¾åœ¨updaterequestçš„docä¸­ï¼Œæ¯ä¸¤ä¸ªä½œä¸ºä¸€å¯¹é”®å€¼å¯¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">void</span> <span class="title function_">updateByIdTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">UpdateRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(<span class="string">&quot;hotel&quot;</span>, <span class="string">&quot;36934&quot;</span>);</span><br><span class="line"></span><br><span class="line">        request.doc(</span><br><span class="line"><span class="comment">//                æ¯ä¸¤ä¸ªå‚æ•°ä½œä¸ºä¸€å¯¹ key value</span></span><br><span class="line">                <span class="string">&quot;brand&quot;</span>,<span class="string">&quot;666å¤©é…’åº—&quot;</span>,</span><br><span class="line">                <span class="string">&quot;city&quot;</span>,<span class="string">&quot;æ·®å—&quot;</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        client.update(request,RequestOptions.DEFAULT);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æˆåŠŸ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312302349964.png" alt="image-20231230234946907"></p><h2 id="åˆ é™¤æ–‡æ¡£"><a href="#åˆ é™¤æ–‡æ¡£" class="headerlink" title="åˆ é™¤æ–‡æ¡£"></a>åˆ é™¤æ–‡æ¡£</h2><p>å¤ªç®€å•ï¼Œä¸å¤šè¯´äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">DeleteRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(<span class="string">&quot;hotel&quot;</span>, <span class="string">&quot;36934&quot;</span>);</span><br><span class="line"></span><br><span class="line">    client.delete(request,RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰¹é‡æ“ä½œ"><a href="#æ‰¹é‡æ“ä½œ" class="headerlink" title="æ‰¹é‡æ“ä½œ"></a>æ‰¹é‡æ“ä½œ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBulkRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// æ‰¹é‡æŸ¥è¯¢é…’åº—æ•°æ®</span></span><br><span class="line">    List&lt;Hotel&gt; hotels = hotelService.list();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºRequest</span></span><br><span class="line">    <span class="type">BulkRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡å‚æ•°ï¼Œæ·»åŠ å¤šä¸ªæ–°å¢çš„Request</span></span><br><span class="line">    <span class="keyword">for</span> (Hotel hotel : hotels) &#123;</span><br><span class="line">        <span class="comment">// 2.1.è½¬æ¢ä¸ºæ–‡æ¡£ç±»å‹HotelDoc</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDoc</span>(hotel);</span><br><span class="line">        <span class="comment">// 2.2.åˆ›å»ºæ–°å¢æ–‡æ¡£çš„Requestå¯¹è±¡</span></span><br><span class="line">        request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;hotel&quot;</span>)</span><br><span class="line">                    .id(hotelDoc.getId().toString())</span><br><span class="line">                    .source(JSON.toJSONString(hotelDoc), XContentType.JSON));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    client.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DSLæ‰¹é‡æ’å™æŒ‡ä»¤ï¼š<br>GET &#x2F;_hotel&#x2F;_search</p><h1 id="DSLæŸ¥è¯¢è¯­å¥"><a href="#DSLæŸ¥è¯¢è¯­å¥" class="headerlink" title="DSLæŸ¥è¯¢è¯­å¥"></a>DSLæŸ¥è¯¢è¯­å¥</h1><h2 id="DSLåˆ†ç±»"><a href="#DSLåˆ†ç±»" class="headerlink" title="DSLåˆ†ç±»"></a>DSLåˆ†ç±»</h2><ul><li>æŸ¥è¯¢æ‰€æœ‰ï¼šæŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®</li><li>å…¨æ–‡æ£€ç´¢ï¼šåˆ©ç”¨åˆ†è¯å™¨å°†ç”¨æˆ·è¾“å…¥åˆ†è¯ï¼Œç„¶åä»ç´¢å¼•åº“ä¸­æŸ¥è¯¢<ul><li>match_query</li><li>multi_match_query</li></ul></li><li>ç²¾ç¡®æŸ¥æ‰¾ï¼šæ ¹æ®ç²¾ç¡®è¯æ¡æŸ¥æ‰¾</li></ul><h2 id="æŸ¥è¯¢æ‰€æœ‰"><a href="#æŸ¥è¯¢æ‰€æœ‰" class="headerlink" title="æŸ¥è¯¢æ‰€æœ‰"></a>æŸ¥è¯¢æ‰€æœ‰</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥è¯¢æ‰€æœ‰</span></span><br><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="å…¨æ–‡æ£€ç´¢"><a href="#å…¨æ–‡æ£€ç´¢" class="headerlink" title="å…¨æ–‡æ£€ç´¢"></a>å…¨æ–‡æ£€ç´¢</h2><p>matchæŸ¥è¯¢è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;TEXT&quot;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>mulit_matchè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;TEXT&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span><span class="string">&quot;FIELD1&quot;</span><span class="punctuation">,</span>Â <span class="string">&quot; FIELD12&quot;</span><span class="punctuation">]</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="ç²¾ç¡®æŸ¥è¯¢"><a href="#ç²¾ç¡®æŸ¥è¯¢" class="headerlink" title="ç²¾ç¡®æŸ¥è¯¢"></a>ç²¾ç¡®æŸ¥è¯¢</h2><p>ç²¾ç¡®æŸ¥è¯¢ä¸€èˆ¬æ˜¯æŸ¥æ‰¾keywordã€æ•°å€¼ã€æ—¥æœŸã€booleanç­‰ç±»å‹å­—æ®µã€‚æ‰€ä»¥<strong>ä¸ä¼š</strong>å¯¹æœç´¢æ¡ä»¶åˆ†è¯ã€‚å¸¸è§çš„æœ‰ï¼š</p><ul><li>termï¼šæ ¹æ®è¯æ¡ç²¾ç¡®å€¼æŸ¥è¯¢</li><li>rangeï¼šæ ¹æ®å€¼çš„èŒƒå›´æŸ¥è¯¢</li></ul><p>è¯­æ³•è¯´æ˜ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â termæŸ¥è¯¢</span></span><br><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;VALUE&quot;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â rangeæŸ¥è¯¢</span></span><br><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span>Â <span class="number">10</span><span class="punctuation">,</span> <span class="comment">// è¿™é‡Œçš„gteä»£è¡¨å¤§äºç­‰äºï¼Œgtåˆ™ä»£è¡¨å¤§äº</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span>Â <span class="number">20</span> <span class="comment">// lteä»£è¡¨å°äºç­‰äºï¼Œltåˆ™ä»£è¡¨å°äº</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="RestClientæŸ¥è¯¢"><a href="#RestClientæŸ¥è¯¢" class="headerlink" title="RestClientæŸ¥è¯¢"></a>RestClientæŸ¥è¯¢</h1><h2 id="æŸ¥è¯¢æ‰€æœ‰-æŸ¥è¯¢å†…å®¹å¤„ç†"><a href="#æŸ¥è¯¢æ‰€æœ‰-æŸ¥è¯¢å†…å®¹å¤„ç†" class="headerlink" title="æŸ¥è¯¢æ‰€æœ‰ + æŸ¥è¯¢å†…å®¹å¤„ç†"></a>æŸ¥è¯¢æ‰€æœ‰ + æŸ¥è¯¢å†…å®¹å¤„ç†</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">void</span> <span class="title function_">testMatchAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//        1.å‡†å¤‡Request</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;test01&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        2.å‡†å¤‡DSL</span></span><br><span class="line">        request.source().query(QueryBuilders.matchAllQuery());</span><br><span class="line"><span class="comment">//        3.å‘é€è¯·æ±‚</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        4.è§£æç»“æœ</span></span><br><span class="line"><span class="comment">//        è·å–hitå¯¹è±¡</span></span><br><span class="line">        <span class="type">SearchHits</span> <span class="variable">hits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line"><span class="comment">//        è·å–hitæ•°ç›®</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">value</span> <span class="operator">=</span> hits.getTotalHits().value;</span><br><span class="line"><span class="comment">//        è·å–hitåˆ°çš„æ•°æ®</span></span><br><span class="line">        SearchHit[] searchHits = hits.getHits();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit :</span><br><span class="line">                searchHits) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        System.out.println(response);</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202401202304327.png" alt="image-20240120230439233"></p><h2 id="matchæŸ¥è¯¢"><a href="#matchæŸ¥è¯¢" class="headerlink" title="matchæŸ¥è¯¢"></a>matchæŸ¥è¯¢</h2><p>RestClientæŸ¥è¯¢æ•´ä½“ä»£ç æµç¨‹æ²¡æœ‰åŒºåˆ«ï¼Œä¸åŒçš„æŸ¥è¯¢æ–¹å¼ä¹‹é—´åªæœ‰QueryBuilderä¸ä¸€æ ·ï¼Œä¸‹é¢å†æ‹¿matchä¸¾ä¾‹ï¼Œç›´æ¥å€Ÿç”¨machallä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">void</span> <span class="title function_">testMatchAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//        1.å‡†å¤‡Request</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;test01&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        2.å‡†å¤‡DSL</span></span><br><span class="line">        request.source().query(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>,<span class="string">&quot;æ—&quot;</span>));</span><br><span class="line"><span class="comment">//        3.å‘é€è¯·æ±‚</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        4.è§£æç»“æœ</span></span><br><span class="line"><span class="comment">//        è·å–hitå¯¹è±¡</span></span><br><span class="line">        <span class="type">SearchHits</span> <span class="variable">hits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line"><span class="comment">//        è·å–hitæ•°ç›®</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">value</span> <span class="operator">=</span> hits.getTotalHits().value;</span><br><span class="line"><span class="comment">//        è·å–hitåˆ°çš„æ•°æ®</span></span><br><span class="line">        SearchHit[] searchHits = hits.getHits();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit :</span><br><span class="line">                searchHits) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        System.out.println(response);</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="ç²¾ç¡®æŸ¥è¯¢-1"><a href="#ç²¾ç¡®æŸ¥è¯¢-1" class="headerlink" title="ç²¾ç¡®æŸ¥è¯¢"></a>ç²¾ç¡®æŸ¥è¯¢</h2><p>å¤šä½™ä»£ç çœç•¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QueryBuilders.termQuery(<span class="string">&quot;gender&quot;</span>,<span class="string">&quot;ç”·&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//èŒƒå›´</span></span><br><span class="line">QueryBuilders.rangeQuery(<span class="string">&quot;price&quot;</span>).gte(<span class="number">100</span>).lte(<span class="number">150</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¤åˆæŸ¥è¯¢"><a href="#å¤åˆæŸ¥è¯¢" class="headerlink" title="å¤åˆæŸ¥è¯¢"></a>å¤åˆæŸ¥è¯¢</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BoolQueryBuilder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line"><span class="comment">// 2.2.æ·»åŠ term</span></span><br><span class="line">boolQuery.must(QueryBuilders.termQuery(<span class="string">&quot;city&quot;</span>, <span class="string">&quot;æ­å·&quot;</span>));</span><br><span class="line"><span class="comment">// 2.3.æ·»åŠ range</span></span><br><span class="line">boolQuery.filter(QueryBuilders.rangeQuery(<span class="string">&quot;price&quot;</span>).lte(<span class="number">250</span>));</span><br><span class="line"></span><br><span class="line">request.source().query(boolQuery);</span><br></pre></td></tr></table></figure><h2 id="æ’åºåˆ†é¡µ"><a href="#æ’åºåˆ†é¡µ" class="headerlink" title="æ’åºåˆ†é¡µ"></a>æ’åºåˆ†é¡µ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.source().sort(<span class="string">&quot;age&quot;</span>, SortOrder.ASC);</span><br><span class="line"><span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> <span class="number">2</span>,size = <span class="number">1</span>;</span><br><span class="line">request.source().from((page - <span class="number">1</span>) * size).size(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><h2 id="é«˜äº®"><a href="#é«˜äº®" class="headerlink" title="é«˜äº®"></a>é«˜äº®</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.source().highlighter(<span class="keyword">new</span> <span class="title class_">HighlightBuilder</span>().field(<span class="string">&quot;name&quot;</span>).requireFieldMatch(<span class="literal">false</span>));</span><br></pre></td></tr></table></figure><h1 id="æ•°æ®èšåˆ"><a href="#æ•°æ®èšåˆ" class="headerlink" title="æ•°æ®èšåˆ"></a>æ•°æ®èšåˆ</h1><h2 id="èšåˆç§ç±»"><a href="#èšåˆç§ç±»" class="headerlink" title="èšåˆç§ç±»"></a>èšåˆç§ç±»</h2><p>èšåˆå¸¸è§çš„æœ‰ä¸‰ç±»ï¼š</p><ul><li><p><strong>æ¡¶ï¼ˆBucketï¼‰</strong>èšåˆï¼šç”¨æ¥å¯¹æ–‡æ¡£åšåˆ†ç»„</p><ul><li>TermAggregationï¼šæŒ‰ç…§æ–‡æ¡£å­—æ®µå€¼åˆ†ç»„ï¼Œä¾‹å¦‚æŒ‰ç…§å“ç‰Œå€¼åˆ†ç»„ã€æŒ‰ç…§å›½å®¶åˆ†ç»„</li><li>Date Histogramï¼šæŒ‰ç…§æ—¥æœŸé˜¶æ¢¯åˆ†ç»„ï¼Œä¾‹å¦‚ä¸€å‘¨ä¸ºä¸€ç»„ï¼Œæˆ–è€…ä¸€æœˆä¸ºä¸€ç»„</li></ul></li><li><p><strong>åº¦é‡ï¼ˆMetricï¼‰</strong>èšåˆï¼šç”¨ä»¥è®¡ç®—ä¸€äº›å€¼ï¼Œæ¯”å¦‚ï¼šæœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ç­‰</p><ul><li>Avgï¼šæ±‚å¹³å‡å€¼</li><li>Maxï¼šæ±‚æœ€å¤§å€¼</li><li>Minï¼šæ±‚æœ€å°å€¼</li><li>Statsï¼šåŒæ—¶æ±‚maxã€minã€avgã€sumç­‰</li></ul></li><li><p><strong>ç®¡é“ï¼ˆpipelineï¼‰</strong>èšåˆï¼šå…¶å®ƒèšåˆçš„ç»“æœä¸ºåŸºç¡€åšèšåˆ</p></li></ul><h2 id="DSLèšåˆè¯­æ³•-bucket"><a href="#DSLèšåˆè¯­æ³•-bucket" class="headerlink" title="DSLèšåˆè¯­æ³•(bucket)"></a>DSLèšåˆè¯­æ³•(bucket)</h2><p>å¯ä»¥å¯¹æ•°æ®è¿›è¡Œä¸€ä¸ªåˆ†ç»„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">get /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; // é™å®šæ¡ä»¶</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;lte&quot;: 200</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 0, // æ˜¾ç¤ºå¤šå°‘æ¡æ•°æ®</span><br><span class="line">  &quot;aggs&quot;: &#123; // èšåˆ</span><br><span class="line">    &quot;brandAgg&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;brand&quot;, // å‚ä¸èšåˆçš„å­—æ®µ</span><br><span class="line">        &quot;order&quot;: &#123;</span><br><span class="line">          &quot;_count&quot;: &quot;desc&quot; // æ’åºæ–¹å¼</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;size&quot;: 10 // æ˜¾ç¤ºå¤šå°‘bucketï¼ˆæ¡¶ï¼‰</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="DSLèšåˆè¯­æ³•ï¼ˆMetricï¼‰"><a href="#DSLèšåˆè¯­æ³•ï¼ˆMetricï¼‰" class="headerlink" title="DSLèšåˆè¯­æ³•ï¼ˆMetricï¼‰"></a>DSLèšåˆè¯­æ³•ï¼ˆMetricï¼‰</h2><p>ç»“åˆä¸Šä¸€ä¸ªç®€å•èšåˆä½¿ç”¨ï¼Œå¯ä»¥åœ¨æ¯ä¸€ä¸ªbucketä¸­æŸ¥æ‰¾æœ€å¤§ï¼Œæœ€å°ï¼Œå¹³å‡ç­‰ç­‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">get /hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;brandAgg&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;brand&quot;,</span><br><span class="line">        &quot;order&quot;: &#123;</span><br><span class="line">          &quot;scoreAgg.avg&quot;: &quot;asc&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;size&quot;: 10</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123; // åœ¨åŸºç¡€èšåˆåŸºç¡€ä¸Š</span><br><span class="line">      &quot;scoreAgg&quot;:&#123;</span><br><span class="line">        &quot;stats&quot;: &#123;</span><br><span class="line">          &quot;field&quot;: &quot;score&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="RestClientå®ç°"><a href="#RestClientå®ç°" class="headerlink" title="RestClientå®ç°"></a>RestClientå®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">void</span> <span class="title function_">testAggregation</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//       å‡†å¤‡è¯·æ±‚</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line"><span class="comment">//        å‡†å¤‡DSL</span></span><br><span class="line">        request.source().size(<span class="number">0</span>);</span><br><span class="line">        request.source().aggregation(</span><br><span class="line">                AggregationBuilders.terms(<span class="string">&quot;brandAgg&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;brand&quot;</span>)</span><br><span class="line">                .size(<span class="number">10</span>)</span><br><span class="line">        );</span><br><span class="line"><span class="comment">//        å‘å‡ºè¯·æ±‚</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"><span class="comment">//        è§£æç»“æœ</span></span><br><span class="line">        <span class="type">Aggregations</span> <span class="variable">aggregations</span> <span class="operator">=</span> response.getAggregations();</span><br><span class="line">        <span class="type">Terms</span> <span class="variable">brandTerms</span> <span class="operator">=</span>  aggregations.get(<span class="string">&quot;brandAgg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;? <span class="keyword">extends</span> <span class="title class_">Terms</span>.Bucket&gt; buckets = brandTerms.getBuckets();</span><br><span class="line">        <span class="keyword">for</span>(Terms.Bucket bucket : buckets)&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> bucket.getKeyAsString();</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="è‡ªåŠ¨è¡¥å…¨"><a href="#è‡ªåŠ¨è¡¥å…¨" class="headerlink" title="è‡ªåŠ¨è¡¥å…¨"></a>è‡ªåŠ¨è¡¥å…¨</h1><h2 id="æ‹¼éŸ³åˆ†è¯å™¨"><a href="#æ‹¼éŸ³åˆ†è¯å™¨" class="headerlink" title="æ‹¼éŸ³åˆ†è¯å™¨"></a>æ‹¼éŸ³åˆ†è¯å™¨</h2><p>æ‹¼éŸ³åˆ†è¯å™¨çš„å®˜æ–¹åœ°å€ï¼š<a href="https://github.com/medcl/elasticsearch-analysis-pinyin">https://github.com/medcl/elasticsearch-analysis-pinyin</a></p><p>ä¸‹è½½å®Œæ¯•åï¼Œå°†å…¶è§£å‹æ”¾å…¥esæ’ä»¶çš„æœ¬åœ°æŒ‚è½½ç›®å½•ä¸­å³å¯</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202401310111850.png" alt="image-20240131011145793"></p><h2 id="æ¼”ç¤ºæ ¹æ®æ‹¼éŸ³åˆ†è¯"><a href="#æ¼”ç¤ºæ ¹æ®æ‹¼éŸ³åˆ†è¯" class="headerlink" title="æ¼”ç¤ºæ ¹æ®æ‹¼éŸ³åˆ†è¯"></a>æ¼”ç¤ºæ ¹æ®æ‹¼éŸ³åˆ†è¯</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">post /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;æ—å³°å­¦åˆ†å¸ƒå¼&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pinyin&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„éƒ¨åˆ†ç»“æœï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;lin&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;lfxfbs&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;feng&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;xue&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰åˆ†è¯å™¨"><a href="#è‡ªå®šä¹‰åˆ†è¯å™¨" class="headerlink" title="è‡ªå®šä¹‰åˆ†è¯å™¨"></a>è‡ªå®šä¹‰åˆ†è¯å™¨</h2><p>elasticsearchä¸­åˆ†è¯å™¨ï¼ˆanalyzerï¼‰çš„ç»„æˆåŒ…å«ä¸‰éƒ¨åˆ†ï¼š</p><ul><li>character filtersï¼šåœ¨tokenizerä¹‹å‰å¯¹æ–‡æœ¬è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚åˆ é™¤å­—ç¬¦ã€æ›¿æ¢å­—ç¬¦</li><li>tokenizerï¼šå°†æ–‡æœ¬æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ‡å‰²æˆè¯æ¡ï¼ˆtermï¼‰ã€‚ä¾‹å¦‚keywordï¼Œå°±æ˜¯ä¸åˆ†è¯ï¼›è¿˜æœ‰ik_smart</li><li>tokenizer filterï¼šå°†tokenizerè¾“å‡ºçš„è¯æ¡åšè¿›ä¸€æ­¥å¤„ç†ã€‚ä¾‹å¦‚å¤§å°å†™è½¬æ¢ã€åŒä¹‰è¯å¤„ç†ã€æ‹¼éŸ³å¤„ç†ç­‰</li></ul><p>æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è¿™ä¸‰éƒ¨åˆ†ï¼Œå¯ä»¥è®©è¿™ä¸‰éƒ¨åˆ†åˆ†åˆ«ä½¿ç”¨ä¸åŒçš„åˆ†è¯å™¨</p><p>æ¯”å¦‚åœ¨tokenizeré˜¶æ®µï¼Œæˆ‘ä»¬æŒ‡å®šä½¿ç”¨ikåˆ†è¯å™¨ï¼Œç„¶ååœ¨tokenizer filteré˜¶æ®µï¼Œæˆ‘ä»¬é€‰ç”¨pinyinåˆ†è¯å™¨ï¼Œè¿™æ ·å‡ºæ¥çš„ç»“æœå’Œç›´æ¥ä½¿ç”¨æ‹¼éŸ³åˆ†è¯å™¨çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œæ‹¼éŸ³åˆ†è¯å™¨ä¼šå°†ikåˆ†è¯å™¨çš„ç»“æœè½¬æ¢ä¸ºæ‹¼éŸ³ï¼ˆæ¯”å¦‚è‹¹æœï¼Œç›´æ¥ä½¿ç”¨æ‹¼éŸ³åˆ†è¯å™¨ç»“æœæ˜¯[â€œpingâ€,â€guoâ€],è€Œä½¿ç”¨è‡ªå®šä¹‰åˆ†è¯å™¨ï¼Œç»“æœä¸º[â€œpingguoâ€]ï¼‰</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªå®šä¹‰æ‹¼éŸ³åˆ†è¯å™¨</span></span><br><span class="line">PUT /test</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;analysis&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">        <span class="attr">&quot;my_analyzer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">          <span class="attr">&quot;tokenizer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;py&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;py&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pinyin&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;keep_full_pinyin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;keep_joined_full_pinyin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;keep_original&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;limit_first_letter_length&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;remove_duplicated_term&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;none_chinese_pinyin_tokenize&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="è‡ªåŠ¨è¡¥å…¨-1"><a href="#è‡ªåŠ¨è¡¥å…¨-1" class="headerlink" title="è‡ªåŠ¨è¡¥å…¨"></a>è‡ªåŠ¨è¡¥å…¨</h2><ul><li><p>å‚ä¸è¡¥å…¨æŸ¥è¯¢çš„å­—æ®µå¿…é¡»æ˜¯completionç±»å‹ã€‚</p></li><li><p>å­—æ®µçš„å†…å®¹ä¸€èˆ¬æ˜¯ç”¨æ¥è¡¥å…¨çš„å¤šä¸ªè¯æ¡å½¢æˆçš„æ•°ç»„ã€‚</p></li></ul><p>ä¾‹å­</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªåŠ¨è¡¥å…¨çš„ç´¢å¼•åº“</span></span><br><span class="line">PUT test</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;completion&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// ç¤ºä¾‹æ•°æ®</span></span><br><span class="line">POST test/_doc</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;Sony&quot;</span><span class="punctuation">,</span> <span class="string">&quot;WH-1000XM3&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">POST test/_doc</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;SK-II&quot;</span><span class="punctuation">,</span> <span class="string">&quot;PITERA&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">POST test/_doc</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;Nintendo&quot;</span><span class="punctuation">,</span> <span class="string">&quot;switch&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢</span></span><br><span class="line">POST /test/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;suggest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title_suggest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s&quot;</span><span class="punctuation">,</span> <span class="comment">// å…³é”®å­—</span></span><br><span class="line">      <span class="attr">&quot;completion&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;title&quot;</span><span class="punctuation">,</span> <span class="comment">// è¡¥å…¨å­—æ®µ</span></span><br><span class="line">        <span class="attr">&quot;skip_duplicates&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="comment">// è·³è¿‡é‡å¤çš„</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span> <span class="comment">// è·å–å‰10æ¡ç»“æœ</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="æ•°æ®åŒæ­¥"><a href="#æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®åŒæ­¥"></a>æ•°æ®åŒæ­¥</h1><p>esé‡Œå­˜æ”¾çš„æ•°æ®ç´¢å¼•ä¸€èˆ¬ä»…ç”¨ä½œæŸ¥è¯¢ä½¿ç”¨ï¼Œå…¶æ•°æ®æ¥æºäºæ•°æ®åº“ï¼Œå½“æ•°æ®åº“ä¸­çš„æ•°æ®é­åˆ°å¢åˆ æ”¹æŸ¥æ—¶ï¼Œesä¸­çš„æ•°æ®å¹¶ä¸ä¼šè‡ªåŠ¨åœ°åŒæ­¥ä¿®æ”¹ï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬é€šè¿‡ä¸€äº›æ–¹æ³•æ¥åŒæ­¥ä¿®æ”¹eså’Œæ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</p><h2 id="ä¸‰ç§æ–¹æ³•"><a href="#ä¸‰ç§æ–¹æ³•" class="headerlink" title="ä¸‰ç§æ–¹æ³•"></a>ä¸‰ç§æ–¹æ³•</h2><p>æ³•ä¸€ï¼š</p><p>åŒæ­¥è°ƒç”¨ï¼šåœ¨ä¿®æ”¹æ•°æ®åº“æ—¶ï¼ŒåŒæ­¥è°ƒç”¨esçš„æ›´æ–°æœåŠ¡æ¥å£ï¼Œè¿™æ ·æ¯æ¬¡ä¿®æ”¹éƒ½åŒæ—¶è¿›è¡Œï¼Œä¸‰ä¸ªæ­¥éª¤ä¾æ¬¡æ‰§è¡Œï¼Œç¼ºç‚¹ä¼šå¯¼è‡´ä¸šåŠ¡è€¦åˆï¼Œæ•´ä¸ªä¸šåŠ¡æµç¨‹è¢«æ‹‰é•¿ï¼Œåœ¨æ›´æ–°å®Œæ•°æ®åº“åæ•´ä¸ªè¿›ç¨‹è¿˜è¦ç­‰å¾…esæ›´æ–°ï¼Œä¸”å¦‚æœå…¶ä¸­æŸä¸ªä¸šåŠ¡å‡ºç°é—®é¢˜ï¼Œæ•´ä¸ªæµç¨‹éƒ½ä¼šå‡ºç°é—®é¢˜</p><p>æ³•äºŒï¼š</p><p>å¼‚æ­¥è°ƒç”¨ï¼Œè¿ç”¨MQä¿¡æ¯é€šé“ï¼Œå°†æ³•ä¸€è°ƒç”¨æœåŠ¡æ¥å£çš„è¿‡ç¨‹è½¬å˜ä¸ºåœ¨é€šé“ä¸­å‘é€æ¶ˆæ¯ï¼Œç„¶åç”±esçš„æ›´æ–°æœåŠ¡æ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶æ›´æ–°esç´¢å¼•åº“ï¼Œè¿™æ ·æ•´ä¸ªè¿‡ç¨‹å°±å°†æ›´æ–°æ•°æ®åº“å’Œæ›´æ–°ç´¢å¼•åº“åˆ†å¼€äº†ï¼Œä¸”ä¸¤è€…ä¹‹é—´æ˜¯å¼‚æ­¥çš„å…³ç³»ï¼Œç¼ºç‚¹æ˜¯å¤æ‚åº¦ç•¥æœ‰æé«˜</p><p>æ³•ä¸‰;</p><p>åˆ©ç”¨mysqlè‡ªå¸¦çš„binlogï¼Œbinlogæ˜¯mysqlè‡ªå¸¦çš„ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œå¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥éƒ½ä¼šåœ¨binlogä¸­è¿›è¡Œè®°å½•ï¼Œç„¶åä½¿ç”¨canalä¸­é—´ä»¶ç›‘å¬binlogçš„å˜åŒ–ï¼Œç„¶åå†åŒæ­¥ä¿®æ”¹esã€‚</p><p><strong>æ¨èç¬¬äºŒç§</strong></p><h2 id="esé›†ç¾¤"><a href="#esé›†ç¾¤" class="headerlink" title="esé›†ç¾¤"></a>esé›†ç¾¤</h2><p>é›†ç¾¤çš„ç›®çš„ï¼šè§£å†³æµ·é‡å­˜å‚¨é—®é¢˜è¿˜æœ‰å•ç‚¹æ•…éšœé—®é¢˜</p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> java </tag>
            
            <tag> SpringCloud </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockeræ•™å­¦</title>
      <link href="/2023/12/23/Docker%E6%95%99%E5%AD%A6/"/>
      <url>/2023/12/23/Docker%E6%95%99%E5%AD%A6/</url>
      
        <content type="html"><![CDATA[<h1 id="Dockeræ•™å­¦"><a href="#Dockeræ•™å­¦" class="headerlink" title="Dockeræ•™å­¦"></a>Dockeræ•™å­¦</h1><h2 id="1-ä»€ä¹ˆæ˜¯Docker"><a href="#1-ä»€ä¹ˆæ˜¯Docker" class="headerlink" title="1.ä»€ä¹ˆæ˜¯Docker"></a>1.ä»€ä¹ˆæ˜¯Docker</h2><p>ä½ å¯ä»¥æŠŠDockerçœ‹ä½œä¸€ä¸ªå®¹å™¨ï¼Œå°±åƒæ˜¯ä¸€ä¸ªå¯ä»¥è£…è½½è½¯ä»¶å’Œä»£ç çš„é›†è£…ç®±ã€‚é€šè¿‡ä½¿ç”¨Dockerï¼Œä½ å¯ä»¥å°†åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰ä¾èµ–é¡¹æ‰“åŒ…åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å®¹å™¨ä¸­ï¼Œè€Œä¸å¿…æ‹…å¿ƒå®ƒä»¬ä¼šä¸å…¶ä»–åº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿç¯å¢ƒå‘ç”Ÿå†²çªã€‚</p><p>ä½¿ç”¨Dockerï¼Œä½ å¯ä»¥å¿«é€Ÿåœ°åœ¨ä¸åŒçš„è®¡ç®—æœºä¸Šéƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œè€Œä¸å¿…æ‹…å¿ƒé…ç½®å’Œä¾èµ–é—®é¢˜ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ä½ çš„ç”µè„‘ä¸Šå¼€å‘ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¹¶å°†å…¶ç›¸åŒçš„è¿è¡Œç¯å¢ƒåœ¨å…¶ä»–äººçš„ç”µè„‘æˆ–æœåŠ¡å™¨ä¸Šè½»æ¾åœ°è¿è¡Œèµ·æ¥ï¼Œè€Œä¸éœ€è¦é‡æ–°é…ç½®å’Œå®‰è£…ä¾èµ–é¡¹ã€‚</p><p>å¦å¤–ï¼ŒDockerè¿˜ä½¿å¾—åº”ç”¨ç¨‹åºçš„äº¤ä»˜æ›´åŠ ç®€å•å’Œå¯é ã€‚ä½ å¯ä»¥å°†åº”ç”¨ç¨‹åºå’Œå…¶ä¾èµ–é¡¹æ‰“åŒ…åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œå¹¶å°†å…¶å‘å¸ƒåˆ°äº‘ç«¯æˆ–å…¶ä»–æœåŠ¡å™¨ä¸Šï¼Œå…¶ä»–äººåªéœ€è¦è¿è¡Œè¿™ä¸ªå®¹å™¨ï¼Œå°±èƒ½å¤Ÿè½»æ¾åœ°ä½¿ç”¨ä½ çš„åº”ç”¨ç¨‹åºã€‚</p><p>æ€»ä¹‹ï¼ŒDockerå¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´è½»æ¾åœ°æ„å»ºã€æ‰“åŒ…å’Œè¿è¡Œåº”ç”¨ç¨‹åºï¼Œæä¾›äº†ä¸€ç§ç®€å•ã€å¯é çš„åº”ç”¨ç¨‹åºäº¤ä»˜æ–¹å¼ã€‚å®ƒçš„ä¼˜åŠ¿åœ¨äºæä¾›äº†ä¸€è‡´çš„è¿è¡Œç¯å¢ƒï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸åŒçš„è®¡ç®—æœºä¸Šè¿›è¡Œéƒ¨ç½²ï¼Œæå¤§åœ°ç®€åŒ–äº†å¼€å‘å’Œéƒ¨ç½²çš„è¿‡ç¨‹ã€‚</p><h2 id="2-Dockerå’Œè™šæ‹Ÿæœºå·®åˆ«"><a href="#2-Dockerå’Œè™šæ‹Ÿæœºå·®åˆ«" class="headerlink" title="2.Dockerå’Œè™šæ‹Ÿæœºå·®åˆ«"></a>2.Dockerå’Œè™šæ‹Ÿæœºå·®åˆ«</h2><p><strong>è™šæ‹Ÿæœº</strong>ï¼ˆvirtual machineï¼‰æ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸­<strong>æ¨¡æ‹Ÿ</strong>ç¡¬ä»¶è®¾å¤‡ï¼Œç„¶åè¿è¡Œå¦ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨ Windows ç³»ç»Ÿé‡Œé¢è¿è¡Œ Ubuntu ç³»ç»Ÿï¼Œè¿™æ ·å°±å¯ä»¥è¿è¡Œä»»æ„çš„Ubuntuåº”ç”¨äº†ã€‚</p><p><strong>Docker</strong>ä»…ä»…æ˜¯å°è£…å‡½æ•°åº“ï¼Œå¹¶æ²¡æœ‰æ¨¡æ‹Ÿå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œå¦‚å›¾ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312231651358.png" alt="image-20210731145914960"></p><p>å¯¹æ¯”æ¥çœ‹ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312231651354.png" alt="image-20210731152243765"></p><h2 id="3-é•œåƒå’Œå®¹å™¨æ¦‚å¿µ"><a href="#3-é•œåƒå’Œå®¹å™¨æ¦‚å¿µ" class="headerlink" title="3.é•œåƒå’Œå®¹å™¨æ¦‚å¿µ"></a>3.é•œåƒå’Œå®¹å™¨æ¦‚å¿µ</h2><p>é•œåƒï¼šDockerå°†åº”ç”¨ç¨‹åºåŠå…¶æ‰€éœ€çš„ä¾èµ–ï¼Œå‡½æ•°åº“ï¼Œç¯å¢ƒï¼Œé…ç½®ç­‰æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œç§°ä¸ºé•œåƒ</p><p>å®¹å™¨ï¼šé•œåƒä¸­çš„åº”ç”¨è¿è¡Œçš„è¿›ç¨‹å°±æ˜¯å®¹å™¨ï¼Œå®¹å™¨æœ‰éš”ç¦»ä½œç”¨</p><h2 id="4-Dockeré•œåƒåŸºæœ¬æ“ä½œ"><a href="#4-Dockeré•œåƒåŸºæœ¬æ“ä½œ" class="headerlink" title="4.Dockeré•œåƒåŸºæœ¬æ“ä½œ"></a>4.Dockeré•œåƒåŸºæœ¬æ“ä½œ</h2><h3 id="4-1-è·å–ï¼ŒæŸ¥çœ‹ï¼Œåˆ é™¤é•œåƒ"><a href="#4-1-è·å–ï¼ŒæŸ¥çœ‹ï¼Œåˆ é™¤é•œåƒ" class="headerlink" title="4.1 è·å–ï¼ŒæŸ¥çœ‹ï¼Œåˆ é™¤é•œåƒ"></a>4.1 è·å–ï¼ŒæŸ¥çœ‹ï¼Œåˆ é™¤é•œåƒ</h3><p>docker pull</p><blockquote><p>ä»æœåŠ¡ç«¯æ‹‰å–</p></blockquote><p>docker images</p><blockquote><p>æŸ¥çœ‹é•œåƒ</p></blockquote><p>docker rmi</p><blockquote><p>åˆ é™¤é•œåƒ</p></blockquote><h3 id="4-2-æ¨é€ï¼Œä¿å­˜ï¼ŒåŠ è½½é•œåƒ"><a href="#4-2-æ¨é€ï¼Œä¿å­˜ï¼ŒåŠ è½½é•œåƒ" class="headerlink" title="4.2 æ¨é€ï¼Œä¿å­˜ï¼ŒåŠ è½½é•œåƒ"></a>4.2 æ¨é€ï¼Œä¿å­˜ï¼ŒåŠ è½½é•œåƒ</h3><p>docker push</p><blockquote><p>æ¨é€é•œåƒåˆ°æœåŠ¡</p></blockquote><p>docker save</p><blockquote><p>ä¿å­˜é•œåƒä¸ºå‹ç¼©åŒ…</p></blockquote><p>docker load</p><blockquote><p>åŠ è½½å‹ç¼©åŒ…ä¸ºé•œåƒ</p></blockquote><h3 id="4-3-dockerå¯åŠ¨"><a href="#4-3-dockerå¯åŠ¨" class="headerlink" title="4.3 dockerå¯åŠ¨"></a>4.3 dockerå¯åŠ¨</h3><p>systemctl start docker</p><blockquote><p>å¯åŠ¨å‘½ä»¤</p></blockquote><h3 id="4-4-dockeræ‹‰å–å®è·µ"><a href="#4-4-dockeræ‹‰å–å®è·µ" class="headerlink" title="4.4 dockeræ‹‰å–å®è·µ"></a>4.4 dockeræ‹‰å–å®è·µ</h3><p>æ‹‰å–nginx</p><blockquote><p>docker pull nginx</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312231748177.png" alt="image-20231223174801081"></p><p>æ‹‰å–æˆåŠŸ</p><p>docker imagesæŸ¥çœ‹æœ¬åœ°é•œåƒ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312231748688.png" alt="image-20231223174833659"></p><h2 id="5-dockerå®¹å™¨åŸºæœ¬æ“ä½œ"><a href="#5-dockerå®¹å™¨åŸºæœ¬æ“ä½œ" class="headerlink" title="5. dockerå®¹å™¨åŸºæœ¬æ“ä½œ"></a>5. dockerå®¹å™¨åŸºæœ¬æ“ä½œ</h2><h3 id="5-1-å¸¸ç”¨å‘½ä»¤"><a href="#5-1-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="5.1 å¸¸ç”¨å‘½ä»¤"></a>5.1 å¸¸ç”¨å‘½ä»¤</h3><p>docker run</p><blockquote><p>è¿è¡Œå®¹å™¨</p></blockquote><p>docker pause&#x2F;unpause</p><blockquote><p>æš‚åœ &#x2F;ç»“æŸæš‚åœ</p></blockquote><p>docker stop&#x2F;start</p><blockquote><p>åœæ­¢&#x2F;å¼€å§‹</p></blockquote><p>docker ps</p><blockquote><p>æŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„å®¹å™¨ï¼Œè¿˜æœ‰çŠ¶æ€</p></blockquote><p>docker exec</p><blockquote><p>è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤</p></blockquote><p>docker rm</p><blockquote><p>åˆ é™¤å®¹å™¨</p></blockquote><h3 id="5-2-ä¸¾ä¾‹ï¼šå¯åŠ¨Nginxå®¹å™¨"><a href="#5-2-ä¸¾ä¾‹ï¼šå¯åŠ¨Nginxå®¹å™¨" class="headerlink" title="5.2 ä¸¾ä¾‹ï¼šå¯åŠ¨Nginxå®¹å™¨"></a>5.2 ä¸¾ä¾‹ï¼šå¯åŠ¨Nginxå®¹å™¨</h3><p>å¯åŠ¨é™Œç”Ÿå®¹å™¨ä¹‹å‰ï¼Œå»dockerhubå®˜ç½‘æŸ¥ä¸€ä¸‹</p><p>åˆ›å»ºå¹¶è¿è¡Œnginxå®¹å™¨çš„å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name containerName -p 80:80 -d nginx</span><br></pre></td></tr></table></figure><ul><li>docker run ï¼šåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨</li><li>â€“name : ç»™å®¹å™¨èµ·ä¸€ä¸ªåå­—ï¼Œæ¯”å¦‚å«åšmn</li><li>-p ï¼šå°†å®¿ä¸»æœºç«¯å£ä¸å®¹å™¨ç«¯å£æ˜ å°„ï¼Œå†’å·å·¦ä¾§æ˜¯å®¿ä¸»æœºç«¯å£ï¼Œå³ä¾§æ˜¯å®¹å™¨ç«¯å£</li><li>-dï¼šåå°è¿è¡Œå®¹å™¨</li><li>nginxï¼šé•œåƒåç§°ï¼Œä¾‹å¦‚nginx</li></ul><h2 id="6-Dockeræ•°æ®å·"><a href="#6-Dockeræ•°æ®å·" class="headerlink" title="6. Dockeræ•°æ®å·"></a>6. Dockeræ•°æ®å·</h2><p>ç›¸å½“äºè®©å®¹å™¨ä½¿ç”¨å®¿ä¸»æœºæŸä¸ªæ–‡ä»¶ç›®å½•ï¼Œè¿™æ ·å°±å¯ä»¥éšæ—¶ä¿®æ”¹å®¹å™¨çš„å†…å®¹ï¼Œæ¯”å¦‚nginxé‡Œçš„é™æ€èµ„æº</p><p>ä¸€æ—¦å®Œæˆæ•°æ®å·æŒ‚è½½ï¼Œå¯¹å®¹å™¨çš„ä¸€åˆ‡æ“ä½œéƒ½ä¼šä½œç”¨åœ¨æ•°æ®å·å¯¹åº”çš„å®¿ä¸»æœºç›®å½•äº†ã€‚</p><h3 id="6-1-æ“ä½œå‘½ä»¤"><a href="#6-1-æ“ä½œå‘½ä»¤" class="headerlink" title="6.1 æ“ä½œå‘½ä»¤"></a>6.1 æ“ä½œå‘½ä»¤</h3><p>æ•°æ®å·æ“ä½œçš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume [COMMAND]</span><br></pre></td></tr></table></figure><p>docker volumeå‘½ä»¤æ˜¯æ•°æ®å·æ“ä½œï¼Œæ ¹æ®å‘½ä»¤åè·Ÿéšçš„commandæ¥ç¡®å®šä¸‹ä¸€æ­¥çš„æ“ä½œï¼š</p><ul><li>create åˆ›å»ºä¸€ä¸ªvolume</li><li>inspect æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªvolumeçš„ä¿¡æ¯</li><li>ls åˆ—å‡ºæ‰€æœ‰çš„volume</li><li>prune åˆ é™¤æœªä½¿ç”¨çš„volume</li><li>rm åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„volume</li></ul><h3 id="6-2-æŒ‚è½½æ•°æ®å·"><a href="#6-2-æŒ‚è½½æ•°æ®å·" class="headerlink" title="6.2 æŒ‚è½½æ•°æ®å·"></a>6.2 æŒ‚è½½æ•°æ®å·</h3><p>æˆ‘ä»¬åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ -v å‚æ•°æ¥æŒ‚è½½ä¸€ä¸ªæ•°æ®å·åˆ°æŸä¸ªå®¹å™¨å†…ç›®å½•ï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">  --name mn \</span><br><span class="line">  -v html:/root/html \</span><br><span class="line">  -p 8080:80</span><br><span class="line">  nginx \</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„-vå°±æ˜¯æŒ‚è½½æ•°æ®å·çš„å‘½ä»¤ï¼š</p><ul><li><code>-v html:/root/htm</code> ï¼šæŠŠhtmlæ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨å†…çš„&#x2F;root&#x2F;htmlè¿™ä¸ªç›®å½•ä¸­</li></ul><p>æŒ‚è½½åï¼Œå®¹å™¨å†…çš„ç›¸åº”ç›®å½•ä¼šåŒæ­¥åˆ°è‡ªå·±è®¾ç½®çš„å®¿ä¸»æœºä¸Šçš„æ•°æ®å·</p><p>æŒ‚è½½æ—¶ï¼Œå¦‚æœå†’å·å·¦çš„æ•°æ®å·ï¼ˆå®¿ä¸»æœºä¸Šçš„ï¼‰ä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨åˆ›å»º</p><h2 id="7-è‡ªå®šä¹‰é•œåƒ"><a href="#7-è‡ªå®šä¹‰é•œåƒ" class="headerlink" title="7.è‡ªå®šä¹‰é•œåƒ"></a>7.è‡ªå®šä¹‰é•œåƒ</h2><h3 id="7-1-Dockerfileå¸¸ç”¨æŒ‡ä»¤"><a href="#7-1-Dockerfileå¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="7.1 Dockerfileå¸¸ç”¨æŒ‡ä»¤"></a>7.1 Dockerfileå¸¸ç”¨æŒ‡ä»¤</h3><p><strong>Dockerfile</strong>å°±æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªä¸ªçš„**æŒ‡ä»¤(Instruction)**ï¼Œç”¨æŒ‡ä»¤æ¥è¯´æ˜è¦æ‰§è¡Œä»€ä¹ˆæ“ä½œæ¥æ„å»ºé•œåƒã€‚æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šå½¢æˆä¸€å±‚Layerã€‚</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312241519924.png" alt="image-20210731180321133"></p><h3 id="7-2-ä¸¾ä¾‹åˆ©ç”¨dockeræ„å»ºjavaé¡¹ç›®"><a href="#7-2-ä¸¾ä¾‹åˆ©ç”¨dockeræ„å»ºjavaé¡¹ç›®" class="headerlink" title="7.2 ä¸¾ä¾‹åˆ©ç”¨dockeræ„å»ºjavaé¡¹ç›®"></a>7.2 ä¸¾ä¾‹åˆ©ç”¨dockeræ„å»ºjavaé¡¹ç›®</h3><p>Dockerfilelä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># æŒ‡å®šåŸºç¡€é•œåƒ</span><br><span class="line">FROM ubuntu:16.04</span><br><span class="line"># é…ç½®ç¯å¢ƒå˜é‡ï¼ŒJDKçš„å®‰è£…ç›®å½•</span><br><span class="line">ENV JAVA_DIR=/usr/local</span><br><span class="line"></span><br><span class="line"># æ‹·è´jdkå’Œjavaé¡¹ç›®çš„åŒ…</span><br><span class="line">COPY ./jdk8.tar.gz $JAVA_DIR/</span><br><span class="line">COPY ./docker-demo.jar /tmp/app.jar</span><br><span class="line"></span><br><span class="line"># å®‰è£…JDK</span><br><span class="line">RUN cd $JAVA_DIR \</span><br><span class="line"> &amp;&amp; tar -xf ./jdk8.tar.gz \</span><br><span class="line"> &amp;&amp; mv ./jdk1.8.0_144 ./java8</span><br><span class="line"></span><br><span class="line"># é…ç½®ç¯å¢ƒå˜é‡</span><br><span class="line">ENV JAVA_HOME=$JAVA_DIR/java8</span><br><span class="line">ENV PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line"># æš´éœ²ç«¯å£</span><br><span class="line">EXPOSE 8090</span><br><span class="line"># å…¥å£ï¼Œjavaé¡¹ç›®çš„å¯åŠ¨å‘½ä»¤</span><br><span class="line">ENTRYPOINT java -jar /tmp/app.jar</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨dockerfileæ„å»ºé•œåƒ</p><blockquote><p>docker build -t javaweb:1.0 . </p></blockquote><p>åœ¨dockerfileåŒç›®å½•ä¸‹æ‰§è¡Œ</p><h2 id="8-DockerCompose"><a href="#8-DockerCompose" class="headerlink" title="8.DockerCompose"></a>8.DockerCompose</h2><h3 id="8-1-ä½•ä¸ºDockerCompose"><a href="#8-1-ä½•ä¸ºDockerCompose" class="headerlink" title="8.1 ä½•ä¸ºDockerCompose"></a>8.1 ä½•ä¸ºDockerCompose</h3><p>Docker Composeå¯ä»¥åŸºäºComposeæ–‡ä»¶å¸®æˆ‘ä»¬å¿«é€Ÿçš„éƒ¨ç½²åˆ†å¸ƒå¼åº”ç”¨ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ä¸€ä¸ªä¸ªåˆ›å»ºå’Œè¿è¡Œå®¹å™¨ï¼</p><h3 id="8-2-Composeä¸¾ä¾‹"><a href="#8-2-Composeä¸¾ä¾‹" class="headerlink" title="8.2 Composeä¸¾ä¾‹"></a>8.2 Composeä¸¾ä¾‹</h3><p>Composeæ–‡ä»¶æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œé€šè¿‡æŒ‡ä»¤å®šä¹‰é›†ç¾¤ä¸­çš„æ¯ä¸ªå®¹å™¨å¦‚ä½•è¿è¡Œã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">version<span class="punctuation">:</span>Â <span class="string">&quot;3.8&quot;</span></span><br><span class="line"> services<span class="punctuation">:</span></span><br><span class="line">Â Â mysql<span class="punctuation">:</span></span><br><span class="line">Â Â Â Â image<span class="punctuation">:</span>Â mysql<span class="punctuation">:</span><span class="number">5.7</span><span class="number">.25</span></span><br><span class="line">    environment<span class="punctuation">:</span></span><br><span class="line">     MYSQL_ROOT_PASSWORD<span class="punctuation">:</span> <span class="number">123</span> </span><br><span class="line">Â Â Â Â volumes<span class="punctuation">:</span></span><br><span class="line">Â Â Â Â Â -Â <span class="string">&quot;/tmp/mysql/data:/var/lib/mysql&quot;</span></span><br><span class="line">Â Â Â Â Â -Â <span class="string">&quot;/tmp/mysql/conf/hmy.cnf:/etc/mysql/conf.d/hmy.cnf&quot;</span></span><br><span class="line">Â Â web<span class="punctuation">:</span></span><br><span class="line">Â Â Â Â build<span class="punctuation">:</span>Â .</span><br><span class="line">Â Â Â Â ports<span class="punctuation">:</span></span><br><span class="line">Â Â Â Â Â - <span class="string">&quot;8090:8090&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„Composeæ–‡ä»¶å°±æè¿°ä¸€ä¸ªé¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªå®¹å™¨ï¼š</p><ul><li>mysqlï¼šä¸€ä¸ªåŸºäº<code>mysql:5.7.25</code>é•œåƒæ„å»ºçš„å®¹å™¨ï¼Œå¹¶ä¸”æŒ‚è½½äº†ä¸¤ä¸ªç›®å½•</li><li>webï¼šä¸€ä¸ªåŸºäº<code>docker build</code>ä¸´æ—¶æ„å»ºçš„é•œåƒå®¹å™¨ï¼Œæ˜ å°„ç«¯å£æ—¶8090</li></ul>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nacosæ•™ç¨‹</title>
      <link href="/2023/12/23/Nacos%E6%95%99%E7%A8%8B/"/>
      <url>/2023/12/23/Nacos%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Nacosæ•™ç¨‹"><a href="#Nacosæ•™ç¨‹" class="headerlink" title="Nacosæ•™ç¨‹"></a>Nacosæ•™ç¨‹</h1><h2 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h2><p>Nacosæ˜¯é˜¿é‡Œæä¾›çš„æ³¨å†Œä¸­å¿ƒï¼ŒåŠŸèƒ½ç±»ä¼¼äºEurekaä¸”è¦æ›´å¼ºå¤§ï¼Œä¸¤ç§æ³¨å†Œä¸­å¿ƒéƒ½è¦å­¦ä¸€ä¸‹</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>GitHubä¸»é¡µï¼š<a href="https://github.com/alibaba/nacos">https://github.com/alibaba/nacos</a></p><p>GitHubçš„Releaseä¸‹è½½é¡µï¼š<a href="https://github.com/alibaba/nacos/releases">https://github.com/alibaba/nacos/releases</a></p><p>å®‰è£…å®Œæˆåè¿›è¡Œè§£å‹</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212256701.png" alt="image-20231221225613653"></p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>conf&#x2F;application.propertiesè¿™æ˜¯nacosçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨é‡Œé¢è¿›è¡Œä¸€äº›å¸¸è§„çš„ç«¯å£é…ç½®</p><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>åœ¨binç›®å½•ä¸‹ï¼Œä½ å¯ä»¥ç›´æ¥åŒå‡»startup.cmd</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212258877.png" alt="image-20231221225839838"></p><p>ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹è¿è¡ŒæŒ‡ä»¤</p><blockquote><p>startup.cmd -m standalone</p><p>æ­¤å¤„ä¸ºå•æœºå¯åŠ¨</p></blockquote><p>å¯åŠ¨ç•Œé¢ï¼š<br><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212300066.png" alt="image-20231221230001017"></p><p>ç„¶åæˆ‘ä»¬å¯ä»¥è®¿é—®ä¸Šé¢ç»™å‡ºçš„ç½‘é¡µï¼Œå¯ä»¥çœ‹åˆ°nacosçš„ç•Œé¢</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212301899.png" alt="image-20231221230114812"></p><p>é»˜è®¤ç™»å½•åå’Œå¯†ç éƒ½æ˜¯nacos</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212301323.png" alt="image-20231221230141264"></p><p>è¿™å°±æ˜¯nacosçš„ç•Œé¢ï¼Œä¹‹åæˆ‘ä»¬ä¼šåœ¨è¿™é‡Œè¿›è¡Œæ“ä½œ</p><p>å…³é—­çš„è¯å°±æ˜¯è¿è¡Œshutdown.cmd</p><h2 id="Nacoså¿«é€Ÿå…¥é—¨"><a href="#Nacoså¿«é€Ÿå…¥é—¨" class="headerlink" title="Nacoså¿«é€Ÿå…¥é—¨"></a>Nacoså¿«é€Ÿå…¥é—¨</h2><p>é¦–å…ˆåœ¨é¡¹ç›®çš„çˆ¶å·¥ç¨‹ä¸­æ·»åŠ spring-cloud-alilbabaç®¡ç†ä¾èµ–ï¼Œè¿›è¡ŒåŒ…ç®¡ç†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨æœåŠ¡ä¸­æ·»åŠ nacoså®¢æˆ·ç«¯ä¾èµ–ï¼ˆæ³¨é‡Šæ‰ä¹‹å‰çš„eurekaä¾èµ–ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¹‹åä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆæ³¨é‡Šæ‰eurekaï¼‰</p><p>é…ç½®ç»“æŸåï¼Œæ­£å¸¸å¯åŠ¨æœåŠ¡ï¼Œç„¶åå¯åŠ¨nacosè¿›å…¥æ§åˆ¶å°ï¼Œå°±ä¼šçœ‹åˆ°ä¸¤ä¸ªæœåŠ¡è¢«æ³¨å†Œè¿›æ¥äº†</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212322745.png" alt="image-20231221232205678"></p><p>åŒæ ·å®ç°äº†æ³¨å†Œä¸­å¿ƒçš„åŠŸèƒ½ã€‚</p><h2 id="NacosæœåŠ¡åˆ†çº§å‚¨å­˜æ¨¡å‹"><a href="#NacosæœåŠ¡åˆ†çº§å‚¨å­˜æ¨¡å‹" class="headerlink" title="NacosæœåŠ¡åˆ†çº§å‚¨å­˜æ¨¡å‹"></a>NacosæœåŠ¡åˆ†çº§å‚¨å­˜æ¨¡å‹</h2><p>å®ç°æœåŠ¡çš„é›†ç¾¤åŒ–</p><p>ä¸€ä¸ª<strong>æœåŠ¡</strong>å¯ä»¥æœ‰å¤šä¸ª<strong>å®ä¾‹</strong>ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„user-serviceï¼Œå¯ä»¥æœ‰:</p><ul><li>127.0.0.1:8081</li><li>127.0.0.1:8082</li><li>127.0.0.1:8083</li></ul><p>å‡å¦‚è¿™äº›å®ä¾‹åˆ†å¸ƒäºå…¨å›½å„åœ°çš„ä¸åŒæœºæˆ¿ï¼Œä¾‹å¦‚ï¼š</p><ul><li>127.0.0.1:8081ï¼Œåœ¨ä¸Šæµ·æœºæˆ¿</li><li>127.0.0.1:8082ï¼Œåœ¨ä¸Šæµ·æœºæˆ¿</li><li>127.0.0.1:8083ï¼Œåœ¨æ­å·æœºæˆ¿</li></ul><p>Nacoså°±å°†åŒä¸€æœºæˆ¿å†…çš„å®ä¾‹ åˆ’åˆ†ä¸ºä¸€ä¸ª<strong>é›†ç¾¤</strong>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œuser-serviceæ˜¯æœåŠ¡ï¼Œä¸€ä¸ªæœåŠ¡å¯ä»¥åŒ…å«å¤šä¸ªé›†ç¾¤ï¼Œå¦‚æ­å·ã€ä¸Šæµ·ï¼Œæ¯ä¸ªé›†ç¾¤ä¸‹å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼Œå½¢æˆåˆ†çº§æ¨¡å‹ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212331253.png" alt="image-20210713232522531"></p><p>å¾®æœåŠ¡äº’ç›¸è®¿é—®æ—¶ï¼Œåº”è¯¥å°½å¯èƒ½è®¿é—®åŒé›†ç¾¤å®ä¾‹ï¼Œå› ä¸ºæœ¬åœ°è®¿é—®é€Ÿåº¦æ›´å¿«ã€‚å½“æœ¬é›†ç¾¤å†…ä¸å¯ç”¨æ—¶ï¼Œæ‰è®¿é—®å…¶å®ƒé›†ç¾¤ã€‚ä¾‹å¦‚ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212331260.png" alt="image-20210713232658928"></p><p>æ­å·æœºæˆ¿å†…çš„order-serviceåº”è¯¥ä¼˜å…ˆè®¿é—®åŒæœºæˆ¿çš„user-serviceã€‚</p><p>æ“ä½œï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nacos:</span></span><br><span class="line">  <span class="attr">server-addr:</span> <span class="string">localhost:8848</span>  <span class="comment">#nacos æœåŠ¡ç«¯åœ°å€</span></span><br><span class="line">  <span class="attr">discovery:</span></span><br><span class="line">    <span class="attr">cluster-name:</span> <span class="string">AH</span></span><br></pre></td></tr></table></figure><h2 id="Nacosè´Ÿè½½å‡è¡¡"><a href="#Nacosè´Ÿè½½å‡è¡¡" class="headerlink" title="Nacosè´Ÿè½½å‡è¡¡"></a>Nacosè´Ÿè½½å‡è¡¡</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userserver:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line"><span class="comment">#    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule # è´Ÿè½½å‡è¡¡è§„åˆ™</span></span><br><span class="line">      <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.alibaba.cloud.nacos.ribbon.NacosRule</span> <span class="comment"># è´Ÿè½½å‡è¡¡è§„åˆ™ </span></span><br></pre></td></tr></table></figure><blockquote><p>NacosRuleä¼˜å…ˆåŒé›†ç¾¤å†…éšæœº</p></blockquote><h2 id="é…ç½®æƒé‡"><a href="#é…ç½®æƒé‡" class="headerlink" title="é…ç½®æƒé‡"></a>é…ç½®æƒé‡</h2><p>æƒé‡å¯ä»¥å½±å“è¢«åˆ†é…çš„å‡ ç‡ï¼Œè¶Šå¤§è¶Šå®¹æ˜“è¢«åˆ†é…åˆ°ï¼Œè¿™ä¸ªåœ¨nacosä¸­å°±å¯ä»¥è®¾ç½®</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212347240.png" alt="image-20231221234708178"></p><h2 id="ç¯å¢ƒéš”ç¦»"><a href="#ç¯å¢ƒéš”ç¦»" class="headerlink" title="ç¯å¢ƒéš”ç¦»"></a>ç¯å¢ƒéš”ç¦»</h2><p>Nacosæä¾›äº†namespaceæ¥å®ç°ç¯å¢ƒéš”ç¦»åŠŸèƒ½ã€‚</p><ul><li>nacosä¸­å¯ä»¥æœ‰å¤šä¸ªnamespace</li><li>namespaceä¸‹å¯ä»¥æœ‰groupã€serviceç­‰</li><li>ä¸åŒnamespaceä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œä¾‹å¦‚ä¸åŒnamespaceçš„æœåŠ¡äº’ç›¸ä¸å¯è§</li></ul><p>æ–¹æ³•</p><p>é¦–å…ˆåˆ›å»ºå‘½åç©ºé—´ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212355722.png" alt="image-20231221235551673"></p><p>ç„¶åè¿›å…¥åˆ°æœåŠ¡çš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nacos:</span></span><br><span class="line">  <span class="attr">server-addr:</span> <span class="string">localhost:8848</span>  <span class="comment">#nacos æœåŠ¡ç«¯åœ°å€</span></span><br><span class="line">  <span class="attr">discovery:</span></span><br><span class="line">    <span class="attr">cluster-name:</span> <span class="string">AH</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">25cd75bc-82c3-4396-ba42-a42a5de77b92</span> <span class="comment">#å‘½åç©ºé—´id</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®ç°äº†éš”ç¦»</p><h2 id="Nacoså’ŒEurekaç›¸åŒå’Œä¸åŒ"><a href="#Nacoså’ŒEurekaç›¸åŒå’Œä¸åŒ" class="headerlink" title="Nacoså’ŒEurekaç›¸åŒå’Œä¸åŒ"></a>Nacoså’ŒEurekaç›¸åŒå’Œä¸åŒ</h2><ul><li>Nacosä¸eurekaçš„å…±åŒç‚¹<ul><li>éƒ½æ”¯æŒæœåŠ¡æ³¨å†Œå’ŒæœåŠ¡æ‹‰å–</li><li>éƒ½æ”¯æŒæœåŠ¡æä¾›è€…å¿ƒè·³æ–¹å¼åšå¥åº·æ£€æµ‹</li></ul></li><li>Nacosä¸Eurekaçš„åŒºåˆ«<ul><li>Nacosæ”¯æŒæœåŠ¡ç«¯ä¸»åŠ¨æ£€æµ‹æä¾›è€…çŠ¶æ€ï¼šä¸´æ—¶å®ä¾‹é‡‡ç”¨å¿ƒè·³æ¨¡å¼ï¼Œéä¸´æ—¶å®ä¾‹é‡‡ç”¨ä¸»åŠ¨æ£€æµ‹æ¨¡å¼</li><li>ä¸´æ—¶å®ä¾‹å¿ƒè·³ä¸æ­£å¸¸ä¼šè¢«å‰”é™¤ï¼Œéä¸´æ—¶å®ä¾‹åˆ™ä¸ä¼šè¢«å‰”é™¤</li><li>Nacosæ”¯æŒæœåŠ¡åˆ—è¡¨å˜æ›´çš„æ¶ˆæ¯æ¨é€æ¨¡å¼ï¼ŒæœåŠ¡åˆ—è¡¨æ›´æ–°æ›´åŠæ—¶</li><li>Nacosé›†ç¾¤é»˜è®¤é‡‡ç”¨APæ–¹å¼ï¼Œå½“é›†ç¾¤ä¸­å­˜åœ¨éä¸´æ—¶å®ä¾‹æ—¶ï¼Œé‡‡ç”¨CPæ¨¡å¼ï¼›Eurekaé‡‡ç”¨APæ–¹å¼</li></ul></li></ul><h2 id="é…ç½®ç®¡ç†"><a href="#é…ç½®ç®¡ç†" class="headerlink" title="é…ç½®ç®¡ç†"></a>é…ç½®ç®¡ç†</h2><p>åœ¨å®é™…ç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°é¢‘ç¹ä¿®æ”¹é…ç½®çš„æƒ…å†µï¼Œä½†æ˜¯å¦‚æœä¿®æ”¹é…ç½®è¿‡ç¨‹ä¸­æ¶‰åŠçš„å¾®æœåŠ¡æ•°é‡å¤šäº†ï¼Œä¼šå¾ˆéº»çƒ¦ä¸”ä¿®æ”¹é…ç½®çš„å¾®æœåŠ¡éœ€è¦é‡å¯ä»¥ç”Ÿæ•ˆæ–°çš„é…ç½®ï¼Œä½†é‡å¯å¯èƒ½ä¼šå¸¦æ¥å¾ˆå¤§çš„æŸå¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦Nacosçš„é…ç½®ç®¡ç†ï¼Œä»–å¯ä»¥ä¿å­˜æœåŠ¡ä¸­ä¸€äº›æ¯”è¾ƒé‡è¦çš„æ ¸å¿ƒé…ç½®ï¼ŒæœåŠ¡åœ¨å¯åŠ¨æ—¶åªéœ€è¯»å–ä¸Šé¢çš„é…ç½®ï¼Œç„¶åç»“åˆè‡ªèº«é…ç½®ç»„æˆä¸€å¥—å®Œæ•´çš„é…ç½®æ–‡ä»¶ã€‚é€šè¿‡é…ç½®çƒ­æ›´æ–°ï¼Œå¦‚æœè¦ä¿®æ”¹åªéœ€è¦ä¿®æ”¹Nacosçš„é…ç½®ç®¡ç†ï¼Œå…¶ä½™å¾®æœåŠ¡å°±ä¼šè¯»å–åˆ°å˜åŒ–åçš„é…ç½®ï¼Œç„¶ååŠ ä»¥åº”ç”¨ï¼Œå®ç°çƒ­æ›´æ–°ã€‚</p><h2 id="Nacoså®ç°é…ç½®ç®¡ç†"><a href="#Nacoså®ç°é…ç½®ç®¡ç†" class="headerlink" title="Nacoså®ç°é…ç½®ç®¡ç†"></a>Nacoså®ç°é…ç½®ç®¡ç†</h2><p>ç›´æ¥åœ¨Nacosæ§åˆ¶å°é‡Œæ“ä½œ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221646375.png" alt="image-20231222164621257"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221651280.png" alt="image-20231222165131214"></p><h2 id="å¾®æœåŠ¡è·å–Nacosä¸­çš„é…ç½®"><a href="#å¾®æœåŠ¡è·å–Nacosä¸­çš„é…ç½®" class="headerlink" title="å¾®æœåŠ¡è·å–Nacosä¸­çš„é…ç½®"></a>å¾®æœåŠ¡è·å–Nacosä¸­çš„é…ç½®</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221700941.png" alt="image-20231222170002889"></p><p>ç”±ä¸Šé¢çš„æµç¨‹å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œbootstrapè¿™ä¸€é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§æ˜¯è¦é«˜äºapplicationçš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠè¿æ¥NacosæœåŠ¡çš„é…ç½®é…ç½®åˆ°è¯¥æ–‡ä»¶é‡Œé¢ï¼Œè¿™æ ·Springä¼šå…ˆæ ¹æ®è¿™ä¸ªé…ç½®æ–‡ä»¶è®¿é—®åˆ°Nacosï¼Œå¹¶æå–åˆ°å…¶ä¸­çš„æœåŠ¡ï¼Œç„¶ååœ¨æŠŠå…¶ä¸­çš„é…ç½®å’Œæœ¬åœ°applicationä¸­çš„é…ç½®åˆå¹¶æˆå®Œæ•´çš„é…ç½®ï¼Œè¿™å°±æ˜¯æ•´ä¸ªé…ç½®ç®¡ç†çš„å…¨è¿‡ç¨‹ã€‚</p><p>é¦–å…ˆå¯¼å…¥Nacosé…ç½®ç®¡ç†ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacosé…ç½®ç®¡ç†ä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨resourceç›®å½•ä¸‹æ·»åŠ bootstrap.ymlæ–‡ä»¶</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221714999.png" alt="image-20231222171403954"></p><p>ç„¶åé…ç½®bootstrapï¼Œå°†NacosæœåŠ¡è¿æ¥é…ç½®ï¼Œè¿˜æœ‰æƒ³è¦è·å–çš„è¢«Nacosç®¡ç†çš„é…ç½®ä¿¡æ¯å†™è¿›å»ï¼Œæ³¨æ„ä¸€å®šè¦å’ŒNacosä¸­çš„åå­—ç›¸å¯¹åº”</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userserver</span> <span class="comment"># å¯¹åº”é…ç½®åç§°</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment">#å¼€å‘ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯dev </span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># Nacosåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># æ–‡ä»¶åç¼€å</span></span><br></pre></td></tr></table></figure><p>ç”±äºapplicationä¸­å·²ç»å­˜åœ¨äº†NacosæœåŠ¡è¿æ¥é…ç½®ï¼Œæ‰€ä»¥éœ€è¦åˆ é™¤ï¼Œè¿˜æœ‰åŸå…ˆåœ¨applicationä¸­é…ç½®çš„dateformat</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221718207.png" alt="image-20231222171848160"></p><p>ç„¶åéªŒè¯ä¸€ä¸‹æ˜¯å¦å·²ç»è¯»åˆ°é…ç½®äº†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨@Valueæ³¨è§£æ‹¿åˆ°é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221725173.png" alt="image-20231222172508121"></p><p>çœ‹ç»“æœï¼ŒæˆåŠŸè¯»åˆ°ï¼š<br><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221725232.png" alt="image-20231222172555188"></p><h2 id="é…ç½®çƒ­æ›´æ–°"><a href="#é…ç½®çƒ­æ›´æ–°" class="headerlink" title="é…ç½®çƒ­æ›´æ–°"></a>é…ç½®çƒ­æ›´æ–°</h2><p>çƒ­æ›´æ–°å³è®©æˆ‘ä»¬çš„å¾®æœåŠ¡èƒ½å®æ—¶è·å–Nacosä¸­å˜åŒ–çš„é…ç½®ï¼Œè€Œæ— éœ€é‡å¯å¾®æœåŠ¡</p><p>æœ‰ä¸¤ç§æ–¹æ³•</p><p>æ³•ä¸€ï¼š<br>åœ¨@Valueæ³¨å…¥çš„ç±»ä¸Šæ·»åŠ æ³¨è§£@RefreshScope</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221752042.png" alt="image-20231222175209994"></p><p>æ³•äºŒï¼ˆæ¨èï¼‰:<br>åˆ©ç”¨@ConfigurationPropertiesæ³¨è§£è‡ªåŠ¨æ³¨å…¥ä»£æ›¿@Valueæ³¨è§£ã€‚</p><p>ä¸ºæ­¤æˆ‘ä»¬å¯ä»¥å•ç‹¬å»ºä¸€ä¸ªç±»ï¼Œæ¥è·å–é…ç½®æ–‡ä»¶çš„å±æ€§å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pattern&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatternProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>@ConfigurationPropertiesä¼šè‡ªåŠ¨å°†ç¬¦åˆå‰ç¼€åå¹¶ä¸”å±æ€§åå’Œè¯¥ç±»ä¸­çš„å±æ€§ä¸€è‡´çš„é…ç½®çš„å€¼ï¼Œè‡ªåŠ¨æ³¨å…¥åˆ°å±æ€§ä¸­ã€‚</p></blockquote><p>è·å–çš„è¯ï¼Œé¦–å…ˆåˆ©ç”¨@Autowiredæ³¨å…¥è¯¥ç±»ï¼Œå› ä¸ºå·²ç»æ·»åŠ è¿‡@Dataæ³¨è§£ï¼Œç›´æ¥è°ƒç”¨getæ–¹æ³•å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(patternProperties.getDateformat());</span><br></pre></td></tr></table></figure><p>ç„¶åè®©æˆ‘ä»¬è¯•éªŒä¸€ä¸‹</p><p>é‡å¯å¾®æœåŠ¡</p><p>å…ˆä¿®æ”¹Nacosé…ç½®ç®¡ç†ä¸­çš„é…ç½®</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221801781.png" alt="image-20231222180110737"></p><p>ç„¶åå†æ¬¡è®¿é—®æˆ‘ä»¬å†™äº†è¾“å‡ºè¯­å¥çš„æ–¹æ³•ï¼Œçƒ­æ›´æ–°æˆåŠŸ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221801049.png" alt="image-20231222180155006"></p><p>å†æ”¹ä¸€æ¬¡</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221802694.png" alt="image-20231222180228652"></p><p>å†è¯•è¯•ï¼Œä¾ç„¶æˆåŠŸ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221803418.png" alt="image-20231222180301381"></p><h2 id="å¤šç¯å¢ƒé…ç½®å…±äº«"><a href="#å¤šç¯å¢ƒé…ç½®å…±äº«" class="headerlink" title="å¤šç¯å¢ƒé…ç½®å…±äº«"></a>å¤šç¯å¢ƒé…ç½®å…±äº«</h2><p>å¾®æœåŠ¡å¯åŠ¨æ—¶ä¼šä»Nacosä¸­è¯»å–å¤šä¸ªé…ç½®</p><p>æˆ‘ä»¬å¯ä»¥åœ¨Nacosä¸­å†åŠ ä¸€ä¸ªé…ç½®ï¼Œæ ¼å¼æ˜¯name + .yaml</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221823872.png" alt="image-20231222182304821"></p><p>è¿™æ ·è¿™ä¸ªé…ç½®æ‰€æœ‰ç¯å¢ƒä¸‹çš„userserveréƒ½å¯ä»¥è¯»åˆ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pattern&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatternProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line">    <span class="keyword">private</span> String sharedValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å†è®¿é—®</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221825327.png" alt="image-20231222182521285"></p><p>è®¿é—®åˆ°äº†ä¸¤ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œä½†å®é™…ä¸Šå½“å‰userserveræ˜¯devç¯å¢ƒï¼Œè¿™è¯´æ˜æ²¡æœ‰æ ‡æ˜ç¯å¢ƒçš„é…ç½®æ–‡ä»¶å¯è¢«å¤šä¸ªå¾®æœåŠ¡å…±äº«</p><p>ä¼˜å…ˆçº§çš„è¯ï¼š<br>ç¯å¢ƒé…ç½® &gt; å¤šç¯å¢ƒé…ç½® &gt; æœ¬åœ°</p><h2 id="Nacosé›†ç¾¤"><a href="#Nacosé›†ç¾¤" class="headerlink" title="Nacosé›†ç¾¤"></a>Nacosé›†ç¾¤</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221943020.png" alt="image-20231222194305936"></p><p>ä¸¾ä¾‹ï¼š</p><p>å…¶ä¸­åŒ…å«3ä¸ªnacosèŠ‚ç‚¹ï¼Œç„¶åä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ä»£ç†3ä¸ªNacosã€‚è¿™é‡Œè´Ÿè½½å‡è¡¡å™¨å¯ä»¥ä½¿ç”¨nginxã€‚</p><h3 id="æ­å»ºé›†ç¾¤"><a href="#æ­å»ºé›†ç¾¤" class="headerlink" title="æ­å»ºé›†ç¾¤"></a>æ­å»ºé›†ç¾¤</h3><h4 id="åˆå§‹åŒ–æ•°æ®åº“"><a href="#åˆå§‹åŒ–æ•°æ®åº“" class="headerlink" title="åˆå§‹åŒ–æ•°æ®åº“"></a>åˆå§‹åŒ–æ•°æ®åº“</h4><p>é¦–å…ˆæ–°å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå‘½åä¸ºnacosï¼Œè€Œåå¯¼å…¥ä¸‹é¢çš„SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  `c_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c_use` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `effect` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c_schema` text,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = config_info_aggr   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_aggr` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `datum_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;datum_id&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å†…å®¹&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;å¢åŠ ç§Ÿæˆ·å­—æ®µ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = config_info_beta   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_beta` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `beta_ips` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;betaIps&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info_beta&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = config_info_tag   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_tag` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tag_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info_tag&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = config_tags_relation   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_tags_relation` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `tag_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_name&#x27;</span>,</span><br><span class="line">  `tag_type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_type&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),</span><br><span class="line">  KEY `idx_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_tag_relation&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = group_capacity   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `group_capacity` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Group IDï¼Œç©ºå­—ç¬¦è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;ä½¿ç”¨é‡&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°ï¼Œï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;æœ€å¤§å˜æ›´å†å²æ•°é‡&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_group_id` (`group_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;é›†ç¾¤ã€å„Groupå®¹é‡ä¿¡æ¯è¡¨&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = his_config_info   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `his_config_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">64</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `src_user` text,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `op_type` <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`),</span><br><span class="line">  KEY `idx_gmt_create` (`gmt_create`),</span><br><span class="line">  KEY `idx_gmt_modified` (`gmt_modified`),</span><br><span class="line">  KEY `idx_did` (`data_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;å¤šç§Ÿæˆ·æ”¹é€ &#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = tenant_capacity   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_capacity` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Tenant ID&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;ä½¿ç”¨é‡&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;æœ€å¤§å˜æ›´å†å²æ•°é‡&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;ç§Ÿæˆ·å®¹é‡ä¿¡æ¯è¡¨&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `kp` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;kp&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tenant_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_name&#x27;</span>,</span><br><span class="line">  `tenant_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tenant_desc&#x27;</span>,</span><br><span class="line">  `create_source` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;create_source&#x27;</span>,</span><br><span class="line">  `gmt_create` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),</span><br><span class="line">  KEY `idx_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;tenant_info&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users` (</span><br><span class="line">`username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">`password` <span class="type">varchar</span>(<span class="number">500</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`enabled` <span class="type">boolean</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `roles` (</span><br><span class="line">`username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`role` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">UNIQUE</span> INDEX `idx_user_role` (`username` <span class="keyword">ASC</span>, `role` <span class="keyword">ASC</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `permissions` (</span><br><span class="line">    `role` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `resource` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `action` <span class="type">varchar</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span> INDEX `uk_role_permission` (`role`,`resource`,`action`) <span class="keyword">USING</span> BTREE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (username, password, enabled) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#x27;</span>, <span class="literal">TRUE</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> roles (username, role) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;ROLE_ADMIN&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="é…ç½®Nacos"><a href="#é…ç½®Nacos" class="headerlink" title="é…ç½®Nacos"></a>é…ç½®Nacos</h4><p>è¿›å…¥nacosçš„confç›®å½•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶cluster.conf.exampleï¼Œé‡å‘½åä¸ºcluster.confï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221946748.png" alt="image-20231222194606692"></p><p>ç„¶åæ·»åŠ å†…å®¹ï¼ˆåˆ†åˆ«å¯¹åº”ä½ ä¸‰ä¸ªnacosèŠ‚ç‚¹çš„åœ°å€å’Œç«¯å£ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:8845</span><br><span class="line">127.0.0.1.8846</span><br><span class="line">127.0.0.1.8847</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹application.propertiesæ–‡ä»¶ï¼Œæ·»åŠ æ•°æ®åº“é…ç½®ï¼Œå¯¹åº”è‡ªå·±ç”µè„‘çš„æ•°æ®åº“åœ°å€è¿˜æœ‰è´¦å·å¯†ç </p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"></span><br><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.user.0</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password.0</span>=<span class="string">123</span></span><br></pre></td></tr></table></figure><p>è¿˜æœ‰æ¯ä¸ªnacosçš„ç«¯å£å·è¦å¯¹åº”cluster.conf</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8845</span></span><br></pre></td></tr></table></figure><p>ï¼ˆæ¯ä¸ªnacoséƒ½è¦è¿›è¡Œé…ç½®ï¼‰</p><h4 id="å¯åŠ¨nacos"><a href="#å¯åŠ¨nacos" class="headerlink" title="å¯åŠ¨nacos"></a>å¯åŠ¨nacos</h4><p>è¿™é‡Œç›´æ¥è¿è¡Œstartup.cmdï¼Œé»˜è®¤é›†ç¾¤å¯åŠ¨</p><h4 id="é…ç½®nginx"><a href="#é…ç½®nginx" class="headerlink" title="é…ç½®nginx"></a>é…ç½®nginx</h4><p>ä¿®æ”¹conf&#x2F;nginx.confæ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> nacos-cluster &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8845</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">127.0.0.1:8846</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">127.0.0.1:8847</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> /nacos &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://nacos-cluster;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±ä½¿ç”¨äº†nginxåå‘ä»£ç†äº†Nacos</p><h4 id="å¯åŠ¨Nginx"><a href="#å¯åŠ¨Nginx" class="headerlink" title="å¯åŠ¨Nginx"></a>å¯åŠ¨Nginx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start nginx.exe</span><br></pre></td></tr></table></figure><p>è€Œååœ¨æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost/nacos%E5%8D%B3%E5%8F%AF%E3%80%82">http://localhost/nacoså³å¯ã€‚</a></p><p>ä»£ç ä¸­application.ymlæ–‡ä»¶é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:80</span> <span class="comment"># Nacosåœ°å€</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºnginxç›‘å¬80ç«¯å£</p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> Nacos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®æœåŠ¡å…¥é—¨å­¦ä¹ </title>
      <link href="/2023/12/21/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/12/21/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="å¾®æœåŠ¡å…¥é—¨å­¦ä¹ "><a href="#å¾®æœåŠ¡å…¥é—¨å­¦ä¹ " class="headerlink" title="å¾®æœåŠ¡å…¥é—¨å­¦ä¹ "></a>å¾®æœåŠ¡å…¥é—¨å­¦ä¹ </h1><blockquote><p>éƒ¨åˆ†èµ„æ–™æ¥è‡ªäºé»‘é©¬ç¨‹åºå‘˜</p></blockquote><h2 id="1-çƒ­é—¨å¾®æœåŠ¡æŠ€æœ¯å¯¹æ¯”"><a href="#1-çƒ­é—¨å¾®æœåŠ¡æŠ€æœ¯å¯¹æ¯”" class="headerlink" title="1. çƒ­é—¨å¾®æœåŠ¡æŠ€æœ¯å¯¹æ¯”"></a>1. çƒ­é—¨å¾®æœåŠ¡æŠ€æœ¯å¯¹æ¯”</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312211454709.png" alt="image-20231221145402634"></p><h2 id="2-ç®€å•å®ç°å¾®æœåŠ¡çš„ä»£ç "><a href="#2-ç®€å•å®ç°å¾®æœåŠ¡çš„ä»£ç " class="headerlink" title="2. ç®€å•å®ç°å¾®æœåŠ¡çš„ä»£ç "></a>2. ç®€å•å®ç°å¾®æœåŠ¡çš„ä»£ç </h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312211528506.png" alt="image-20231221152818473"></p><p>æ­¤å¤„åˆ†åˆ«ä¸ºç”¨æˆ·æœåŠ¡å’Œè®¢å•æœåŠ¡</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312211529092.png" alt="image-20231221152901057"></p><p>è®¢å•æœåŠ¡çš„ç«¯å£ä¸º8080ï¼Œä¸”è°ƒç”¨cloud_orderæ•°æ®åº“</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312211529778.png" alt="image-20231221152949744"></p><p>ç”¨æˆ·æœåŠ¡åœ¨8081ï¼Œä¸”æ•°æ®åº“ä¸ºcloud_user</p><p>åŠ ä¸Šç®€å•çš„ä¸šåŠ¡ä»£ç ï¼Œè¿™æ ·å°±èƒ½å®ç°ç®€å•çš„å¾®æœåŠ¡ã€‚</p><p>è®¿é—®user_service</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312211531063.png" alt="image-20231221153135034"></p><p>è®¿é—®order_service</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312211531420.png" alt="image-20231221153150390"></p><h2 id="3-å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨"><a href="#3-å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨" class="headerlink" title="3. å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨"></a>3. å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨</h2><p>é—®é¢˜æè¿°ï¼š</p><p>ç”±äºå¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®è¢«åˆ†æˆäº†å¾ˆå¤šå¯ä»¥ç‹¬ç«‹å·¥ä½œçš„éƒ¨åˆ†ï¼Œä½†æˆ‘ä»¬åœ¨å®é™…è°ƒç”¨è¿™äº›æ¨¡å—çš„æ—¶å€™ï¼Œå¯èƒ½å¹¶ä¸åªæ˜¯è°ƒç”¨å…¶ä¸­ä¸€ä¸ªï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¤šä¸ªæ¨¡å—ååŒå·¥ä½œåçš„ç»“æœï¼Œæ¯”å¦‚ä¸Šé¢ä¸¾ä¾‹çš„ç”¨æˆ·çš„è®¢å•æ¨¡å—ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨æŸ¥è¯¢è®¢å•çš„æ—¶å€™ä¸€å—æŸ¥è¯¢åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œè€Œè®¢å•æ¨¡å—åˆæ— æ³•ç›´æ¥æ“ä½œç”¨æˆ·æ•°æ®åº“ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>è¿™å°±éœ€è¦å¾®æœåŠ¡çš„è¿œç¨‹è°ƒç”¨ï¼Œå³ç”¨æ¨¡å—è°ƒç”¨æ¨¡å—ï¼Œå®ç°æ–¹æ³•ç±»ä¼¼äºç”¨javaä»£ç å‘é€httpè¯·æ±‚ç»™ç›®æ ‡æ¨¡å—</p><p>springæä¾›äº†å¯ä»¥å®ç°è¿™ä¸€åŠŸèƒ½çš„å·¥å…·ï¼šRestTemplate</p><p>é¦–å…ˆå…ˆåœ¨å¯åŠ¨ç±»é‡Œé¢æ³¨å†ŒRestTemplate</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    æ³¨å†ŒRestTemplate</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨éœ€è¦çš„åœ°æ–¹æ³¨å…¥å¹¶è°ƒç”¨RestTemplate</p><p>æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RestTemplate restTemplate;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        åˆ›å»ºurlï¼ŒæŒ‡å‘å‘é€è¯·æ±‚çš„åœ°å€</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081/user/&quot;</span> + order.getUserId();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(url, User.class);</span><br></pre></td></tr></table></figure><blockquote><p>restTemplate.getForObject å‘é€getè¯·æ±‚</p><p>restTemplate.postForObject å‘é€postè¯·æ±‚</p><p>é»˜è®¤è¿”å›jsonæ ¼å¼å­—ç¬¦ä¸²ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰è¿”å›ç±»å‹</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312211602645.png" alt="image-20231221160222609"></p><p>è¿”å›çš„jsonåŒæ—¶æœ‰useræ¨¡å—çš„å†…å®¹</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šurlä¸€å®šè®°å¾—å®Œæ•´ï¼ŒåŠ http:&#x2F;&#x2F;,ç„¶åä¸è¦å¿˜è®°å‚æ•°å‰åŠ &#x2F;</p><h2 id="4-Eurekaæ³¨å†Œä¸­å¿ƒ"><a href="#4-Eurekaæ³¨å†Œä¸­å¿ƒ" class="headerlink" title="4. Eurekaæ³¨å†Œä¸­å¿ƒ"></a>4. Eurekaæ³¨å†Œä¸­å¿ƒ</h2><p>ä¸Šè¿°è¿œç¨‹è°ƒç”¨çœ‹ä¼¼å¾ˆæˆåŠŸï¼Œå®åˆ™å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼š</p><ul><li>æœåŠ¡æ¶ˆè´¹è€…å¦‚ä½•è·çŸ¥æä¾›è€…çš„åœ°å€ä¿¡æ¯ï¼ˆè‚¯å®šä¸æ˜¯å†™localhostï¼‰</li><li>å¦‚æœå­˜åœ¨å¤šä¸ªæä¾›è€…ï¼Œæ¶ˆè´¹è€…å¦‚ä½•ä»ä¸­é€‰æ‹©</li><li>æ¶ˆè´¹è€…å¦‚ä½•çŸ¥é“æä¾›è€…çš„å¥åº·çŠ¶æ€ï¼ˆæœåŠ¡å™¨æ˜¯å¦æŒ‚äº†ï¼‰</li></ul><p>è¿™å°±éœ€è¦Eurekaï¼Œå®ƒä½œä¸ºä¸€ä¸ªä¸­é—´åª’ä»‹ï¼Œåœ¨æ¯ä¸€ä¸ªæœåŠ¡å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šå‘eurekaæ³¨å†ŒæœåŠ¡ä¿¡æ¯ï¼ˆåå­—ï¼Œåœ°å€ç«¯å£ï¼‰,ç„¶åå¦‚æœæœ‰æœåŠ¡æœ‰è¿œç¨‹è°ƒç”¨éœ€è¦ï¼Œå®ƒä¼šè”ç³»Eurekaï¼Œç„¶åEurekaæä¾›ä¿¡æ¯ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªæä¾›è€…ï¼Œåˆ™ä¼šåˆ©ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚è‡³äºå¥åº·çŠ¶æ€ï¼ŒEurekaæ¯30sä¼šä»æ¯ä¸ªæœåŠ¡æ¥å—ä¸€æ¬¡ä¿¡å·ï¼ˆå¿ƒè·³ç»­çº¦ï¼‰ï¼Œå¦‚æœæ”¶ä¸åˆ°ï¼Œè¯¥æœåŠ¡çš„ä¿¡æ¯å°±ä¼šè¢«å‰”é™¤ã€‚</p><h2 id="5-Eurekaå®è·µ"><a href="#5-Eurekaå®è·µ" class="headerlink" title="5. Eurekaå®è·µ"></a>5. Eurekaå®è·µ</h2><p>å¯¼å…¥ä¾èµ–åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        å¯¼å…¥Eurekaä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºå¯åŠ¨ç±»,å¹¶åŠ å…¥@EnableEurekaServeræ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(EurekaApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œé…ç½®eureka</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8082</span> <span class="comment">#æœåŠ¡ç«¯å£</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eurekaserver</span> <span class="comment">#æœåŠ¡åç§°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment">#eurekaåœ°å€ä¿¡æ¯</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8082/eureka</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨eureka</p><p>è®¿é—®defaultZone: <a href="http://localhost:8082/eureka%EF%BC%8C%E7%9C%8B%E5%88%B0%E4%B8%8B%E9%9D%A2%E7%9A%84%E6%8E%A7%E5%88%B6%E5%8F%B0%E4%BB%A3%E8%A1%A8%E6%88%90%E5%8A%9F">http://localhost:8082/eurekaï¼Œçœ‹åˆ°ä¸‹é¢çš„æ§åˆ¶å°ä»£è¡¨æˆåŠŸ</a></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312211655423.png" alt="image-20231221165535338"></p><h2 id="6-EurekaæœåŠ¡æ³¨å†Œ"><a href="#6-EurekaæœåŠ¡æ³¨å†Œ" class="headerlink" title="6. EurekaæœåŠ¡æ³¨å†Œ"></a>6. EurekaæœåŠ¡æ³¨å†Œ</h2><p>ä¹‹å‰æåˆ°è¿‡ï¼ŒEurekaæ˜¯ä¸€ä¸ªä¸­é—´åª’ä»‹ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½ä¼šåœ¨å®ƒä¸Šé¢è¿›è¡Œä¸€ä¸ªæ³¨å†Œï¼ŒåŒæ—¶æ‰€æœ‰çš„è¿œç¨‹è°ƒç”¨éƒ½ä¼šç»è¿‡å®ƒå¾—åˆ°æœåŠ¡æä¾›è€…ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è¦åšçš„æ˜¯å°†æ¯ä¸ªæœåŠ¡éƒ½æ³¨å†Œåˆ°Eurekaä¸Š</p><p>å…ˆå¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        Eurekaå®¢æˆ·ç«¯ä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®æ³¨å†Œä¿¡æ¯ï¼ˆæœ¬æœåŠ¡çš„åå­—ï¼Œä»¥åŠEurekaæœåŠ¡çš„åœ°å€ï¼‰ï¼Œæ­¤å¤„ä»¥user-serviceä¸ºä¾‹ï¼Œorder-serviceä¸€è‡´</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userserver</span> <span class="comment">#æœåŠ¡åç§°</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment">#eurekaåœ°å€ä¿¡æ¯</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8082/eureka</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥å¯åŠ¨çœ‹ä¸€ä¸‹æ˜¯å¦å·²ç»åœ¨Eurekaæ³¨å†Œè¡¨é‡Œäº†</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312211957766.png" alt="image-20231221195713695"></p><h2 id="7-æ€ä¹ˆä½¿ç”¨Eureka"><a href="#7-æ€ä¹ˆä½¿ç”¨Eureka" class="headerlink" title="7. æ€ä¹ˆä½¿ç”¨Eureka"></a>7. æ€ä¹ˆä½¿ç”¨Eureka</h2><p>æˆ‘ä»¬ä¹‹å‰åˆ©ç”¨templateè¿œç¨‹è°ƒç”¨æ—¶ï¼Œåœ¨urlä¸­å†™çš„æ˜¯æ­»ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081/user/&quot;</span> + order.getUserId();</span><br></pre></td></tr></table></figure><p>æœ‰äº†Eurekaåï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨æœåŠ¡åç§°æ¥æ›¿ä»£ipåœ°å€å’Œç«¯å£å·éƒ¨åˆ†</p><p>å³</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://userserver/user/&quot;</span> + order.getUserId();</span><br></pre></td></tr></table></figure><p>è¿˜è¦åœ¨å¯åŠ¨ç±»çš„æ³¨å†Œresttemplateå‡½æ•°ä¸ŠåŠ ä¸Š@LoadBalancedæ³¨è§£ç”¨æ¥å¯åŠ¨è´Ÿè½½å‡è¡¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    æ³¨å†ŒRestTemplate</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™æ˜¯å¿…é¡»è¦åŠ çš„ã€‚</p><h2 id="8-Ribbonè´Ÿè½½å‡è¡¡"><a href="#8-Ribbonè´Ÿè½½å‡è¡¡" class="headerlink" title="8. Ribbonè´Ÿè½½å‡è¡¡"></a>8. Ribbonè´Ÿè½½å‡è¡¡</h2><p>é¦–å…ˆè¿™ä¸ªåœ°å€<a href="http://userserver/user/...%EF%BC%8C%E6%98%AF%E4%B8%80%E4%B8%AA%E6%97%A0%E6%95%88%E5%9C%B0%E5%9D%80%EF%BC%8C%E5%8D%B3%E6%88%91%E4%BB%AC%E6%97%A0%E6%B3%95%E9%80%9A%E8%BF%87%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AE%E8%AF%A5%E5%9C%B0%E5%9D%80%E4%B8%8B%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8C%E8%80%8C%E6%88%91%E4%BB%AC%E6%9C%80%E7%BB%88%E5%8D%B4%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E5%88%B0%E6%88%91%E4%BB%AC%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%BF%99%E6%98%AF%E5%9B%A0%E4%B8%BA%E4%B8%AD%E9%97%B4%E6%9C%89%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%8B%A6%E6%88%AA%E5%99%A8%E6%8B%A6%E6%88%AA%E4%BA%86%E8%BF%99%E4%B8%AA%E8%AF%B7%E6%B1%82%EF%BC%8C%E7%84%B6%E5%90%8E%E4%BA%A4%E7%BB%99Ribbon%E5%B9%B6%E5%AE%9E%E7%8E%B0%E4%BA%86%E8%A7%A3%E6%9E%90%EF%BC%8C%E7%84%B6%E5%90%8E%E4%BA%A4%E7%BB%99IRule%E6%89%A7%E8%A1%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95%E9%80%89%E6%8B%A9%E4%BA%86%E5%90%88%E9%80%82%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85">http://userserver/user/...ï¼Œæ˜¯ä¸€ä¸ªæ— æ•ˆåœ°å€ï¼Œå³æˆ‘ä»¬æ— æ³•é€šè¿‡æµè§ˆå™¨ç›´æ¥è®¿é—®è¯¥åœ°å€ä¸‹çš„å†…å®¹ï¼Œè€Œæˆ‘ä»¬æœ€ç»ˆå´å¯ä»¥è®¿é—®åˆ°æˆ‘ä»¬è¦çš„æ•°æ®ï¼Œè¿™æ˜¯å› ä¸ºä¸­é—´æœ‰è´Ÿè½½å‡è¡¡æ‹¦æˆªå™¨æ‹¦æˆªäº†è¿™ä¸ªè¯·æ±‚ï¼Œç„¶åäº¤ç»™Ribbonå¹¶å®ç°äº†è§£æï¼Œç„¶åäº¤ç»™IRuleæ‰§è¡Œè´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©äº†åˆé€‚çš„æœåŠ¡æä¾›è€…</a></p><h2 id="9-è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#9-è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="9. è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>9. è´Ÿè½½å‡è¡¡ç­–ç•¥</h2><table><thead><tr><th><strong>å†…ç½®è´Ÿè½½å‡è¡¡è§„åˆ™ç±»</strong></th><th><strong>è§„åˆ™æè¿°</strong></th></tr></thead><tbody><tr><td>RoundRobinRule</td><td>ç®€å•è½®è¯¢æœåŠ¡åˆ—è¡¨æ¥é€‰æ‹©æœåŠ¡å™¨ã€‚å®ƒæ˜¯Ribboné»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™ã€‚</td></tr><tr><td>AvailabilityFilteringRule</td><td>å¯¹ä»¥ä¸‹ä¸¤ç§æœåŠ¡å™¨è¿›è¡Œå¿½ç•¥ï¼š   ï¼ˆ1ï¼‰åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™å°æœåŠ¡å™¨å¦‚æœ3æ¬¡è¿æ¥å¤±è´¥ï¼Œè¿™å°æœåŠ¡å™¨å°±ä¼šè¢«è®¾ç½®ä¸ºâ€œçŸ­è·¯â€çŠ¶æ€ã€‚çŸ­è·¯çŠ¶æ€å°†æŒç»­30ç§’ï¼Œå¦‚æœå†æ¬¡è¿æ¥å¤±è´¥ï¼ŒçŸ­è·¯çš„æŒç»­æ—¶é—´å°±ä¼šå‡ ä½•çº§åœ°å¢åŠ ã€‚  ï¼ˆ2ï¼‰å¹¶å‘æ•°è¿‡é«˜çš„æœåŠ¡å™¨ã€‚å¦‚æœä¸€ä¸ªæœåŠ¡å™¨çš„å¹¶å‘è¿æ¥æ•°è¿‡é«˜ï¼Œé…ç½®äº†AvailabilityFilteringRuleè§„åˆ™çš„å®¢æˆ·ç«¯ä¹Ÿä¼šå°†å…¶å¿½ç•¥ã€‚å¹¶å‘è¿æ¥æ•°çš„ä¸Šé™ï¼Œå¯ä»¥ç”±å®¢æˆ·ç«¯çš„<clientName>.<clientConfigNameSpace>.ActiveConnectionsLimitå±æ€§è¿›è¡Œé…ç½®ã€‚</td></tr><tr><td>WeightedResponseTimeRule</td><td>ä¸ºæ¯ä¸€ä¸ªæœåŠ¡å™¨èµ‹äºˆä¸€ä¸ªæƒé‡å€¼ã€‚æœåŠ¡å™¨å“åº”æ—¶é—´è¶Šé•¿ï¼Œè¿™ä¸ªæœåŠ¡å™¨çš„æƒé‡å°±è¶Šå°ã€‚è¿™ä¸ªè§„åˆ™ä¼šéšæœºé€‰æ‹©æœåŠ¡å™¨ï¼Œè¿™ä¸ªæƒé‡å€¼ä¼šå½±å“æœåŠ¡å™¨çš„é€‰æ‹©ã€‚</td></tr><tr><td><strong>ZoneAvoidanceRule</strong></td><td>ä»¥åŒºåŸŸå¯ç”¨çš„æœåŠ¡å™¨ä¸ºåŸºç¡€è¿›è¡ŒæœåŠ¡å™¨çš„é€‰æ‹©ã€‚ä½¿ç”¨Zoneå¯¹æœåŠ¡å™¨è¿›è¡Œåˆ†ç±»ï¼Œè¿™ä¸ªZoneå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæœºæˆ¿ã€ä¸€ä¸ªæœºæ¶ç­‰ã€‚è€Œåå†å¯¹Zoneå†…çš„å¤šä¸ªæœåŠ¡åšè½®è¯¢ã€‚</td></tr><tr><td>BestAvailableRule</td><td>å¿½ç•¥é‚£äº›çŸ­è·¯çš„æœåŠ¡å™¨ï¼Œå¹¶é€‰æ‹©å¹¶å‘æ•°è¾ƒä½çš„æœåŠ¡å™¨ã€‚</td></tr><tr><td>RandomRule</td><td>éšæœºé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡å™¨ã€‚</td></tr><tr><td>RetryRule</td><td>é‡è¯•æœºåˆ¶çš„é€‰æ‹©é€»è¾‘</td></tr></tbody></table><p>é»˜è®¤è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸ºè½®è®­<strong>ZoneAvoidanceRule</strong>ï¼Œæ€ä¹ˆæ”¹å˜è¿™ä¸ªé»˜è®¤ç­–ç•¥ï¼š</p><p>æ–¹æ³•1ï¼š<br>è‡ªå·±æ³¨å…¥ä¸€ä¸ª(é…ç½®ç±»æˆ–è€…å¯åŠ¨ç±»ä¸­)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> IRule <span class="title function_">randomRule</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼š</p><p>åœ¨é…ç½®æ–‡ä»¶ä¸­é’ˆå¯¹æŸé¡¹å¾®æœåŠ¡ä¿®æ”¹ï¼ˆæ­¤å¤„é’ˆå¯¹userserverï¼‰</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userserver:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RandomRule</span> <span class="comment"># è´Ÿè½½å‡è¡¡è§„åˆ™ </span></span><br></pre></td></tr></table></figure><h2 id="10-Ribboné¥¥é¥¿åŠ è½½"><a href="#10-Ribboné¥¥é¥¿åŠ è½½" class="headerlink" title="10. Ribboné¥¥é¥¿åŠ è½½"></a>10. Ribboné¥¥é¥¿åŠ è½½</h2><p>Ribboné»˜è®¤æ˜¯æ‡’åŠ è½½ï¼Œå³ç¬¬ä¸€æ¬¡è®¿é—®æ‰åˆ›å»ºLoadBalanceClientï¼Œè¯·æ±‚æ—¶é—´é•¿ã€‚é¥¥é¥¿åŠ è½½ä¼šåœ¨é¡¹ç›®å¯åŠ¨æ—¶åŠ è½½ï¼Œé™ä½ç¬¬ä¸€æ¬¡è®¿é—®æ—¶çš„æ—¶é—´ã€‚</p><p>åœ¨éœ€è¦é¥¥é¥¿åŠ è½½çš„æœåŠ¡é…ç½®ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eager-load:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">clients:</span> </span><br><span class="line">    <span class="string">-userserver</span>  <span class="comment">#æŒ‡å®šå¯¹å“ªä¸ªæœåŠ¡é¥¥é¥¿åŠ è½½ï¼Œå¯ä»¥å¤šä¸ª</span></span><br><span class="line">    <span class="string">-xxxserver</span></span><br></pre></td></tr></table></figure><h2 id="11-Nacos"><a href="#11-Nacos" class="headerlink" title="11. Nacos"></a>11. Nacos</h2><p>Nacosæ˜¯é˜¿é‡Œæä¾›çš„æ³¨å†Œä¸­å¿ƒï¼ŒåŠŸèƒ½ç±»ä¼¼äºEurekaä¸”è¦æ›´å¼ºå¤§ï¼Œä¸¤ç§æ³¨å†Œä¸­å¿ƒéƒ½è¦å­¦ä¸€ä¸‹</p><h3 id="11-1-å®‰è£…"><a href="#11-1-å®‰è£…" class="headerlink" title="11.1 å®‰è£…"></a>11.1 å®‰è£…</h3><p>GitHubä¸»é¡µï¼š<a href="https://github.com/alibaba/nacos">https://github.com/alibaba/nacos</a></p><p>GitHubçš„Releaseä¸‹è½½é¡µï¼š<a href="https://github.com/alibaba/nacos/releases">https://github.com/alibaba/nacos/releases</a></p><p>å®‰è£…å®Œæˆåè¿›è¡Œè§£å‹</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212256701.png" alt="image-20231221225613653"></p><h3 id="11-2-é…ç½®"><a href="#11-2-é…ç½®" class="headerlink" title="11.2 é…ç½®"></a>11.2 é…ç½®</h3><p>conf&#x2F;application.propertiesè¿™æ˜¯nacosçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨é‡Œé¢è¿›è¡Œä¸€äº›å¸¸è§„çš„ç«¯å£é…ç½®</p><h3 id="11-3-å¯åŠ¨"><a href="#11-3-å¯åŠ¨" class="headerlink" title="11.3 å¯åŠ¨"></a>11.3 å¯åŠ¨</h3><p>åœ¨binç›®å½•ä¸‹ï¼Œä½ å¯ä»¥ç›´æ¥åŒå‡»startup.cmd</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212258877.png" alt="image-20231221225839838"></p><p>ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹è¿è¡ŒæŒ‡ä»¤</p><blockquote><p>startup.cmd -m standalone</p><p>æ­¤å¤„ä¸ºå•æœºå¯åŠ¨</p></blockquote><p>å¯åŠ¨ç•Œé¢ï¼š<br><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212300066.png" alt="image-20231221230001017"></p><p>ç„¶åæˆ‘ä»¬å¯ä»¥è®¿é—®ä¸Šé¢ç»™å‡ºçš„ç½‘é¡µï¼Œå¯ä»¥çœ‹åˆ°nacosçš„ç•Œé¢</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212301899.png" alt="image-20231221230114812"></p><p>é»˜è®¤ç™»å½•åå’Œå¯†ç éƒ½æ˜¯nacos</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212301323.png" alt="image-20231221230141264"></p><p>è¿™å°±æ˜¯nacosçš„ç•Œé¢ï¼Œä¹‹åæˆ‘ä»¬ä¼šåœ¨è¿™é‡Œè¿›è¡Œæ“ä½œ</p><p>å…³é—­çš„è¯å°±æ˜¯è¿è¡Œshutdown.cmd</p><h2 id="12-Nacoså¿«é€Ÿå…¥é—¨"><a href="#12-Nacoså¿«é€Ÿå…¥é—¨" class="headerlink" title="12. Nacoså¿«é€Ÿå…¥é—¨"></a>12. Nacoså¿«é€Ÿå…¥é—¨</h2><p>é¦–å…ˆåœ¨é¡¹ç›®çš„çˆ¶å·¥ç¨‹ä¸­æ·»åŠ spring-cloud-alilbabaç®¡ç†ä¾èµ–ï¼Œè¿›è¡ŒåŒ…ç®¡ç†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨æœåŠ¡ä¸­æ·»åŠ nacoså®¢æˆ·ç«¯ä¾èµ–ï¼ˆæ³¨é‡Šæ‰ä¹‹å‰çš„eurekaä¾èµ–ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¹‹åä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆæ³¨é‡Šæ‰eurekaï¼‰</p><p>é…ç½®ç»“æŸåï¼Œæ­£å¸¸å¯åŠ¨æœåŠ¡ï¼Œç„¶åå¯åŠ¨nacosè¿›å…¥æ§åˆ¶å°ï¼Œå°±ä¼šçœ‹åˆ°ä¸¤ä¸ªæœåŠ¡è¢«æ³¨å†Œè¿›æ¥äº†</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212322745.png" alt="image-20231221232205678"></p><p>åŒæ ·å®ç°äº†æ³¨å†Œä¸­å¿ƒçš„åŠŸèƒ½ã€‚</p><h2 id="13-NacosæœåŠ¡åˆ†çº§å‚¨å­˜æ¨¡å‹"><a href="#13-NacosæœåŠ¡åˆ†çº§å‚¨å­˜æ¨¡å‹" class="headerlink" title="13. NacosæœåŠ¡åˆ†çº§å‚¨å­˜æ¨¡å‹"></a>13. NacosæœåŠ¡åˆ†çº§å‚¨å­˜æ¨¡å‹</h2><p>å®ç°æœåŠ¡çš„é›†ç¾¤åŒ–</p><p>ä¸€ä¸ª<strong>æœåŠ¡</strong>å¯ä»¥æœ‰å¤šä¸ª<strong>å®ä¾‹</strong>ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„user-serviceï¼Œå¯ä»¥æœ‰:</p><ul><li>127.0.0.1:8081</li><li>127.0.0.1:8082</li><li>127.0.0.1:8083</li></ul><p>å‡å¦‚è¿™äº›å®ä¾‹åˆ†å¸ƒäºå…¨å›½å„åœ°çš„ä¸åŒæœºæˆ¿ï¼Œä¾‹å¦‚ï¼š</p><ul><li>127.0.0.1:8081ï¼Œåœ¨ä¸Šæµ·æœºæˆ¿</li><li>127.0.0.1:8082ï¼Œåœ¨ä¸Šæµ·æœºæˆ¿</li><li>127.0.0.1:8083ï¼Œåœ¨æ­å·æœºæˆ¿</li></ul><p>Nacoså°±å°†åŒä¸€æœºæˆ¿å†…çš„å®ä¾‹ åˆ’åˆ†ä¸ºä¸€ä¸ª<strong>é›†ç¾¤</strong>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œuser-serviceæ˜¯æœåŠ¡ï¼Œä¸€ä¸ªæœåŠ¡å¯ä»¥åŒ…å«å¤šä¸ªé›†ç¾¤ï¼Œå¦‚æ­å·ã€ä¸Šæµ·ï¼Œæ¯ä¸ªé›†ç¾¤ä¸‹å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼Œå½¢æˆåˆ†çº§æ¨¡å‹ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212331253.png" alt="image-20210713232522531"></p><p>å¾®æœåŠ¡äº’ç›¸è®¿é—®æ—¶ï¼Œåº”è¯¥å°½å¯èƒ½è®¿é—®åŒé›†ç¾¤å®ä¾‹ï¼Œå› ä¸ºæœ¬åœ°è®¿é—®é€Ÿåº¦æ›´å¿«ã€‚å½“æœ¬é›†ç¾¤å†…ä¸å¯ç”¨æ—¶ï¼Œæ‰è®¿é—®å…¶å®ƒé›†ç¾¤ã€‚ä¾‹å¦‚ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212331260.png" alt="image-20210713232658928"></p><p>æ­å·æœºæˆ¿å†…çš„order-serviceåº”è¯¥ä¼˜å…ˆè®¿é—®åŒæœºæˆ¿çš„user-serviceã€‚</p><p>æ“ä½œï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nacos:</span></span><br><span class="line">  <span class="attr">server-addr:</span> <span class="string">localhost:8848</span>  <span class="comment">#nacos æœåŠ¡ç«¯åœ°å€</span></span><br><span class="line">  <span class="attr">discovery:</span></span><br><span class="line">    <span class="attr">cluster-name:</span> <span class="string">AH</span></span><br></pre></td></tr></table></figure><h2 id="14-Nacosè´Ÿè½½å‡è¡¡"><a href="#14-Nacosè´Ÿè½½å‡è¡¡" class="headerlink" title="14. Nacosè´Ÿè½½å‡è¡¡"></a>14. Nacosè´Ÿè½½å‡è¡¡</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userserver:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line"><span class="comment">#    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule # è´Ÿè½½å‡è¡¡è§„åˆ™</span></span><br><span class="line">      <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.alibaba.cloud.nacos.ribbon.NacosRule</span> <span class="comment"># è´Ÿè½½å‡è¡¡è§„åˆ™ </span></span><br></pre></td></tr></table></figure><blockquote><p>NacosRuleä¼˜å…ˆåŒé›†ç¾¤å†…éšæœº</p></blockquote><h2 id="15-é…ç½®æƒé‡"><a href="#15-é…ç½®æƒé‡" class="headerlink" title="15. é…ç½®æƒé‡"></a>15. é…ç½®æƒé‡</h2><p>æƒé‡å¯ä»¥å½±å“è¢«åˆ†é…çš„å‡ ç‡ï¼Œè¶Šå¤§è¶Šå®¹æ˜“è¢«åˆ†é…åˆ°ï¼Œè¿™ä¸ªåœ¨nacosä¸­å°±å¯ä»¥è®¾ç½®</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212347240.png" alt="image-20231221234708178"></p><h2 id="16-ç¯å¢ƒéš”ç¦»"><a href="#16-ç¯å¢ƒéš”ç¦»" class="headerlink" title="16. ç¯å¢ƒéš”ç¦»"></a>16. ç¯å¢ƒéš”ç¦»</h2><p>Nacosæä¾›äº†namespaceæ¥å®ç°ç¯å¢ƒéš”ç¦»åŠŸèƒ½ã€‚</p><ul><li>nacosä¸­å¯ä»¥æœ‰å¤šä¸ªnamespace</li><li>namespaceä¸‹å¯ä»¥æœ‰groupã€serviceç­‰</li><li>ä¸åŒnamespaceä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œä¾‹å¦‚ä¸åŒnamespaceçš„æœåŠ¡äº’ç›¸ä¸å¯è§</li></ul><p>æ–¹æ³•</p><p>é¦–å…ˆåˆ›å»ºå‘½åç©ºé—´ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312212355722.png" alt="image-20231221235551673"></p><p>ç„¶åè¿›å…¥åˆ°æœåŠ¡çš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nacos:</span></span><br><span class="line">  <span class="attr">server-addr:</span> <span class="string">localhost:8848</span>  <span class="comment">#nacos æœåŠ¡ç«¯åœ°å€</span></span><br><span class="line">  <span class="attr">discovery:</span></span><br><span class="line">    <span class="attr">cluster-name:</span> <span class="string">AH</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">25cd75bc-82c3-4396-ba42-a42a5de77b92</span> <span class="comment">#å‘½åç©ºé—´id</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®ç°äº†éš”ç¦»</p><h2 id="17-Nacoså’ŒEurekaç›¸åŒå’Œä¸åŒ"><a href="#17-Nacoså’ŒEurekaç›¸åŒå’Œä¸åŒ" class="headerlink" title="17. Nacoså’ŒEurekaç›¸åŒå’Œä¸åŒ"></a>17. Nacoså’ŒEurekaç›¸åŒå’Œä¸åŒ</h2><ul><li>Nacosä¸eurekaçš„å…±åŒç‚¹<ul><li>éƒ½æ”¯æŒæœåŠ¡æ³¨å†Œå’ŒæœåŠ¡æ‹‰å–</li><li>éƒ½æ”¯æŒæœåŠ¡æä¾›è€…å¿ƒè·³æ–¹å¼åšå¥åº·æ£€æµ‹</li></ul></li><li>Nacosä¸Eurekaçš„åŒºåˆ«<ul><li>Nacosæ”¯æŒæœåŠ¡ç«¯ä¸»åŠ¨æ£€æµ‹æä¾›è€…çŠ¶æ€ï¼šä¸´æ—¶å®ä¾‹é‡‡ç”¨å¿ƒè·³æ¨¡å¼ï¼Œéä¸´æ—¶å®ä¾‹é‡‡ç”¨ä¸»åŠ¨æ£€æµ‹æ¨¡å¼</li><li>ä¸´æ—¶å®ä¾‹å¿ƒè·³ä¸æ­£å¸¸ä¼šè¢«å‰”é™¤ï¼Œéä¸´æ—¶å®ä¾‹åˆ™ä¸ä¼šè¢«å‰”é™¤</li><li>Nacosæ”¯æŒæœåŠ¡åˆ—è¡¨å˜æ›´çš„æ¶ˆæ¯æ¨é€æ¨¡å¼ï¼ŒæœåŠ¡åˆ—è¡¨æ›´æ–°æ›´åŠæ—¶</li><li>Nacosé›†ç¾¤é»˜è®¤é‡‡ç”¨APæ–¹å¼ï¼Œå½“é›†ç¾¤ä¸­å­˜åœ¨éä¸´æ—¶å®ä¾‹æ—¶ï¼Œé‡‡ç”¨CPæ¨¡å¼ï¼›Eurekaé‡‡ç”¨APæ–¹å¼</li></ul></li></ul><h2 id="18-é…ç½®ç®¡ç†"><a href="#18-é…ç½®ç®¡ç†" class="headerlink" title="18. é…ç½®ç®¡ç†"></a>18. é…ç½®ç®¡ç†</h2><p>åœ¨å®é™…ç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°é¢‘ç¹ä¿®æ”¹é…ç½®çš„æƒ…å†µï¼Œä½†æ˜¯å¦‚æœä¿®æ”¹é…ç½®è¿‡ç¨‹ä¸­æ¶‰åŠçš„å¾®æœåŠ¡æ•°é‡å¤šäº†ï¼Œä¼šå¾ˆéº»çƒ¦ä¸”ä¿®æ”¹é…ç½®çš„å¾®æœåŠ¡éœ€è¦é‡å¯ä»¥ç”Ÿæ•ˆæ–°çš„é…ç½®ï¼Œä½†é‡å¯å¯èƒ½ä¼šå¸¦æ¥å¾ˆå¤§çš„æŸå¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦Nacosçš„é…ç½®ç®¡ç†ï¼Œä»–å¯ä»¥ä¿å­˜æœåŠ¡ä¸­ä¸€äº›æ¯”è¾ƒé‡è¦çš„æ ¸å¿ƒé…ç½®ï¼ŒæœåŠ¡åœ¨å¯åŠ¨æ—¶åªéœ€è¯»å–ä¸Šé¢çš„é…ç½®ï¼Œç„¶åç»“åˆè‡ªèº«é…ç½®ç»„æˆä¸€å¥—å®Œæ•´çš„é…ç½®æ–‡ä»¶ã€‚é€šè¿‡é…ç½®çƒ­æ›´æ–°ï¼Œå¦‚æœè¦ä¿®æ”¹åªéœ€è¦ä¿®æ”¹Nacosçš„é…ç½®ç®¡ç†ï¼Œå…¶ä½™å¾®æœåŠ¡å°±ä¼šè¯»å–åˆ°å˜åŒ–åçš„é…ç½®ï¼Œç„¶ååŠ ä»¥åº”ç”¨ï¼Œå®ç°çƒ­æ›´æ–°ã€‚</p><h2 id="19-Nacoså®ç°é…ç½®ç®¡ç†"><a href="#19-Nacoså®ç°é…ç½®ç®¡ç†" class="headerlink" title="19. Nacoså®ç°é…ç½®ç®¡ç†"></a>19. Nacoså®ç°é…ç½®ç®¡ç†</h2><p>ç›´æ¥åœ¨Nacosæ§åˆ¶å°é‡Œæ“ä½œ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221646375.png" alt="image-20231222164621257"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221651280.png" alt="image-20231222165131214"></p><h2 id="20-å¾®æœåŠ¡è·å–Nacosä¸­çš„é…ç½®"><a href="#20-å¾®æœåŠ¡è·å–Nacosä¸­çš„é…ç½®" class="headerlink" title="20. å¾®æœåŠ¡è·å–Nacosä¸­çš„é…ç½®"></a>20. å¾®æœåŠ¡è·å–Nacosä¸­çš„é…ç½®</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221700941.png" alt="image-20231222170002889"></p><p>ç”±ä¸Šé¢çš„æµç¨‹å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œbootstrapè¿™ä¸€é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§æ˜¯è¦é«˜äºapplicationçš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠè¿æ¥NacosæœåŠ¡çš„é…ç½®é…ç½®åˆ°è¯¥æ–‡ä»¶é‡Œé¢ï¼Œè¿™æ ·Springä¼šå…ˆæ ¹æ®è¿™ä¸ªé…ç½®æ–‡ä»¶è®¿é—®åˆ°Nacosï¼Œå¹¶æå–åˆ°å…¶ä¸­çš„æœåŠ¡ï¼Œç„¶ååœ¨æŠŠå…¶ä¸­çš„é…ç½®å’Œæœ¬åœ°applicationä¸­çš„é…ç½®åˆå¹¶æˆå®Œæ•´çš„é…ç½®ï¼Œè¿™å°±æ˜¯æ•´ä¸ªé…ç½®ç®¡ç†çš„å…¨è¿‡ç¨‹ã€‚</p><p>é¦–å…ˆå¯¼å…¥Nacosé…ç½®ç®¡ç†ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacosé…ç½®ç®¡ç†ä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨resourceç›®å½•ä¸‹æ·»åŠ bootstrap.ymlæ–‡ä»¶</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221714999.png" alt="image-20231222171403954"></p><p>ç„¶åé…ç½®bootstrapï¼Œå°†NacosæœåŠ¡è¿æ¥é…ç½®ï¼Œè¿˜æœ‰æƒ³è¦è·å–çš„è¢«Nacosç®¡ç†çš„é…ç½®ä¿¡æ¯å†™è¿›å»ï¼Œæ³¨æ„ä¸€å®šè¦å’ŒNacosä¸­çš„åå­—ç›¸å¯¹åº”</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userserver</span> <span class="comment"># å¯¹åº”é…ç½®åç§°</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment">#å¼€å‘ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯dev </span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># Nacosåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># æ–‡ä»¶åç¼€å</span></span><br></pre></td></tr></table></figure><p>ç”±äºapplicationä¸­å·²ç»å­˜åœ¨äº†NacosæœåŠ¡è¿æ¥é…ç½®ï¼Œæ‰€ä»¥éœ€è¦åˆ é™¤ï¼Œè¿˜æœ‰åŸå…ˆåœ¨applicationä¸­é…ç½®çš„dateformat</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221718207.png" alt="image-20231222171848160"></p><p>ç„¶åéªŒè¯ä¸€ä¸‹æ˜¯å¦å·²ç»è¯»åˆ°é…ç½®äº†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨@Valueæ³¨è§£æ‹¿åˆ°é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221725173.png" alt="image-20231222172508121"></p><p>çœ‹ç»“æœï¼ŒæˆåŠŸè¯»åˆ°ï¼š<br><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221725232.png" alt="image-20231222172555188"></p><h2 id="21-é…ç½®çƒ­æ›´æ–°"><a href="#21-é…ç½®çƒ­æ›´æ–°" class="headerlink" title="21. é…ç½®çƒ­æ›´æ–°"></a>21. é…ç½®çƒ­æ›´æ–°</h2><p>çƒ­æ›´æ–°å³è®©æˆ‘ä»¬çš„å¾®æœåŠ¡èƒ½å®æ—¶è·å–Nacosä¸­å˜åŒ–çš„é…ç½®ï¼Œè€Œæ— éœ€é‡å¯å¾®æœåŠ¡</p><p>æœ‰ä¸¤ç§æ–¹æ³•</p><p>æ³•ä¸€ï¼š<br>åœ¨@Valueæ³¨å…¥çš„ç±»ä¸Šæ·»åŠ æ³¨è§£@RefreshScope</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221752042.png" alt="image-20231222175209994"></p><p>æ³•äºŒï¼ˆæ¨èï¼‰:<br>åˆ©ç”¨@ConfigurationPropertiesæ³¨è§£è‡ªåŠ¨æ³¨å…¥ä»£æ›¿@Valueæ³¨è§£ã€‚</p><p>ä¸ºæ­¤æˆ‘ä»¬å¯ä»¥å•ç‹¬å»ºä¸€ä¸ªç±»ï¼Œæ¥è·å–é…ç½®æ–‡ä»¶çš„å±æ€§å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pattern&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatternProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>@ConfigurationPropertiesä¼šè‡ªåŠ¨å°†ç¬¦åˆå‰ç¼€åå¹¶ä¸”å±æ€§åå’Œè¯¥ç±»ä¸­çš„å±æ€§ä¸€è‡´çš„é…ç½®çš„å€¼ï¼Œè‡ªåŠ¨æ³¨å…¥åˆ°å±æ€§ä¸­ã€‚</p></blockquote><p>è·å–çš„è¯ï¼Œé¦–å…ˆåˆ©ç”¨@Autowiredæ³¨å…¥è¯¥ç±»ï¼Œå› ä¸ºå·²ç»æ·»åŠ è¿‡@Dataæ³¨è§£ï¼Œç›´æ¥è°ƒç”¨getæ–¹æ³•å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(patternProperties.getDateformat());</span><br></pre></td></tr></table></figure><p>ç„¶åè®©æˆ‘ä»¬è¯•éªŒä¸€ä¸‹</p><p>é‡å¯å¾®æœåŠ¡</p><p>å…ˆä¿®æ”¹Nacosé…ç½®ç®¡ç†ä¸­çš„é…ç½®</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221801781.png" alt="image-20231222180110737"></p><p>ç„¶åå†æ¬¡è®¿é—®æˆ‘ä»¬å†™äº†è¾“å‡ºè¯­å¥çš„æ–¹æ³•ï¼Œçƒ­æ›´æ–°æˆåŠŸ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221801049.png" alt="image-20231222180155006"></p><p>å†æ”¹ä¸€æ¬¡</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221802694.png" alt="image-20231222180228652"></p><p>å†è¯•è¯•ï¼Œä¾ç„¶æˆåŠŸ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221803418.png" alt="image-20231222180301381"></p><h2 id="22-å¤šç¯å¢ƒé…ç½®å…±äº«"><a href="#22-å¤šç¯å¢ƒé…ç½®å…±äº«" class="headerlink" title="22. å¤šç¯å¢ƒé…ç½®å…±äº«"></a>22. å¤šç¯å¢ƒé…ç½®å…±äº«</h2><p>å¾®æœåŠ¡å¯åŠ¨æ—¶ä¼šä»Nacosä¸­è¯»å–å¤šä¸ªé…ç½®</p><p>æˆ‘ä»¬å¯ä»¥åœ¨Nacosä¸­å†åŠ ä¸€ä¸ªé…ç½®ï¼Œæ ¼å¼æ˜¯name + .yaml</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221823872.png" alt="image-20231222182304821"></p><p>è¿™æ ·è¿™ä¸ªé…ç½®æ‰€æœ‰ç¯å¢ƒä¸‹çš„userserveréƒ½å¯ä»¥è¯»åˆ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pattern&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatternProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line">    <span class="keyword">private</span> String sharedValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å†è®¿é—®</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221825327.png" alt="image-20231222182521285"></p><p>è®¿é—®åˆ°äº†ä¸¤ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œä½†å®é™…ä¸Šå½“å‰userserveræ˜¯devç¯å¢ƒï¼Œè¿™è¯´æ˜æ²¡æœ‰æ ‡æ˜ç¯å¢ƒçš„é…ç½®æ–‡ä»¶å¯è¢«å¤šä¸ªå¾®æœåŠ¡å…±äº«</p><p>ä¼˜å…ˆçº§çš„è¯ï¼š<br>ç¯å¢ƒé…ç½® &gt; å¤šç¯å¢ƒé…ç½® &gt; æœ¬åœ°</p><h2 id="23-Nacosé›†ç¾¤"><a href="#23-Nacosé›†ç¾¤" class="headerlink" title="23. Nacosé›†ç¾¤"></a>23. Nacosé›†ç¾¤</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221943020.png" alt="image-20231222194305936"></p><p>ä¸¾ä¾‹ï¼š</p><p>å…¶ä¸­åŒ…å«3ä¸ªnacosèŠ‚ç‚¹ï¼Œç„¶åä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ä»£ç†3ä¸ªNacosã€‚è¿™é‡Œè´Ÿè½½å‡è¡¡å™¨å¯ä»¥ä½¿ç”¨nginxã€‚</p><h3 id="23-1-æ­å»ºé›†ç¾¤"><a href="#23-1-æ­å»ºé›†ç¾¤" class="headerlink" title="23.1 æ­å»ºé›†ç¾¤"></a>23.1 æ­å»ºé›†ç¾¤</h3><h4 id="23-1-1-åˆå§‹åŒ–æ•°æ®åº“"><a href="#23-1-1-åˆå§‹åŒ–æ•°æ®åº“" class="headerlink" title="23.1.1 åˆå§‹åŒ–æ•°æ®åº“"></a>23.1.1 åˆå§‹åŒ–æ•°æ®åº“</h4><p>é¦–å…ˆæ–°å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå‘½åä¸ºnacosï¼Œè€Œåå¯¼å…¥ä¸‹é¢çš„SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  `c_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c_use` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `effect` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c_schema` text,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = config_info_aggr   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_aggr` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `datum_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;datum_id&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å†…å®¹&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;å¢åŠ ç§Ÿæˆ·å­—æ®µ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = config_info_beta   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_beta` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `beta_ips` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;betaIps&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info_beta&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = config_info_tag   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_tag` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tag_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info_tag&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = config_tags_relation   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_tags_relation` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `tag_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_name&#x27;</span>,</span><br><span class="line">  `tag_type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_type&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),</span><br><span class="line">  KEY `idx_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_tag_relation&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = group_capacity   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `group_capacity` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Group IDï¼Œç©ºå­—ç¬¦è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;ä½¿ç”¨é‡&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°ï¼Œï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;æœ€å¤§å˜æ›´å†å²æ•°é‡&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_group_id` (`group_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;é›†ç¾¤ã€å„Groupå®¹é‡ä¿¡æ¯è¡¨&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = his_config_info   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `his_config_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">64</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `src_user` text,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `op_type` <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`),</span><br><span class="line">  KEY `idx_gmt_create` (`gmt_create`),</span><br><span class="line">  KEY `idx_gmt_modified` (`gmt_modified`),</span><br><span class="line">  KEY `idx_did` (`data_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;å¤šç§Ÿæˆ·æ”¹é€ &#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = tenant_capacity   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_capacity` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Tenant ID&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;ä½¿ç”¨é‡&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;æœ€å¤§å˜æ›´å†å²æ•°é‡&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;ç§Ÿæˆ·å®¹é‡ä¿¡æ¯è¡¨&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `kp` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;kp&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tenant_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_name&#x27;</span>,</span><br><span class="line">  `tenant_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tenant_desc&#x27;</span>,</span><br><span class="line">  `create_source` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;create_source&#x27;</span>,</span><br><span class="line">  `gmt_create` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),</span><br><span class="line">  KEY `idx_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;tenant_info&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users` (</span><br><span class="line">`username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">`password` <span class="type">varchar</span>(<span class="number">500</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`enabled` <span class="type">boolean</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `roles` (</span><br><span class="line">`username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`role` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">UNIQUE</span> INDEX `idx_user_role` (`username` <span class="keyword">ASC</span>, `role` <span class="keyword">ASC</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `permissions` (</span><br><span class="line">    `role` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `resource` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `action` <span class="type">varchar</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span> INDEX `uk_role_permission` (`role`,`resource`,`action`) <span class="keyword">USING</span> BTREE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (username, password, enabled) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#x27;</span>, <span class="literal">TRUE</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> roles (username, role) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;ROLE_ADMIN&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="23-1-2-é…ç½®Nacos"><a href="#23-1-2-é…ç½®Nacos" class="headerlink" title="23.1.2 é…ç½®Nacos"></a>23.1.2 é…ç½®Nacos</h4><p>è¿›å…¥nacosçš„confç›®å½•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶cluster.conf.exampleï¼Œé‡å‘½åä¸ºcluster.confï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312221946748.png" alt="image-20231222194606692"></p><p>ç„¶åæ·»åŠ å†…å®¹ï¼ˆåˆ†åˆ«å¯¹åº”ä½ ä¸‰ä¸ªnacosèŠ‚ç‚¹çš„åœ°å€å’Œç«¯å£ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:8845</span><br><span class="line">127.0.0.1.8846</span><br><span class="line">127.0.0.1.8847</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹application.propertiesæ–‡ä»¶ï¼Œæ·»åŠ æ•°æ®åº“é…ç½®ï¼Œå¯¹åº”è‡ªå·±ç”µè„‘çš„æ•°æ®åº“åœ°å€è¿˜æœ‰è´¦å·å¯†ç </p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"></span><br><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.user.0</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password.0</span>=<span class="string">123</span></span><br></pre></td></tr></table></figure><p>è¿˜æœ‰æ¯ä¸ªnacosçš„ç«¯å£å·è¦å¯¹åº”cluster.conf</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8845</span></span><br></pre></td></tr></table></figure><p>ï¼ˆæ¯ä¸ªnacoséƒ½è¦è¿›è¡Œé…ç½®ï¼‰</p><h4 id="23-1-3-å¯åŠ¨nacos"><a href="#23-1-3-å¯åŠ¨nacos" class="headerlink" title="23.1.3 å¯åŠ¨nacos"></a>23.1.3 å¯åŠ¨nacos</h4><p>è¿™é‡Œç›´æ¥è¿è¡Œstartup.cmdï¼Œé»˜è®¤é›†ç¾¤å¯åŠ¨</p><h4 id="23-1-4-é…ç½®nginx"><a href="#23-1-4-é…ç½®nginx" class="headerlink" title="23.1.4 é…ç½®nginx"></a>23.1.4 é…ç½®nginx</h4><p>ä¿®æ”¹conf&#x2F;nginx.confæ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> nacos-cluster &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8845</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">127.0.0.1:8846</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">127.0.0.1:8847</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> /nacos &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://nacos-cluster;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±ä½¿ç”¨äº†nginxåå‘ä»£ç†äº†Nacos</p><h4 id="23-1-5-å¯åŠ¨Nginx"><a href="#23-1-5-å¯åŠ¨Nginx" class="headerlink" title="23.1.5 å¯åŠ¨Nginx"></a>23.1.5 å¯åŠ¨Nginx</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start nginx.exe</span><br></pre></td></tr></table></figure><p>è€Œååœ¨æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost/nacos%E5%8D%B3%E5%8F%AF%E3%80%82">http://localhost/nacoså³å¯ã€‚</a></p><p>ä»£ç ä¸­application.ymlæ–‡ä»¶é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:80</span> <span class="comment"># Nacosåœ°å€</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºnginxç›‘å¬80ç«¯å£</p><h2 id="24-Feignå®¢æˆ·ç«¯"><a href="#24-Feignå®¢æˆ·ç«¯" class="headerlink" title="24.Feignå®¢æˆ·ç«¯"></a>24.Feignå®¢æˆ·ç«¯</h2><p>Feignæ˜¯ç”¨æ¥æ›¿ä»£RestTemplateä¸ºæœåŠ¡ä¸æœåŠ¡ä¹‹é—´è¯·æ±‚æ­å»ºæ¡¥æ¢</p><p>æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨RestTemplateï¼Œå…¶ç”¨æ³•æ˜¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        åˆ›å»ºurlï¼ŒæŒ‡å‘å‘é€è¯·æ±‚çš„åœ°å€</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081/user/&quot;</span> + order.getUserId();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(url, User.class);</span><br></pre></td></tr></table></figure><h2 id="25-ä½¿ç”¨Feign"><a href="#25-ä½¿ç”¨Feign" class="headerlink" title="25.ä½¿ç”¨Feign"></a>25.ä½¿ç”¨Feign</h2><p>å¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨å¯åŠ¨ç±»ä¸ŠåŠ æ³¨è§£ï¼Œå¯åŠ¨feignåŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> &#123;</span><br></pre></td></tr></table></figure><p>ç¼–å†™Feignçš„æœåŠ¡ç«¯æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;userserver&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>@FeignClient(â€œuserserverâ€)ï¼šé‡Œé¢å†™è®¿é—®æœåŠ¡å</p><p>@GetMapping(â€œ&#x2F;user&#x2F;{id}â€)ï¼šå†™è®¿é—®è·¯å¾„ï¼Œæœ‰å‚æ•°å†™å‚æ•°ï¼ˆrestfulé£æ ¼ï¼‰</p></blockquote><p>è°ƒç”¨ä¸€ä¸‹è¯•è¯•</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312222049052.png" alt="image-20231222204922970"></p><p>æˆåŠŸæŸ¥è¯¢å‡ºå¸¦ç”¨æˆ·ä¿¡æ¯çš„è®¢å•</p><h2 id="26-Feignä¼˜åŒ–"><a href="#26-Feignä¼˜åŒ–" class="headerlink" title="26.Feignä¼˜åŒ–"></a>26.Feignä¼˜åŒ–</h2><p>Feignåº•å±‚å‘èµ·httpè¯·æ±‚ï¼Œä¾èµ–äºå…¶å®ƒçš„æ¡†æ¶ã€‚å…¶åº•å±‚å®¢æˆ·ç«¯å®ç°åŒ…æ‹¬ï¼š</p><p>â€¢URLConnectionï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ± </p><p>â€¢Apache HttpClient ï¼šæ”¯æŒè¿æ¥æ± </p><p>â€¢OKHttpï¼šæ”¯æŒè¿æ¥æ± </p><p>å› æ­¤æé«˜Feignçš„æ€§èƒ½ä¸»è¦æ‰‹æ®µå°±æ˜¯ä½¿ç”¨<strong>è¿æ¥æ± </strong>ä»£æ›¿é»˜è®¤çš„URLConnectionã€‚</p><p>é¦–å…ˆå¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--httpClientçš„ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®è¿æ¥æ± </p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">httpclient:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span>  <span class="comment">#å¼€å¯feignå¯¹httpclientæ”¯æŒ</span></span><br><span class="line">    <span class="attr">max-connections:</span> <span class="number">200</span> <span class="comment">#æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">    <span class="attr">max-connections-per-route:</span> <span class="number">50</span> <span class="comment">#æ¯ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•°</span></span><br></pre></td></tr></table></figure><h2 id="27-Feignæœ€ä½³å®è·µ"><a href="#27-Feignæœ€ä½³å®è·µ" class="headerlink" title="27. Feignæœ€ä½³å®è·µ"></a>27. Feignæœ€ä½³å®è·µ</h2><h3 id="27-1-ç»§æ‰¿æ–¹å¼"><a href="#27-1-ç»§æ‰¿æ–¹å¼" class="headerlink" title="27.1 ç»§æ‰¿æ–¹å¼"></a>27.1 ç»§æ‰¿æ–¹å¼</h3><p>ä¸€æ ·çš„ä»£ç å¯ä»¥é€šè¿‡ç»§æ‰¿æ¥å…±äº«ï¼š</p><p>1ï¼‰å®šä¹‰ä¸€ä¸ªAPIæ¥å£ï¼Œåˆ©ç”¨å®šä¹‰æ–¹æ³•ï¼Œå¹¶åŸºäºSpringMVCæ³¨è§£åšå£°æ˜ã€‚</p><p>2ï¼‰Feignå®¢æˆ·ç«¯å’ŒControlleréƒ½ç»§æ‰¿è¯¥æ¥å£</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312222112810.png" alt="image-20210714190640857"></p><p>ä¼˜ç‚¹ï¼š</p><ul><li>ç®€å•</li><li>å®ç°äº†ä»£ç å…±äº«</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li><p>æœåŠ¡æä¾›æ–¹ã€æœåŠ¡æ¶ˆè´¹æ–¹ç´§è€¦åˆ</p></li><li><p>å‚æ•°åˆ—è¡¨ä¸­çš„æ³¨è§£æ˜ å°„å¹¶ä¸ä¼šç»§æ‰¿ï¼Œå› æ­¤Controllerä¸­å¿…é¡»å†æ¬¡å£°æ˜æ–¹æ³•ã€å‚æ•°åˆ—è¡¨ã€æ³¨è§£</p></li></ul><h3 id="27-2-æŠ½å–æ–¹å¼"><a href="#27-2-æŠ½å–æ–¹å¼" class="headerlink" title="27.2 æŠ½å–æ–¹å¼"></a>27.2 æŠ½å–æ–¹å¼</h3><p>å°†Feignçš„ClientæŠ½å–ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œå¹¶ä¸”æŠŠæ¥å£æœ‰å…³çš„POJOã€é»˜è®¤çš„Feigné…ç½®éƒ½æ”¾åˆ°è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæä¾›ç»™æ‰€æœ‰æ¶ˆè´¹è€…ä½¿ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œå°†UserClientã€Userã€Feignçš„é»˜è®¤é…ç½®éƒ½æŠ½å–åˆ°ä¸€ä¸ªfeign-apiåŒ…ä¸­ï¼Œæ‰€æœ‰å¾®æœåŠ¡å¼•ç”¨è¯¥ä¾èµ–åŒ…ï¼Œå³å¯ç›´æ¥ä½¿ç”¨ã€‚</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312222116839.png" alt="image-20210714214041796"></p><h2 id="28-æŠ½å–æ–¹å¼å®è·µ"><a href="#28-æŠ½å–æ–¹å¼å®è·µ" class="headerlink" title="28. æŠ½å–æ–¹å¼å®è·µ"></a>28. æŠ½å–æ–¹å¼å®è·µ</h2><p>åˆ›å»ºæ–°çš„æ¨¡å—feign-apiï¼Œç”¨æ¥æ”¾ç½®feignæœåŠ¡</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312222123476.png" alt="image-20231222212324413"></p><p>å°†åŸæœ¬order-serviceä¸­çš„clientè¿˜æœ‰å®ƒéœ€è¦çš„userå®ä½“ç±»æå–å‡ºæ¥ï¼Œæ”¾åˆ°feign-apiä¸­ï¼ŒåŸé¡¹ç›®é‡Œçš„å°±å¯ä»¥åˆ é™¤äº†</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312222124349.png" alt="image-20231222212417286"></p><p>ç„¶åå°†feign-apiä»¥ä¾èµ–çš„å½¢å¼å¯¼å…¥åˆ°order-serviceä¸­</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€åä¿®æ”¹å¯åŠ¨ç±»çš„@EnableFeignClientsæ³¨è§£ï¼Œå®ƒé»˜è®¤æ˜¯æ‰«æå½“å‰æ¨¡å—çš„åŒ…ï¼Œç”±äºæˆ‘ä»¬å½“å‰é¡¹ç›®çš„clientå·²ç»æå–å‡ºå»äº†ï¼Œæ‰€ä»¥æ­¤å¤„æ˜¯æ‰«æä¸åˆ°çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¿®æ”¹åŒ…æ‰«æä½ç½®ï¼Œæ”¹ä¸ºå¯¼å…¥çš„feignä¾èµ–çš„ä½ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(clients = UserClient.class)</span></span><br></pre></td></tr></table></figure><h2 id="29-ç»Ÿä¸€ç½‘å…³"><a href="#29-ç»Ÿä¸€ç½‘å…³" class="headerlink" title="29. ç»Ÿä¸€ç½‘å…³"></a>29. ç»Ÿä¸€ç½‘å…³</h2><p>ç½‘å…³åŠŸèƒ½</p><ul><li>èº«ä»½è®¤è¯æƒé™è®¤è¯</li><li>æœåŠ¡è·¯ç”±ï¼Œè´Ÿè½½å‡è¡¡ï¼ˆåˆ¤æ–­æ˜¯è®¿é—®å“ªä¸ªåŠŸèƒ½ï¼‰</li><li>è¯·æ±‚é™æµ</li></ul><p>å®ç°</p><ul><li>gateway</li><li>zuul</li></ul><h2 id="30-ç½‘å…³æ­å»º"><a href="#30-ç½‘å…³æ­å»º" class="headerlink" title="30. ç½‘å…³æ­å»º"></a>30. ç½‘å…³æ­å»º</h2><p>åˆ›å»ºç½‘å…³æ¨¡å—ï¼Œå¹¶å¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ç½‘å…³--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--nacosæœåŠ¡å‘ç°ä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é…ç½®è·¯ç”±æ–‡ä»¶</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span> <span class="comment"># ç½‘å…³ç«¯å£</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># æœåŠ¡åç§°</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacosåœ°å€</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span> <span class="comment"># ç½‘å…³è·¯ç”±é…ç½®</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># è·¯ç”±idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯</span></span><br><span class="line">          <span class="comment"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ httpå°±æ˜¯å›ºå®šåœ°å€</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userserver</span> <span class="comment"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lbå°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥/user/å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">order-service</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://orderserver</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/order/**</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±èƒ½ä»ç½‘å…³è®¿é—®åˆ°å…¶ä»–æœåŠ¡</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312231456471.png" alt="image-20231223145608371"></p><h2 id="31-è·¯ç”±æ–­è¨€predicates"><a href="#31-è·¯ç”±æ–­è¨€predicates" class="headerlink" title="31. è·¯ç”±æ–­è¨€predicates"></a>31. è·¯ç”±æ–­è¨€predicates</h2><p>æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å†™çš„æ–­è¨€è§„åˆ™åªæ˜¯å­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²ä¼šè¢«Predicate Factoryè¯»å–å¹¶å¤„ç†ï¼Œè½¬å˜ä¸ºè·¯ç”±åˆ¤æ–­çš„æ¡ä»¶</p><p>ç”¨åˆ°å“ªä¸ªå»å®˜ç½‘æŸ¥å“ªä¸ªæ€ä¹ˆå†™</p><table><thead><tr><th><strong>åç§°</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>ç¤ºä¾‹</strong></th></tr></thead><tbody><tr><td>After</td><td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹åçš„è¯·æ±‚</td><td>-  After&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver]</td></tr><tr><td>Before</td><td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td>-  Before&#x3D;2031-04-13T15:14:47.433+08:00[Asia&#x2F;Shanghai]</td></tr><tr><td>Between</td><td>æ˜¯æŸä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td>-  Between&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver],  2037-01-21T17:42:47.789-07:00[America&#x2F;Denver]</td></tr><tr><td>Cookie</td><td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›cookie</td><td>- Cookie&#x3D;chocolate, ch.p</td></tr><tr><td>Header</td><td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›header</td><td>- Header&#x3D;X-Request-Id, \d+</td></tr><tr><td>Host</td><td>è¯·æ±‚å¿…é¡»æ˜¯è®¿é—®æŸä¸ªhostï¼ˆåŸŸåï¼‰</td><td>-  Host&#x3D;<strong>.somehost.org,</strong>.anotherhost.org</td></tr><tr><td>Method</td><td>è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯æŒ‡å®šæ–¹å¼</td><td>- Method&#x3D;GET,POST</td></tr><tr><td>Path</td><td>è¯·æ±‚è·¯å¾„å¿…é¡»ç¬¦åˆæŒ‡å®šè§„åˆ™</td><td>- Path&#x3D;&#x2F;red&#x2F;{segment},&#x2F;blue&#x2F;**</td></tr><tr><td>Query</td><td>è¯·æ±‚å‚æ•°å¿…é¡»åŒ…å«æŒ‡å®šå‚æ•°</td><td>- Query&#x3D;name, Jackæˆ–è€…-  Query&#x3D;name</td></tr><tr><td>RemoteAddr</td><td>è¯·æ±‚è€…çš„ipå¿…é¡»æ˜¯æŒ‡å®šèŒƒå›´</td><td>- RemoteAddr&#x3D;192.168.1.1&#x2F;24</td></tr><tr><td>Weight</td><td>æƒé‡å¤„ç†</td><td></td></tr></tbody></table><h2 id="32-ç½‘å…³è¿‡æ»¤å™¨"><a href="#32-ç½‘å…³è¿‡æ»¤å™¨" class="headerlink" title="32. ç½‘å…³è¿‡æ»¤å™¨"></a>32. ç½‘å…³è¿‡æ»¤å™¨</h2><p>è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>â‘  å¯¹è·¯ç”±çš„è¯·æ±‚æˆ–å“åº”åšåŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´</p><p>â‘¡ é…ç½®åœ¨è·¯ç”±ä¸‹çš„è¿‡æ»¤å™¨åªå¯¹å½“å‰è·¯ç”±çš„è¯·æ±‚ç”Ÿæ•ˆ</p><p>defaultFiltersçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>â‘  å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">routes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> </span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://userservice</span> </span><br><span class="line">  <span class="attr">predicates:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">Path=/user/**</span> </span><br><span class="line">  <span class="attr">filters:</span> <span class="comment"># è¿‡æ»¤å™¨</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">AddRequestHeader=</span> <span class="string">Hello</span> <span class="string">world!</span> <span class="comment"># æ·»åŠ è¯·æ±‚å¤´</span></span><br><span class="line">  <span class="attr">default-filters:</span> <span class="comment"># é»˜è®¤è¿‡æ»¤é¡¹,é’ˆå¯¹æ‰€æœ‰è·¯ç”±</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,</span> <span class="string">Itcast</span> <span class="string">is</span> <span class="string">freaking</span> <span class="string">awesome!</span> </span><br></pre></td></tr></table></figure><h2 id="33-å…¨å±€è¿‡æ»¤å™¨"><a href="#33-å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="33. å…¨å±€è¿‡æ»¤å™¨"></a>33. å…¨å±€è¿‡æ»¤å™¨</h2><p>å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨ä¹Ÿæ˜¯å¤„ç†ä¸€åˆ‡è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡å“åº”ï¼Œä¸GatewayFilterçš„ä½œç”¨ä¸€æ ·ã€‚åŒºåˆ«åœ¨äºGatewayFilteré€šè¿‡é…ç½®å®šä¹‰ï¼Œå¤„ç†é€»è¾‘æ˜¯å›ºå®šçš„ï¼›è€ŒGlobalFilterçš„é€»è¾‘éœ€è¦è‡ªå·±å†™ä»£ç å®ç°ã€‚ï¼ˆä¹‹å‰è¯´çš„é‚£ä¸ªæ˜¯å®˜æ–¹å›ºå®šçš„å‡ ä¸ªå†™æ³•ï¼‰</p><p>é¦–å…ˆåˆ›å»ºè¿‡æ»¤å™¨æ¥å£ï¼Œç»§æ‰¿GlobalFilterï¼Œå¹¶å®ç°filteræ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizeFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå·±å†™æ‹¦æˆªå™¨æ¥å£ä¸­çš„æ‹¦æˆªé€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizeFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line"><span class="comment">//        æ­¤å¤„æ¨¡æ‹Ÿå®ç°æŸ¥çœ‹ç”¨æˆ·èº«ä»½çš„è¿‡æ»¤å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        1.è·å–è¯·æ±‚å‚æ•°</span></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        MultiValueMap&lt;String, String&gt; queryParams = request.getQueryParams();</span><br><span class="line"><span class="comment">//        2.è·å–å…¶ä¸­çš„å‚æ•°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">authorization</span> <span class="operator">=</span> queryParams.getFirst(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line"><span class="comment">//        3.åˆ¤æ–­å…¶èº«ä»½æ˜¯å¦æ˜¯admin</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span>.equals(authorization))&#123;</span><br><span class="line"><span class="comment">//            æ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        æ‹¦æˆª</span></span><br><span class="line"><span class="comment">//        æ‹¦æˆªå‰è®¾ç½®çŠ¶æ€ç ï¼Œå‘ŠçŸ¥ç”¨æˆ·åŸå› </span></span><br><span class="line">        exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">        <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç±»ä¸ŠåŠ æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(-1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizeFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br></pre></td></tr></table></figure><blockquote><p>Orderæ˜¯æ‹¦æˆªå™¨çš„è®¿é—®é¡ºåº</p></blockquote><p>ç„¶åé‡å¯ç½‘å…³ï¼Œå†æ¬¡è®¿é—®</p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312231547631.png" alt="image-20231223154737500" style="zoom:50%;" /><p>å‘ç°æ— æ³•è®¿é—®äº†ï¼Œå†åŠ ä¸Šæˆ‘ä»¬åˆšåˆšè®¾ç½®çš„è¯·æ±‚å‚æ•°ï¼ŒæˆåŠŸæ”¾è¡Œ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312231548950.png" alt="image-20231223154840861"></p><p>ï¼ˆçŠ¯äº†ä¸€ä¸ªé”™ï¼Œåˆ›å»ºgatewayå¯åŠ¨ç±»çš„æ—¶å€™å¿˜äº†ï¼Œå¯åŠ¨ç±»åº”è¯¥åœ¨æœ€å¤–å±‚ï¼Œå› ä¸ºåŒ…æ‰«æé»˜è®¤æ‰«æçš„æ˜¯å¯åŠ¨ç±»çš„åŒä¸€ç›®å½•ä¸‹çš„å†…å®¹ï¼Œå¯¼è‡´æˆ‘é…ç½®çš„æ‹¦æˆªå™¨å¤±æ•ˆï¼ŒæŠŠå¯åŠ¨ç±»æ”¾åˆ°æœ€å¤–å±‚å°±å¯ä»¥äº†ï¼‰</p><h2 id="34-è¿‡æ»¤å™¨æ’åºè§„åˆ™"><a href="#34-è¿‡æ»¤å™¨æ’åºè§„åˆ™" class="headerlink" title="34. è¿‡æ»¤å™¨æ’åºè§„åˆ™"></a>34. è¿‡æ»¤å™¨æ’åºè§„åˆ™</h2><p>æ’åºçš„è§„åˆ™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>æ¯ä¸€ä¸ªè¿‡æ»¤å™¨éƒ½å¿…é¡»æŒ‡å®šä¸€ä¸ªintç±»å‹çš„orderå€¼ï¼Œ<strong>orderå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œé¡ºåºè¶Šé å‰</strong>ã€‚</li><li>GlobalFilteré€šè¿‡å®ç°Orderedæ¥å£ï¼Œæˆ–è€…æ·»åŠ @Orderæ³¨è§£æ¥æŒ‡å®šorderå€¼ï¼Œç”±æˆ‘ä»¬è‡ªå·±æŒ‡å®š</li><li>è·¯ç”±è¿‡æ»¤å™¨å’ŒdefaultFilterçš„orderç”±SpringæŒ‡å®šï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºä»1é€’å¢ã€‚</li><li>å½“è¿‡æ»¤å™¨çš„orderå€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§ defaultFilter &gt; è·¯ç”±è¿‡æ»¤å™¨ &gt; GlobalFilterçš„é¡ºåºæ‰§è¡Œã€‚</li></ul><h2 id="35-è§£å†³è·¨åŸŸé—®é¢˜"><a href="#35-è§£å†³è·¨åŸŸé—®é¢˜" class="headerlink" title="35. è§£å†³è·¨åŸŸé—®é¢˜"></a>35. è§£å†³è·¨åŸŸé—®é¢˜</h2><p>åœ¨gatewayæœåŠ¡çš„application.ymlæ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="comment"># ã€‚ã€‚ã€‚</span></span><br><span class="line">      <span class="attr">globalcors:</span> <span class="comment"># å…¨å±€çš„è·¨åŸŸå¤„ç†</span></span><br><span class="line">        <span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span> <span class="comment"># è§£å†³optionsè¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜</span></span><br><span class="line">        <span class="attr">corsConfigurations:</span></span><br><span class="line">          <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line">            <span class="attr">allowedOrigins:</span> <span class="comment"># å…è®¸å“ªäº›ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚ </span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;http://localhost:8090&quot;</span></span><br><span class="line">            <span class="attr">allowedMethods:</span> <span class="comment"># å…è®¸çš„è·¨åŸŸajaxçš„è¯·æ±‚æ–¹å¼</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;GET&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;POST&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;DELETE&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;PUT&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;OPTIONS&quot;</span></span><br><span class="line">            <span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span> <span class="comment"># å…è®¸åœ¨è¯·æ±‚ä¸­æºå¸¦çš„å¤´ä¿¡æ¯</span></span><br><span class="line">            <span class="attr">allowCredentials:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å…è®¸æºå¸¦cookie</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">360000</span> <span class="comment"># è¿™æ¬¡è·¨åŸŸæ£€æµ‹çš„æœ‰æ•ˆæœŸ</span></span><br></pre></td></tr></table></figure><h2 id="36-RabbitMQ"><a href="#36-RabbitMQ" class="headerlink" title="36. RabbitMQ"></a>36. RabbitMQ</h2><p>å¾®æœåŠ¡é—´é€šè®¯æœ‰åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹å¼ï¼š</p><p>åŒæ­¥é€šè®¯ï¼šå°±åƒæ‰“ç”µè¯ï¼Œéœ€è¦å®æ—¶å“åº”ã€‚</p><p>å¼‚æ­¥é€šè®¯ï¼šå°±åƒå‘é‚®ä»¶ï¼Œä¸éœ€è¦é©¬ä¸Šå›å¤ã€‚</p><h3 id="36-1-åŒæ­¥è°ƒç”¨"><a href="#36-1-åŒæ­¥è°ƒç”¨" class="headerlink" title="36.1 åŒæ­¥è°ƒç”¨"></a>36.1 åŒæ­¥è°ƒç”¨</h3><p>åŒæ­¥è°ƒç”¨çš„ä¼˜ç‚¹ï¼š</p><ul><li>æ—¶æ•ˆæ€§è¾ƒå¼ºï¼Œå¯ä»¥ç«‹å³å¾—åˆ°ç»“æœ</li></ul><p>åŒæ­¥è°ƒç”¨çš„é—®é¢˜ï¼š</p><ul><li>è€¦åˆåº¦é«˜</li><li>æ€§èƒ½å’Œååèƒ½åŠ›ä¸‹é™</li><li>æœ‰é¢å¤–çš„èµ„æºæ¶ˆè€—</li><li>æœ‰çº§è”å¤±è´¥é—®é¢˜</li></ul><h3 id="36-2-å¼‚æ­¥è°ƒç”¨"><a href="#36-2-å¼‚æ­¥è°ƒç”¨" class="headerlink" title="36.2 å¼‚æ­¥è°ƒç”¨"></a>36.2 å¼‚æ­¥è°ƒç”¨</h3><p>å¥½å¤„ï¼š</p><ul><li><p>ååé‡æå‡ï¼šæ— éœ€ç­‰å¾…è®¢é˜…è€…å¤„ç†å®Œæˆï¼Œå“åº”æ›´å¿«é€Ÿ</p></li><li><p>æ•…éšœéš”ç¦»ï¼šæœåŠ¡æ²¡æœ‰ç›´æ¥è°ƒç”¨ï¼Œä¸å­˜åœ¨çº§è”å¤±è´¥é—®é¢˜</p></li><li><p>è°ƒç”¨é—´æ²¡æœ‰é˜»å¡ï¼Œä¸ä¼šé€ æˆæ— æ•ˆçš„èµ„æºå ç”¨</p></li><li><p>è€¦åˆåº¦æä½ï¼Œæ¯ä¸ªæœåŠ¡éƒ½å¯ä»¥çµæ´»æ’æ‹”ï¼Œå¯æ›¿æ¢</p></li><li><p>æµé‡å‰Šå³°ï¼šä¸ç®¡å‘å¸ƒäº‹ä»¶çš„æµé‡æ³¢åŠ¨å¤šå¤§ï¼Œéƒ½ç”±Brokeræ¥æ”¶ï¼Œè®¢é˜…è€…å¯ä»¥æŒ‰ç…§è‡ªå·±çš„é€Ÿåº¦å»å¤„ç†äº‹ä»¶</p></li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ¶æ„å¤æ‚äº†ï¼Œä¸šåŠ¡æ²¡æœ‰æ˜æ˜¾çš„æµç¨‹çº¿ï¼Œä¸å¥½ç®¡ç†</li><li>éœ€è¦ä¾èµ–äºBrokerçš„å¯é ã€å®‰å…¨ã€æ€§èƒ½</li></ul><h3 id="36-3-RabbitMQå®‰è£…"><a href="#36-3-RabbitMQå®‰è£…" class="headerlink" title="36.3 RabbitMQå®‰è£…"></a>36.3 RabbitMQå®‰è£…</h3><p>æ¨èä½¿ç”¨dockeré•œåƒ</p><p>å®‰è£…å®Œé•œåƒåè¿è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line"> -e RABBITMQ_DEFAULT_USER=linfeng \</span><br><span class="line"> -e RABBITMQ_DEFAULT_PASS=123456 \</span><br><span class="line"> --name mq \</span><br><span class="line"> --hostname mq1 \</span><br><span class="line"> -p 15672:15672 \</span><br><span class="line"> -p 5672:5672 \</span><br><span class="line"> -d \</span><br><span class="line"> rabbitmq:3-management</span><br></pre></td></tr></table></figure><blockquote><p>ç”¨æˆ·åï¼šRABBITMQ_DEFAULT_USER&#x3D;linfeng<br>å¯†ç ï¼šRABBITMQ_DEFAULT_PASS&#x3D;123456</p><p>15672æ˜¯å¯è§†åŒ–å¹³å°çš„è®¿é—®ç«¯å£ </p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312261403332.png" alt="image-20231226140317235"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312261403065.png" alt="image-20231226140345951"></p><h3 id="36-4-æ¶ˆæ¯æ¨¡å‹"><a href="#36-4-æ¶ˆæ¯æ¨¡å‹" class="headerlink" title="36.4 æ¶ˆæ¯æ¨¡å‹"></a>36.4 æ¶ˆæ¯æ¨¡å‹</h3><p>RabbitMQå®˜æ–¹æä¾›äº†5ä¸ªä¸åŒçš„Demoç¤ºä¾‹ï¼Œå¯¹åº”äº†ä¸åŒçš„æ¶ˆæ¯æ¨¡å‹ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312261411408.png" alt="image-20210717163332646"></p><h3 id="36-5-RMQçš„ç®€å•å®ç°"><a href="#36-5-RMQçš„ç®€å•å®ç°" class="headerlink" title="36.5 RMQçš„ç®€å•å®ç°"></a>36.5 RMQçš„ç®€å•å®ç°</h3><p>ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å‘é€æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendMessage</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">    <span class="comment">// 1.å»ºç«‹è¿æ¥</span></span><br><span class="line">    <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">    <span class="comment">// 1.1.è®¾ç½®è¿æ¥å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šä¸»æœºåã€ç«¯å£å·ã€vhostã€ç”¨æˆ·åã€å¯†ç </span></span><br><span class="line">    factory.setHost(<span class="string">&quot;192.168.10.128&quot;</span>);</span><br><span class="line">    factory.setPort(<span class="number">5672</span>);</span><br><span class="line">    factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    factory.setUsername(<span class="string">&quot;linfeng&quot;</span>);</span><br><span class="line">    factory.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="comment">// 1.2.å»ºç«‹è¿æ¥</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.åˆ›å»ºé€šé“Channel</span></span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.åˆ›å»ºé˜Ÿåˆ—</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>; <span class="comment">//å‘é€å’Œæ¥æ”¶éƒ½è¦åˆ›å»ºé˜Ÿåˆ—ï¼Œå› ä¸ºä¸ç¡®å®šå“ªä¸ªå…ˆæ‰§è¡Œï¼Œæ˜¯ä¸€ç§ä¿é™©æªæ–½</span></span><br><span class="line">    channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.å‘é€æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, rabbitmq!&quot;</span>;</span><br><span class="line">    channel.basicPublish(<span class="string">&quot;&quot;</span>, queueName, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">    System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯æˆåŠŸï¼šã€&quot;</span> + message + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.å…³é—­é€šé“å’Œè¿æ¥</span></span><br><span class="line">    channel.close();</span><br><span class="line">    connection.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥æ”¶æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">    <span class="comment">// 1.å»ºç«‹è¿æ¥</span></span><br><span class="line">    <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">    <span class="comment">// 1.1.è®¾ç½®è¿æ¥å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šä¸»æœºåã€ç«¯å£å·ã€vhostã€ç”¨æˆ·åã€å¯†ç </span></span><br><span class="line">    factory.setHost(<span class="string">&quot;192.168.10.128&quot;</span>);</span><br><span class="line">    factory.setPort(<span class="number">5672</span>);</span><br><span class="line">    factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    factory.setUsername(<span class="string">&quot;linfeng&quot;</span>);</span><br><span class="line">    factory.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="comment">// 1.2.å»ºç«‹è¿æ¥</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.åˆ›å»ºé€šé“Channel</span></span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.åˆ›å»ºé˜Ÿåˆ—</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">    channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.è®¢é˜…æ¶ˆæ¯</span></span><br><span class="line">    channel.basicConsume(queueName, <span class="literal">true</span>, <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel)&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope,</span></span><br><span class="line"><span class="params">                                   AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="comment">// 5.å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + message + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯ã€‚ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="36-6-æµ‹è¯•ç»“æœ"><a href="#36-6-æµ‹è¯•ç»“æœ" class="headerlink" title="36.6 æµ‹è¯•ç»“æœ"></a>36.6 æµ‹è¯•ç»“æœ</h3><p>è¿è¡Œå‘é€ç«¯ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312261428101.png" alt="image-20231226142826006"></p><p>åŒæ—¶åœ¨RabbitMQæ§åˆ¶å°ä¸­å°±èƒ½çœ‹åˆ°é˜Ÿåˆ—ä¸­æœ‰å†…å®¹</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312261429129.png" alt="image-20231226142917051"></p><p>è¿è¡Œæ¥å—ç«¯</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312261430042.png" alt="image-20231226143006974"></p><h2 id="37-SpringAMQPï¼ˆhello-worldé˜Ÿåˆ—ï¼‰"><a href="#37-SpringAMQPï¼ˆhello-worldé˜Ÿåˆ—ï¼‰" class="headerlink" title="37. SpringAMQPï¼ˆhello worldé˜Ÿåˆ—ï¼‰"></a>37. SpringAMQPï¼ˆhello worldé˜Ÿåˆ—ï¼‰</h2><p>ä¹‹å‰çš„å®ç°æ–¹æ³•æ˜¯RabbitMQå®˜æ–¹çš„å®ç°æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°ä»£ç éå¸¸å¤šï¼Œå¾ˆå¤æ‚ã€‚</p><p>SpringAMQPæ˜¯åŸºäºRabbitMQå°è£…çš„ä¸€å¥—æ¨¡æ¿ï¼Œå¹¶ä¸”è¿˜åˆ©ç”¨SpringBootå¯¹å…¶å®ç°äº†è‡ªåŠ¨è£…é…ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚</p><p>SpringAMQPæä¾›äº†ä¸‰ä¸ªåŠŸèƒ½ï¼š</p><ul><li>è‡ªåŠ¨å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºåŠå…¶ç»‘å®šå…³ç³»</li><li>åŸºäºæ³¨è§£çš„ç›‘å¬å™¨æ¨¡å¼ï¼Œå¼‚æ­¥æ¥æ”¶æ¶ˆæ¯</li><li>å°è£…äº†RabbitTemplateå·¥å…·ï¼Œç”¨äºå‘é€æ¶ˆæ¯</li></ul><h3 id="37-1-ä½¿ç”¨SpringAMQP"><a href="#37-1-ä½¿ç”¨SpringAMQP" class="headerlink" title="37.1 ä½¿ç”¨SpringAMQP"></a>37.1 ä½¿ç”¨SpringAMQP</h3><p>å¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ mqè¿æ¥é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.128</span> <span class="comment">#MQåœ°å€</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># ç«¯å£</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">linfeng</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br></pre></td></tr></table></figure><p>ç¼–å†™å‘é€ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringAmqpTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMessage</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello,linfeng!hello world!&quot;</span>;</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(queueName,message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥æ”¶ç«¯ä¹Ÿè¦é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.128</span> <span class="comment">#MQåœ°å€</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># ç«¯å£</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">linfeng</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br></pre></td></tr></table></figure><p>æ¥å—æ¶ˆæ¯é€»è¾‘ï¼Œç¼–å†™ç›‘å¬ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRabblitListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenerQ</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> + msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œspringbooté¡¹ç›®ï¼Œä¾¿ä¼šè‡ªåŠ¨ç›‘å¬</p><h3 id="37-2-ä½¿ç”¨SpringAMQPï¼ˆå·¥ä½œé˜Ÿåˆ—ï¼‰"><a href="#37-2-ä½¿ç”¨SpringAMQPï¼ˆå·¥ä½œé˜Ÿåˆ—ï¼‰" class="headerlink" title="37.2 ä½¿ç”¨SpringAMQPï¼ˆå·¥ä½œé˜Ÿåˆ—ï¼‰"></a>37.2 ä½¿ç”¨SpringAMQPï¼ˆå·¥ä½œé˜Ÿåˆ—ï¼‰</h3><p>Work queuesï¼Œä¹Ÿè¢«ç§°ä¸ºï¼ˆTask queuesï¼‰ï¼Œä»»åŠ¡æ¨¡å‹ã€‚ç®€å•æ¥è¯´å°±æ˜¯<strong>è®©å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…±åŒæ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</strong>ã€‚</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312261500704.png" alt="image-20210717164238910"></p><p>å½“æ¶ˆæ¯å¤„ç†æ¯”è¾ƒè€—æ—¶çš„æ—¶å€™ï¼Œå¯èƒ½ç”Ÿäº§æ¶ˆæ¯çš„é€Ÿåº¦ä¼šè¿œè¿œå¤§äºæ¶ˆæ¯çš„æ¶ˆè´¹é€Ÿåº¦ã€‚é•¿æ­¤ä»¥å¾€ï¼Œæ¶ˆæ¯å°±ä¼šå †ç§¯è¶Šæ¥è¶Šå¤šï¼Œæ— æ³•åŠæ—¶å¤„ç†ã€‚</p><p>æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨work æ¨¡å‹ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å…±åŒå¤„ç†æ¶ˆæ¯å¤„ç†ï¼Œé€Ÿåº¦å°±èƒ½å¤§å¤§æé«˜äº†ã€‚</p><p>åœ¨å¤šæ¶ˆæ¯æ—¶ï¼Œä¸¤ä¸ªæ¥æ”¶ç«¯ä¼šä¸€èµ·æ¥å—ï¼Œå·®ä¸å¤šå°±æ˜¯ä¸‹å›¾è¿™ç§æƒ…å†µ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312261537655.png" alt="image-20231226153738574"></p><h3 id="37-3-æ¶ˆæ¯é¢„å–é™åˆ¶"><a href="#37-3-æ¶ˆæ¯é¢„å–é™åˆ¶" class="headerlink" title="37.3 æ¶ˆæ¯é¢„å–é™åˆ¶"></a>37.3 æ¶ˆæ¯é¢„å–é™åˆ¶</h3><p>å› ä¸ºé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šæå‰åˆ†é…åˆ°æ¶ˆè´¹è€…ä¸­ï¼Œåˆ†é…çš„é‡æ˜¯ç”±æ¶ˆæ¯é¢„å–å€¼å†³å®šçš„ï¼Œé»˜è®¤æ˜¯æ— é™ï¼Œä½†è¿™æ²¡æœ‰è€ƒè™‘æ ¹æ®æ¶ˆè´¹è€…çš„èƒ½åŠ›è¿›è¡Œè€ƒè™‘ã€‚</p><p>å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è°ƒæ•´</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.128</span> <span class="comment">#MQåœ°å€</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># ç«¯å£</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">linfeng</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="38-å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#38-å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="38. å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>38. å‘å¸ƒè®¢é˜…æ¨¡å¼</h2><p>å‘å¸ƒè®¢é˜…çš„æ¨¡å‹å¦‚å›¾ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312261600140.png" alt="image-20210717165309625"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è®¢é˜…æ¨¡å‹ä¸­ï¼Œå¤šäº†ä¸€ä¸ªexchangeè§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ï¼š</p><ul><li>Publisherï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œä½†æ˜¯ä¸å†å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™Xï¼ˆäº¤æ¢æœºï¼‰</li><li>Exchangeï¼šäº¤æ¢æœºï¼Œå›¾ä¸­çš„Xã€‚ä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeçš„ç±»å‹ã€‚Exchangeæœ‰ä»¥ä¸‹3ç§ç±»å‹ï¼š<ul><li>Fanoutï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—</li><li>Directï¼šå®šå‘ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®šrouting key çš„é˜Ÿåˆ—</li><li>Topicï¼šé€šé…ç¬¦ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆrouting patternï¼ˆè·¯ç”±æ¨¡å¼ï¼‰ çš„é˜Ÿåˆ—</li></ul></li><li>Consumerï¼šæ¶ˆè´¹è€…ï¼Œä¸ä»¥å‰ä¸€æ ·ï¼Œè®¢é˜…é˜Ÿåˆ—ï¼Œæ²¡æœ‰å˜åŒ–</li><li>Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿä¸ä»¥å‰ä¸€æ ·ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯ã€‚</li></ul><p><strong>Exchangeï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›</strong>ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸Exchangeç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤±ï¼</p><h3 id="38-1-Fanout-Exchange-å¹¿å‘"><a href="#38-1-Fanout-Exchange-å¹¿å‘" class="headerlink" title="38.1 Fanout Exchange å¹¿å‘"></a>38.1 Fanout Exchange å¹¿å‘</h3><p>è¯¥ç§äº¤æ¢ä»·æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¼šè½¬å‘ç»™æ‰€æœ‰äºå…¶ç»‘å®šçš„é˜Ÿåˆ—ä¸Š</p><p>ç»‘å®šè¿‡ç¨‹å¦‚ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªäº¤æ¢æœºé…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FanoutConfig</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    äº¤æ¢æœºå linfeng.fanout</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">fanoutExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(<span class="string">&quot;linfeng.fanout&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    ç¬¬ä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQ1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.q1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    ç¬¬äºŒä¸ªé˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQ2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.q2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    ç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">fanoutBinding</span><span class="params">(Queue fanoutQ1,FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">                BindingBuilder.bind(fanoutQ1).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    ç¬¬äºŒæ¬¡ç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">fanoutBinding2</span><span class="params">(Queue fanoutQ2,FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">                BindingBuilder.bind(fanoutQ2).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥æ”¶æ¶ˆæ¯ç«¯ä»£ç æ²¡ä»€ä¹ˆå˜åŒ–ï¼Œlisteneré˜Ÿåˆ—åå³å¯</p><p>å‘é€ç«¯å°†åŸå…ˆçš„é˜Ÿåˆ—åä½ç½®æ”¹ä¸ºäº¤æ¢æœºåï¼Œå‘é€æ–¹æ³•éœ€è¦routingKeyï¼ˆå½“å‰è®¾ç½®ä¸ºç©ºï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendFanoutExchange</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        äº¤æ¢æœºåç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">exchangename</span> <span class="operator">=</span> <span class="string">&quot;linfeng.fanout&quot;</span>;</span><br><span class="line"><span class="comment">//        æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;hello fanout exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(exchangename,<span class="string">&quot;&quot;</span>,msg);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå°±æ˜¯ä¸¤ä¸ªæ¶ˆè´¹è€…å“¦åº¦æ”¶åˆ°äº†åŒæ ·çš„æ¶ˆæ¯</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312261631686.png" alt="image-20231226163113611"></p><h3 id="38-2-DirectExchange-æŒ‡å®šè·¯ç”±"><a href="#38-2-DirectExchange-æŒ‡å®šè·¯ç”±" class="headerlink" title="38.2 DirectExchange æŒ‡å®šè·¯ç”±"></a>38.2 DirectExchange æŒ‡å®šè·¯ç”±</h3><p>æ¯ä¸ªQueueéƒ½ä¼šä¸Exchangeè®¾ç½®ä¸€ä¸ªBindingKeyï¼Œå‘å¸ƒè€…å‘é€æ¶ˆæ¯æ—¶ä¹Ÿä¼šæŒ‡å®šä¸€ä¸ªRoutingKeyï¼Œç„¶åexchangeå°†æ¶ˆæ¯è½¬å‘åˆ°å’ŒRoutingKeyä¸€è‡´çš„BindingKeyæ‰€æŒ‡çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸Šï¼Œå¦å¤–ä¸åŒQueueå¯ä»¥æŒ‡å®šç›¸åŒkey</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312262059031.png" alt="image-20210717170223317"></p><p>é¦–å…ˆæ˜¯åˆ›å»ºäº¤æ¢æœºï¼Œç„¶åå°†å®ƒå’Œæ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œä¹‹å‰æˆ‘ä»¬æ˜¯ç”¨@Beanæ¥å®ç°çš„ï¼Œå¤ªéº»çƒ¦ï¼Œè¿™é‡Œæå‡ºæ”¹è¿›æ–¹æ³•ï¼Œç”¨æ³¨è§£çš„å½¢å¼ç›´æ¥å®Œæˆåˆ›å»ºï¼Œåˆ°ç»‘å®šï¼Œåˆ°æŒ‡å®škey</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(</span></span><br><span class="line"><span class="meta">        bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">        value = @Queue(name=&quot;direct.q1&quot;),</span></span><br><span class="line"><span class="meta">        exchange = @Exchange(name=&quot;linfeng.direct&quot;,type= ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">        key=&#123;&quot;red&quot;,&quot;yellow&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQ1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°äº†ï¼š&quot;</span> + msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¼šè‡ªåŠ¨åˆ›å»ºäº¤æ¢æœºå’Œç»‘å®šå…³ç³»</p><p>ä¸‹é¢å†™å‘é€ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendDirectExchange</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangename</span> <span class="operator">=</span> <span class="string">&quot;linfeng.direct&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;hello Direct Exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangename,<span class="string">&quot;red&quot;</span>,msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>rabbitTemplate.convertAndSend(exchangename,â€redâ€,msg);</p><p>æ­¤å¤„çš„redå°±æ˜¯ä¹‹å‰å®šä¹‰çš„keyï¼Œå› ä¸ºredæ˜¯ä¸¤ä¸ªé˜Ÿåˆ—éƒ½ç»‘å®šçš„keyï¼Œæ‰€ä»¥æœ¬æ­¤æ¶ˆæ¯ç±»ä¼¼äºç¾¤å‘</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312262125518.png" alt="image-20231226212541464"></p><p>å¦‚æœå°†keyæ”¹ä¸ºblue</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312262126954.png" alt="image-20231226212602908"></p><p>åªæœ‰2æ”¶åˆ°äº†</p><h3 id="38-3-å‘å¸ƒè®¢é˜…TopicExchange"><a href="#38-3-å‘å¸ƒè®¢é˜…TopicExchange" class="headerlink" title="38.3 å‘å¸ƒè®¢é˜…TopicExchange"></a>38.3 å‘å¸ƒè®¢é˜…TopicExchange</h3><p><code>Topic</code>ç±»å‹çš„<code>Exchange</code>ä¸<code>Direct</code>ç›¸æ¯”ï¼Œéƒ½æ˜¯å¯ä»¥æ ¹æ®<code>RoutingKey</code>æŠŠæ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„é˜Ÿåˆ—ã€‚åªä¸è¿‡<code>Topic</code>ç±»å‹<code>Exchange</code>å¯ä»¥è®©é˜Ÿåˆ—åœ¨ç»‘å®š<code>Routing key</code> çš„æ—¶å€™ä½¿ç”¨é€šé…ç¬¦ï¼</p><p><code>Routingkey</code> ä¸€èˆ¬éƒ½æ˜¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯ç»„æˆï¼Œå¤šä¸ªå•è¯ä¹‹é—´ä»¥â€.â€åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š <code>item.insert</code></p><p> é€šé…ç¬¦è§„åˆ™ï¼š</p><p><code>#</code>ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯</p><p><code>*</code>ï¼šåŒ¹é…ä¸å¤šä¸å°‘æ°å¥½1ä¸ªè¯</p><p>ä¸¾ä¾‹ï¼š</p><p><code>item.#</code>ï¼šèƒ½å¤ŸåŒ¹é…<code>item.spu.insert</code> æˆ–è€… <code>item.spu</code></p><p><code>item.*</code>ï¼šåªèƒ½åŒ¹é…<code>item.spu</code></p><p>â€‹     </p><p>å›¾ç¤ºï¼š</p><p> <img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312262132008.png" alt="image-20210717170705380"></p><p>è§£é‡Šï¼š</p><ul><li>Queue1ï¼šç»‘å®šçš„æ˜¯<code>china.#</code> ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ <code>china.</code>å¼€å¤´çš„<code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…åˆ°ã€‚åŒ…æ‹¬china.newså’Œchina.weather</li><li>Queue2ï¼šç»‘å®šçš„æ˜¯<code>#.news</code> ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ <code>.news</code>ç»“å°¾çš„ <code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…ã€‚åŒ…æ‹¬china.newså’Œjapan.news</li></ul><p>ä¸¾ä¾‹å®è·µä¸€æŠŠï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(</span></span><br><span class="line"><span class="meta">        bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">                value = @Queue(name = &quot;topic.q1&quot;),</span></span><br><span class="line"><span class="meta">                exchange = @Exchange(name = &quot;linfeng.topic&quot;,type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">                key = &quot;china.#&quot;</span></span><br><span class="line"><span class="meta">        )</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQ1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;1æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> + msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(</span></span><br><span class="line"><span class="meta">        bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">                value = @Queue(name = &quot;topic.q2&quot;),</span></span><br><span class="line"><span class="meta">                exchange = @Exchange(name = &quot;linfeng.topic&quot;,type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">                key = &quot;#.news&quot;</span></span><br><span class="line"><span class="meta">        )</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQ2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;2æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> + msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•ç»‘å®šä¸¤ä¸ªï¼Œå’Œä¹‹å‰çš„è®¾ç½®å·®ä¸å¤šï¼Œä¸‹é¢æ˜¯å‘é€ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendTopicExchange</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangename</span> <span class="operator">=</span> <span class="string">&quot;linfeng.topic&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;hello world!&quot;</span>;</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangename,<span class="string">&quot;china.huainan&quot;</span>,msg + <span class="string">&quot;china.huainan&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‡å®šçš„æ˜¯china.huainanï¼Œå¾ˆæ˜¾ç„¶ç¬¦åˆkeyï¼šchina.#</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312262142315.png" alt="image-20231226214232259"></p><p>å¦‚æœæ”¹ä¸ºhuainan.newsï¼Œå¾ˆæ˜¾ç„¶ä¼šåŒ¹é…åˆ°Q2</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312262143963.png" alt="image-20231226214333914"></p><h2 id="39-æ¶ˆæ¯è½¬æ¢å™¨"><a href="#39-æ¶ˆæ¯è½¬æ¢å™¨" class="headerlink" title="39. æ¶ˆæ¯è½¬æ¢å™¨"></a>39. æ¶ˆæ¯è½¬æ¢å™¨</h2><p>Springä¼šæŠŠä½ å‘é€çš„æ¶ˆæ¯åºåˆ—åŒ–ä¸ºå­—èŠ‚å‘é€ç»™MQï¼Œæ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¿˜ä¼šæŠŠå­—èŠ‚ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312262152828.png" alt="image-20200525170410401"></p><p>åªä¸è¿‡ï¼Œé»˜è®¤æƒ…å†µä¸‹Springé‡‡ç”¨çš„åºåˆ—åŒ–æ–¹å¼æ˜¯JDKåºåˆ—åŒ–ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒJDKåºåˆ—åŒ–å­˜åœ¨ä¸‹åˆ—é—®é¢˜ï¼š</p><ul><li>æ•°æ®ä½“ç§¯è¿‡å¤§</li><li>æœ‰å®‰å…¨æ¼æ´</li><li>å¯è¯»æ€§å·®</li></ul><p>æ¨èä½¿ç”¨jsonè½¬æ¢å™¨</p><h3 id="39-1-jsonè½¬æ¢å™¨é…ç½®"><a href="#39-1-jsonè½¬æ¢å™¨é…ç½®" class="headerlink" title="39.1 jsonè½¬æ¢å™¨é…ç½®"></a>39.1 jsonè½¬æ¢å™¨é…ç½®</h3><p>åœ¨publisherå’Œconsumerä¸¤ä¸ªæœåŠ¡ä¸­éƒ½å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®æ¶ˆæ¯è½¬æ¢å™¨ã€‚</p><p>åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ªBeanå³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageConverter <span class="title function_">jsonMessageConverter</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> java </tag>
            
            <tag> SpringCloud </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxå…¥é—¨</title>
      <link href="/2023/12/09/Nginx%E5%85%A5%E9%97%A8/"/>
      <url>/2023/12/09/Nginx%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Nginxå…¥é—¨"><a href="#Nginxå…¥é—¨" class="headerlink" title="Nginxå…¥é—¨"></a>Nginxå…¥é—¨</h1><blockquote><p>éƒ¨åˆ†è¯æ¡æ¥è‡ªç™¾åº¦ç™¾ç§‘</p></blockquote><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Nginxæ˜¯ä¸€æ¬¾è½»é‡çº§çš„Web æœåŠ¡å™¨&#x2F;åå‘ä»£ç†æœåŠ¡å™¨åŠç”µå­é‚®ä»¶ï¼ˆIMAP&#x2F;POP3ï¼‰ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨BSD-like åè®®ä¸‹å‘è¡Œã€‚å…¶ç‰¹ç‚¹æ˜¯å æœ‰å†…å­˜å°‘ï¼Œå¹¶å‘èƒ½åŠ›å¼ºï¼Œäº‹å®ä¸Šnginxçš„å¹¶å‘èƒ½åŠ›åœ¨åŒç±»å‹çš„ç½‘é¡µæœåŠ¡å™¨ä¸­è¡¨ç°è¾ƒå¥½ã€‚</p><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><p>ubuntuä¸‹ï¼š</p><blockquote><p>&#x2F;usr&#x2F;sbin&#x2F;nginxï¼šä¸»ç¨‹åºï¼Œå¯åŠ¨æ–‡ä»¶<br>&#x2F;etc&#x2F;nginxï¼šå­˜æ”¾é…ç½®æ–‡ä»¶<br>&#x2F;var&#x2F;www&#x2F;htmlï¼šå­˜æ”¾é¡¹ç›®ç›®å½•<br>&#x2F;var&#x2F;log&#x2F;nginxï¼šå­˜æ”¾æ—¥å¿—  </p></blockquote><p>å¯åŠ¨ï¼š</p><p>åœ¨sbinç›®å½•ä¸‹</p><blockquote><p>.&#x2F;nginx</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312092004100.png" alt="image-20231209200428025"></p><p>å¯åŠ¨åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è™šæ‹Ÿæœºçš„ipåœ°å€è®¿é—®åˆ°nginxçš„é»˜è®¤é¡µé¢ï¼ˆå¦‚æœè®¿é—®ä¸åˆ°ï¼Œè¯·å…³é—­linuxé˜²ç«å¢™ï¼‰</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312092008547.png" alt="image-20231209200809504"></p><p>å…³é—­nginx</p><blockquote><p>.&#x2F;nginx -s stop</p></blockquote><p>é‡æ–°åŠ è½½nginx</p><blockquote><p>.&#x2F;niginx -s reload</p></blockquote><h2 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h2><p>åœ¨etc&#x2F;profileæ–‡ä»¶ä¸­è¿½åŠ ï¼š<br><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312092022860.png" alt="image-20231209202204827"></p><blockquote><p>&#x2F;user&#x2F;sbinï¼ˆä½ çš„nginxå¯åŠ¨å™¨æ‰€åœ¨ç›®å½•ï¼‰</p></blockquote><p>è¿™æ ·åœ¨æ‰€æœ‰ç›®å½•ä¸‹éƒ½å¯ä»¥å¯åŠ¨nginxäº†ï¼ˆä¸ç”¨.&#x2F;nginxï¼‰</p><h2 id="éƒ¨ç½²é™æ€èµ„æº"><a href="#éƒ¨ç½²é™æ€èµ„æº" class="headerlink" title="éƒ¨ç½²é™æ€èµ„æº"></a>éƒ¨ç½²é™æ€èµ„æº</h2><p>æŠŠé™æ€htmlæ”¾åˆ°&#x2F;var&#x2F;www&#x2F;htmlä¸‹å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysqlä¸»ä»å¤åˆ¶</title>
      <link href="/2023/12/07/Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"/>
      <url>/2023/12/07/Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="Mysqlä¸»ä»å¤åˆ¶"><a href="#Mysqlä¸»ä»å¤åˆ¶" class="headerlink" title="Mysqlä¸»ä»å¤åˆ¶"></a>Mysqlä¸»ä»å¤åˆ¶</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å½“æ‰€æœ‰çš„è¯»å†™æ“ä½œéƒ½é›†ä¸­åœ¨ä¸€å°mysqlæœåŠ¡å™¨ä¸Šæ—¶ï¼Œä¼šä½¿å¾—è¯¥å°æœåŠ¡å™¨è´Ÿè½½å¢å¤§ï¼Œå…¶æ¬¡æ˜¯ï¼Œå½“æ•°æ®å…¨éƒ¨é›†ä¸­åˆ°ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œä¸”æ²¡æœ‰å…¶ä»–æœåŠ¡å™¨åšå¤‡ä»½çš„è¯ï¼Œä¸€æ—¦å‘ç”Ÿäº‹æ•…å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œä¼šå¸¦æ¥å·¨å¤§çš„æŸå¤±ã€‚è¦æƒ³è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå°±å¼•å‡ºäº†Mysqlä¸»ä»å¤åˆ¶çš„åŠŸèƒ½ï¼Œå³å°†ä¸»æœåŠ¡å™¨ä¸Šçš„æ•°æ®â€œå¤‡ä»½â€ä¸€ä»½ï¼Œæ”¾åˆ°ä»æœåŠ¡å™¨ä¸Šï¼Œç„¶åè®©ä»æœåŠ¡å™¨ä¹Ÿæ‰¿æ‹…ä¸€éƒ¨åˆ†æ•°æ®åº“åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸“é—¨æŸ¥è¯¢ï¼Œè¿™æ ·æ—¢ç¼“è§£äº†ä¸€ä¸ªæœåŠ¡å™¨çš„å‹åŠ›ï¼Œåˆèƒ½å­˜åœ¨å¤‡ä»½ã€‚</p><h2 id="æ¡†æ¶å›¾"><a href="#æ¡†æ¶å›¾" class="headerlink" title="æ¡†æ¶å›¾"></a>æ¡†æ¶å›¾</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312072123240.png" alt="image-20231207212310135"></p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><ul><li>ä¸»åº“å°†æ‰€æœ‰çš„å†™æ“ä½œè®°å½•åˆ°binlogæ—¥å¿—ä¸­å¹¶ç”Ÿæˆä¸€ä¸ªlog dumpçº¿ç¨‹ï¼Œå°†binlogæ—¥å¿—ä¼ ç»™ä»åº“çš„I&#x2F;Oçº¿ç¨‹ã€‚</li><li>ä»åº“çš„IOçº¿ç¨‹ä¼šè¯»å–ä¸»åº“çš„binlogæ—¥å¿—ï¼Œç„¶åå°†è¯»åˆ°çš„æ—¥å¿—å†™å…¥relaylogï¼ˆä¸­ç»§æ—¥å¿—ï¼‰ä¸­</li><li>ä»åº“çš„sqlçº¿ç¨‹å†è¯»å–relaylogç„¶åå¤ç°æ—¥å¿—ä¸­çš„sqlæ“ä½œï¼Œè¾¾æˆä¸»ä»æ•°æ®ä¸€è‡´</li></ul><h2 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h2><h3 id="ä¸¤å°æœåŠ¡å™¨ï¼Œåˆ†åˆ«é…ç½®Mysql"><a href="#ä¸¤å°æœåŠ¡å™¨ï¼Œåˆ†åˆ«é…ç½®Mysql" class="headerlink" title="ä¸¤å°æœåŠ¡å™¨ï¼Œåˆ†åˆ«é…ç½®Mysql"></a>ä¸¤å°æœåŠ¡å™¨ï¼Œåˆ†åˆ«é…ç½®Mysql</h3><p>æ¯”å¦‚ï¼š<br>ä¸»åº“ï¼š 192.168.138.100</p><p>ä»åº“ï¼š 192.168.138.101</p><h3 id="é…ç½®ä¸»åº“"><a href="#é…ç½®ä¸»åº“" class="headerlink" title="é…ç½®ä¸»åº“"></a>é…ç½®ä¸»åº“</h3><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ &#x2F;etc&#x2F;my.conf</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line">  server-id=11</span><br><span class="line">  log-bin=mysql-bin#æ·»åŠ ï¼Œä¸»æœåŠ¡å™¨å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">  binlog_format=mixed</span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯æœåŠ¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><p>ç™»å½•æ•°æ®åº“ï¼Œç„¶åä¸ºä»åº“åˆ†é…ä¸€ä¸ªèº«ä»½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p *** </span><br><span class="line">grant replication slave on *.* to &#x27;åå­—&#x27;@&#x27;%&#x27; identified by &#x27;123456   #ç»™ä»æœåŠ¡å™¨æˆæƒ</span><br><span class="line">flush privileges;</span><br><span class="line">show master status;  #æŸ¥çœ‹ç”¨æˆ·çŠ¶æ€</span><br></pre></td></tr></table></figure><h3 id="é…ç½®ä»åº“"><a href="#é…ç½®ä»åº“" class="headerlink" title="é…ç½®ä»åº“"></a>é…ç½®ä»åº“</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line">  server-id = 22#ä¿®æ”¹ï¼Œæ³¨æ„idä¸Masterçš„ä¸åŒï¼Œä¸¤ä¸ªslaveçš„idä¹Ÿè¦ä¸åŒ</span><br><span class="line">  relay-log=relay-log-bin#å¼€å¯ä¸­ç»§æ—¥å¿—ï¼Œä»ä¸»æœåŠ¡å™¨ä¸ŠåŒæ­¥æ—¥å¿—æ–‡ä»¶è®°å½•åˆ°æœ¬åœ°</span><br><span class="line">  relay-log-index=relay-log-bin.index#å®šä¹‰ä¸­ç»§æ—¥å¿—æ–‡ä»¶çš„ä½ç½®å’Œåç§°ï¼Œä¸€èˆ¬å’Œrelay-logåœ¨åŒä¸€ç›®å½•</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡ï¼Œå¹¶ç™»å½•ï¼Œç„¶åè¿æ¥åˆ°ä¸»åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br><span class="line">mysql -u root -p***</span><br><span class="line">change master to master_host=&#x27;192.168.138.100&#x27;,master_user=&#x27;åå­—&#x27;,master_password=&#x27;123456&#x27;,master_log_file=&#x27;mysql-bin.000002&#x27;,master_log_pos=604;#é…ç½®åŒæ­¥ï¼Œæ³¨æ„ master_log_file å’Œ master_log_pos çš„å€¼è¦ä¸MasteræŸ¥è¯¢çš„ä¸€è‡´</span><br><span class="line">start slave;#å¯åŠ¨åŒæ­¥ï¼Œå¦‚æœ‰æŠ¥é”™æ‰§è¡Œ reset </span><br><span class="line">show slave status/G#æŸ¥çœ‹ slave çŠ¶æ€</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rediså…¥é—¨</title>
      <link href="/2023/12/03/Redis%E5%85%A5%E9%97%A8/"/>
      <url>/2023/12/03/Redis%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Rediså…¥é—¨"><a href="#Rediså…¥é—¨" class="headerlink" title="Rediså…¥é—¨"></a>Rediså…¥é—¨</h1><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312031922774.png" alt="image-20231203192247704"></p><h2 id="è®¾ç½®è¿æ¥å¯†ç "><a href="#è®¾ç½®è¿æ¥å¯†ç " class="headerlink" title="è®¾ç½®è¿æ¥å¯†ç "></a>è®¾ç½®è¿æ¥å¯†ç </h2><p>æ‰“å¼€redisæ ¹ç›®å½•ä¸‹çš„redis.windows.confï¼Œæ‰¾åˆ°requirepassè¿™ä¸€è¡Œï¼Œå¯ä»¥çœ‹åˆ°å…¶é»˜è®¤æ˜¯æ³¨é‡Šæ‰çš„ï¼Œè§£å¼€æ³¨é‡Šï¼Œç„¶åè¾“å…¥è‡ªå·±æƒ³è¦è®¾ç½®çš„å¯†ç ä¿å­˜å°±å¯ä»¥äº†ã€‚</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312031924487.png" alt="image-20231203192448458"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312031932639.png" alt="image-20231203193201603"></p><p>è®¾ç½®å¯†ç åï¼Œåœ¨è¾“å…¥å‘½ä»¤æ—¶ä¼šæç¤ºæ²¡æœ‰è®¤è¯</p><p>è¾“å…¥å¯†ç ï¼š<br><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312031932293.png" alt="image-20231203193253266"></p><p>å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ç™»å½•çš„æ—¶å€™è¾“å…¥å¯†ç ï¼š<br><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312031934763.png" alt="image-20231203193421726"></p><p>è™½ç„¶ä¼šæç¤ºä¸å®‰å…¨</p><h2 id="è®¾ç½®è¿œç¨‹è¿æ¥"><a href="#è®¾ç½®è¿œç¨‹è¿æ¥" class="headerlink" title="è®¾ç½®è¿œç¨‹è¿æ¥"></a>è®¾ç½®è¿œç¨‹è¿æ¥</h2><p>å®Œæ•´çš„ç™»å½•å‘½ä»¤</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312031936908.png" alt="image-20231203193651881"></p><blockquote><p>redis-cli.exe -h localhost -p 6379 -a 123456</p><p>-h :åŠ IPåœ°å€</p><p>-p :åŠ ç«¯å£å·</p><p>-a : åŠ å¯†ç </p></blockquote><p>è¦æƒ³å®ç°è¿œç¨‹è¿æ¥ï¼Œéœ€è¦å†æ¬¡æ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œåœ¨é‡Œé¢æœç´¢ä¸‹é¢è¿™æ¡å‘½ä»¤ï¼š<br><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312031952780.png" alt="image-20231203195216753"></p><p>è¯¥å‘½ä»¤æ„æ€æ˜¯åªå…è®¸127.0.0.1è¿æ¥ï¼Œç›´æ¥æ³¨é‡Šæ‰ç„¶åä¿å­˜é€€å‡ºã€‚</p><h2 id="Rediså¸¸ç”¨æ•°æ®ç±»å‹"><a href="#Rediså¸¸ç”¨æ•°æ®ç±»å‹" class="headerlink" title="Rediså¸¸ç”¨æ•°æ®ç±»å‹"></a>Rediså¸¸ç”¨æ•°æ®ç±»å‹</h2><p>Redisé‡Œé¢å­˜å‚¨çš„æ˜¯key-valueç»“æ„çš„æ•°æ®ï¼Œå…¶ä¸­keyä¸ºå­—ç¬¦ä¸²ï¼Œvalueå¯ä»¥æ˜¯ä¸€ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š</p><ol><li>å­—ç¬¦ä¸²string</li><li>å“ˆå¸Œ hash (ç”¨æ¥å­˜å‚¨å¯¹è±¡)</li><li>åˆ—è¡¨ list </li><li>é›†åˆ set</li><li>æœ‰åºé›†åˆ sorted set</li></ol><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><p>stringç±»å‹ï¼š</p><ul><li>set key value ï¼šè®¾ç½®é”®å€¼</li><li>get key ï¼š è·å¾—é”®å¯¹åº”çš„å€¼</li><li>setex key seconds value ï¼š è®¾ç½®keyå€¼ï¼Œå¹¶åœ¨secondsç§’åè¿‡æœŸ</li><li>setnx key value ï¼šå½“keyä¸å­˜åœ¨æ—¶æ‰åˆ›å»ºè¯¥é”®å€¼å¯¹</li><li>del key ï¼š åˆ é™¤</li></ul><p>hashç±»å‹</p><ul><li>hset key field value ï¼š å°†å“ˆå¸Œè¡¨keyä¸­çš„å­—æ®µfieldçš„å€¼è®¾ä¸ºvalue</li><li>hget key field ï¼š è·å–æŒ‡å®šå­—æ®µ</li><li>hdel key field ï¼š åˆ é™¤å­—æ®µ</li><li>hkeys key ï¼š è·å–å“ˆå¸Œè¡¨æ‰€æœ‰å­—æ®µ</li><li>hvals keyï¼š è·å–æ‰€æœ‰å€¼</li><li>hgetall key ï¼š è·å–æ‰€æœ‰å­—æ®µå’Œå€¼</li></ul><p>Listç±»å‹</p><ul><li>lpush key value: æ’å…¥ï¼ˆå¤´æ’ï¼‰</li><li>lrange key start stop ï¼šè·å–èŒƒå›´å†…çš„å…ƒç´  ï¼ˆ0 -1æ˜¯è·å–å…¨éƒ¨ï¼‰</li><li>rpop key : ç§»é™¤å¹¶è·å–æœ€åä¸€ä¸ª</li><li>llen key ï¼šè·å–é•¿åº¦</li><li>brpop key timeout : ç§»é™¤å¹¶è·å–æœ€åä¸€ä¸ªï¼Œå¦‚æœè·å–ä¸åˆ°ä¼šä¸€ç›´å µå¡åˆ°tiemoutç»“æŸ</li></ul><p>setç±»å‹</p><ul><li>sadd key member ï¼š å‘é›†åˆä¸­æ·»åŠ æˆå‘˜</li><li>smembers key ï¼šè¿”å›é›†åˆä¸­æ‰€æœ‰æˆå‘˜</li><li>scard key ï¼šè·å–æˆå‘˜æ•°</li><li>sinter key1 key2 ï¼šè¿”å›ç»™å®šé›†åˆçš„äº¤é›†</li><li>sunion key1 key2 ï¼šè¿”å›ç»™å®šé›†åˆçš„å¹¶é›†</li><li>sdiff key1 key2 ï¼šå·®é›†</li><li>srem key member ï¼šç§»é™¤å…ƒç´ </li></ul><p>sorted setç±»å‹</p><ul><li>zadd key score memberï¼šæ·»åŠ ä¸€ä¸ªæˆå‘˜ï¼ˆstringï¼‰å¹¶æŒ‡å®šå…¶åˆ†æ•°ä¸ºscore(double)ï¼Œåˆ†æ•°å¯ä»¥ç†è§£ä¸ºä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§è¶Šå¤§æ’çš„è¶Šåã€‚</li><li>zrange key start stop ï¼šè¿”å›åŒºé—´å†…çš„æˆå‘˜</li><li>zincrby key increment member ï¼šå¯¹æŸä¸ªæˆå‘˜çš„åˆ†æ•°åŠ increment</li><li>zrem key member ï¼šåˆ é™¤</li></ul><h2 id="é€šç”¨å‘½ä»¤"><a href="#é€šç”¨å‘½ä»¤" class="headerlink" title="é€šç”¨å‘½ä»¤"></a>é€šç”¨å‘½ä»¤</h2><ul><li>keys patternæŸ¥åˆ°æ‰€æœ‰ç»™å®škey</li><li>exists key         æ£€æŸ¥ç»™å®škeyæ˜¯å¦å­˜åœ¨</li><li>type key          è¿”å›keyå­˜å‚¨çš„å€¼ç±»å‹Â·</li><li>ttl key              è¿”å›ç»™å®škeyçš„å‰©ä½™ç”Ÿå­˜æ—¶é—´</li><li>del key             keyå­˜åœ¨åˆ™åˆ é™¤key</li></ul>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxæ•™ç¨‹</title>
      <link href="/2023/11/27/Linux%E6%95%99%E7%A8%8B/"/>
      <url>/2023/11/27/Linux%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Linuxæ•™ç¨‹"><a href="#Linuxæ•™ç¨‹" class="headerlink" title="Linuxæ•™ç¨‹"></a>Linuxæ•™ç¨‹</h1><p>ç¯å¢ƒä¸ºubuntu20</p><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><table><thead><tr><th>åºå·</th><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>1</td><td>ls</td><td>æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„å†…å®¹</td></tr><tr><td>2</td><td>pwd</td><td>æŸ¥çœ‹å½“å‰æ‰€åœ¨ç›®å½•</td></tr><tr><td>3</td><td>cd [ç›®å½•å]</td><td>åˆ‡æ¢ç›®å½•</td></tr><tr><td>4</td><td>touch [æ–‡ä»¶å]</td><td>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º</td></tr><tr><td>5</td><td>mkdir [ç›®å½•å]</td><td>åˆ›å»ºç›®å½•</td></tr><tr><td>6</td><td>rm [æ–‡ä»¶å]</td><td>åˆ é™¤æ–‡ä»¶</td></tr></tbody></table><p>å‘½ä»¤ä½¿ç”¨å°æŠ€å·§</p><blockquote><p>tab è‡ªåŠ¨è¡¥å…¨ è¿ç»­ä¸¤æ¬¡tabç»™å‡ºæ“ä½œæç¤º</p><p>ä¸Šä¸‹ç®­å¤´ç»™å‡ºå†å²å‘½ä»¤</p><p>clear æˆ–è€… ctrl + læ¸…å±</p></blockquote><p>å‘½ä»¤æ ¼å¼</p><p>command [-options] [parameter]</p><blockquote><p>[-options] : é€‰é¡¹ï¼Œå¯¹å‘½ä»¤è¿›è¡Œæ§åˆ¶</p><p>[parameter]ï¼šå‘½ä»¤æ‰€éœ€å‚æ•°</p></blockquote><h3 id="ls-å‘½ä»¤"><a href="#ls-å‘½ä»¤" class="headerlink" title="ls å‘½ä»¤"></a>ls å‘½ä»¤</h3><p>l [-a|-l|-al] [dir]</p><blockquote><p>-a: åˆ—å‡ºæ‰€æœ‰</p><p>-lï¼šè¯¦ç»†ä¿¡æ¯</p></blockquote><p>ls -l å¯ä»¥ç®€å†™ä¸º ll</p><h3 id="cd-å‘½ä»¤"><a href="#cd-å‘½ä»¤" class="headerlink" title="cd å‘½ä»¤"></a>cd å‘½ä»¤</h3><p>cd [dirName]</p><blockquote><p>ç‰¹æ®Šç¬¦å·ï¼š</p><p>~ï¼šhomeç›®å½•</p><p>. :å½“å‰ç›®å½•</p><p>.. :ä¸Šä¸€çº§</p></blockquote><h3 id="catå‘½ä»¤"><a href="#catå‘½ä»¤" class="headerlink" title="catå‘½ä»¤"></a>catå‘½ä»¤</h3><p>cat [-n] fileName</p><blockquote><p>-n: ç¼–å·</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311272245843.png" alt="image-20231127224510781"></p><h3 id="moreå‘½ä»¤"><a href="#moreå‘½ä»¤" class="headerlink" title="moreå‘½ä»¤"></a>moreå‘½ä»¤</h3><p>more filename</p><blockquote><p>å·²åˆ†é¡µå½¢å¼å±•ç¤ºæ–‡ä»¶å†…å®¹</p><p>å›è½¦å‘ä¸‹ä¸€è¡Œ</p><p>ç©ºæ ¼å‘ä¸‹ä¸€å±</p><p>b  è¿”å›ä¸Šä¸€å±</p><p>q æˆ– ctrl + c é€€å‡º</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311272249458.png" alt="image-20231127224920411"></p><h3 id="tailå‘½ä»¤"><a href="#tailå‘½ä»¤" class="headerlink" title="tailå‘½ä»¤"></a>tailå‘½ä»¤</h3><p>tail [-f] filename</p><blockquote><p>æŸ¥çœ‹æ–‡ä»¶æœ«å°¾</p><p>-f: åŠ¨æ€è¯»å–æ–‡ä»¶æœ«å°¾ï¼Œå¹¶è¾“å‡º</p><p>-è¡Œæ•°: è¯»å–å‡ è¡Œ</p></blockquote><h3 id="mkdir-å‘½ä»¤"><a href="#mkdir-å‘½ä»¤" class="headerlink" title="mkdir å‘½ä»¤"></a>mkdir å‘½ä»¤</h3><p>mkdir [-p] ç›®å½•</p><blockquote><p>-pï¼šåŠ äº† -p å¯ä»¥åˆ›å»ºå¤šå±‚ç›®å½•</p></blockquote><h3 id="rmdir-å‘½ä»¤"><a href="#rmdir-å‘½ä»¤" class="headerlink" title="rmdir å‘½ä»¤"></a>rmdir å‘½ä»¤</h3><p>rmdir [-p] ç›®å½•</p><blockquote><p>-pï¼šå­ç›®å½•åˆ é™¤ä½¿çˆ¶ç›®å½•ä¸ºç©ºï¼Œåˆ™ä¸€å¹¶åˆ é™¤</p><p>rmdir + åç§°*ï¼šåˆ é™¤ä»¥åç§°å¼€å¤´çš„æ‰€æœ‰ç›®å½•</p></blockquote><p>rmå‘½ä»¤</p><p>rm [-rf] name</p><blockquote><p>åˆ é™¤æ–‡ä»¶æˆ–è€…ç›®å½•</p><p>-rï¼šåˆ é™¤ç›®å½•å’Œå…¶ä¸­çš„æ–‡ä»¶ï¼ˆé€’å½’åˆ é™¤ï¼‰</p><p>-fï¼šæ— éœ€ç¡®è®¤ï¼Œç›´æ¥åˆ </p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311272302724.png" alt="image-20231127230230690"></p><h3 id="cp-å‘½ä»¤"><a href="#cp-å‘½ä»¤" class="headerlink" title="cp å‘½ä»¤"></a>cp å‘½ä»¤</h3><p>cp [-r] source dest</p><blockquote><p>å°†æ–‡ä»¶æˆ–è€…ç›®å½•ä»sourceå¤åˆ¶åˆ°dest</p><p>-r:å¦‚æœæ˜¯ç›®å½•åˆ™éœ€è¦ï¼Œå¤åˆ¶ç›®å½•ä¸‹æ‰€æœ‰</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311272306073.png" alt="image-20231127230616030"></p><blockquote><p>cp -r lf&#x2F;* ..&#x2F; ï¼šlf&#x2F;* æŒ‡å¤åˆ¶lfç›®å½•ä¸‹çš„æ–‡ä»¶</p></blockquote><h3 id="mvå‘½ä»¤"><a href="#mvå‘½ä»¤" class="headerlink" title="mvå‘½ä»¤"></a>mvå‘½ä»¤</h3><p>mv source dest</p><blockquote><p>æ”¹åç›®å½•æˆ–è€…æ–‡ä»¶ï¼Œæˆ–è€…ç§»åŠ¨</p><p>æ”¹åï¼šmv hello.txt hi.txt</p><p>â€‹mv lf&#x2F; linf&#x2F; å¦‚æœlinf&#x2F;ä¸å­˜åœ¨ï¼Œåˆ™æ”¹åï¼Œå­˜åœ¨åˆ™ç§»åŠ¨</p></blockquote><h3 id="tarå‘½ä»¤"><a href="#tarå‘½ä»¤" class="headerlink" title="tarå‘½ä»¤"></a>tarå‘½ä»¤</h3><p>tar [-zcxvf] fileName [files]</p><p>æ–‡ä»¶åç¼€ä¸º.tarè¡¨ç¤ºä»…æ‰“åŒ…ï¼Œ.tar.gzè¡¨ç¤ºæ‰“åŒ…åŠ å‹ç¼©</p><blockquote><p>-z:è¡¨ç¤ºç”¨gzipå‹ç¼©æˆ–è€…è§£å‹</p><p>-cï¼šåˆ›å»ºæ–°çš„åŒ…æ–‡ä»¶</p><p>-x:ä»åŒ…æ–‡ä»¶è¿˜åŸæ–‡ä»¶</p><p>-v:æ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œè¿‡ç¨‹</p><p>-f: æŒ‡å®šåŒ…æ–‡ä»¶åç§°</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311291024758.png" alt="image-20231129102450682"></p><p>å¸¸ç”¨ç»„åˆï¼š</p><p>-cvf</p><p>æ‰“åŒ… + æ˜¾ç¤ºè¿‡ç¨‹ + å‘½å</p><p>-zcvf</p><p>æ‰“åŒ… + å‹ç¼© + æ˜¾ç¤ºè¿‡ç¨‹ + å‘½å</p><p>-xvf </p><p>è§£å‹ + è¿‡ç¨‹ + æ–‡ä»¶å</p><h3 id="viå‘½ä»¤"><a href="#viå‘½ä»¤" class="headerlink" title="viå‘½ä»¤"></a>viå‘½ä»¤</h3><p>vi + filename</p><blockquote><p>å¯¹æ–‡æœ¬å†…å®¹è¿›è¡Œç¼–è¾‘</p></blockquote><p>è¿˜æœ‰ä¸ªç±»ä¼¼çš„å«vimï¼Œä»–èƒ½è®©æ–‡æœ¬å†…å®¹å‡ºç°é¢œè‰²å˜åŒ–ï¼ˆå¯ä»¥è§£ææˆ‘ä»¬çš„æ–‡æœ¬ï¼‰</p><p>viméœ€è¦è‡ªå·±ä¸‹è½½ï¼šyum install vim</p><p>æ‰“å¼€çš„æ–‡ä»¶æœ‰ä¸‰ç§æ¨¡å¼ï¼š<br>å‘½ä»¤æ¨¡å¼ï¼š<br>èƒ½æŸ¥çœ‹æˆ–è€…ç§»åŠ¨å…‰æ ‡ï¼Œé»˜è®¤è¿›å…¥å‘½ä»¤æ¨¡å¼</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311291037994.png" alt="image-20231129103754932"></p><p>æ’å…¥æ¨¡å¼ï¼š<br>æŒ‰ä¸‹a,i,oä»»æ„ä¸€ä¸ªï¼Œè¿›å…¥æ’å…¥æ¨¡å¼ï¼Œæ­¤æ—¶å¯ä»¥å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œæ’å…¥</p><p>æŒ‰escé€€å‡º</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311291039293.png" alt="image-20231129103908254"></p><p>åº•è¡Œæ¨¡å¼</p><p>å¯ä»¥å¯¹æ–‡ä»¶å†…å®¹æŸ¥æ‰¾ï¼Œæ˜¾ç¤ºè¡Œå·ï¼Œé€€å‡º</p><p>æŒ‰ä¸‹ ï¼šæˆ–è€…&#x2F;</p><p>&#x2F; ï¼š å¯ä»¥å¯¹æ–‡ä»¶å†…å®¹è¿›è¡ŒæŸ¥æ‰¾</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311291042996.png" alt="image-20231129104216958"></p><p>ï¼šï¼šwqä¿å­˜å¹¶é€€å‡ºï¼Œqï¼ä¸ä¿å­˜é€€å‡ºï¼Œset nuæ˜¾ç¤ºè¡Œå·</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311291042864.png" alt="image-20231129104240827"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311291043271.png" alt="image-20231129104301236"></p><h3 id="findå‘½ä»¤"><a href="#findå‘½ä»¤" class="headerlink" title="findå‘½ä»¤"></a>findå‘½ä»¤</h3><p>find dirName -name fileName</p><blockquote><p>dirname ï¼šç›®æ ‡ç›®å½•</p><p>filenameï¼šæŸ¥æ‰¾æ–‡ä»¶  å¯ä»¥åˆ©ç”¨é€šé…ç¬¦æ¯”å¦‚ï¼š*.cpp æ‰€æœ‰c++æ–‡ä»¶</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311291047829.png" alt="image-20231129104719795"></p><h3 id="grepå‘½ä»¤"><a href="#grepå‘½ä»¤" class="headerlink" title="grepå‘½ä»¤"></a>grepå‘½ä»¤</h3><p>grep word filename</p><blockquote><p>ä»æŒ‡å®šæ–‡ä»¶ä¸­æŸ¥æ‰¾å†…å®¹</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311291049770.png" alt="image-20231129104939740"></p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitæ•™ç¨‹</title>
      <link href="/2023/11/23/Git%E6%95%99%E7%A8%8B/"/>
      <url>/2023/11/23/Git%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="GitåŸºç¡€æ•™å­¦ç¬”è®°"><a href="#GitåŸºç¡€æ•™å­¦ç¬”è®°" class="headerlink" title="GitåŸºç¡€æ•™å­¦ç¬”è®°"></a>GitåŸºç¡€æ•™å­¦ç¬”è®°</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311232227203.png" alt="image-20231123222710137" style="zoom:50%;" /><p>gitæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œé€šå¸¸ç”¨æ¥ç®¡ç†æºä»£ç ã€‚</p><p>gitå¯ä»¥ç®¡ç†ä¸¤ç§ä»“åº“ï¼šæœ¬åœ°ä»“åº“ &amp; è¿œç¨‹ä»“åº“</p><blockquote><p>åŸºæœ¬çš„å‘½ä»¤æœ‰ï¼š<br>commit : æäº¤ï¼Œå°†æœ¬åœ°æ–‡ä»¶å’Œç‰ˆæœ¬ä¿¡æ¯ä¿å­˜åˆ°æœ¬åœ°ä»“åº“</p><p>push:æ¨é€ï¼Œå°†æœ¬åœ°ä»“åº“ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“</p><p>pullï¼šæ‹‰å–ï¼Œä¸‹è½½è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°ä»“åº“</p></blockquote><h2 id="é¦–å…ˆ"><a href="#é¦–å…ˆ" class="headerlink" title="é¦–å…ˆ"></a>é¦–å…ˆ</h2><p>å®‰è£…å®Œgitåï¼Œé¦–å…ˆè¦åšçš„å°±æ˜¯é…ç½®ä½ çš„ç”¨æˆ·åå’Œemailåœ°å€ã€‚</p><p>å‘½ä»¤ï¼š</p><blockquote><p>git config â€“global user.name â€œ***â€</p><p>git config â€“global user.email â€œ***â€</p></blockquote><p>æŸ¥çœ‹é…ç½®ä¿¡æ¯</p><blockquote><p>git config â€“list</p></blockquote><h2 id="æœ¬åœ°åˆå§‹åŒ–ä»“åº“"><a href="#æœ¬åœ°åˆå§‹åŒ–ä»“åº“" class="headerlink" title="æœ¬åœ°åˆå§‹åŒ–ä»“åº“"></a>æœ¬åœ°åˆå§‹åŒ–ä»“åº“</h2><h3 id="æ–¹æ³•ä¸€ï¼š"><a href="#æ–¹æ³•ä¸€ï¼š" class="headerlink" title="æ–¹æ³•ä¸€ï¼š"></a>æ–¹æ³•ä¸€ï¼š</h3><p>æœ¬åœ°è¿è¡Œ</p><blockquote><p>git init</p></blockquote><h3 id="æ–¹æ³•äºŒï¼š"><a href="#æ–¹æ³•äºŒï¼š" class="headerlink" title="æ–¹æ³•äºŒï¼š"></a>æ–¹æ³•äºŒï¼š</h3><p>é€šè¿‡å‘½ä»¤å…‹éš†å·²æœ‰ä»“åº“</p><blockquote><p>git clone + â€œåœ°å€â€</p></blockquote><h2 id="å·¥ä½œåŒºï¼Œæš‚å­˜åŒºï¼Œç‰ˆæœ¬åº“"><a href="#å·¥ä½œåŒºï¼Œæš‚å­˜åŒºï¼Œç‰ˆæœ¬åº“" class="headerlink" title="å·¥ä½œåŒºï¼Œæš‚å­˜åŒºï¼Œç‰ˆæœ¬åº“"></a>å·¥ä½œåŒºï¼Œæš‚å­˜åŒºï¼Œç‰ˆæœ¬åº“</h2><p>ç‰ˆæœ¬åº“ï¼šå°±æ˜¯æˆ‘ä»¬æœ¬åœ°ç›®å½•ä¸­çš„.gitæ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†å¾ˆå¤šé…ç½®ä¿¡æ¯ï¼Œæ—¥å¿—ï¼Œå’Œæ–‡ä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼ˆä¸è¦åŠ¨ï¼‰</p><p>å·¥ä½œåŒºï¼šåŒ…å«.gitçš„æ–‡ä»¶ç›®å½•</p><p>æš‚å­˜åŒºï¼šä½äº.gitçš„indexä¸‹ï¼Œç”¨äºä¸´æ—¶ä¿å­˜ä¿®æ”¹æ–‡ä»¶</p><h2 id="æ–‡ä»¶çš„ä¸¤ç§çŠ¶æ€"><a href="#æ–‡ä»¶çš„ä¸¤ç§çŠ¶æ€" class="headerlink" title="æ–‡ä»¶çš„ä¸¤ç§çŠ¶æ€"></a>æ–‡ä»¶çš„ä¸¤ç§çŠ¶æ€</h2><ul><li>untrackedæœªè·Ÿè¸ªï¼ˆæœªçº³å…¥ç‰ˆæœ¬æ§åˆ¶ï¼‰(gitä¸ä¼šç®¡ç†è¯¥æ–‡ä»¶)</li><li>trackedå·²è·Ÿè¸ª</li></ul><ol><li>unmodified æœªä¿®æ”¹</li><li>modifiedå·²ä¿®æ”¹</li><li>stagedæš‚å­˜</li></ol><h2 id="Gitå¸¸ç”¨å‘½ä»¤"><a href="#Gitå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Gitå¸¸ç”¨å‘½ä»¤"></a>Gitå¸¸ç”¨å‘½ä»¤</h2><h3 id="æœ¬åœ°æ“ä½œ"><a href="#æœ¬åœ°æ“ä½œ" class="headerlink" title="æœ¬åœ°æ“ä½œ"></a>æœ¬åœ°æ“ä½œ</h3><blockquote><p>git statusæŸ¥çœ‹æ–‡ä»¶çŠ¶æ€ï¼ˆçœ‹æ–‡ä»¶æ˜¯å¦è¢«è·Ÿè¸ªï¼‰</p><p>git addå°†ä¿®æ”¹åŠ å…¥æš‚å­˜åŒº</p><p>git reset  å–æ¶ˆæš‚å­˜æˆ–è€…åˆ‡æ¢åˆ°æŒ‡å®šç‰ˆæœ¬</p><p>git commit  æäº¤æš‚å­˜åŒºæ–‡ä»¶åˆ°ç‰ˆæœ¬åº“</p><p>git log  æ—¥å¿—</p></blockquote><h3 id="è¿œç¨‹ä»“åº“æ“ä½œ"><a href="#è¿œç¨‹ä»“åº“æ“ä½œ" class="headerlink" title="è¿œç¨‹ä»“åº“æ“ä½œ"></a>è¿œç¨‹ä»“åº“æ“ä½œ</h3><blockquote><p>git remoteæŸ¥çœ‹è¿œç¨‹ä»“åº“</p><p>git remote add æ·»åŠ è¿œç¨‹ä»“åº“ï¼ˆå¦‚æœæ˜¯ä»å·²æœ‰ä»“åº“å…‹éš†ï¼Œåˆ™æœ¬åœ°ä»“åº“è‡ªåŠ¨å…³è”è¿œç¨‹ï¼Œå¦‚æœæ˜¯æœ¬åœ°initï¼Œåˆ™éœ€è¦æ·»åŠ  æ ¼å¼ï¼šgit remote add origin + åœ°å€ï¼‰</p><p>git clone     ä»è¿œç¨‹ä»“åº“å…‹éš†</p><p>git pullä»è¿œç¨‹ä»“åº“æ‹‰å–</p><p>git push  æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆgit push origin masterï¼‰</p></blockquote><p>æ³¨æ„ï¼šgit pullè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæœ¬åœ°initçš„ä»“åº“é€šè¿‡addå…³è”è¿œç¨‹ï¼Œç„¶åpullè¿œç¨‹ä»“åº“ï¼Œå¦‚æœæœ¬åœ°initçš„ä»“åº“å·²ç»å­˜åœ¨æ–‡ä»¶ï¼Œé‚£ä¹ˆæ‹‰å–æ—¶ä¼šæŠ¥é”™ï¼Œè§£å†³æ–¹æ³•ï¼šåœ¨git pull ååŠ â€“allow-unrelated-histories</p><h3 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h3><p>é»˜è®¤master</p><blockquote><p>git branchæŸ¥çœ‹åˆ†æ”¯</p><p>git branch nameåˆ›å»ºåˆ†æ”¯</p><p>git checkout nameåˆ‡æ¢åˆ†æ”¯</p><p>git push origin nameæ¨é€åˆ°originçš„nameåˆ†æ”¯ä¸Š</p><p>git merge nameåˆå¹¶åˆ†æ”¯</p></blockquote><h3 id="å†²çªè§£å†³"><a href="#å†²çªè§£å†³" class="headerlink" title="å†²çªè§£å†³"></a>å†²çªè§£å†³</h3><p>å†²çªåŸå› ï¼šä¸¤ä¸ªåˆ†æ”¯ä¿®æ”¹äº†åŒä¸ªæ–‡ä»¶çš„åŒä¸€ä½ç½®</p><ol><li>æ‰¾åˆ°å†²çªæ–‡ä»¶</li><li>ä¿®æ”¹å†²çªä½ç½®ï¼ˆç•™å“ªä¸€æ®µï¼‰</li><li>ä¿å­˜</li><li>git add + å†²çªæ–‡ä»¶</li><li>git commit -m  -i</li></ol><p>é¿å…å†²çªï¼šåŠæ—¶git pullæ‹‰å–æœ€æ–°ä»“åº“</p><h3 id="æ ‡ç­¾"><a href="#æ ‡ç­¾" class="headerlink" title="æ ‡ç­¾"></a>æ ‡ç­¾</h3><p>å¯ä»¥çœ‹åšç‰ˆæœ¬å·</p><p>å‘½ä»¤</p><blockquote><p>git tagåˆ—å‡ºå·²æœ‰æ ‡ç­¾</p><p>git tag nameåˆ›å»ºæ ‡ç­¾</p><p>git push origin æ ‡ç­¾åæ¨é€æ ‡ç­¾</p><p>git checkout -b â€œbranchâ€ â€œnameâ€ æ£€å‡ºæ ‡ç­¾ï¼ˆbranchåéšä¾¿ï¼Œå®ƒå°†ä½œä¸ºä½ æ£€å‡ºæ ‡ç­¾åå­˜æ”¾çš„åˆ†æ”¯åï¼Œæ£€å‡ºå’Œç‰ˆæœ¬å›é€€å·®ä¸å¤šï¼‰</p></blockquote><p>æ ‡ç­¾å’Œåˆ†æ”¯å·®åˆ«ï¼šæ ‡ç­¾æ˜¯é™æ€çš„ï¼Œä»–ä¼šæ°¸è¿œç¡®è®¤ä¸€ä¸ªä»“åº“çš„çŠ¶æ€ï¼›åˆ†æ”¯æ˜¯åŠ¨æ€çš„</p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£é˜¶æ®µæ€§æ€»ç»“ï¼ˆ1~30ï¼‰</title>
      <link href="/2023/11/14/%E5%8A%9B%E6%89%A3%E9%98%B6%E6%AE%B5%E6%80%A7%E6%80%BB%E7%BB%93%EF%BC%881-30%EF%BC%89/"/>
      <url>/2023/11/14/%E5%8A%9B%E6%89%A3%E9%98%B6%E6%AE%B5%E6%80%A7%E6%80%BB%E7%BB%93%EF%BC%881-30%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ·é¢˜é˜¶æ®µæ€§å›é¡¾ï¼ˆDay1-30ï¼‰"><a href="#åˆ·é¢˜é˜¶æ®µæ€§å›é¡¾ï¼ˆDay1-30ï¼‰" class="headerlink" title="åˆ·é¢˜é˜¶æ®µæ€§å›é¡¾ï¼ˆDay1~30ï¼‰"></a>åˆ·é¢˜é˜¶æ®µæ€§å›é¡¾ï¼ˆDay1~30ï¼‰</h1><h2 id="Day1åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„"><a href="#Day1åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„" class="headerlink" title="Day1åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„"></a>Day1<a href="https://leetcode.cn/problems/merge-sorted-array/">åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</a></h2><p>é¢˜ç›®ï¼šç»™ä½ ä¸¤ä¸ªæŒ‰ <strong>éé€’å‡é¡ºåº</strong> æ’åˆ—çš„æ•´æ•°æ•°ç»„ <code>nums1</code> å’Œ <code>nums2</code>ï¼Œå¦æœ‰ä¸¤ä¸ªæ•´æ•° <code>m</code> å’Œ <code>n</code> ï¼Œåˆ†åˆ«è¡¨ç¤º <code>nums1</code> å’Œ <code>nums2</code> ä¸­çš„å…ƒç´ æ•°ç›®ã€‚</p><p>è¯·ä½  <strong>åˆå¹¶</strong> <code>nums2</code> åˆ° <code>nums1</code> ä¸­ï¼Œä½¿åˆå¹¶åçš„æ•°ç»„åŒæ ·æŒ‰ <strong>éé€’å‡é¡ºåº</strong> æ’åˆ—ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>æœ€ç»ˆï¼Œåˆå¹¶åæ•°ç»„ä¸åº”ç”±å‡½æ•°è¿”å›ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨æ•°ç»„ <code>nums1</code> ä¸­ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼Œ<code>nums1</code> çš„åˆå§‹é•¿åº¦ä¸º <code>m + n</code>ï¼Œå…¶ä¸­å‰ <code>m</code> ä¸ªå…ƒç´ è¡¨ç¤ºåº”åˆå¹¶çš„å…ƒç´ ï¼Œå <code>n</code> ä¸ªå…ƒç´ ä¸º <code>0</code> ï¼Œåº”å¿½ç•¥ã€‚<code>nums2</code> çš„é•¿åº¦ä¸º <code>n</code> ã€‚</p><p>å›é¡¾è§£è¯»ï¼š<br>æœ¬é¢˜å…³é”®å°±æ˜¯åˆå¹¶åçš„æ•°ç»„ä¹Ÿæ˜¯æœ‰åºçš„ï¼Œé¡¾è®¾ä¸¤ä¸ªæŒ‡é’ˆi,jåˆ†åˆ«ç”¨æ¥éå†nums1å’Œnums2,å°†å…¶ä¸­çš„è¾ƒå°ï¼ˆæˆ–å¤§ï¼‰è€…æ’å…¥åˆ°æ–°æ•°ç»„ä¸­ï¼ŒåŒæ—¶åšæ’å…¥çš„æ•°ç»„æŒ‡é’ˆè¿›è¡Œç§»åŠ¨ï¼Œä¸åšæ’å…¥çš„ä¸ç§»åŠ¨ã€‚</p><p>æœ‰ä¸ªå…³é”®å°±æ˜¯ï¼Œåœ¨å¾ªç¯ç»“æŸåï¼Œå¯èƒ½ä¼šå­˜åœ¨æŸä¸ªæ•°ç»„ä¸­çš„å€¼è¿˜æœ‰å‰©ä½™ï¼Œæ­¤æ—¶éœ€è¦å†è®¾ç½®å¾ªç¯ï¼Œå°†å‰©ä½™çš„å€¼æ’å…¥çš„æ–°æ•°ç»„ä¸­ã€‚</p><p>æ”¶è·ï¼š</p><p>vectoræ•°ç»„çš„åˆ›å»ºæ–¹æ³•ï¼švector<int> nums(m + n);</p><h2 id="Day2ç§»é™¤å…ƒç´ "><a href="#Day2ç§»é™¤å…ƒç´ " class="headerlink" title="Day2ç§»é™¤å…ƒç´ "></a>Day2<a href="https://leetcode.cn/problems/remove-element/">ç§»é™¤å…ƒç´ </a></h2><p>é¢˜ç›®ï¼šç»™ä½ ä¸€ä¸ªæ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªå€¼ <code>val</code>ï¼Œä½ éœ€è¦ <strong><a href="https://baike.baidu.com/item/%E5%8E%9F%E5%9C%B0%E7%AE%97%E6%B3%95">åŸåœ°</a></strong> ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº <code>val</code> çš„å…ƒç´ ï¼Œå¹¶è¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p><p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»ä»…ä½¿ç”¨ <code>O(1)</code> é¢å¤–ç©ºé—´å¹¶ <strong><a href="https://baike.baidu.com/item/%E5%8E%9F%E5%9C%B0%E7%AE%97%E6%B3%95">åŸåœ° </a>ä¿®æ”¹è¾“å…¥æ•°ç»„</strong>ã€‚</p><p>å…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</p><p>å›é¡¾è§£è¯»ï¼š<br>é¢˜ç›®è¦æ±‚åŸåœ°ç§»é™¤ï¼Œå¹¶ä¸”è¡¥å……ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚å¾ˆæ˜¾ç„¶æ˜¯è®©æˆ‘ä»¬é€šè¿‡æŠŠévalçš„æ•°ç§»åˆ°åˆ°valå¤„ï¼Œæœ€ç»ˆå®ç°æ•°ç»„å°¾éƒ¨éƒ½æ˜¯valçš„ç»“æœã€‚</p><p>æˆ‘çš„æ€è·¯éå†æ•°ç»„ï¼Œé‡åˆ°valçš„æ—¶å€™å°±è¿›è¡Œå¾ªç¯ä»valåç¬¬nä¸ªå…ƒç´ å¼€å§‹åˆ¤æ–­ï¼Œæ˜¯å¦æ˜¯valï¼Œæ˜¯nå°±è‡ªå¢ï¼Œä¸æ˜¯åˆ™äº¤æ¢ï¼ˆå®é™…ä¸Šèµ‹å€¼ä¹Ÿå¯ä»¥ï¼‰ã€‚nè®¾ç½®çš„æ˜¯ä¸€ä¸ªä¸ä¼šé‡ç½®çš„å˜é‡ï¼Œå› ä¸ºä¸€æ—¦valè¿ç»­å‡ºç°ï¼Œä¸”æœ€ç»ˆæˆ‘ä»¬ä¼šæŠŠé‡åˆ°çš„ç¬¬ä¸€ä¸ªévalçš„æ•°æ¢åˆ°iå¤„ï¼Œæ‰€ä»¥nçš„å€¼ä¼šæ°¸ä¹…å˜å¤§ï¼Œç„¶ååœ¨æ¯æ¬¡å¾€åæ‰¾évalçš„æ•°æ—¶ï¼Œiå’Œnä¸­é—´çš„å°±æ²¡å¿…è¦å†éå†äº†ï¼Œå› ä¸ºè‚¯å®šéƒ½æ˜¯valï¼Œè¿™ä¸ªè§£é¢˜æ€è·¯è¦ä¼˜äºåŠ›æ‰£å®˜æ–¹ç»™å‡ºçš„é¢˜è§£ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³•æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day34</title>
      <link href="/2023/11/13/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day34/"/>
      <url>/2023/11/13/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day34/</url>
      
        <content type="html"><![CDATA[<p><em><u>è·³è„±å¸¸è§„æ¿€å‘æ›´å¤šçš„åˆ›é€ åŠ›ï¼ŒåŒæ—¶å¯ä»¥é€ å°±ä¸å‡¡çš„æˆåŠŸã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/rotate-image/">æ—‹è½¬å›¾åƒ</a></p><p>ç»™å®šä¸€ä¸ª <em>n</em> Ã— <em>n</em> çš„äºŒç»´çŸ©é˜µ <code>matrix</code> è¡¨ç¤ºä¸€ä¸ªå›¾åƒã€‚è¯·ä½ å°†å›¾åƒé¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦ã€‚</p><p>ä½ å¿…é¡»åœ¨**<a href="https://baike.baidu.com/item/%E5%8E%9F%E5%9C%B0%E7%AE%97%E6%B3%95"> åŸåœ°</a>** æ—‹è½¬å›¾åƒï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦ç›´æ¥ä¿®æ”¹è¾“å…¥çš„äºŒç»´çŸ©é˜µã€‚<strong>è¯·ä¸è¦</strong> ä½¿ç”¨å¦ä¸€ä¸ªçŸ©é˜µæ¥æ—‹è½¬å›¾åƒã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; matrix)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = matrix.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n / <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; (n + <span class="number">1</span>) / <span class="number">2</span>; j++) &#123;</span><br><span class="line">                <span class="type">int</span> tmp = matrix[i][j];</span><br><span class="line">                matrix[i][j] = matrix[n - <span class="number">1</span> - j][i];</span><br><span class="line">                matrix[n - <span class="number">1</span> - j][i] = matrix[n - <span class="number">1</span> - i][n - <span class="number">1</span> - j];</span><br><span class="line">                matrix[n - <span class="number">1</span> - i][n - <span class="number">1</span> - j] = matrix[j][n - <span class="number">1</span> - i];</span><br><span class="line">                matrix[j][n - <span class="number">1</span> - i] = tmp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311131957045.png" alt="image-20231113195754992"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>é¢˜ç›®è¦æ±‚æˆ‘ä»¬åŸåœ°æ—‹è½¬ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡æ‰¾è§„å¾‹æ¥å®ç°ï¼Œæœ‰å¦‚ä¸‹è§„å¾‹ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311131958884.png" alt="image-20231113195857844"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311132001389.png" alt="image-20231113200128356"></p><p>æ¯æ¬¡æŒ‰ä»¥ä¸Šè§„å¾‹äº¤æ¢å³å¯ã€‚</p><p>è¿™ä¸ªæ€è·¯æ¯”è¾ƒéš¾æƒ³ï¼Œè¿™é‡Œå†è´´ä¸€ä»½ç”¨åˆ°é¢å¤–ç©ºé—´çš„,</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; matrix)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = matrix.<span class="built_in">size</span>();</span><br><span class="line">        <span class="comment">// æ·±æ‹·è´ matrix -&gt; tmp</span></span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; tmp = matrix;</span><br><span class="line">        <span class="comment">// æ ¹æ®å…ƒç´ æ—‹è½¬å…¬å¼ï¼Œéå†ä¿®æ”¹åŸçŸ©é˜µ matrix çš„å„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                matrix[j][n - <span class="number">1</span> - i] = tmp[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day33</title>
      <link href="/2023/11/12/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day33/"/>
      <url>/2023/11/12/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day33/</url>
      
        <content type="html"><![CDATA[<p><em><u>æˆåŠŸçš„äººä¸»å®°æ—¶é—´ï¼Œå¤±è´¥çš„äººè¢«æ—¶é—´ä¸»å®°ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/spiral-matrix/">èºæ—‹çŸ©é˜µ</a></p><p>ç»™ä½ ä¸€ä¸ª <code>m</code> è¡Œ <code>n</code> åˆ—çš„çŸ©é˜µ <code>matrix</code> ï¼Œè¯·æŒ‰ç…§ <strong>é¡ºæ—¶é’ˆèºæ—‹é¡ºåº</strong> ï¼Œè¿”å›çŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">spiralOrder</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; matrix)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">        <span class="keyword">if</span> (matrix.<span class="built_in">empty</span>()) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        <span class="type">int</span> top = <span class="number">0</span>, left = <span class="number">0</span>,right = matrix[<span class="number">0</span>].<span class="built_in">size</span>()<span class="number">-1</span>,bottom = matrix.<span class="built_in">size</span>()<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> l = left;l&lt;=right;l++)&#123;</span><br><span class="line">                res.<span class="built_in">push_back</span>(matrix[top][l]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(++top &gt; bottom) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> l = top;l&lt;=bottom;l++)&#123;</span><br><span class="line">                res.<span class="built_in">push_back</span>(matrix[l][right]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(--right &lt; left) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> l = right;l&gt;=left;l--)&#123;</span><br><span class="line">                res.<span class="built_in">push_back</span>(matrix[bottom][l]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(--bottom &lt; top) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> l = bottom;l&gt;=top;l--)&#123;</span><br><span class="line">                res.<span class="built_in">push_back</span>(matrix[l][left]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(++left &gt; right) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311122137449.png" alt="image-20231112213733403"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>ç»å…¸é¢˜ç›®ï¼Œåˆšå¼€å§‹åšçš„æ—¶å€™é™·å…¥äº†å¾ˆå¤šè¯¯åŒºï¼Œæ¯”å¦‚è®¾è®¡ä¸€ä¸ªnæ¥ç»Ÿè®¡åœˆæ•°ï¼ˆç”¨æ¥æ§åˆ¶è¾¹ç•Œï¼‰ï¼Œç»•äº†å¾ˆå¤šè·¯ã€‚</p><p>è§£æ³•ï¼š<br>å…ˆå®šä¹‰å¥½ä¸Šï¼Œä¸‹ï¼Œå·¦ï¼Œå³å››ä¸ªè¾¹ç•Œï¼Œç„¶ååœ¨è¿›è¡Œå®Œæ¯ä¸€æ¬¡éå†åï¼ˆä»å·¦åˆ°å³ï¼Œä¸Šåˆ°ä¸‹ï¼Œå³åˆ°å·¦ï¼Œä¸‹åˆ°ä¸Šï¼‰ï¼Œéƒ½è®©è¾¹ç•Œå†…æ•›ä¸€ä¸ªå•ä½ï¼Œè¿™æ ·å°±èƒ½å®ç°æ§åˆ¶è¾¹ç•Œï¼Œå½“è¾¹ç•Œäº¤å‰æ—¶ï¼Œè¯´æ˜ç»“æŸã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day32</title>
      <link href="/2023/11/11/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day32/"/>
      <url>/2023/11/11/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day32/</url>
      
        <content type="html"><![CDATA[<p><em><u>ç”Ÿå‘½çŸ­æš‚ï¼Œè€Œä½ å¯ä»¥å†³å®šè®©å®ƒæ´»å‡ºç¿çƒ‚ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/valid-sudoku/">æœ‰æ•ˆçš„æ•°ç‹¬</a></p><p>è¯·ä½ åˆ¤æ–­ä¸€ä¸ª <code>9 x 9</code> çš„æ•°ç‹¬æ˜¯å¦æœ‰æ•ˆã€‚åªéœ€è¦ <strong>æ ¹æ®ä»¥ä¸‹è§„åˆ™</strong> ï¼ŒéªŒè¯å·²ç»å¡«å…¥çš„æ•°å­—æ˜¯å¦æœ‰æ•ˆå³å¯ã€‚</p><ol><li>æ•°å­— <code>1-9</code> åœ¨æ¯ä¸€è¡Œåªèƒ½å‡ºç°ä¸€æ¬¡ã€‚</li><li>æ•°å­— <code>1-9</code> åœ¨æ¯ä¸€åˆ—åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚</li><li>æ•°å­— <code>1-9</code> åœ¨æ¯ä¸€ä¸ªä»¥ç²—å®çº¿åˆ†éš”çš„ <code>3x3</code> å®«å†…åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚ï¼ˆè¯·å‚è€ƒç¤ºä¾‹å›¾ï¼‰</li></ol><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isValidSudoku</span><span class="params">(vector&lt;vector&lt;<span class="type">char</span>&gt;&gt;&amp; board)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¯·ä½ åˆ¤æ–­ä¸€ä¸ª 9 x 9 çš„æ•°ç‹¬æ˜¯å¦æœ‰æ•ˆã€‚åªéœ€è¦ æ ¹æ®ä»¥ä¸‹è§„åˆ™ ï¼ŒéªŒè¯å·²ç»å¡«å…¥çš„æ•°å­—æ˜¯å¦æœ‰æ•ˆå³å¯ã€‚</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•°å­— 1-9 åœ¨æ¯ä¸€è¡Œåªèƒ½å‡ºç°ä¸€æ¬¡ã€‚</span></span><br><span class="line">        <span class="comment">// æ•°å­— 1-9 åœ¨æ¯ä¸€åˆ—åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚</span></span><br><span class="line">        <span class="comment">// æ•°å­— 1-9 åœ¨æ¯ä¸€ä¸ªä»¥ç²—å®çº¿åˆ†éš”çš„ 3x3 å®«å†…åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚ï¼ˆè¯·å‚è€ƒç¤ºä¾‹å›¾ï¼‰</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> row[<span class="number">9</span>][<span class="number">9</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">int</span> col[<span class="number">9</span>][<span class="number">9</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">int</span> box[<span class="number">9</span>][<span class="number">9</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">9</span>; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(board[i][j] == <span class="string">&#x27;.&#x27;</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> num = board[i][j] - <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">                <span class="keyword">if</span>(row[i][num]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">if</span>(col[j][num]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">if</span>(box[i/<span class="number">3</span>*<span class="number">3</span>+j/<span class="number">3</span>][num]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">                row[i][num] = <span class="number">1</span>;</span><br><span class="line">                col[j][num] = <span class="number">1</span>;</span><br><span class="line">                box[i/<span class="number">3</span>*<span class="number">3</span>+j/<span class="number">3</span>][num] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311111855116.png" alt="image-20231111185538069"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>ç®€å•çš„æš´åŠ›ç®—æ³•ï¼Œè®¾ç½®ä¸‰ä¸ª9*9çš„æ•°ç»„åˆ†åˆ«è®°å½•ä¸‹æ¯è¡Œæ¯åˆ—æ¯å—ï¼ˆ9x9ï¼‰ä¸­ï¼Œæ•°å­—æ˜¯å¦å‡ºç°è¿‡ï¼Œç„¶åä»å¤´éå†è¯¥äºŒç»´æ•°ç»„ï¼Œç»è¿‡int num &#x3D; boardij - â€˜1â€™ï¼Œå°†charè½¬int,åˆ†åˆ«åˆ¤æ–­ï¼š</p><blockquote><pre><code>            if(row[i][num]) return false;  //æ¡ä»¶1            if(col[j][num]) return false;  //æ¡ä»¶2            if(box[i/3*3+j/3][num]) return false; //æ¡ä»¶3</code></pre></blockquote><p>å…¶å®åˆ·äº†ä¸€äº›æ—¥å­çš„é¢˜ï¼Œæˆ‘å‘ç°è‡ªå·±çš„æ€æƒ³å‘ç”Ÿäº†æ”¹å˜ã€‚çœ‹åˆ°é¢˜çš„ç¬¬ä¸€çœ¼ï¼Œæˆ‘æ€»æ˜¯ä¼šä¸‹æ„è¯†å¦è®¤æ‰é‚£äº›â€œæš´åŠ›è§£æ³•â€ï¼Œå› ä¸ºæˆ‘è®¤ä¸ºå®ƒä»¬å¤ªç®€å•ï¼Œå ç”¨èµ„æºå¤ªå¤šäº†ï¼Œå¦‚æœæäº¤ä¸Šå»å¾ˆå®¹æ˜“å‡ºç°è¶…æ—¶ä¹‹ç±»çš„ã€‚ä½†æ˜¯å¾ˆéš¾å¦è®¤ï¼Œçœ‹èµ·æ¥å›°éš¾çš„é¢˜ï¼Œä»–çš„æœ€ä¼˜è§£æ³•å¾€å¾€å°±æ˜¯æš´åŠ›ç®—æ³•ï¼Œç›´æ¥ç›´å»ã€‚å¦‚æœä¸€ä¸ªé¢˜ï¼Œæš´åŠ›ç®—æ³•éƒ½æ²¡æœ‰æ€è·¯çš„è¯ï¼Œé‚£å°±æ²¡èµ„æ ¼å»æ€è€ƒæ›´ä¼˜çš„æ–¹æ³•ï¼Œæˆ‘ä¹‹åä¼šå…ˆæ€è€ƒæ¯ä¸€é¢˜çš„æš´åŠ›ç®—æ³•ï¼Œç„¶åè¿›è¡Œä¼˜åŒ–ï¼Œè¿™æ˜¯æˆ‘æœ€è¿‘é†’æ‚Ÿåˆ°çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day31</title>
      <link href="/2023/11/09/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day31/"/>
      <url>/2023/11/09/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day31/</url>
      
        <content type="html"><![CDATA[<p><u><em>æ²¡æœ‰ä»€ä¹ˆæ˜¯ä¸å¯èƒ½çš„ ; è¿™ä¸ªè¯æœ¬æ„å°±æ˜¯â€œæˆ‘æœ‰ä¸€åˆ‡å¯èƒ½â€ ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/substring-with-concatenation-of-all-words/">ä¸²è”æ‰€æœ‰å•è¯çš„å­ä¸²</a></p><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> å’Œä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ <code>words</code><strong>ã€‚</strong> <code>words</code> ä¸­æ‰€æœ‰å­—ç¬¦ä¸² <strong>é•¿åº¦ç›¸åŒ</strong>ã€‚</p><p> <code>s</code> ä¸­çš„ <strong>ä¸²è”å­ä¸²</strong> æ˜¯æŒ‡ä¸€ä¸ªåŒ…å« <code>words</code> ä¸­æ‰€æœ‰å­—ç¬¦ä¸²ä»¥ä»»æ„é¡ºåºæ’åˆ—è¿æ¥èµ·æ¥çš„å­ä¸²ã€‚</p><ul><li>ä¾‹å¦‚ï¼Œå¦‚æœ <code>words = [&quot;ab&quot;,&quot;cd&quot;,&quot;ef&quot;]</code>ï¼Œ é‚£ä¹ˆ <code>&quot;abcdef&quot;</code>ï¼Œ <code>&quot;abefcd&quot;</code>ï¼Œ<code>&quot;cdabef&quot;</code>ï¼Œ <code>&quot;cdefab&quot;</code>ï¼Œ<code>&quot;efabcd&quot;</code>ï¼Œ å’Œ <code>&quot;efcdab&quot;</code> éƒ½æ˜¯ä¸²è”å­ä¸²ã€‚ <code>&quot;acdbef&quot;</code> ä¸æ˜¯ä¸²è”å­ä¸²ï¼Œå› ä¸ºä»–ä¸æ˜¯ä»»ä½• <code>words</code> æ’åˆ—çš„è¿æ¥ã€‚</li></ul><p>è¿”å›æ‰€æœ‰ä¸²è”å­ä¸²åœ¨ <code>s</code> ä¸­çš„å¼€å§‹ç´¢å¼•ã€‚ä½ å¯ä»¥ä»¥ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç­”æ¡ˆã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">findSubstring</span><span class="params">(string s, vector&lt;string&gt;&amp; words)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(words.<span class="built_in">empty</span>()) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        unordered_map&lt;string,<span class="type">int</span>&gt; wordmap,smap;</span><br><span class="line">        <span class="keyword">for</span>(string word:words) wordmap[word]++;</span><br><span class="line">        <span class="type">int</span> wordlen = words[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> wordnum = words.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;wordlen;k++)&#123;</span><br><span class="line">            <span class="type">int</span> i=k,j=k;</span><br><span class="line">            <span class="keyword">while</span>(i&lt;s.<span class="built_in">size</span>()-wordnum*wordlen+<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">while</span>(j&lt;i+wordnum*wordlen)&#123;</span><br><span class="line">                    string temp = s.<span class="built_in">substr</span>(j,wordlen);</span><br><span class="line">                    smap[temp]++;</span><br><span class="line">                    j+=wordlen;</span><br><span class="line">                    <span class="keyword">if</span>(wordmap[temp]==<span class="number">0</span>)&#123;<span class="comment">//æƒ…å†µäºŒï¼Œæœ‰wordsä¸­ä¸å­˜åœ¨çš„å•è¯</span></span><br><span class="line">                        i=j;<span class="comment">//å¯¹iåŠ é€Ÿ</span></span><br><span class="line">                        smap.<span class="built_in">clear</span>();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(smap[temp]&gt;wordmap[temp])&#123;<span class="comment">//æƒ…å†µä¸‰ï¼Œå­ä¸²ä¸­tempæ•°é‡è¶…äº†</span></span><br><span class="line">                        <span class="keyword">while</span>(smap[temp]&gt;wordmap[temp])&#123;</span><br><span class="line">                            smap[s.<span class="built_in">substr</span>(i,wordlen)]--;</span><br><span class="line">                            i+=wordlen;<span class="comment">//å¯¹iåŠ é€Ÿ</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;                   </span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//æ­£ç¡®åŒ¹é…ï¼Œç”±äºæƒ…å†µäºŒå’Œä¸‰éƒ½å¯¹iåŠ é€Ÿäº†ï¼Œä¸å¯èƒ½æ»¡è¶³æ­¤æ¡ä»¶</span></span><br><span class="line">                <span class="keyword">if</span>(j==i+wordlen*wordnum)&#123;</span><br><span class="line">                    ans.<span class="built_in">push_back</span>(i);</span><br><span class="line">                    smap[s.<span class="built_in">substr</span>(i,wordlen)]--;</span><br><span class="line">                    i+=wordlen;<span class="comment">//iæ­£å¸¸å‰è¿›</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            smap.<span class="built_in">clear</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311091021172.png" alt="image-20231109102139114"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>å›°éš¾é¢˜ã€‚èŠ±äº†æˆ‘æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼ˆé¢˜è§£ä¹Ÿçœ‹äº†å¾ˆä¹…ï¼‰ï¼Œç®€å•è¯´ä¸€ä¸‹æ€è·¯ï¼šç”¨ä¸¤ä¸ªhashmapï¼ˆwordmap,smapï¼‰åˆ†åˆ«ç”¨æ¥å­˜æ”¾wordsä¸­çš„å•è¯å’Œå‡ºç°æ•°é‡ï¼Œä»¥åŠåœ¨çª—å£ä¸­çš„å•è¯ä»¥åŠå‡ºç°æ•°é‡ã€‚ç„¶åä¸‰å±‚å¾ªç¯ï¼šç¬¬ä¸€å±‚æ˜¯ç”¨æ¥ç¡®å®šæ»‘åŠ¨çª—å£çš„å‡ºå‘ç‚¹ï¼Œæ¥ä¿è¯èƒ½éå†åˆ°sçš„æ¯ä¸€ä¸ªå­ä¸²ï¼Œç¬¬äºŒã€ä¸‰å±‚å¾ªç¯ç”¨æ¥è¿›è¡Œçª—å£æ»‘åŠ¨ï¼Œiæ˜¯çª—å£å·¦è¾¹ç•Œï¼Œjä¸ºå³è¾¹ç•Œã€‚æ¯æ¬¡å–å³è¾¹ç•Œçš„ä¸€ä¸ªé•¿ä¸ºwordlençš„å•è¯è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœè¯¥å•è¯ä¸åœ¨wordmapï¼Œåˆ™å°†iåŠ é€Ÿåˆ°jçš„ä½ç½®ï¼ˆä¹‹å‰çª—å£å†…æ‰€æœ‰å•è¯éƒ½å¤±æ•ˆäº†ï¼‰ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯å•è¯åœ¨wordmapä½†æ˜¯æ•°é‡è¶…è¿‡äº†è§„å®šæ•°ï¼Œåˆ™iè¿›è¡Œå³ç§»ï¼ˆå°†ä¸€ä¸ªå•è¯ç§»å‡ºçª—å£ï¼‰ï¼Œè‹¥ä¸¤ç§æƒ…å†µéƒ½ä¸ç¬¦åˆï¼Œè¯´æ˜æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å­—ä¸²ï¼Œè®°å½•ä¸‹æ ‡iã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day30</title>
      <link href="/2023/11/04/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day30/"/>
      <url>/2023/11/04/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day30/</url>
      
        <content type="html"><![CDATA[<p><em><u>åœ¨æœ‰è¯´æœåŠ›çš„æ¼”è®²ï¼Œè®¯æ¯çš„ä¼ é€’ä¸æ˜¯ç”±å£åˆ°è€³ï¼Œè€Œæ˜¯ç”±å¿ƒåˆ°å¿ƒã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/longest-substring-without-repeating-characters/">æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a></p><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ <strong>æœ€é•¿å­ä¸²</strong> çš„é•¿åº¦ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">// &quot;abcabcbb&quot;</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> tag;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; s.<span class="built_in">length</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(tag = i; tag &lt; j; tag++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(s[tag] == s[j])&#123;</span><br><span class="line">                    i = tag + <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ans = ans &gt; (j - i + <span class="number">1</span>) ? ans : (j - i + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311041405503.png" alt="image-20231104140551457"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>æœ¬æ¥æƒ³æ˜¯å…ˆç”¨æš´åŠ›æ³•åšä¸€åšï¼Œçœ‹çœ‹è¯„åˆ†å¦‚ä½•ï¼Œæ²¡æƒ³åˆ°è¿˜ä¸é”™ï¼Œæ‰€ä»¥ç›´æ¥æš´åŠ›æ³•ç§’äº†ã€‚åŸç†å³jæŒ‡é’ˆæ¯ç§»åŠ¨ä¸€æ¬¡å°±å›å¤´çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰é‡å¤çš„ï¼Œæœ‰çš„è¯å°†iç§»åˆ°é‡å¤å…ƒç´ çš„ä¸‹ä¸€ä½ï¼Œç„¶åé‡æ–°æ‰¾ã€‚æ¯æ¬¡å¾ªç¯åæ›´æ–°ansçš„å¤§å°ã€‚</p><p>æ³¨æ„ï¼š</p><p>â€œpwwkewâ€ä»–çš„æœ€é•¿æ— é‡å¤å­ä¸²é•¿ä¸ºâ€œwkeâ€3ä½ï¼Œè€Œä¸æ˜¯â€pwkeâ€œï¼Œè¿™æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œè€Œä¸æ˜¯å­ä¸²ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day29ï¼ˆæ»‘åŠ¨çª—å£ï¼‰</title>
      <link href="/2023/11/02/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day29/"/>
      <url>/2023/11/02/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day29/</url>
      
        <content type="html"><![CDATA[<p><u><em>æ°¸è¿œæ— æ³•ä¿è¯æœ‰äººä¼šå–œæ¬¢ä½ ã€‚ æ‰€ä»¥å¦‚æœæœ‰äººå–œæ¬¢ä½ ï¼Œä½ å°±å·²ç»èµ¢äº†ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/minimum-size-subarray-sum/">é•¿åº¦æœ€å°çš„å­æ•°ç»„</a></p><p>ç»™å®šä¸€ä¸ªå«æœ‰ <code>n</code> ä¸ªæ­£æ•´æ•°çš„æ•°ç»„å’Œä¸€ä¸ªæ­£æ•´æ•° <code>target</code> <strong>ã€‚</strong></p><p>æ‰¾å‡ºè¯¥æ•°ç»„ä¸­æ»¡è¶³å…¶æ€»å’Œå¤§äºç­‰äº <code>target</code> çš„é•¿åº¦æœ€å°çš„ <strong>è¿ç»­å­æ•°ç»„</strong> <code>[numsl, numsl+1, ..., numsr-1, numsr]</code> ï¼Œå¹¶è¿”å›å…¶é•¿åº¦<strong>ã€‚</strong>å¦‚æœä¸å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„å­æ•°ç»„ï¼Œè¿”å› <code>0</code> ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minSubArrayLen</span><span class="params">(<span class="type">int</span> target, vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> ans = INT_MAX;</span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; nums.<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            sum += nums[j];</span><br><span class="line">            <span class="keyword">while</span>(sum &gt;= target)&#123;</span><br><span class="line">                ans = (j - i + <span class="number">1</span>) &gt; ans ? ans : (j - i + <span class="number">1</span>);</span><br><span class="line">                sum -= nums[i++];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(ans == INT_MAX) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ans;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311022117220.png" alt="image-20231102211703168"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>æ»‘åŠ¨çª—å£æ–¹æ³•ï¼š</p><blockquote><p>ä»¥ä¸‹æ€è·¯æ˜¯æ¯”è¾ƒå½¢è±¡çš„æ»‘åŠ¨çª—å£é—®é¢˜çš„è§£é¢˜æ­¥éª¤ï¼Œä½†æœ‰äº›é¢˜ç›®æ‰¾åˆ°çª—å£é™å®šæ¯”è¾ƒéšæ™¦ï¼Œéœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼š</p><p>ï¼ˆ1ï¼‰åˆå§‹åŒ–çª—å£ï¼š<br>åˆå§‹åŒ–å·¦å³è¾¹ç•Œ left &#x3D; right &#x3D; 0ï¼ŒæŠŠç´¢å¼•é—­åŒºé—´ [left, right] ç§°ä¸ºä¸€ä¸ªã€Œçª—å£ã€ã€‚</p><p>ï¼ˆ2ï¼‰å¯»æ‰¾å¯è¡Œè§£ï¼š<br>æˆ‘ä»¬å…ˆä¸æ–­åœ°å¢åŠ  right æŒ‡é’ˆæ‰©å¤§çª—å£ [left, right]ï¼Œç›´åˆ°çª—å£ä¸­çš„æ»¡è¶³å¯è¡Œè§£ã€‚</p><p>ï¼ˆ3ï¼‰ä¼˜åŒ–å¯è¡Œè§£ï¼š<br>æ­¤æ—¶ï¼Œæˆ‘ä»¬åœæ­¢å¢åŠ  rightï¼Œè½¬è€Œä¸æ–­å¢åŠ  left æŒ‡é’ˆç¼©å°çª—å£ [left, right]ï¼Œç›´åˆ°çª—å£ä¸­çš„å¯è¡Œè§£ä¸å†ç¬¦åˆè¦æ±‚ã€‚åŒæ—¶ï¼Œæ¯æ¬¡å¢åŠ  leftï¼Œæˆ‘ä»¬éƒ½è¦æ›´æ–°ä¸€è½®ç»“æœã€‚</p><p>ï¼ˆ4ï¼‰æ»‘åŠ¨çª—å£ï¼Œç›´è‡³ä¸€æ¬¡éå†ç»“æŸï¼š<br>é‡å¤ç¬¬ 2 å’Œç¬¬ 3 æ­¥ï¼Œç›´åˆ° right åˆ°è¾¾åˆ°çš„å°½å¤´ã€‚</p></blockquote><p>æ¯”è¾ƒé€‚ç”¨äºéœ€è¦åœ¨ä¸æ”¹å˜æ•°ç»„åŸé¡ºåºçš„æƒ…å†µä¸‹é€‰æ‹©æ»¡è¶³è¦æ±‚çš„å­æ•°ç»„ï¼Œæœ¬é¢˜å¥—ç”¨ä¸Šè¿°æ¨¡æ¿å°±èƒ½æ‰¾åˆ°è§£é¢˜æ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day28</title>
      <link href="/2023/11/01/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day28/"/>
      <url>/2023/11/01/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day28/</url>
      
        <content type="html"><![CDATA[<p><u><em>é‡åˆ°å¤±è´¥ç»ä¸è¦ä¸€èµ°äº†ä¹‹ï¼Œç›¸åçš„ï¼Œä¸ºå…¶éšè—çš„èµ„äº§ä»”ç»†å¹¶æœ‰æƒ³åƒåŠ›çš„ç ”ç©¶ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/3sum/">ä¸‰æ•°ä¹‹å’Œ</a></p><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‰å…ƒç»„ <code>[nums[i], nums[j], nums[k]]</code> æ»¡è¶³ <code>i != j</code>ã€<code>i != k</code> ä¸” <code>j != k</code> ï¼ŒåŒæ—¶è¿˜æ»¡è¶³ <code>nums[i] + nums[j] + nums[k] == 0</code> ã€‚è¯·</p><p>ä½ è¿”å›æ‰€æœ‰å’Œä¸º <code>0</code> ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>ç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">threeSum</span>(vector&lt;<span class="type">int</span>&gt;&amp; nums) &#123;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; ans;</span><br><span class="line">        <span class="keyword">if</span> (nums.<span class="built_in">size</span>() &lt; <span class="number">3</span>) <span class="keyword">return</span> ans;</span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; <span class="number">0</span>) <span class="keyword">return</span> ans;</span><br><span class="line">            <span class="comment">// å»é‡</span></span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; nums[i] == nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> left = i + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> right = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[left] + nums[right] + nums[i] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    right--;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[left] + nums[right] + nums[i] &lt; <span class="number">0</span>)&#123;</span><br><span class="line">                    left++;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    ans.<span class="built_in">push_back</span>(&#123;nums[left], nums[right], nums[i]&#125;);</span><br><span class="line">                    <span class="keyword">while</span> (right &gt; left &amp;&amp; nums[right] == nums[right - <span class="number">1</span>]) right--;</span><br><span class="line">                    <span class="keyword">while</span> (right &gt; left &amp;&amp; nums[left] == nums[left + <span class="number">1</span>]) left++;</span><br><span class="line">                    left++;</span><br><span class="line">                    right--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202311012257955.png" alt="image-20231101225729911"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>å…ˆå¯¹æ•°ç»„æ•´ä½“æ’åºï¼Œç„¶åè¿›è¡Œå¾ªç¯ï¼Œæ¯æ¬¡å›ºå®šä¸€ä¸ªæœ€å°å€¼iï¼ˆæ•°ç»„æœ€å³è¾¹çš„æ•°ï¼‰,ç„¶ååŒæŒ‡é’ˆleftï¼ˆi + 1ï¼‰ï¼Œrightï¼ˆsize - 1ï¼‰å‘å†…æ”¶ç¼©ï¼ŒåŠ å’Œç¢°åˆ°ç­‰äº0çš„æƒ…å†µå°±åŠ å…¥åˆ°ç­”æ¡ˆä¸­ï¼Œå¹¶åŒæ—¶å˜åŠ¨leftå’Œfightã€‚å¦‚æœå’Œå¤§äº0ï¼Œè¯´æ˜rightå¤§äº†ï¼Œåˆ™rightå·¦ç§»ï¼Œå¦‚æœåŠ å’Œå°äº0ï¼Œè¯´æ˜leftå°äº†ï¼Œleftå³ç§»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day27</title>
      <link href="/2023/10/30/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day27/"/>
      <url>/2023/10/30/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day27/</url>
      
        <content type="html"><![CDATA[<p><u><em>å½“ä½ æŠŠè‡ªå·²äº¤ç»™æ„¿æ™¯åï¼ŒæˆåŠŸå¼€å§‹è¿½é€ä½ ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/container-with-most-water/">ç››æœ€å¤šæ°´çš„å®¹å™¨</a></p><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º <code>n</code> çš„æ•´æ•°æ•°ç»„ <code>height</code> ã€‚æœ‰ <code>n</code> æ¡å‚çº¿ï¼Œç¬¬ <code>i</code> æ¡çº¿çš„ä¸¤ä¸ªç«¯ç‚¹æ˜¯ <code>(i, 0)</code> å’Œ <code>(i, height[i])</code> ã€‚</p><p>æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ <code>x</code> è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚</p><p>è¿”å›å®¹å™¨å¯ä»¥å‚¨å­˜çš„æœ€å¤§æ°´é‡ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxArea</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; height)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å› ä¸ºä¸¤ä¸ªæ¿ä¹‹é—´èƒ½å®¹çš„ä¸‹çš„æœ€å¤§æ°´é‡æ˜¯ç”±çŸ­æ¿å†³å®šçš„</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥æ¯æ¬¡åªç§»åŠ¨çŸ­æ¿ï¼Œè¿™æ ·æœ€ç»ˆç»“æœå¯èƒ½å˜å¤§æˆ–è€…ä¸å˜</span></span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, j = height.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; j)&#123;</span><br><span class="line">            ans = height[i] &lt; height[j] ?</span><br><span class="line">                <span class="built_in">max</span>(ans, (j - i) * height[i++]) :</span><br><span class="line">                <span class="built_in">max</span>(ans, (j - i) * height[j--]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310302234712.png" alt="image-20231030223408666"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>åŒæŒ‡é’ˆéå†ï¼Œç”±äºä¸¤æ¿ä¹‹é—´çš„æœ€å¤§å‚¨æ°´é‡æ˜¯ç”±æœ€çŸ­çš„æ¿å­å†³å®šçš„ï¼Œé‚£ç°åœ¨å°±å­˜åœ¨ä¸¤ç§æƒ…å†µï¼š1.ç§»åŠ¨çŸ­æ¿ï¼Œé‚£ä¸¤æ¿ä¸­çŸ­æ¿å¯èƒ½å˜é•¿æˆ–è€…ä¸å˜ã€‚2.ç§»åŠ¨é•¿æ¿ï¼ŒçŸ­æ¿å¯èƒ½ä¸å˜æˆ–è€…å˜çŸ­ ä¸¤ç§æƒ…å†µç›¸å¯¹æ¯”ï¼Œæ˜æ˜¾ç§»åŠ¨çŸ­æ¿æ¯”è¾ƒåˆ’ç®—ï¼Œæ‰€ä»¥æ¯æ¬¡éå†æ¯”è¾ƒä¸¤æ¿é«˜åº¦ï¼Œç§»åŠ¨è¾ƒå°è€…ï¼Œå°±èƒ½å¾—åˆ°æœ€å¤§å€¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day26</title>
      <link href="/2023/10/28/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day26/"/>
      <url>/2023/10/28/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day26/</url>
      
        <content type="html"><![CDATA[<p><u><em>åŠ¨æœºæ€»æ˜¯èƒ½æˆ˜èƒœå¤©èµ‹ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/two-sum-ii-input-array-is-sorted/">ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„</a></p><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» <strong>1</strong> å¼€å§‹çš„æ•´æ•°æ•°ç»„ <code>numbers</code> ï¼Œè¯¥æ•°ç»„å·²æŒ‰ <strong>éé€’å‡é¡ºåºæ’åˆ—</strong> ï¼Œè¯·ä½ ä»æ•°ç»„ä¸­æ‰¾å‡ºæ»¡è¶³ç›¸åŠ ä¹‹å’Œç­‰äºç›®æ ‡æ•° <code>target</code> çš„ä¸¤ä¸ªæ•°ã€‚å¦‚æœè®¾è¿™ä¸¤ä¸ªæ•°åˆ†åˆ«æ˜¯ <code>numbers[index1]</code> å’Œ <code>numbers[index2]</code> ï¼Œåˆ™ <code>1 &lt;= index1 &lt; index2 &lt;= numbers.length</code> ã€‚</p><p>ä»¥é•¿åº¦ä¸º 2 çš„æ•´æ•°æ•°ç»„ <code>[index1, index2]</code> çš„å½¢å¼è¿”å›è¿™ä¸¤ä¸ªæ•´æ•°çš„ä¸‹æ ‡ <code>index1</code> å’Œ <code>index2</code>ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ¯ä¸ªè¾“å…¥ <strong>åªå¯¹åº”å”¯ä¸€çš„ç­”æ¡ˆ</strong> ï¼Œè€Œä¸”ä½  <strong>ä¸å¯ä»¥</strong> é‡å¤ä½¿ç”¨ç›¸åŒçš„å…ƒç´ ã€‚</p><p>ä½ æ‰€è®¾è®¡çš„è§£å†³æ–¹æ¡ˆå¿…é¡»åªä½¿ç”¨å¸¸é‡çº§çš„é¢å¤–ç©ºé—´ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">twoSum</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; numbers, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, j = numbers.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; j)&#123;</span><br><span class="line">            <span class="keyword">if</span>(numbers[i] + numbers[j] == target)&#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;i + <span class="number">1</span> , j + <span class="number">1</span>&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(numbers[j] &gt; target - numbers[i])&#123;</span><br><span class="line">                j--;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310282030209.png" alt="image-20231028203000162"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>ç¼ªèï¼å¦‚æœé‡‡ç”¨æš´åŠ›æ–¹æ³•ï¼Œä¸€ä¸ªä¸€ä¸ªè¯•ï¼Œé‚£æ—¶é—´å¤æ‚åº¦æ˜¯o(m * n)ï¼Œéå¸¸æ»´é«˜ã€‚å› ä¸ºé¢˜ç›®ç»™çš„æ˜¯æœ‰åºæ•°ç»„ï¼Œéšçµå…‰ä¸€ç°ï¼ŒåŒæŒ‡é’ˆï¼ˆi,jï¼‰ä¸€ä¸ªä»å¤´éå†ï¼Œä¸€ä¸ªä»å°¾ã€‚è¿‡ç¨‹ä¸­å…ˆå›ºå®ši,ç„¶åè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœiå’Œjå°±æ˜¯é¢˜è§£ï¼Œé‚£ç›´æ¥è¿”å›ï¼ˆi+1,j+1ï¼‰ï¼Œå¦‚æœnumbers[j] &gt; target - numbers[i]ï¼Œé‚£è¯´æ˜åœ¨jå‰é¢å¯èƒ½ä¼šå‡ºç°æƒ³è¦çš„å€¼ï¼Œæ•…jâ€“å‰ç§»ï¼ˆiå›ºå®šï¼‰,è‹¥åœ¨å‰ç§»è¿‡ç¨‹ä¸­å‘ç°numbers[j] &lt; target - numbers[i],è¯´æ˜ä¸å­˜åœ¨å½“å‰iå¯¹åº”çš„å€¼ï¼Œæ•…jä¸åŠ¨i++è¿›è¡Œåç§»ï¼Œå› ä¸ºiå¯¹åº”çš„å€¼å˜å¤§äº†ï¼Œtarget - numbers[i]å€¼å˜å°ï¼Œé‚å¯ä»¥ç»§ç»­æ¯”è¾ƒï¼Œé‡å¤ä»¥ä¸Šè¿‡ç¨‹ã€‚</p><p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œå›ºå®šiï¼Œç„¶åæ ¹æ®iæ‰¾å¯¹åº”çš„jï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™iåç§»é‡æ–°æ‰¾ï¼Œè¿™æ ·é€šè¿‡ä¸€ééå†å°±èƒ½è§£å†³é—®é¢˜ï¼Œå¦™ï¼</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day25</title>
      <link href="/2023/10/27/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day25/"/>
      <url>/2023/10/27/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day25/</url>
      
        <content type="html"><![CDATA[<p><u><em>ä¸€ä¸ªäººç¦»é—®é¢˜æ„ˆè¿œå°±æ„ˆç†æƒ³ä¸»ä¹‰ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/is-subsequence/">åˆ¤æ–­å­åºåˆ—</a></p><p>ç»™å®šå­—ç¬¦ä¸² <strong>s</strong> å’Œ <strong>t</strong> ï¼Œåˆ¤æ–­ <strong>s</strong> æ˜¯å¦ä¸º <strong>t</strong> çš„å­åºåˆ—ã€‚</p><p>å­—ç¬¦ä¸²çš„ä¸€ä¸ªå­åºåˆ—æ˜¯åŸå§‹å­—ç¬¦ä¸²åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å­—ç¬¦è€Œä¸æ”¹å˜å‰©ä½™å­—ç¬¦ç›¸å¯¹ä½ç½®å½¢æˆçš„æ–°å­—ç¬¦ä¸²ã€‚ï¼ˆä¾‹å¦‚ï¼Œ<code>&quot;ace&quot;</code>æ˜¯<code>&quot;abcde&quot;</code>çš„ä¸€ä¸ªå­åºåˆ—ï¼Œè€Œ<code>&quot;aec&quot;</code>ä¸æ˜¯ï¼‰ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isSubsequence</span><span class="params">(string s, string t)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (s.<span class="built_in">size</span>() == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(s.<span class="built_in">size</span>() &gt; t.<span class="built_in">size</span>())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; s.<span class="built_in">size</span>() &amp;&amp; j &lt; t.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="keyword">if</span>(s[i] == t[j])&#123;</span><br><span class="line">                i++;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i == s.<span class="built_in">size</span>())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310271619191.png" alt="image-20231027161957143"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>åŒæŒ‡é’ˆï¼Œå¦‚æœåŒ¹é…åˆ°s[i] &#x3D;&#x3D; t[j]åˆ™iå’ŒjåŒæ—¶ç§»åŠ¨ï¼Œå¦‚æœä¸åŒ¹é…åˆ™åªç§»åŠ¨jï¼Œæœ€ç»ˆæ ¹æ®ç»ˆæ­¢æ¡ä»¶åˆ¤æ–­ç»“æœã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day24</title>
      <link href="/2023/10/26/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day24/"/>
      <url>/2023/10/26/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day24/</url>
      
        <content type="html"><![CDATA[<p><u><em>è¿‡å»çš„æŸå¤±å’Œå¤±è´¥ç»éªŒï¼Œåº”æ˜¯ä½ é‡‡å–è¡ŒåŠ¨ï¼Œè€Œéä¸é‡‡å–è¡ŒåŠ¨çš„ç†ç”±ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/valid-palindrome/">éªŒè¯å›æ–‡ä¸²</a></p><p>å¦‚æœåœ¨å°†æ‰€æœ‰å¤§å†™å­—ç¬¦è½¬æ¢ä¸ºå°å†™å­—ç¬¦ã€å¹¶ç§»é™¤æ‰€æœ‰éå­—æ¯æ•°å­—å­—ç¬¦ä¹‹åï¼ŒçŸ­è¯­æ­£ç€è¯»å’Œåç€è¯»éƒ½ä¸€æ ·ã€‚åˆ™å¯ä»¥è®¤ä¸ºè¯¥çŸ­è¯­æ˜¯ä¸€ä¸ª <strong>å›æ–‡ä¸²</strong> ã€‚</p><p>å­—æ¯å’Œæ•°å­—éƒ½å±äºå­—æ¯æ•°å­—å­—ç¬¦ã€‚</p><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code>ï¼Œå¦‚æœå®ƒæ˜¯ <strong>å›æ–‡ä¸²</strong> ï¼Œè¿”å› <code>true</code> ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isPalindrome</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>,j = s.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; j)&#123;</span><br><span class="line">            <span class="keyword">while</span>(!<span class="built_in">isalpha</span>(s[i]) &amp;&amp; i &lt; j &amp;&amp; !<span class="built_in">isdigit</span>(s[i]))&#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(!<span class="built_in">isalpha</span>(s[j]) &amp;&amp; i &lt; j &amp;&amp; !<span class="built_in">isdigit</span>(s[j]))&#123;</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">tolower</span>(s[i]) != <span class="built_in">tolower</span>(s[j]))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                i++;</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310262117710.png" alt="image-20231026211742662"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>ç®€å•é¢˜ï¼Œæ€è·¯ä¹Ÿæ¯”è¾ƒç®€å•ï¼ŒåŒæŒ‡é’ˆï¼Œä¸€ä¸ªä»å¤´å¼€å§‹ä¾¿åˆ©ï¼Œä¸€ä¸ªä»å°¾å¼€å§‹éå†ã€‚ä¸­é€”å¦‚æœé‡åˆ°ä¸æ˜¯å­—æ¯æˆ–æ•°å­—çš„å…ƒç´ ï¼Œåˆ™i++ï¼ŒåŒç†jâ€“ï¼Œç›´åˆ°é‡åˆ°å¯ä»¥æ¯”è¾ƒçš„ï¼Œå¦‚æœç›¸åŒåˆ™ç»§ç»­å¾€åæ¯”è¾ƒï¼Œä¸åŒç›´æ¥è¿”å›falseã€‚</p><blockquote><p>isalpha ç”¨æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯å­—æ¯</p><p>isdigit åˆ¤æ–­æ˜¯å¦æ˜¯æ•°å­—</p><p>tolower å°†å­—æ¯è½¬åŒ–ä¸ºå°å†™</p><p>toupper å­—æ¯è½¬åŒ–ä¸ºå¤§å†™</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day23</title>
      <link href="/2023/10/24/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day23/"/>
      <url>/2023/10/24/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day23/</url>
      
        <content type="html"><![CDATA[<p><em><u>ä½ ä¸é€ å°±æœªæ¥ï¼Œå°±ä¸èƒ½æ§åˆ¶å‘ç”Ÿåœ¨ä½ èº«ä¸Šçš„äº‹ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/">æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡</a></p><p>ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² <code>haystack</code> å’Œ <code>needle</code> ï¼Œè¯·ä½ åœ¨ <code>haystack</code> å­—ç¬¦ä¸²ä¸­æ‰¾å‡º <code>needle</code> å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ <code>needle</code> ä¸æ˜¯ <code>haystack</code> çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™è¿”å› <code>-1</code> ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">strStr</span><span class="params">(string haystack, string needle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(needle.<span class="built_in">size</span>() == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(haystack.<span class="built_in">size</span>() == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; haystack.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(haystack[i] == needle[j])&#123;</span><br><span class="line">                <span class="keyword">if</span>(j == needle.<span class="built_in">size</span>() - <span class="number">1</span>) <span class="keyword">return</span> i - j;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                i = i - j;</span><br><span class="line">                j = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>æ­¤é¢˜ç”¨çš„æš´åŠ›åŒ¹é…ï¼Œè¿˜æœ‰æ›´å¥½çš„kmpç®—æ³•ï¼Œä»Šæ™šæ‡’ä¸æƒ³å†™äº†ï¼Œä¹‹åæœ‰ç©ºå†è¯´ï¼Œæš´åŠ›åŒ¹é…å³ç›®æ ‡ä¸²å’ŒåŒ¹é…ä¸²åˆ†åˆ«æœ‰ä¸€ä¸ªä¸‹æ ‡æŒ‡é’ˆï¼Œå¦‚æœé‡åˆ°åŒ¹é…çš„å­—ç¬¦ï¼Œç›®æ ‡ä¸²å’ŒåŒ¹é…ä¸²çš„ä¸‹æ ‡ä¸€èµ·ç§»åŠ¨ï¼Œè‹¥åŒ¹é…ä¸²ä¸‹æ ‡ç­‰äºåŒ¹é…ä¸²é•¿åº¦å‡1ï¼Œè¯´æ˜æ‰¾åˆ°åŒ¹é…æ®µäº†ï¼Œè¿”å›ç›®æ ‡ä¸²ä¸‹æ ‡å‡åŒ¹é…ä¸²ä¸‹æ ‡ï¼Œå°±èƒ½å¾—åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ä¸‹æ ‡ï¼›å¦‚æœåœ¨æ­¤è¿‡ç¨‹ä¸­å‡ºç°ä¸€ä¸ªä¸åŒ¹é…çš„å­—ç¬¦ï¼Œé‚£ç›®æ ‡ä¸²çš„ä¸‹æ ‡è¦ç§»åŠ¨åˆ°å¼€å§‹ç¬¬ä¸€ä¸ªåŒ¹é…å­—ç¬¦çš„ä¸‹ä¸€ä¸ªï¼Œç„¶ååŒ¹é…ä¸²ä¸‹æ ‡å½’é›¶é‡æ–°è¿›è¡ŒåŒ¹é…ï¼Œè¿™ä¹Ÿæ˜¯è¯¥åšæ³•â€œæš´åŠ›â€æ‰€åœ¨ï¼Œæ—¶é—´å¤æ‚åº¦è¾ƒé«˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day22</title>
      <link href="/2023/10/23/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day22/"/>
      <url>/2023/10/23/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day22/</url>
      
        <content type="html"><![CDATA[<p><u><em>ä½†ä½ å¿…é¡»ä¸æ–­å°è¯•ï¼Œæ¯å¤©è¡¨ç°ä½ æœ€å¥½çš„ä¸€é¢ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/zigzag-conversion/">N å­—å½¢å˜æ¢</a></p><p>å°†ä¸€ä¸ªç»™å®šå­—ç¬¦ä¸² <code>s</code> æ ¹æ®ç»™å®šçš„è¡Œæ•° <code>numRows</code> ï¼Œä»¥ä»ä¸Šå¾€ä¸‹ã€ä»å·¦åˆ°å³è¿›è¡Œ Z å­—å½¢æ’åˆ—ã€‚</p><p>æ¯”å¦‚è¾“å…¥å­—ç¬¦ä¸²ä¸º <code>&quot;PAYPALISHIRING&quot;</code> è¡Œæ•°ä¸º <code>3</code> æ—¶ï¼Œæ’åˆ—å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">P   A   H   N</span><br><span class="line">A P L S I I G</span><br><span class="line">Y   I   R</span><br></pre></td></tr></table></figure><p>ä¹‹åï¼Œä½ çš„è¾“å‡ºéœ€è¦ä»å·¦å¾€å³é€è¡Œè¯»å–ï¼Œäº§ç”Ÿå‡ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ï¼š<code>&quot;PAHNAPLSIIGYIR&quot;</code>ã€‚</p><p>è¯·ä½ å®ç°è¿™ä¸ªå°†å­—ç¬¦ä¸²è¿›è¡ŒæŒ‡å®šè¡Œæ•°å˜æ¢çš„å‡½æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string convert(string s, int numRows);</span><br></pre></td></tr></table></figure><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">convert</span><span class="params">(string s, <span class="type">int</span> numRows)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(numRows &lt; <span class="number">2</span>) <span class="keyword">return</span> s;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> flag = <span class="number">-1</span>;</span><br><span class="line">        <span class="function">vector&lt;string&gt; <span class="title">rows</span><span class="params">(numRows)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c : s)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">0</span> || i == numRows - <span class="number">1</span>)&#123;</span><br><span class="line">                flag = -flag;  </span><br><span class="line">            &#125;</span><br><span class="line">            rows[i] += c;</span><br><span class="line">            i += flag;</span><br><span class="line">        &#125;</span><br><span class="line">        string ans;</span><br><span class="line">        <span class="keyword">for</span>(string row : rows)&#123;</span><br><span class="line">            ans += row;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310231630185.png" alt="image-20231023163046137"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>æœ¬é¢˜ç®—æ³•æ¨¡æ‹Ÿäº†é¢˜ç›®ä¸­çš„â€Zâ€œå½¢æˆçš„è¿‡ç¨‹ï¼Œè®¾ç½®ä¸‹æ ‡iå’Œæ ‡å¿—ä½flagï¼Œä»å¤´éå†å­—ç¬¦ä¸²sï¼ŒæœŸé—´å¾€å­—ç¬¦ä¸²æ•°ç»„rowsä¸­å¡«å……å­—ç¬¦ï¼Œå…¶ä¸­iä¸‹æ ‡æ¨¡æ‹Ÿäº†Zçš„æ¯ä¸€å±‚ï¼Œå¦‚æœiç­‰äº0æˆ–æ˜¯å±‚æ•°-1ï¼Œè¯´æ˜åˆ°äº†è½¬æŠ˜ç‚¹ï¼Œæ­¤æ—¶æ”¹å˜flagä¸º-flagï¼Œiçš„å€¼ä¾¿ä¼šå¾€ç›¸åæ–¹å‘å¢é•¿ï¼Œè¿™å°±å®ç°äº†ç±»ä¼¼äºåå¤æ‰«æçš„è¿‡ç¨‹ï¼Œâ€æ‰«æâ€œç»“æŸåï¼Œå­—ç¬¦ä¸²æ•°ç»„æ¯ä¸€ä¸ªå…ƒç´ å¯¹åº”çš„å°±æ˜¯Zçš„æ¯ä¸€å±‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day21</title>
      <link href="/2023/10/22/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day21/"/>
      <url>/2023/10/22/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day21/</url>
      
        <content type="html"><![CDATA[<p><u><em>ä½ å¾—å…ˆè·¨è¶Šææƒ§æ‰èƒ½è·å¾—ä½ æ‰€æƒ³è¦çš„ä¸€åˆ‡ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/reverse-words-in-a-string/">åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯</a></p><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> ï¼Œè¯·ä½ åè½¬å­—ç¬¦ä¸²ä¸­ <strong>å•è¯</strong> çš„é¡ºåºã€‚</p><p><strong>å•è¯</strong> æ˜¯ç”±éç©ºæ ¼å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ã€‚<code>s</code> ä¸­ä½¿ç”¨è‡³å°‘ä¸€ä¸ªç©ºæ ¼å°†å­—ç¬¦ä¸²ä¸­çš„ <strong>å•è¯</strong> åˆ†éš”å¼€ã€‚</p><p>è¿”å› <strong>å•è¯</strong> é¡ºåºé¢ å€’ä¸” <strong>å•è¯</strong> ä¹‹é—´ç”¨å•ä¸ªç©ºæ ¼è¿æ¥çš„ç»“æœå­—ç¬¦ä¸²ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>è¾“å…¥å­—ç¬¦ä¸² <code>s</code>ä¸­å¯èƒ½ä¼šå­˜åœ¨å‰å¯¼ç©ºæ ¼ã€å°¾éšç©ºæ ¼æˆ–è€…å•è¯é—´çš„å¤šä¸ªç©ºæ ¼ã€‚è¿”å›çš„ç»“æœå­—ç¬¦ä¸²ä¸­ï¼Œå•è¯é—´åº”å½“ä»…ç”¨å•ä¸ªç©ºæ ¼åˆ†éš”ï¼Œä¸”ä¸åŒ…å«ä»»ä½•é¢å¤–çš„ç©ºæ ¼ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">reverseWords</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        string word = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        string ans = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">int</span> tag = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; s.<span class="built_in">length</span>();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s[i] == <span class="string">&#x27; &#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(tag)&#123;</span><br><span class="line">                    ans == <span class="string">&quot;&quot;</span> ? ans = word : ans = word + <span class="string">&quot; &quot;</span> + ans;</span><br><span class="line">                    word = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                    tag = <span class="number">0</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                   <span class="keyword">continue</span>; </span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                tag = <span class="number">1</span>;</span><br><span class="line">                word += s[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(word != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">            ans == <span class="string">&quot;&quot;</span> ? ans = word : ans = word + <span class="string">&quot; &quot;</span> + ans;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310221723511.png" alt="image-20231022172336457"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>ç”¨äº†ä¸€ä¸ªç¬¨ä½†æœ‰æ•ˆçš„æ–¹æ³•ï¼šå…ˆè®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½tagï¼Œä»å¤´éå†å­—ç¬¦ä¸²ï¼Œé‡åˆ°ç©ºæ ¼ä¸”æ ‡å¿—ä½ä¸º0æ—¶ï¼Œåˆ™è·³è¿‡ç©ºæ ¼ç»§ç»­éå†ï¼Œé‡åˆ°éç©ºæ ¼åˆ™å°†æ ‡å¿—ä½ç½®1ï¼Œå¹¶åŠ åˆ°wordä¸­ï¼Œè¿™æ ·å½“å†æ¬¡é‡åˆ°ç©ºæ ¼æ—¶ï¼Œæ ‡å¿—ä½ä¸º1ä»£è¡¨wordä¸­å·²ç»æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„å•è¯ï¼Œç„¶åå°†wordå’Œansç»“åˆï¼Œæ³¨æ„æ­¤å¤„wordè¦åœ¨anså‰ã€‚è¿™é‡Œæœ‰å‡ ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼Œå¦‚æœæ­¤æ—¶ansä¸ºç©ºï¼Œåˆ™ä¸èƒ½ä½¿ç”¨ans &#x3D; word + â€œ â€œ + ansè¿™ç§å½¢å¼ï¼ˆä¼šå¯¼è‡´ç»“å°¾å¤šç©ºæ ¼ï¼‰ï¼Œå¿…é¡»åŒºåˆ†å‡ºæ­¤æƒ…å†µã€‚å¦å¤–ç»“æŸéå†æ—¶ï¼Œwordå¯èƒ½ä¸ä¸ºç©ºï¼ˆå› ä¸ºè¿˜æ²¡æœ‰æ¥å¾—åŠåŠ å…¥åˆ°ansï¼Œéå†å°±åˆ°ç»“æŸæ¡ä»¶äº†ï¼‰ï¼Œæ­¤æ—¶åº”è¯¥ç”¨åŒæ ·çš„æ–¹æ³•å°†wordä¸ansç»“åˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day20</title>
      <link href="/2023/10/21/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day20/"/>
      <url>/2023/10/21/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day20/</url>
      
        <content type="html"><![CDATA[<p><u><em>åˆ«å®³æ€•å¤±è´¥ï¼Œåªè¦åšå¯¹ä¸€æ¬¡å°±å¤Ÿäº†ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/longest-common-prefix/">æœ€é•¿å…¬å…±å‰ç¼€</a></p><p>ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚</p><p>å¦‚æœä¸å­˜åœ¨å…¬å…±å‰ç¼€ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸² <code>&quot;&quot;</code>ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">longestCommonPrefix</span><span class="params">(vector&lt;string&gt;&amp; strs)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        string ans_str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">int</span> min_len = <span class="number">1000000</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; strs.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(strs[i].<span class="built_in">length</span>() &lt; min_len)&#123;</span><br><span class="line">                min_len = strs[i].<span class="built_in">length</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; min_len)&#123;</span><br><span class="line">            <span class="type">char</span> c = strs[<span class="number">0</span>][i];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt; strs.<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(strs[j][i] != c)&#123;</span><br><span class="line">                    <span class="keyword">return</span> ans_str;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">            ans_str += c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans_str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310211654074.png" alt="image-20231021165435032"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>ç®€å•é¢˜ï¼Œé¦–å…ˆç»Ÿè®¡å‡ºæœ€çŸ­å­—ç¬¦ä¸²ï¼Œç„¶ååŒæ—¶æ¯”è¾ƒå­—ç¬¦ä¸²çš„iä¸‹æ ‡å¯¹åº”çš„å­—ç¬¦æ˜¯å¦ä¸€è‡´ï¼Œç›¸åŒåˆ™åŠ åˆ°ç»“æœä¸­ï¼Œä¸åŒåˆ™ç›´æ¥è¿”å›å½“å‰ç»“æœã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day19</title>
      <link href="/2023/10/21/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day19/"/>
      <url>/2023/10/21/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day19/</url>
      
        <content type="html"><![CDATA[<p><u><em>è‹¥æƒ³å¾—åˆ°ä½ ä»æœªæ‹¥æœ‰çš„ä¸œè¥¿ï¼Œä½ å¾—æ„¿æ„åšä½ ä»æœªåšè¿‡çš„äº‹ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/length-of-last-word/">æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦</a></p><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code>ï¼Œç”±è‹¥å¹²å•è¯ç»„æˆï¼Œå•è¯å‰åç”¨ä¸€äº›ç©ºæ ¼å­—ç¬¦éš”å¼€ã€‚è¿”å›å­—ç¬¦ä¸²ä¸­ <strong>æœ€åä¸€ä¸ª</strong> å•è¯çš„é•¿åº¦ã€‚</p><p><strong>å•è¯</strong> æ˜¯æŒ‡ä»…ç”±å­—æ¯ç»„æˆã€ä¸åŒ…å«ä»»ä½•ç©ºæ ¼å­—ç¬¦çš„æœ€å¤§å­å­—ç¬¦ä¸²ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">lengthOfLastWord</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = s.<span class="built_in">length</span>();</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="keyword">for</span>(i = len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s[i] == <span class="string">&#x27; &#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(i;i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s[i] == <span class="string">&#x27; &#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                ans++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310211626322.png" alt="image-20231021162646271"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>ç®€å•é¢˜ï¼Œè¿‡äºç®€å•äº†ã€‚é€šè¿‡è§‚å¯Ÿç»™å‡ºçš„æµ‹è¯•ç”¨ä¾‹ï¼Œå‘ç°å­˜åœ¨ä»¥ç©ºæ ¼ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å•çº¯ä»åå¾€å‰éå†å­—ç¬¦ä¸²ï¼Œç¢°åˆ°ç©ºæ ¼å°±åœæ­¢æ˜¯æ— æ³•å®ç°çš„ï¼Œæ‰€ä»¥å…ˆç”¨äº†ä¸€ä¸ªå¾ªç¯ï¼Œè®°å½•ç¬¬ä¸€ä¸ªå­—æ¯çš„ä½ç½®ï¼Œä»æ­¤ä½ç½®å¼€å§‹å†è¿›è¡Œä¾æ¬¡å¾ªç¯ï¼Œç¢°åˆ°ç©ºæ ¼å°±åœæ­¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day18</title>
      <link href="/2023/10/18/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day18/"/>
      <url>/2023/10/18/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day18/</url>
      
        <content type="html"><![CDATA[<p><u><em>æ€ªç½ªåˆ«äººç»ä¸ä¼šè®©ä½ è·å¾—æˆåŠŸã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/integer-to-roman/">æ•´æ•°è½¬ç½—é©¬æ•°å­—</a></p><p>ç½—é©¬æ•°å­—åŒ…å«ä»¥ä¸‹ä¸ƒç§å­—ç¬¦ï¼š <code>I</code>ï¼Œ <code>V</code>ï¼Œ <code>X</code>ï¼Œ <code>L</code>ï¼Œ<code>C</code>ï¼Œ<code>D</code> å’Œ <code>M</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å­—ç¬¦          æ•°å€¼</span><br><span class="line">I             1</span><br><span class="line">V             5</span><br><span class="line">X             10</span><br><span class="line">L             50</span><br><span class="line">C             100</span><br><span class="line">D             500</span><br><span class="line">M             1000</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œ ç½—é©¬æ•°å­— 2 å†™åš <code>II</code> ï¼Œå³ä¸ºä¸¤ä¸ªå¹¶åˆ—çš„ 1ã€‚12 å†™åš <code>XII</code> ï¼Œå³ä¸º <code>X</code> + <code>II</code> ã€‚ 27 å†™åš <code>XXVII</code>, å³ä¸º <code>XX</code> + <code>V</code> + <code>II</code> ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç½—é©¬æ•°å­—ä¸­å°çš„æ•°å­—åœ¨å¤§çš„æ•°å­—çš„å³è¾¹ã€‚ä½†ä¹Ÿå­˜åœ¨ç‰¹ä¾‹ï¼Œä¾‹å¦‚ 4 ä¸å†™åš <code>IIII</code>ï¼Œè€Œæ˜¯ <code>IV</code>ã€‚æ•°å­— 1 åœ¨æ•°å­— 5 çš„å·¦è¾¹ï¼Œæ‰€è¡¨ç¤ºçš„æ•°ç­‰äºå¤§æ•° 5 å‡å°æ•° 1 å¾—åˆ°çš„æ•°å€¼ 4 ã€‚åŒæ ·åœ°ï¼Œæ•°å­— 9 è¡¨ç¤ºä¸º <code>IX</code>ã€‚è¿™ä¸ªç‰¹æ®Šçš„è§„åˆ™åªé€‚ç”¨äºä»¥ä¸‹å…­ç§æƒ…å†µï¼š</p><ul><li><code>I</code> å¯ä»¥æ”¾åœ¨ <code>V</code> (5) å’Œ <code>X</code> (10) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 4 å’Œ 9ã€‚</li><li><code>X</code> å¯ä»¥æ”¾åœ¨ <code>L</code> (50) å’Œ <code>C</code> (100) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 40 å’Œ 90ã€‚ </li><li><code>C</code> å¯ä»¥æ”¾åœ¨ <code>D</code> (500) å’Œ <code>M</code> (1000) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 400 å’Œ 900ã€‚</li></ul><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°ï¼Œå°†å…¶è½¬ä¸ºç½—é©¬æ•°å­—ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">intToRoman</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">        string result;</span><br><span class="line">        <span class="type">int</span> values[] = &#123;<span class="number">1000</span>, <span class="number">900</span>, <span class="number">500</span>, <span class="number">400</span>, <span class="number">100</span>, <span class="number">90</span>, <span class="number">50</span>, <span class="number">40</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">1</span>&#125;;</span><br><span class="line">        string reps[] = &#123;<span class="string">&quot;M&quot;</span>, <span class="string">&quot;CM&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;CD&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;XC&quot;</span>, <span class="string">&quot;L&quot;</span>, <span class="string">&quot;XL&quot;</span>, <span class="string">&quot;X&quot;</span>, <span class="string">&quot;IX&quot;</span>, <span class="string">&quot;V&quot;</span>, <span class="string">&quot;IV&quot;</span>, <span class="string">&quot;I&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">while</span>(num)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">13</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(num &gt;= values[i])&#123;</span><br><span class="line">                    result += reps[i];</span><br><span class="line">                    num -= values[i];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310182055103.png" alt="image-20231018205534054"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>æ­¤é¢˜æ˜¯ä¸Šä¸€é“é¢˜ç›®çš„å˜ç§ï¼Œä¸Šä¸€é“é¢˜ç›®æ˜¯ç»™å‡ºç½—é©¬æ•°å­—è½¬é˜¿æ‹‰ä¼¯æ•°å­—ï¼Œæœ¬é¢˜ç»™å‡ºé˜¿æ‹‰ä¼¯æ•°å­—è½¬ç½—é©¬æ•°å­—ã€‚å…ˆè¯´ä¸€ä¸‹æˆ‘é‡åˆ°çš„é—®é¢˜ï¼Œå¼€å§‹æˆ‘è¿˜æ˜¯æ‰“ç®—åˆ©ç”¨hashè¡¨å­˜æ”¾å¯¹åº”å…³ç³»ï¼Œå³é”®æ˜¯intå€¼æ˜¯stringã€‚ä½†åé¢é‡åˆ°äº†é—®é¢˜ã€‚æ­¤é¢˜è§£æ³•ä¸ºè´ªå¿ƒç®—æ³•ï¼Œè´ªå¿ƒæ€è·¯æ˜¯éå†å­˜æ”¾æ•°å’Œç½—é©¬æ•°å­—æ•°ç»„ï¼Œæ¯æ¬¡å–å…¶ä¸­èƒ½è¡¨ç¤ºçš„æœ€å¤§çš„æ•°ï¼Œï¼ˆå› ä¸ºæ•°ç»„ä¸­çš„å¯¹åº”å…³ç³»åˆ»æ„é‡‡ç”¨ä»å¤§åˆ°å°çš„æ–¹å¼æ’åˆ—ï¼Œåªè¦ä»å¤´éå†ï¼Œä¸€æ—¦æ»¡è¶³æ¡ä»¶å°±breakï¼‰ï¼Œè¡¨ç¤ºå‡ºæ¥ç„¶åå°†åŸæ•°å‡æ‰è¡¨ç¤ºå®Œçš„æ•°ï¼Œå°†å¾—åˆ°çš„ç½—é©¬æ•°å­—åŠ åˆ°ansé‡Œï¼Œå¾ªç¯ç»“æŸåå³å¯å¾—åˆ°æ­£ç¡®ansã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day17</title>
      <link href="/2023/10/17/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day17/"/>
      <url>/2023/10/17/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day17/</url>
      
        <content type="html"><![CDATA[<p><em><u>åŠªåŠ›æˆä¸ºé‚£ä½èƒ½è·å¾—ä½ è¿½å¯»ç›®æ ‡çš„äººç‰©ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/roman-to-integer/">ç½—é©¬æ•°å­—è½¬æ•´æ•°</a></p><p>ç½—é©¬æ•°å­—åŒ…å«ä»¥ä¸‹ä¸ƒç§å­—ç¬¦: <code>I</code>ï¼Œ <code>V</code>ï¼Œ <code>X</code>ï¼Œ <code>L</code>ï¼Œ<code>C</code>ï¼Œ<code>D</code> å’Œ <code>M</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å­—ç¬¦          æ•°å€¼</span><br><span class="line">I             1</span><br><span class="line">V             5</span><br><span class="line">X             10</span><br><span class="line">L             50</span><br><span class="line">C             100</span><br><span class="line">D             500</span><br><span class="line">M             1000</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œ ç½—é©¬æ•°å­— <code>2</code> å†™åš <code>II</code> ï¼Œå³ä¸ºä¸¤ä¸ªå¹¶åˆ—çš„ 1 ã€‚<code>12</code> å†™åš <code>XII</code> ï¼Œå³ä¸º <code>X</code> + <code>II</code> ã€‚ <code>27</code> å†™åš <code>XXVII</code>, å³ä¸º <code>XX</code> + <code>V</code> + <code>II</code> ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç½—é©¬æ•°å­—ä¸­å°çš„æ•°å­—åœ¨å¤§çš„æ•°å­—çš„å³è¾¹ã€‚ä½†ä¹Ÿå­˜åœ¨ç‰¹ä¾‹ï¼Œä¾‹å¦‚ 4 ä¸å†™åš <code>IIII</code>ï¼Œè€Œæ˜¯ <code>IV</code>ã€‚æ•°å­— 1 åœ¨æ•°å­— 5 çš„å·¦è¾¹ï¼Œæ‰€è¡¨ç¤ºçš„æ•°ç­‰äºå¤§æ•° 5 å‡å°æ•° 1 å¾—åˆ°çš„æ•°å€¼ 4 ã€‚åŒæ ·åœ°ï¼Œæ•°å­— 9 è¡¨ç¤ºä¸º <code>IX</code>ã€‚è¿™ä¸ªç‰¹æ®Šçš„è§„åˆ™åªé€‚ç”¨äºä»¥ä¸‹å…­ç§æƒ…å†µï¼š</p><ul><li><code>I</code> å¯ä»¥æ”¾åœ¨ <code>V</code> (5) å’Œ <code>X</code> (10) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 4 å’Œ 9ã€‚</li><li><code>X</code> å¯ä»¥æ”¾åœ¨ <code>L</code> (50) å’Œ <code>C</code> (100) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 40 å’Œ 90ã€‚ </li><li><code>C</code> å¯ä»¥æ”¾åœ¨ <code>D</code> (500) å’Œ <code>M</code> (1000) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 400 å’Œ 900ã€‚</li></ul><p>ç»™å®šä¸€ä¸ªç½—é©¬æ•°å­—ï¼Œå°†å…¶è½¬æ¢æˆæ•´æ•°ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">romanToInt</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        unordered_map&lt;<span class="type">char</span>,<span class="type">int</span>&gt; m;</span><br><span class="line">        m[<span class="string">&#x27;I&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">        m[<span class="string">&#x27;V&#x27;</span>]=<span class="number">5</span>;</span><br><span class="line">        m[<span class="string">&#x27;X&#x27;</span>]=<span class="number">10</span>;</span><br><span class="line">        m[<span class="string">&#x27;L&#x27;</span>]=<span class="number">50</span>;</span><br><span class="line">        m[<span class="string">&#x27;C&#x27;</span>]=<span class="number">100</span>;</span><br><span class="line">        m[<span class="string">&#x27;D&#x27;</span>]=<span class="number">500</span>;</span><br><span class="line">        m[<span class="string">&#x27;M&#x27;</span>]=<span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> per = <span class="number">1001</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;s.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(m[s[i]] &lt;= per)&#123;</span><br><span class="line">                ans += m[s[i]];</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                ans -= per;</span><br><span class="line">                ans += m[s[i]] - per;</span><br><span class="line">            &#125;</span><br><span class="line">            per = m[s[i]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310172149174.png" alt="image-20231017214958127"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>é‡å›ç®€å•é¢˜çš„æ„Ÿè§‰éå¸¸å¥½ï¼Œé¦–å…ˆé€‰æ‹©ç”¨hashè¡¨å­˜å‚¨charå­—ç¬¦å’Œæ•°å­—çš„ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œç„¶åé€ä¸€è§£æå­—ç¬¦ï¼Œåœ¨è§£æè¿‡ç¨‹ä¸­ä¿å­˜å‰ä¸€ä¸ªå­—ç¬¦å¯¹åº”çš„æ•°å­—è®°ä¸ºperï¼Œperåˆå§‹å€¼è®¾ä¸º1001ï¼ˆæ¯”æœ€å¤§çš„Må¤§1ï¼‰ï¼Œç„¶åè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœå½“å‰å­—ç¬¦å¯¹åº”çš„å€¼è¦å°äºç­‰äºperï¼Œåˆ™æ­£å¸¸ç´¯åŠ åˆ°ansä¸­ï¼Œå¦‚æœå¤§äºè¿™è¯´æ˜æ˜¯ç‰¹æ®Šè¡¨ç¤ºï¼Œå°±æŠŠperä»ansä¸­åˆ é™¤å†é‡æ–°åŠ å…¥å½“å‰æ•°-perå³å¯å¾—åˆ°æ­£ç¡®å€¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day16</title>
      <link href="/2023/10/16/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day16/"/>
      <url>/2023/10/16/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day16/</url>
      
        <content type="html"><![CDATA[<p><em><u>å¤§äººç‰©éƒ½æ˜¯ä»å°äººç‰©æ—¶ä¸æ–­åœ°å°è¯•è€Œé€ å°±ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/trapping-rain-water/">æ¥é›¨æ°´</a></p><p>ç»™å®š <code>n</code> ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º <code>1</code> çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">trap</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; height)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> h = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> max_height = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> hole = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> wall = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; height.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            max_height = <span class="built_in">max</span>(max_height,height[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(max_height &gt; h)&#123;</span><br><span class="line">            <span class="type">int</span> left = <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> right = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; height.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(height[i] &gt; h)&#123;</span><br><span class="line">                    left = i;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = height.<span class="built_in">size</span>() - <span class="number">1</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line">                <span class="keyword">if</span>(height[i] &gt; h)&#123;</span><br><span class="line">                    right = i;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            wall = <span class="built_in">min</span>(height[left],height[right]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = left + <span class="number">1</span>;i &lt; right;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(height[i] &lt; wall)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(height[i] &gt; h)&#123;</span><br><span class="line">                        sum += wall - height[i];</span><br><span class="line">                    &#125;<span class="keyword">else</span> </span><br><span class="line">                        sum += wall - h;</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            h = wall;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310161842687.png" alt="image-20231016184207642"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>æˆ‘æœ¬äººçš„æƒ³æ³•æ˜¯ï¼Œé¦–å…ˆå¯¹æ•´ä¸ªæ•°ç»„è¿›è¡Œä¸€æ¬¡éå†ï¼Œæ‰¾åˆ°æ•°ç»„ä¸­çš„æœ€å¤§å€¼ä½œä¸ºå¾ªç¯çš„é™åˆ¶æ¡ä»¶ã€‚è®¾ç½®å˜é‡hä¸ºå½“å‰å±‚æ•°ï¼Œç„¶åè¿›å…¥whileå¾ªç¯ï¼Œåœ¨whileå¾ªç¯ä¸­é¦–å…ˆä»å·¦åˆ°å³éå†ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå€¼å¤§äºhçš„ä¸‹æ ‡ï¼Œè®°ä¸ºleftï¼ŒåŒç†ä»å³åˆ°å·¦éå†ï¼Œè®°ä¸ºrightã€‚æ¥ä¸‹æ¥åœ¨leftå’Œrightä¸­çš„è¾ƒå°è€…ï¼ˆè®°ä¸ºwallï¼‰å›´æˆçš„åŒºåŸŸä¸­è¿›è¡Œæ“ä½œï¼Œéå†æ­¤åŒºåŸŸï¼Œä»ä¸­å‡å»æ— æ³•å­˜å‚¨é›¨æ°´çš„åŒºåŸŸï¼Œè¿™é‡Œåˆ†ä¸¤ç§æƒ…å†µï¼Œå¦‚æœå€¼å¤§äºhï¼Œåˆ™wallä¸å½“å‰height[i]çš„å·®å€¼å°±æ˜¯å‚¨æ°´åŒºåŸŸï¼Œå¦‚æœå€¼å°äºhï¼Œåˆ™wallå’Œhçš„å·®å€¼æ˜¯å‚¨æ°´åŒºåŸŸï¼Œç¬¬äºŒç§è¿™æ ·å¤„ç†çš„åŸå› æ˜¯é˜²æ­¢å·²ç»è®¡ç®—è¿‡çš„åŒºåŸŸé‡å¤è®¡ç®—ï¼Œéå†å®Œå½“å‰å±‚åï¼Œæ›´æ–°hçš„å€¼ä¸ºå½“å‰wallçš„é«˜åº¦ã€‚</p><p>ä½†è¿™æ ·æ—¶é—´å¤æ‚åº¦ååˆ†æ»´é«˜ï¼Œå¤§æ¦‚ç‡å› ä¸ºè¿›è¡Œäº†å¤ªå¤šæ¬¡çš„å¾ªç¯ï¼Œä¸‹é¢æ˜¯å®˜æ–¹é¢˜è§£ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">trap</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; height)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> left = <span class="number">0</span>, right = height.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> leftMax = <span class="number">0</span>, rightMax = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            leftMax = <span class="built_in">max</span>(leftMax, height[left]);</span><br><span class="line">            rightMax = <span class="built_in">max</span>(rightMax, height[right]);</span><br><span class="line">            <span class="keyword">if</span> (height[left] &lt; height[right]) &#123;</span><br><span class="line">                ans += leftMax - height[left];</span><br><span class="line">                ++left;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ans += rightMax - height[right];</span><br><span class="line">                --right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¦å¤–æˆ‘å•ç‹¬å†™äº†ä¸€ä»½å¯ä»¥å¯è§†åŒ–æ ·ä¾‹çš„ç¨‹åºï¼Œèƒ½æ–¹ä¾¿è°ƒè¯•å§ã€‚</p><p>(æ¯”è¾ƒä¸‘)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;head.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; n = &#123;<span class="number">5</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">6</span>&#125;;</span><br><span class="line">    <span class="type">int</span> max = <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">while</span>(max &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(n[i] &gt;= max)&#123;</span><br><span class="line">                cout&lt;&lt;<span class="number">0</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> </span><br><span class="line">                cout&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cout&lt;&lt;endl;</span><br><span class="line">        max--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310161933908.png" alt="image-20231016193349868"></p><p>æ ¹æ®ç»™çš„æ ·ä¾‹ç”ŸæˆæŸ±çŠ¶å›¾â†‘</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day15</title>
      <link href="/2023/10/12/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day15/"/>
      <url>/2023/10/12/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day15/</url>
      
        <content type="html"><![CDATA[<p><u><em>è¿‡åˆ†è°¨æ…çš„äººéš¾æœ‰æˆå°±ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/candy/">åˆ†å‘ç³–æœ</a></p><p><code>n</code> ä¸ªå­©å­ç«™æˆä¸€æ’ã€‚ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>ratings</code> è¡¨ç¤ºæ¯ä¸ªå­©å­çš„è¯„åˆ†ã€‚</p><p>ä½ éœ€è¦æŒ‰ç…§ä»¥ä¸‹è¦æ±‚ï¼Œç»™è¿™äº›å­©å­åˆ†å‘ç³–æœï¼š</p><ul><li>æ¯ä¸ªå­©å­è‡³å°‘åˆ†é…åˆ° <code>1</code> ä¸ªç³–æœã€‚</li><li>ç›¸é‚»ä¸¤ä¸ªå­©å­è¯„åˆ†æ›´é«˜çš„å­©å­ä¼šè·å¾—æ›´å¤šçš„ç³–æœã€‚</li></ul><p>è¯·ä½ ç»™æ¯ä¸ªå­©å­åˆ†å‘ç³–æœï¼Œè®¡ç®—å¹¶è¿”å›éœ€è¦å‡†å¤‡çš„ <strong>æœ€å°‘ç³–æœæ•°ç›®</strong> ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">candy</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; ratings)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = ratings.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">left</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">right</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i != <span class="number">0</span> &amp;&amp; ratings[i] &gt; ratings[i - <span class="number">1</span>])&#123;</span><br><span class="line">                left[i] = left[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                left[i] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(i != n - <span class="number">1</span> &amp;&amp; ratings[i] &gt; ratings[i + <span class="number">1</span>])&#123;</span><br><span class="line">                right[i] = right[i + <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                right[i] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            sum += <span class="built_in">max</span>(left[i], right[i]);</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310122122022.png" alt="image-20231012212252979"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>æ­¤é¢˜æœ€ç»ˆæ»¡è¶³ä¸¤ä¸ªè§„åˆ™ï¼Œä»å·¦åˆ°å³éå†ï¼Œæ¯æ¬¡æ¯”è¾ƒä¸¤ä¸ªå­©å­ï¼Œä¿è¯å¦‚æœå³è¾¹çš„å­©å­æ¯”å·¦è¾¹å­©å­åˆ†é«˜ï¼Œç³–æœä¹Ÿè¦å¤šã€‚ä»å³åˆ°å·¦éå†ï¼Œä¿è¯å·¦è¾¹çš„å­©å­åˆ†é«˜ï¼Œç³–æœæ¯”å³è¾¹å¤šã€‚ç®€ç§°å·¦è§„åˆ™å’Œå³è§„åˆ™ã€‚è¿›è¡Œä¸¤æ¬¡éå†ï¼Œç¬¬ä¸€æ¬¡éå†ä»å·¦åˆ°å³ï¼Œå°†æ»¡è¶³å·¦è§„åˆ™çš„ç³–æœåˆ†é…å­˜æ”¾åœ¨leftæ•°ç»„ä¸­ã€‚å†è¿›è¡Œä¸€éå³ä¾¿åˆ©ï¼Œæ»¡è¶³å°†æ»¡è¶³å³è§„åˆ™çš„ç³–æœåˆ†é…å­˜æ”¾åˆ°rightã€‚åŒæ—¶å¯¹æ¯”left[i]å’Œright[i]ï¼Œå–å…¶ä¸­æœ€å¤§çš„æ•°ï¼Œè¿™ä¸ªæ•°ä¸€å®šåŒæ—¶æ»¡è¶³å·¦å³è§„åˆ™ï¼Œç´¯åŠ åˆ°sumï¼Œæœ€ç»ˆå¾—åˆ°ç³–æœæ€»æ•°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day14</title>
      <link href="/2023/10/11/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day14/"/>
      <url>/2023/10/11/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day14/</url>
      
        <content type="html"><![CDATA[<p><u><em>æ—¶ä»£å’Œç¯å¢ƒå˜åŒ–éå¸¸å¿«é€Ÿï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æŒç»­å°†ç›®å…‰èšç„¦åœ¨æœªæ¥ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/gas-station/">åŠ æ²¹ç«™</a></p><p>åœ¨ä¸€æ¡ç¯è·¯ä¸Šæœ‰ <code>n</code> ä¸ªåŠ æ²¹ç«™ï¼Œå…¶ä¸­ç¬¬ <code>i</code> ä¸ªåŠ æ²¹ç«™æœ‰æ±½æ²¹ <code>gas[i]</code> å‡ã€‚</p><p>ä½ æœ‰ä¸€è¾†æ²¹ç®±å®¹é‡æ— é™çš„çš„æ±½è½¦ï¼Œä»ç¬¬ <code>i</code> ä¸ªåŠ æ²¹ç«™å¼€å¾€ç¬¬ <code>i+1</code> ä¸ªåŠ æ²¹ç«™éœ€è¦æ¶ˆè€—æ±½æ²¹ <code>cost[i]</code> å‡ã€‚ä½ ä»å…¶ä¸­çš„ä¸€ä¸ªåŠ æ²¹ç«™å‡ºå‘ï¼Œå¼€å§‹æ—¶æ²¹ç®±ä¸ºç©ºã€‚</p><p>ç»™å®šä¸¤ä¸ªæ•´æ•°æ•°ç»„ <code>gas</code> å’Œ <code>cost</code> ï¼Œå¦‚æœä½ å¯ä»¥æŒ‰é¡ºåºç»•ç¯è·¯è¡Œé©¶ä¸€å‘¨ï¼Œåˆ™è¿”å›å‡ºå‘æ—¶åŠ æ²¹ç«™çš„ç¼–å·ï¼Œå¦åˆ™è¿”å› <code>-1</code> ã€‚å¦‚æœå­˜åœ¨è§£ï¼Œåˆ™ <strong>ä¿è¯</strong> å®ƒæ˜¯ <strong>å”¯ä¸€</strong> çš„ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">canCompleteCircuit</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; gas, vector&lt;<span class="type">int</span>&gt;&amp; cost)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> now = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> start = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; gas.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            now += gas[i] - cost[i];</span><br><span class="line">            sum += gas[i] - cost[i];</span><br><span class="line">            <span class="keyword">if</span>(now &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                start = i+<span class="number">1</span>;</span><br><span class="line">                now = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(sum &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> start;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“ä¸æ”¶è·ï¼š"><a href="#æ€»ç»“ä¸æ”¶è·ï¼š" class="headerlink" title="æ€»ç»“ä¸æ”¶è·ï¼š"></a>æ€»ç»“ä¸æ”¶è·ï¼š</h1><p>æ­¤é¢˜é¦–å…ˆç¡®ç«‹ä¸¤æ­¥ï¼Œä¸€æ˜¯æ€»æ²¹é‡å‡æ€»æ¶ˆè€—å¦‚æœå¤§äº0ï¼Œé‚£å¿…å®šæœ‰è§£ï¼›äºŒæ˜¯éå†æ‰€æœ‰åŠ æ²¹ç«™ï¼Œåªè¦å½“å‰çš„æ¶ˆè€—å¤§äºæ²¹é‡ï¼Œåˆ™è¯´æ˜è¿™ä¸ªå‡ºå‘ç‚¹ä¸è¡Œï¼Œç›´æ¥å®šä¹‰ä¸‹ä¸€ä¸ªåŠ æ²¹ç«™ä¸ºèµ·ç‚¹ã€‚è¿™æ ·éå†ä¸€éåŠ æ²¹ç«™åï¼Œå°±èƒ½å¾—å‡ºæœ‰æ²¡æœ‰è§£ã€‚ï¼ˆæ€ä¹ˆç¡®ä¿è¿™æ˜¯å”¯ä¸€è§£ï¼Ÿï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day13</title>
      <link href="/2023/10/10/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day13/"/>
      <url>/2023/10/10/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day13/</url>
      
        <content type="html"><![CDATA[<p><em><u>å¤±è´¥æ˜¯æŠµè¾¾å“è¶Šçš„å¦ä¸€ä¸ªè¸è„šçŸ³ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/product-of-array-except-self/"> é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯</a></p><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œè¿”å› <em>æ•°ç»„ <code>answer</code> ï¼Œå…¶ä¸­ <code>answer[i]</code> ç­‰äº <code>nums</code> ä¸­é™¤ <code>nums[i]</code> ä¹‹å¤–å…¶ä½™å„å…ƒç´ çš„ä¹˜ç§¯</em> ã€‚</p><p>é¢˜ç›®æ•°æ® <strong>ä¿è¯</strong> æ•°ç»„ <code>nums</code>ä¹‹ä¸­ä»»æ„å…ƒç´ çš„å…¨éƒ¨å‰ç¼€å…ƒç´ å’Œåç¼€çš„ä¹˜ç§¯éƒ½åœ¨ <strong>32 ä½</strong> æ•´æ•°èŒƒå›´å†…ã€‚</p><p>è¯· <strong>ä¸è¦ä½¿ç”¨é™¤æ³•ï¼Œ</strong>ä¸”åœ¨ <code>O(*n*)</code> æ—¶é—´å¤æ‚åº¦å†…å®Œæˆæ­¤é¢˜ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">productExceptSelf</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(len == <span class="number">0</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">ans</span><span class="params">(len,<span class="number">1</span>)</span></span>;</span><br><span class="line">        ans[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; nums.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            ans[i] = ans[i - <span class="number">1</span>] * nums[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> tmp = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = nums.<span class="built_in">size</span>() - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line">            tmp *= nums[i + <span class="number">1</span>];</span><br><span class="line">            ans[i] *= tmp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310101901689.png" alt="image-20231010190145639"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>åˆšæ‹¿åˆ°é¢˜ç›®ï¼Œæˆ‘è¿˜åœ¨çªƒå–œï¼Œæ­¤é¢˜åªè¦æå‰ç®—å‡ºæ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯ï¼Œå†åˆ©ç”¨é™¤æ³•å³å¯è½»æ¾è§£å†³ï¼Œæ— å¥ˆå‘ç°é¢˜ç›®è¦æ±‚ä¸èƒ½ç”¨é™¤æ³•ï¼Œé‚ä½œç½¢ã€‚å…¶å®è¦æƒ³æ±‚ä¸€ä¸ªæ•°é™¤äº†è‡ªå·±æœ¬èº«ï¼Œå…¶ä»–æ•°çš„ä¹˜ç§¯æ— éå°±æ˜¯ä¸‰ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€æ­¥ï¼Œæ±‚è¯¥æ•°å·¦è¾¹éƒ¨åˆ†çš„ä¹˜ç§¯ï¼Œç¬¬äºŒæ­¥æ±‚å³è¾¹éƒ¨åˆ†çš„ä¹˜ç§¯ï¼Œç¬¬ä¸‰æ­¥ä¸¤è¾¹ä¹˜ç§¯ç›¸ä¹˜ï¼Œå³å¯å¾—åˆ°ç»“æœï¼Œäºæ˜¯åœ¨ä»£ç ä¸­ï¼Œæˆ‘ç”¨äº†ä¸¤ä¸ªå¾ªç¯ï¼Œç¬¬ä¸€ä¸ªå¾ªç¯æ˜¯è®¡ç®—æ¯ä¸ªå…ƒç´ å·¦è¾¹æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯ï¼Œç¬¬äºŒä¸ªå¾ªç¯æ˜¯ç”¨ç¬¬ä¸€æ­¥çš„è®¡ç®—ç»“æœï¼Œä¹˜å³è¾¹éƒ¨åˆ†ï¼Œæœ€ç»ˆå¾—åˆ°ansæ•°ç»„å³æ˜¯ç»“æœï¼Œé¢˜ä¸­è¿˜è¿ç”¨äº†åŠ¨æ€è§„åˆ’ï¼Œansæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œéƒ½å¯ä»¥çœ‹åšæ˜¯å‰ä¸€ä¸ªå…ƒç´ ä¹˜numsæ•°ç»„ä¸Šä¸€ä¸ªå…ƒç´ æ‰€å¾—ï¼Œæ²¡æœ‰é‡å¤è®¡ç®—ï¼Œä¸‹é¢é™„å‡ å¼ å¤§ä½¬çš„è§£è¯»å›¾ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310101904116.png" alt="image-20231010190452079"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310101905326.png" alt="image-20231010190502289"></p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day12</title>
      <link href="/2023/10/09/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day12/"/>
      <url>/2023/10/09/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day12/</url>
      
        <content type="html"><![CDATA[<p><em><u>äº‹æƒ…ä¼šæ”¹å˜ï¼Œæœ‹å‹ä¼šç¦»å»ã€‚ ç”Ÿå‘½ä¸ä¼šä¸ºäº†ä»»ä½•äººè€Œåœæ­‡ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/insert-delete-getrandom-o1/">O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ </a></p><p>å®ç°<code>RandomizedSet</code> ç±»ï¼š</p><ul><li><code>RandomizedSet()</code> åˆå§‹åŒ– <code>RandomizedSet</code> å¯¹è±¡</li><li><code>bool insert(int val)</code> å½“å…ƒç´  <code>val</code> ä¸å­˜åœ¨æ—¶ï¼Œå‘é›†åˆä¸­æ’å…¥è¯¥é¡¹ï¼Œå¹¶è¿”å› <code>true</code> ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</li><li><code>bool remove(int val)</code> å½“å…ƒç´  <code>val</code> å­˜åœ¨æ—¶ï¼Œä»é›†åˆä¸­ç§»é™¤è¯¥é¡¹ï¼Œå¹¶è¿”å› <code>true</code> ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</li><li><code>int getRandom()</code> éšæœºè¿”å›ç°æœ‰é›†åˆä¸­çš„ä¸€é¡¹ï¼ˆæµ‹è¯•ç”¨ä¾‹ä¿è¯è°ƒç”¨æ­¤æ–¹æ³•æ—¶é›†åˆä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚æ¯ä¸ªå…ƒç´ åº”è¯¥æœ‰ <strong>ç›¸åŒçš„æ¦‚ç‡</strong> è¢«è¿”å›ã€‚</li></ul><p>ä½ å¿…é¡»å®ç°ç±»çš„æ‰€æœ‰å‡½æ•°ï¼Œå¹¶æ»¡è¶³æ¯ä¸ªå‡½æ•°çš„ <strong>å¹³å‡</strong> æ—¶é—´å¤æ‚åº¦ä¸º <code>O(1)</code> ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RandomizedSet</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; data;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">RandomizedSet</span>() &#123;</span><br><span class="line"></span><br><span class="line">        data.<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data.<span class="built_in">find</span>(val) != data.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        data[val] = data.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">remove</span><span class="params">(<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data.<span class="built_in">find</span>(val) == data.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        data.<span class="built_in">erase</span>(val);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getRandom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = data.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> index = <span class="built_in">rand</span>() % n;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> it = data.<span class="built_in">begin</span>(); it != data.<span class="built_in">end</span>(); it++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == index) &#123;</span><br><span class="line">                <span class="keyword">return</span> it-&gt;first;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-999</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310092308196.png" alt="image-20231009230830147"></p><h1 id="æ€»ç»“æ”¶è·ï¼š"><a href="#æ€»ç»“æ”¶è·ï¼š" class="headerlink" title="æ€»ç»“æ”¶è·ï¼š"></a>æ€»ç»“æ”¶è·ï¼š</h1><p>é¢˜ç›®è¦æ±‚åœ¨o(1)å¤æ‚åº¦å†…å®ç°é›†åˆçš„å¢ï¼Œåˆ ï¼Œå’Œéšæœºè·å–ï¼Œoï¼ˆ1ï¼‰å¤æ‚çš„é¦–é€‰å“ˆå¸Œè¡¨ï¼Œåœ¨é¢˜ç›®ç»™çš„ç±»ä¸­åŠ å…¥æ–°çš„å…ƒç´ ï¼šå“ˆå¸Œè¡¨dataï¼Œç”¨æ¥å­˜æ”¾æ•°æ®ï¼Œä¹‹åå†è°ƒç”¨å“ˆå¸Œè¡¨æœ¬èº«è‡ªå¸¦çš„æ–¹æ³•å³å¯å®ç°o(1)å¤æ‚åº¦å¢åˆ ï¼Œä½†å–éšæœºå…ƒç´ ä¼šæ¯”è¾ƒå¤æ‚ï¼Œæœ€åæƒ…å†µéœ€è¦oï¼ˆnï¼‰çš„å¤æ‚åº¦ï¼Œå› æ­¤è¿™å¹¶ä¸æ˜¯æœ€ä¼˜è§£ã€‚</p><h1 id="ä¼˜åŒ–ï¼š"><a href="#ä¼˜åŒ–ï¼š" class="headerlink" title="ä¼˜åŒ–ï¼š"></a>ä¼˜åŒ–ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RandomizedSet</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; nums;</span><br><span class="line">    unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; data;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">RandomizedSet</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data.<span class="built_in">count</span>(val) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        data[val] = data.<span class="built_in">size</span>();</span><br><span class="line">        nums.<span class="built_in">emplace_back</span>(val);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">remove</span><span class="params">(<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data.<span class="built_in">count</span>(val) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> index = data[val];</span><br><span class="line">        <span class="type">int</span> last = nums.<span class="built_in">back</span>();</span><br><span class="line">        nums[index] = last;</span><br><span class="line">        data[last] = index;</span><br><span class="line">        nums.<span class="built_in">pop_back</span>();</span><br><span class="line">        data.<span class="built_in">erase</span>(val);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getRandom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> index = <span class="built_in">rand</span>() % nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">return</span> nums[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…·ä½“ä¼˜åŒ–å°±æ˜¯æ–°å¢äº†ä¸€ä¸ªæ•°ç»„ç”¨æ¥å­˜æ”¾é›†åˆé‡Œçš„å…ƒç´ ï¼Œä¸ä¹‹å‰çš„ä»£ç ç›¸æ¯”ï¼Œé™¤äº†ç©ºé—´å¤æ‚åº¦ç•¥æœ‰æé«˜ä¹‹å¤–ï¼Œä»£ç ä½“ç§¯ä¸Šä¹Ÿæœ‰å¢åŠ ï¼Œå› ä¸ºéœ€è¦åŒæ­¥ç»´æŠ¤è¯¥æ•°ç»„ï¼Œè¯¥æ•°ç»„æœ€é‡è¦çš„ä½œç”¨æ˜¯åœ¨å–éšæœºå€¼æ—¶å¯ä»¥ç›´æ¥ä½œä¸ºç´¢å¼•ï¼Œå–å¾—éšæœºæ•°ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯o(1)ã€‚</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310092316276.png" alt="image-20231009231602231"></p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day11</title>
      <link href="/2023/10/08/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day11/"/>
      <url>/2023/10/08/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day11/</url>
      
        <content type="html"><![CDATA[<p><em><u>åŸè°…æ˜¯äººé™…å…³ç³»çš„æ¶¦æ»‘æ²¹ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/h-index/">H æŒ‡æ•°</a></p><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>citations</code> ï¼Œå…¶ä¸­ <code>citations[i]</code> è¡¨ç¤ºç ”ç©¶è€…çš„ç¬¬ <code>i</code> ç¯‡è®ºæ–‡è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚è®¡ç®—å¹¶è¿”å›è¯¥ç ”ç©¶è€…çš„ <strong><code>h</code> æŒ‡æ•°</strong>ã€‚</p><p>æ ¹æ®ç»´åŸºç™¾ç§‘ä¸Š <a href="https://baike.baidu.com/item/h-index/3991452?fr=aladdin">h æŒ‡æ•°çš„å®šä¹‰</a>ï¼š<code>h</code> ä»£è¡¨â€œé«˜å¼•ç”¨æ¬¡æ•°â€ ï¼Œä¸€åç§‘ç ”äººå‘˜çš„ <code>h</code> <strong>æŒ‡æ•°</strong> æ˜¯æŒ‡ä»–ï¼ˆå¥¹ï¼‰è‡³å°‘å‘è¡¨äº† <code>h</code> ç¯‡è®ºæ–‡ï¼Œå¹¶ä¸”æ¯ç¯‡è®ºæ–‡ <strong>è‡³å°‘</strong> è¢«å¼•ç”¨ <code>h</code> æ¬¡ã€‚å¦‚æœ <code>h</code> æœ‰å¤šç§å¯èƒ½çš„å€¼ï¼Œ**<code>h</code> æŒ‡æ•°** æ˜¯å…¶ä¸­æœ€å¤§çš„é‚£ä¸ªã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">hIndex</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; citations)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(citations.<span class="built_in">begin</span>(), citations.<span class="built_in">end</span>());</span><br><span class="line">        <span class="type">int</span> len = citations.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(citations[i] &gt;= len - i)&#123;</span><br><span class="line">                <span class="keyword">return</span> len - i;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310082137008.png" alt="image-20231008213659929"></p><h1 id="æ€»ç»“æ”¶è·ï¼š"><a href="#æ€»ç»“æ”¶è·ï¼š" class="headerlink" title="æ€»ç»“æ”¶è·ï¼š"></a>æ€»ç»“æ”¶è·ï¼š</h1><p>é¢˜ç›®çœ‹èµ·æ¥æ¯”è¾ƒå”¬äººï¼Œä½†å®é™…å°±æ˜¯ä¸‹æ ‡å’Œæ•°ç»„å€¼ä¹‹é—´çš„å…³ç³»ï¼Œå½“æˆ‘ä»¬æŠŠæ•°ç»„å‡åºæ’åºåï¼Œæ­¤æ—¶æ•°ç»„ä¸­æ˜¯è®ºæ–‡å¼•ç”¨æ¬¡æ•°é€’å¢ï¼Œå†ä»å¤´éå†æ•°ç»„ï¼Œå½“æ•°ç»„ä¸­çš„æœ€å°å€¼å¤§äºæ•°ç»„å‰©ä½™å…ƒç´ ä¸ªæ•°ï¼Œè¿™ä¸ªå€¼å°±æ˜¯é¢˜ç›®è¦æ±‚çš„hæŒ‡æ•°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day10</title>
      <link href="/2023/10/07/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day10/"/>
      <url>/2023/10/07/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day10/</url>
      
        <content type="html"><![CDATA[<p><em><u>å–„ç”¨ä½ çš„ä¼˜åŠ¿ã€‚ å¤šåšä½ æ“…é•¿çš„äº‹æƒ…è€Œä¸æ˜¯é‚£äº›ä½ ä¸æ“…é•¿çš„äº‹ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/jump-game-ii/">è·³è·ƒæ¸¸æˆ II</a></p><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º <code>n</code> çš„ <strong>0 ç´¢å¼•</strong>æ•´æ•°æ•°ç»„ <code>nums</code>ã€‚åˆå§‹ä½ç½®ä¸º <code>nums[0]</code>ã€‚</p><p>æ¯ä¸ªå…ƒç´  <code>nums[i]</code> è¡¨ç¤ºä»ç´¢å¼• <code>i</code> å‘å‰è·³è½¬çš„æœ€å¤§é•¿åº¦ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ åœ¨ <code>nums[i]</code> å¤„ï¼Œä½ å¯ä»¥è·³è½¬åˆ°ä»»æ„ <code>nums[i + j]</code> å¤„:</p><ul><li><code>0 &lt;= j &lt;= nums[i]</code> </li><li><code>i + j &lt; n</code></li></ul><p>è¿”å›åˆ°è¾¾ <code>nums[n - 1]</code> çš„æœ€å°è·³è·ƒæ¬¡æ•°ã€‚ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹å¯ä»¥åˆ°è¾¾ <code>nums[n - 1]</code>ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">jump</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> step = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> end = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> maxPos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>() - <span class="number">1</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        maxPos = <span class="built_in">max</span>(nums[i] + i, maxPos);</span><br><span class="line">        <span class="keyword">if</span> (i == end)</span><br><span class="line">        &#123;</span><br><span class="line">            end = maxPos;</span><br><span class="line">            step++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> step;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310072326239.png" alt="image-20231007232643158"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day09</title>
      <link href="/2023/10/04/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day09/"/>
      <url>/2023/10/04/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day09/</url>
      
        <content type="html"><![CDATA[<p><em><u>ä¸è®ºä»Šå¤©è¿‡å¾—å¾ˆå¥½è¿˜æ˜¯è¿‡å¾—å¾ˆæœ‰è¶£ã€‚ æ˜å¤©éƒ½æ˜¯æ–°çš„å¼€å§‹ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/jump-game/">è·³è·ƒæ¸¸æˆ</a></p><p>ç»™ä½ ä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ <strong>ç¬¬ä¸€ä¸ªä¸‹æ ‡</strong> ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚</p><p>åˆ¤æ–­ä½ æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾æœ€åä¸€ä¸ªä¸‹æ ‡ï¼Œå¦‚æœå¯ä»¥ï¼Œè¿”å› <code>true</code> ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">canJump</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> most = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; most) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            k = <span class="built_in">max</span>(most, i + nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310041949219.png" alt="image-20231004194923166"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>éå†ä¸€éæ•°ç»„ï¼Œçœ‹çœ‹èƒ½åˆ°è¾¾çš„æœ€è¿œè·ç¦»æ˜¯å¦æ¯”æ•°ç»„è¦é•¿ï¼Œå¦‚æœæ˜¯å°±èƒ½åˆ°è¾¾ã€‚å¼€å§‹æƒ³éº»çƒ¦äº†ï¼ŒæŠŠæ‰€æœ‰ä¹‹åèƒ½è·³åˆ°çš„ç‚¹éƒ½éå†ä¸€éï¼Œæ‰¾æœ€è¿œçš„ï¼Œç„¶åä¸åœé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œå®é™…ä¸Šåªéœ€è¦è®°å½•ä¸€ä¸ªæœ€è¿œè·ç¦»ï¼Œå¦‚æœã€‚å¦å¤–å¦‚æœi &gt; mostè¯´æ˜içš„å€¼å·²ç»è¶…è¿‡äº†æœ€è¿œè·ç¦»ï¼Œè¯´æ˜mostä¸€å®šåœ¨æŸå¤„åœæ­¢æ›´æ–°ï¼Œæ°¸è¿œä¸ä¼šåˆ°è¾¾ç»ˆç‚¹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day08</title>
      <link href="/2023/10/03/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day08/"/>
      <url>/2023/10/03/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day08/</url>
      
        <content type="html"><![CDATA[<p><u><em>åƒç§‹ä¸ºå·ï¼Œå±±æ²³ä½œç­”ã€‚</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-ii/">ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II</a></p><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>prices</code> ï¼Œå…¶ä¸­ <code>prices[i]</code> è¡¨ç¤ºæŸæ”¯è‚¡ç¥¨ç¬¬ <code>i</code> å¤©çš„ä»·æ ¼ã€‚</p><p>åœ¨æ¯ä¸€å¤©ï¼Œä½ å¯ä»¥å†³å®šæ˜¯å¦è´­ä¹°å’Œ&#x2F;æˆ–å‡ºå”®è‚¡ç¥¨ã€‚ä½ åœ¨ä»»ä½•æ—¶å€™ <strong>æœ€å¤š</strong> åªèƒ½æŒæœ‰ <strong>ä¸€è‚¡</strong> è‚¡ç¥¨ã€‚ä½ ä¹Ÿå¯ä»¥å…ˆè´­ä¹°ï¼Œç„¶ååœ¨ <strong>åŒä¸€å¤©</strong> å‡ºå”®ã€‚</p><p>è¿”å› <em>ä½ èƒ½è·å¾—çš„ <strong>æœ€å¤§</strong> åˆ©æ¶¦</em> ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> temp = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> profit = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>;i &lt; prices.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            temp = prices[i] - prices[i<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">if</span>(temp &gt; <span class="number">0</span>) profit += temp;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> profit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310032015200.png" alt="image-20231003201555152"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>æœ¬é¢˜è¿ç”¨äº†è´ªå¿ƒç®—æ³•ï¼Œå…¶å®æ˜¯ä¸€ç§å–å·§æ–¹æ³•ï¼Œè´ªå¿ƒç®—æ³•çš„è¦ç‚¹æ˜¯æ¯æ¬¡éƒ½å–æœ€ä¼˜è§£ï¼Œè¿ç”¨åˆ°æœ¬é¢˜ä¸­ï¼Œå…¶å®å°±æ˜¯åªè¦ä»Šå¤©æ¯”æ˜¨å¤©çš„è‚¡ç¥¨æœ‰æ¶¨å€¼ï¼Œå°±å‡ºæ‰‹è·å¾—åˆ©æ¶¦ï¼Œè´ªå¿ƒçš„è¿‡ç¨‹ä¸æ˜¯æœ€ç»ˆçš„è´­ä¹°è¿‡ç¨‹ï¼Œä½†å¯ä»¥åˆ©ç”¨è´ªå¿ƒç®—æ³•è®¡ç®—æœ€å¤§åˆ©æ¶¦ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day07</title>
      <link href="/2023/10/01/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day07/"/>
      <url>/2023/10/01/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day07/</url>
      
        <content type="html"><![CDATA[<h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/best-time-to-buy-and-sell-stock/">ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</a></p><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <code>prices</code> ï¼Œå®ƒçš„ç¬¬ <code>i</code> ä¸ªå…ƒç´  <code>prices[i]</code> è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ <code>i</code> å¤©çš„ä»·æ ¼ã€‚</p><p>ä½ åªèƒ½é€‰æ‹© <strong>æŸä¸€å¤©</strong> ä¹°å…¥è¿™åªè‚¡ç¥¨ï¼Œå¹¶é€‰æ‹©åœ¨ <strong>æœªæ¥çš„æŸä¸€ä¸ªä¸åŒçš„æ—¥å­</strong> å–å‡ºè¯¥è‚¡ç¥¨ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚</p><p>è¿”å›ä½ å¯ä»¥ä»è¿™ç¬”äº¤æ˜“ä¸­è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚å¦‚æœä½ ä¸èƒ½è·å–ä»»ä½•åˆ©æ¶¦ï¼Œè¿”å› <code>0</code> ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> min = prices[<span class="number">0</span>];    </span><br><span class="line">        <span class="type">int</span> max_profit = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> day: prices)&#123;</span><br><span class="line">            max_profit = max_profit&gt;(day-min)?max_profit:(day-min);</span><br><span class="line">            min = min&lt;(day)?min:day;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> max_profit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310012353713.png" alt="image-20231001235321662"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>æ‹¿ç°å®ä¸­ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬ä¹°å½©ç¥¨æƒ³è®¡ç®—å¦‚æœæˆ‘ä»¬ä»Šå¤©å–å‡ºï¼Œæœ€å¤šèƒ½èµšå¤šå°‘ï¼Œé‚£ä¸€å®šæ˜¯éœ€è¦æˆ‘ä»¬åœ¨ä¹‹å‰ä»·æ ¼æœ€ä½çš„ä¸€å¤©ä¹°å…¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€æ¬¡éå†è¯¥æ•°ç»„ï¼Œè®°å½•ä¸‹å†å²æœ€ä½ä»·æ ¼ï¼Œå°±å‡è®¾æˆ‘ä»¬æ˜¯é‚£å¤©ä¹°å…¥çš„ï¼Œä¹‹åå†ç»§ç»­éå†æ¯å¤©çš„åˆ©æ¶¦ï¼ˆå–å‡º-ä¹°å…¥ï¼‰ï¼Œè®°å½•ä¸‹ä¸€ä¸ªæœ€å¤§å€¼ã€‚è¿™æ ·åœ¨ä¸€æ¬¡éå†ä¹‹åï¼Œå°±èƒ½å¾—åˆ°æœ€ä¼˜è§£ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day06</title>
      <link href="/2023/09/30/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day06/"/>
      <url>/2023/09/30/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day06/</url>
      
        <content type="html"><![CDATA[<p><u><em>é¢å¯¹é˜³å…‰ä½ å°±ä¸ä¼šçœ‹åˆ°é˜´å½±</em></u></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/rotate-array/">è½®è½¬æ•°ç»„</a></p><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œå°†æ•°ç»„ä¸­çš„å…ƒç´ å‘å³è½®è½¬ <code>k</code> ä¸ªä½ç½®ï¼Œå…¶ä¸­ <code>k</code> æ˜¯éè´Ÿæ•°ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        k = k % nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">reverse</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="built_in">reverse</span>(nums.<span class="built_in">begin</span>(),nums.<span class="built_in">begin</span>()+ k - <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">reverse</span>(nums.<span class="built_in">begin</span>() + k, nums.<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202309301820301.png" alt="image-20230930182046224"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>æœ¬é¢˜è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè½®è½¬æ•°ç»„ï¼Œå¦‚æœè¦è½®è½¬kä¸ªå…ƒç´ ï¼Œé¦–å…ˆå°†kçš„æ•°å€¼èŒƒå›´å‡å°æˆk % nums.size()ï¼Œè¿™æ‰æ˜¯æœ‰æ•ˆç§»åŠ¨çš„ä½æ•°ï¼Œç„¶åå°†æ•´ä¸ªæ•°ç»„è¿›è¡Œç¿»è½¬ï¼Œå†ç„¶åä»¥ä¸‹æ ‡kä¸ºåˆ†ç•Œçº¿ï¼Œåˆ†ç•Œçº¿å·¦è¾¹å’Œå³è¾¹åˆ†åˆ«å†è¿›è¡Œä¸€æ¬¡ç¿»è½¬ï¼Œæœ€ç»ˆå¾—åˆ°ç¿»è½¬åçš„æ•°ç»„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day05æ‘©å°”æŠ•ç¥¨</title>
      <link href="/2023/09/29/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day05%E6%91%A9%E5%B0%94%E6%8A%95%E7%A5%A8/"/>
      <url>/2023/09/29/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day05%E6%91%A9%E5%B0%94%E6%8A%95%E7%A5%A8/</url>
      
        <content type="html"><![CDATA[<p><em><u>æˆ‘ä»å¤±è´¥èµ°å‘æˆåŠŸã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/majority-element/">å¤šæ•°å…ƒç´ </a></p><p>ç»™å®šä¸€ä¸ªå¤§å°ä¸º <code>n</code> çš„æ•°ç»„ <code>nums</code> ï¼Œè¿”å›å…¶ä¸­çš„å¤šæ•°å…ƒç´ ã€‚å¤šæ•°å…ƒç´ æ˜¯æŒ‡åœ¨æ•°ç»„ä¸­å‡ºç°æ¬¡æ•° <strong>å¤§äº</strong> <code>âŒŠ n/2 âŒ‹</code> çš„å…ƒç´ ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ•°ç»„æ˜¯éç©ºçš„ï¼Œå¹¶ä¸”ç»™å®šçš„æ•°ç»„æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">majorityElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">ceil</span>(nums.<span class="built_in">size</span>() / <span class="number">2.0</span>);</span><br><span class="line">        <span class="keyword">return</span> nums[len - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202309300042563.png" alt="image-20230930004210454"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>è¿™ä¸ªæ±‚è§£æ€è·¯å…¶å®å’Œæ±‚è§£ä¼—æ•°ï¼ˆä¸€ç»„æ•°æ®ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ•°ï¼‰ä½†é¢˜ç›®æ˜¯æ‰¾å‡ºå‡ºç°æ¬¡æ•°å¤§äºn&#x2F;2çš„æ•°ï¼ˆå¤šæ•°å…ƒç´ ï¼‰ï¼Œåªèƒ½è¯´å¤šæ•°å…ƒç´ ä¸€å®šæ˜¯ä¼—æ•°ï¼Œè€Œä¼—æ•°ä¸ä¸€å®šæ˜¯å¤šæ•°å…ƒç´ ï¼Œä½†é¢˜ç›®è¯´å‡è®¾ä¸€å®šä¼šæœ‰å¤šæ•°å…ƒç´ ï¼Œæ‰€ä»¥ç”¨è¿™ç§æ–¹æ³•ä¹Ÿå¯ä»¥æ±‚å‡ºé¢˜è§£ã€‚</p><p>å°†ä¸€ä¸ªæ•°ç»„æ’åºï¼Œä¸­ä½æ•°ä¸€å®šæ˜¯ä¼—æ•°ã€‚</p><p>åœ¨è¯„è®ºåŒºçœ‹åˆ°äº†ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„è§£æ³•ï¼Œå«æ‘©å°”æŠ•ç¥¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">majorityElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = <span class="number">0</span>,votes = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> num:nums)&#123;</span><br><span class="line">            <span class="keyword">if</span>(votes == <span class="number">0</span>) n = num;</span><br><span class="line">            votes += num == n?<span class="number">1</span>:<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>nä¸ºç›®å‰å‡è®¾çš„å¤šæ•°å…ƒç´ çš„å€¼ï¼Œvotesæ˜¯â€œç¥¨æ•°â€ï¼Œéå†æ•°ç»„ï¼Œå½“æ•°ç»„å…ƒç´ ç­‰äºæˆ‘ä»¬å‡è®¾çš„å¤šæ•°å…ƒç´ ï¼Œé‚£å°±ç»™ç¥¨æ•°+1ï¼Œå¦‚æœç­‰äºåˆ™-1ï¼Œå› ä¸ºå¤šæ•°å…ƒç´ çš„æ•°é‡ä¸€å®šå¤§äºæ•°ç»„é•¿åº¦çš„ä¸€åŠï¼Œæ‰€ä»¥å…¶ä»–å…ƒç´ çš„ç¥¨æ•°æ˜¯ä¸å¯èƒ½å¤§äºå¤šæ•°å…ƒç´ çš„ï¼Œå³-1çš„æ•°é‡ä¼šå°äº+1ï¼Œè€Œå¯¹äºé”™è¯¯çš„å‡è®¾ï¼Œæœ€ç»ˆvotesä¸€å®šä¼šå˜æˆ0ï¼Œç„¶åä¼šå‡è®¾æ–°çš„å…ƒç´ ä¸ºå¤šæ•°å…ƒç´ ã€‚</p><ul><li><strong>æ—¶é—´å¤æ‚åº¦ O(N)O(N)*O*(*N*) ï¼š</strong> NN<em>N</em> ä¸ºæ•°ç»„ <code>nums</code> é•¿åº¦ã€‚</li><li><strong>ç©ºé—´å¤æ‚åº¦ O(1)O(1)*O*(1) ï¼š</strong> <code>votes</code> å˜é‡ä½¿ç”¨å¸¸æ•°å¤§å°çš„é¢å¤–ç©ºé—´ã€‚</li></ul><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202309300101950.png" alt="image-20230930010124902"></p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day04</title>
      <link href="/2023/09/29/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day04/"/>
      <url>/2023/09/29/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day04/</url>
      
        <content type="html"><![CDATA[<p><em><u>å¿§è™‘çš„åº¦è¿‡ä¸€å¤©ï¼Œæ¯”èµ·å·¥ä½œä¸€å‘¨è¿˜ä»¤äººåŠ³ç´¯ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/remove-duplicates-from-sorted-array-ii/">åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ II</a></p><p>ç»™ä½ ä¸€ä¸ªæœ‰åºæ•°ç»„ <code>nums</code> ï¼Œè¯·ä½ **<a href="http://baike.baidu.com/item/%E5%8E%9F%E5%9C%B0%E7%AE%97%E6%B3%95"> åŸåœ°</a>** åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿å¾—å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸¤æ¬¡çš„å…ƒç´ <strong>åªå‡ºç°ä¸¤æ¬¡</strong> ï¼Œè¿”å›åˆ é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p><p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨ <strong><a href="https://baike.baidu.com/item/%E5%8E%9F%E5%9C%B0%E7%AE%97%E6%B3%95">åŸåœ° </a>ä¿®æ”¹è¾“å…¥æ•°ç»„</strong> å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">removeDuplicates</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.<span class="built_in">size</span>() &lt;= <span class="number">2</span>) <span class="keyword">return</span> nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> fast = <span class="number">2</span>,slow = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span>(fast;fast &lt; nums.<span class="built_in">size</span>();fast++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[fast] != nums[slow - <span class="number">2</span>])&#123;</span><br><span class="line">                nums[slow] = nums[fast];</span><br><span class="line">                slow++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> slow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202309292227897.png" alt="image-20230929222725858"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>æ­¤é¢˜å¯ä»¥å‚è€ƒæ˜¨å¤©çš„ä¸€é¢˜ï¼Œéƒ½æ˜¯é‡‡ç”¨äº†å¿«æ…¢æŒ‡é’ˆçš„æ€è·¯ï¼Œä¸è¿‡æœ¬é¢˜å¤šäº†ä¸€ä¸ªæ¡ä»¶æ˜¯å¯ä»¥å…è®¸å…ƒç´ æœ€å¤šå‡ºç°ä¸¤æ¬¡ï¼Œåœ¨æ˜¨å¤©çš„é¢˜ç›®ä¸­ï¼Œæˆ‘ä»¬æ˜¯ç”¨å¿«æŒ‡é’ˆå’Œæ…¢æŒ‡é’ˆå‰ä¸€ä¸ªå…ƒç´ æ¯”è¾ƒï¼Œå‘ç°å¦‚æœä¸€æ ·åˆ™è¡¨ç¤ºé‡å¤ï¼Œæ…¢æŒ‡é’ˆæ‰€æŒ‡çš„ä½ç½®ä½œä¸ºå¾…æ›¿æ¢ä½ã€‚ä»Šå¤©çš„é¢˜ç›®ï¼Œæˆ‘ä»¬éœ€è¦æ¯”è¾ƒæ…¢æŒ‡é’ˆå‰ä¸¤ä¸ªå…ƒç´ å’Œå¿«æŒ‡é’ˆæ‰€æŒ‡å…ƒç´ ï¼Œå¦‚æœä¸€æ ·ï¼Œè¯´æ˜å…ƒç´ æ•°é‡è¶…è¿‡ä¸¤ä¸ªï¼Œåˆ™æ…¢æŒ‡é’ˆä¸ºå¾…æ›¿æ¢ä½ã€‚<br>æœ¬é¢˜æäº¤çš„æ—¶å€™é”™äº†ä¸€æ¬¡ï¼Œå› ä¸ºæ²¡æœ‰æ£€æµ‹å¦‚æœæ•°ç»„çš„å…ƒç´ æ•°é‡å°äºç­‰äº2ï¼ˆå› ä¸ºä¸¤ä¸ªå…ƒç´ ç†è®ºä¸Šä¸éœ€è¦è¿›è¡Œæ“ä½œï¼‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day03</title>
      <link href="/2023/09/29/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day03/"/>
      <url>/2023/09/29/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day03/</url>
      
        <content type="html"><![CDATA[<p><em><u>æµ·ä¸Šç”Ÿæ˜æœˆï¼Œå¤©æ¶¯å…±æ­¤æ—¶ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/remove-duplicates-from-sorted-array/">åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</a></p><p>ç»™ä½ ä¸€ä¸ª <strong>éä¸¥æ ¼é€’å¢æ’åˆ—</strong> çš„æ•°ç»„ <code>nums</code> ï¼Œè¯·ä½ **<a href="http://baike.baidu.com/item/%E5%8E%9F%E5%9C%B0%E7%AE%97%E6%B3%95"> åŸåœ°</a>** åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿æ¯ä¸ªå…ƒç´  <strong>åªå‡ºç°ä¸€æ¬¡</strong> ï¼Œè¿”å›åˆ é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚å…ƒç´ çš„ <strong>ç›¸å¯¹é¡ºåº</strong> åº”è¯¥ä¿æŒ <strong>ä¸€è‡´</strong> ã€‚ç„¶åè¿”å› <code>nums</code> ä¸­å”¯ä¸€å…ƒç´ çš„ä¸ªæ•°ã€‚</p><p>è€ƒè™‘ <code>nums</code> çš„å”¯ä¸€å…ƒç´ çš„æ•°é‡ä¸º <code>k</code> ï¼Œä½ éœ€è¦åšä»¥ä¸‹äº‹æƒ…ç¡®ä¿ä½ çš„é¢˜è§£å¯ä»¥è¢«é€šè¿‡ï¼š</p><ul><li>æ›´æ”¹æ•°ç»„ <code>nums</code> ï¼Œä½¿ <code>nums</code> çš„å‰ <code>k</code> ä¸ªå…ƒç´ åŒ…å«å”¯ä¸€å…ƒç´ ï¼Œå¹¶æŒ‰ç…§å®ƒä»¬æœ€åˆåœ¨ <code>nums</code> ä¸­å‡ºç°çš„é¡ºåºæ’åˆ—ã€‚<code>nums</code> çš„å…¶ä½™å…ƒç´ ä¸ <code>nums</code> çš„å¤§å°ä¸é‡è¦ã€‚</li><li>è¿”å› <code>k</code> ã€‚</li></ul><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">removeDuplicates</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">       <span class="type">int</span> first = <span class="number">1</span>;</span><br><span class="line">       <span class="type">int</span> second = <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">for</span>(first;first &lt; nums.<span class="built_in">size</span>();first++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[first] != nums[second - <span class="number">1</span>])&#123;</span><br><span class="line">                nums[second] = nums[first];</span><br><span class="line">                second++;</span><br><span class="line">            &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> second + <span class="number">1</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202309292145337.png" alt="image-20230929214547282"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>æœ¬é¢˜è¿ç”¨äº†å¿«æ…¢æŒ‡é’ˆï¼Œä»£ç ä¸­firstä¸ºå¿«æŒ‡é’ˆï¼Œsecondä¸ºæ…¢æŒ‡é’ˆï¼Œå¾ªç¯å¼€å§‹æ—¶ï¼Œå¿«æ…¢æŒ‡é’ˆåŒæ—¶æŒ‡å‘æ•°ç»„ä¸­ç¬¬äºŒä¸ªå…ƒç´ ï¼Œåœ¨ä¹‹åçš„å¾ªç¯ä¸­ï¼Œè‹¥å¿«æŒ‡é’ˆå’Œæ…¢æŒ‡é’ˆåä¸€ä½ä¸ç›¸ç­‰ï¼Œåˆ™å¿«æ…¢æŒ‡é’ˆä¸€èµ·åç§»ï¼Œè‹¥ç›¸ç­‰ï¼Œåˆ™ æ…¢æŒ‡é’ˆåŸåœ°ä¸åŠ¨ï¼Œä½œä¸ºæ›¿æ¢ä½ï¼Œå¿«æŒ‡é’ˆç»§ç»­åç§»ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ç­‰äºæ…¢æŒ‡é’ˆåä¸€ä½å…ƒç´ çš„æ•°ï¼Œè¿™æ—¶å°†æ…¢æŒ‡é’ˆæœ¬èº«æŒ‡å‘çš„æ•°æ›¿æ¢ä¸ºå¿«æŒ‡é’ˆçš„å€¼ï¼Œå®Œæˆå»é‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day02</title>
      <link href="/2023/09/27/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day02/"/>
      <url>/2023/09/27/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day02/</url>
      
        <content type="html"><![CDATA[<p><em><u>äº‹æƒ…ä¸æ˜¯è¶³ä»¥æ”¹å˜ä¸–ç•Œæ‰ç®—é‡è¦ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/remove-element/">ç§»é™¤å…ƒç´ </a></p><p>ç»™ä½ ä¸€ä¸ªæ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªå€¼ <code>val</code>ï¼Œä½ éœ€è¦ <strong><a href="https://baike.baidu.com/item/%E5%8E%9F%E5%9C%B0%E7%AE%97%E6%B3%95">åŸåœ°</a></strong> ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº <code>val</code> çš„å…ƒç´ ï¼Œå¹¶è¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p><p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»ä»…ä½¿ç”¨ <code>O(1)</code> é¢å¤–ç©ºé—´å¹¶ <strong><a href="https://baike.baidu.com/item/%E5%8E%9F%E5%9C%B0%E7%AE%97%E6%B3%95">åŸåœ° </a>ä¿®æ”¹è¾“å…¥æ•°ç»„</strong>ã€‚</p><p>å…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">removeElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> n = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="type">bool</span> is_end = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; len; i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(nums[i] == val)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i + n == len )&#123;</span><br><span class="line">                    is_end = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(nums[i + n] != val)&#123;</span><br><span class="line">                    <span class="built_in">swap</span>(nums[i], nums[i + n]);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    n++; </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(is_end)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202309272241529.png" alt="image-20230927224136448"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>è¿™é“é¢˜æˆ‘çš„æ€è·¯æ˜¯å¦‚æœå½“å‰ä¸‹æ ‡æŒ‡å‘çš„å…ƒç´ æ•°å€¼ç­‰äºvalï¼Œé‚£å°±å°†ä»–å’Œåé¢ä¸€ä¸ªä¸ä¸ºvalçš„æ•°äº¤æ¢ï¼Œç›´åˆ°æ‰€æœ‰ç­‰äºvalçš„æ•°äº¤æ¢åˆ°æ•°ç»„å°¾éƒ¨ï¼Œç„¶åå†è¿”å›å®é™…é•¿åº¦å°±å¯ä»¥äº†ã€‚å…¶ä¸­æˆ‘è®¾ç½®äº†ä¸€ä¸ªå˜é‡nï¼Œåˆå§‹åŒ–ä¸º1ï¼Œä»£è¡¨å¦‚æœé‡åˆ°ç­‰äºvalçš„æ•°ï¼Œå°±çœ‹ä»–åé¢1ä½æ˜¯ä¸æ˜¯ä¹Ÿç­‰äºvalï¼Œå¦‚æœä¸æ˜¯ç›´æ¥äº¤æ¢ï¼Œå¦‚æœæ˜¯å°±å°†n++ï¼Œä»£è¡¨ä¹‹åä¼šçœ‹åé¢ç¬¬2ä½æ˜¯å¦æ˜¯valï¼Œnçš„å€¼æ˜¯æ°¸ä¹…æ”¹å˜çš„ï¼Œå› ä¸ºæŒ‰ç…§è¯¥ç®—æ³•å¦‚æœå‡ºç°äº†ä¸¤ä¸ªæˆ–ä»¥ä¸Švalè¿åœ¨ä¸€èµ·çš„æƒ…å†µï¼Œå¦‚æœä¸æ”¹å˜nçš„å€¼ï¼Œä¼šå¯¼è‡´valå€¼ä¹‹é—´æ¢æ¥æ¢å»ï¼ŒåŒæ—¶æˆ‘åŠ äº†ä¸€ä¸ªåˆ¤æ–­æ ‡å¿—ï¼Œå¦‚æœå½“å‰ä¸‹æ ‡åŠ ä¸Šnçš„å€¼è¶…è¿‡äº†æ•°ç»„é•¿åº¦ï¼Œé‚£å°±è¯´æ˜ä¸‹æ ‡åæ‰€æœ‰çš„å€¼éƒ½æ˜¯valï¼Œè¿™æ—¶åªè¦è¿”å›ä¸‹æ ‡å€¼ï¼ˆå› ä¸ºä¸‹æ ‡æ¯”å®é™…é•¿åº¦å°‘1ï¼‰ï¼Œå°±ç­‰äºæ•°ç»„æœ€ç»ˆé•¿åº¦ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£æ¯æ—¥ä¸€é¢˜Day01</title>
      <link href="/2023/09/26/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day01/"/>
      <url>/2023/09/26/%E5%8A%9B%E6%89%A3%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98Day01/</url>
      
        <content type="html"><![CDATA[<p><em><u>æœ€å±é™©æƒ…å†µæ˜¯å½“ä½ ä¸å†æœ‰æ–°è¿›å±•ã€‚</u></em></p><h1 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h1><p><a href="https://leetcode.cn/problems/merge-sorted-array/">åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</a></p><p>ç»™ä½ ä¸¤ä¸ªæŒ‰ <strong>éé€’å‡é¡ºåº</strong> æ’åˆ—çš„æ•´æ•°æ•°ç»„ <code>nums1</code> å’Œ <code>nums2</code>ï¼Œå¦æœ‰ä¸¤ä¸ªæ•´æ•° <code>m</code> å’Œ <code>n</code> ï¼Œåˆ†åˆ«è¡¨ç¤º <code>nums1</code> å’Œ <code>nums2</code> ä¸­çš„å…ƒç´ æ•°ç›®ã€‚</p><p>è¯·ä½  <strong>åˆå¹¶</strong> <code>nums2</code> åˆ° <code>nums1</code> ä¸­ï¼Œä½¿åˆå¹¶åçš„æ•°ç»„åŒæ ·æŒ‰ <strong>éé€’å‡é¡ºåº</strong> æ’åˆ—ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>æœ€ç»ˆï¼Œåˆå¹¶åæ•°ç»„ä¸åº”ç”±å‡½æ•°è¿”å›ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨æ•°ç»„ <code>nums1</code> ä¸­ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼Œ<code>nums1</code> çš„åˆå§‹é•¿åº¦ä¸º <code>m + n</code>ï¼Œå…¶ä¸­å‰ <code>m</code> ä¸ªå…ƒç´ è¡¨ç¤ºåº”åˆå¹¶çš„å…ƒç´ ï¼Œå <code>n</code> ä¸ªå…ƒç´ ä¸º <code>0</code> ï¼Œåº”å¿½ç•¥ã€‚<code>nums2</code> çš„é•¿åº¦ä¸º <code>n</code> ã€‚</p><h1 id="è§£é¢˜ä»£ç ï¼š"><a href="#è§£é¢˜ä»£ç ï¼š" class="headerlink" title="è§£é¢˜ä»£ç ï¼š"></a>è§£é¢˜ä»£ç ï¼š</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">merge</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums1, <span class="type">int</span> m, vector&lt;<span class="type">int</span>&gt;&amp; nums2, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">nums3</span><span class="params">(m + n)</span></span>;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> key = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; m &amp;&amp; j &lt; n) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums1[i] &lt; nums2[j])&#123;</span><br><span class="line">                nums3[key++] = nums1[i++];</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                nums3[key++] = nums2[j++];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; m)&#123;</span><br><span class="line">            nums3[key++] = nums1[i++];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(j &lt; n)&#123;</span><br><span class="line">            nums3[key++] = nums2[j++];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        nums1 = nums3;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202309262135213.png" alt="image-20230926213549163"></p><h1 id="è§£è¯»ä¸æ”¶è·ï¼š"><a href="#è§£è¯»ä¸æ”¶è·ï¼š" class="headerlink" title="è§£è¯»ä¸æ”¶è·ï¼š"></a>è§£è¯»ä¸æ”¶è·ï¼š</h1><p>è¿™æ˜¯ä¸€é“å¾ˆç»å…¸çš„é¢˜ç›®ï¼Œæˆ‘çš„è§£é¢˜æ€è·¯æ˜¯åˆ›å»ºä¸€ä¸ªvectoræ•°ç»„nums3ï¼Œå®ƒçš„å¤§å°æ˜¯m+n,ç”¨æ¥æš‚æ—¶å­˜æ”¾åˆå¹¶åçš„æ•°ç»„ï¼Œç„¶åä»å¤´éå†nums1å’Œnums2,å°†ä¸¤è€…ä¹‹é—´çš„è¾ƒå°è€…æ’å…¥nums3ä¸­ï¼Œè¢«é€‰æ‹©çš„å…ƒç´ æ‰€åœ¨çš„æ•°ç»„ä¸‹æ ‡å’Œnums3ä¸‹æ ‡åŒæ—¶åç§»ä¸€ä½ï¼Œå¾ªç¯ç»“æŸåå°†æ²¡æ’å…¥num3çš„å‰©ä½™å†…å®¹å¾ªç¯æ’å…¥ï¼Œæœ€åå°†nums3èµ‹å€¼ç»™nums1ã€‚</p><p>æ”¶è·ï¼š</p><p>1.vectoræ•°ç»„çš„åˆ›å»ºæ–¹æ³•ï¼švector<int> nums(m + n);</p>]]></content>
      
      
      <categories>
          
          <category> åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„åŸºç¡€</title>
      <link href="/2023/09/21/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80/"/>
      <url>/2023/09/21/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="é‡æ‹¾æ•°æ®ç»“æ„"><a href="#é‡æ‹¾æ•°æ®ç»“æ„" class="headerlink" title="é‡æ‹¾æ•°æ®ç»“æ„"></a>é‡æ‹¾æ•°æ®ç»“æ„</h1><p>æˆ‘è®¤ä¸ºæ•°æ®ç»“æ„ç›¸å…³çš„ä¸œè¥¿éƒ½æ˜¯åŒä¸€å¥—æ¨¡æ¿ï¼Œåªä¸è¿‡æ˜¯ä½¿ç”¨äº†ä¸åŒçš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œæ‰€ä»¥çœ‹æ‡‚ä»£ç æ€è·¯å¾ˆé‡è¦ï¼Œçœ‹æ‡‚æ€è·¯åé¢çš„ä¸è®ºæ˜¯é¡ºåºè¡¨ï¼Œé“¾è¡¨è¿˜æ˜¯æ ‘ï¼Œå…¶å®æ€§è´¨å¤§å·®ä¸å·®ã€‚</p><h2 id="é¡ºåºè¡¨"><a href="#é¡ºåºè¡¨" class="headerlink" title="é¡ºåºè¡¨"></a>é¡ºåºè¡¨</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span> <span class="comment">//è‹¥ç”¨printf,scanf,getchar,putchar,gets,putså‡½æ•°éœ€åŒ…å«è¯¥å¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;malloc.h&gt;</span><span class="comment">//ç”¨malloc,free,reallocå‡½æ•°éœ€åŒ…å«è¯¥å¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXSIZE 100 <span class="comment">//è®¾çº¿æ€§è¡¨åˆå§‹åˆ†é…ç©ºé—´å¤§å°</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> ElemType;  <span class="comment">//å…ˆè®¾å®šæ•°æ®å…ƒç´ çš„ç±»å‹ä¸ºæ•´å‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//0ï¼šå®šä¹‰é¡ºåºè¡¨çš„ç»“æ„ç±»å‹</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">ElemType* elem;</span><br><span class="line"><span class="type">int</span> length;</span><br><span class="line"><span class="type">int</span> listsize;</span><br><span class="line">&#125;SqList;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1ï¼šåˆå§‹åŒ–é¡ºåºè¡¨</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">InitList_Sq</span><span class="params">(SqList&amp; L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">L.elem = (ElemType*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(ElemType) * MAXSIZE);</span><br><span class="line"><span class="keyword">if</span> (!L.elem) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">L.length = <span class="number">0</span>;</span><br><span class="line">L.listsize = MAXSIZE;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>malloc :åŠ¨æ€å†…å­˜åˆ†é…ï¼Œç”¨æ³•æ˜¯ï¼ˆæ•°æ®ç±»å‹*ï¼‰malloc(sizeof(è¦åˆ†é…çš„åœ°å€å—å¤§å°) * å—æ•°é‡)</p><p>è¡¥å……ï¼šrealloc åŠ¨æ€ä¿®æ”¹å†…å­˜</p><p>ç”¨æ³•æ˜¯ (æ•°æ®ç±»å‹* )realloc(åŸåœ°å€æŒ‡é’ˆ,æ–°åœ°å€å¤§å°)</p><p>reallocçš„ä½¿ç”¨å­˜åœ¨ä¸‰ç§æƒ…å†µï¼Œä¸€æ˜¯å¦‚æœåé¢çš„ç©ºé—´è¶³å¤Ÿæ‰©å±•ï¼Œåˆ™ä¼šç›´æ¥æ‰©å±•ï¼›äºŒæ˜¯åé¢çš„ç©ºé—´ä¸è¶³æ‰©å±•ï¼Œreallocä¼šè°ƒç”¨mallocé‡æ–°å¼€è¾Ÿä¸€å—å¤§å°ä¸ºæ‰€éœ€å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œç„¶åæŠŠåŸå†…å®¹æ‹·è´è¿›æ¥ï¼Œå¹¶é‡Šæ”¾åŸç©ºé—´ï¼›ä¸‰æ˜¯å†…å­˜ä¸è¶³ï¼Œæ‰©å±•å¤±è´¥ï¼Œæ­¤æ—¶åŸç©ºé—´ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œreallocè¿”å›ä¸€ä¸ªç©ºåœ°å€ã€‚</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2ï¼šæ‰“å°é¡ºåºè¡¨ä¸­æ‰€æœ‰å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PrintList</span><span class="params">(SqList&amp; L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; L.length; i++)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, L.elem[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//*****3ï¼šåœ¨é¡ºåºè¡¨ä¸­ç¬¬iä¸ªä½ç½®(i=1~n)æ’å…¥å…ƒç´ *****</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ListInsert_Sq</span><span class="params">(SqList&amp; L, <span class="type">int</span> i, ElemType e)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (i&lt;<span class="number">1</span> || i&gt;L.length + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> p = L.length - <span class="number">1</span>; p &gt;= i; p--) &#123;</span><br><span class="line">L.elem[p] = L.elem[p - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">L.elem[i - <span class="number">1</span>] = e;</span><br><span class="line">L.length++;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//*****4ï¼šåˆ é™¤é¡ºåºè¡¨ä¸­ç¬¬i(i=1~n)ä¸ªå…ƒç´ ï¼Œç”¨eè¿”å›åˆ é™¤çš„å…ƒç´ *****</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ListDelete_Sq</span><span class="params">(SqList&amp; L, <span class="type">int</span> i, ElemType&amp; e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (i&lt;<span class="number">1</span> || i&gt;L.length + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">e = L.elem[i - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> p = i - <span class="number">1</span>; p &lt; L.length - <span class="number">1</span>; p++) &#123;</span><br><span class="line">L.elem[p] = L.elem[p + <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">L.length--;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé‡åˆ°çš„å‘æ— éå°±æ˜¯ä½•ä¸ºlengthï¼Œæ’å…¥ä½ç½®ï¼Œä¸‹æ ‡ä¹‹é—´çš„å…³ç³»ï¼Œå› ä¸ºä¸‹æ ‡æ˜¯ä»0å¼€å§‹ï¼Œæ‰€ä»¥å¦‚æœè¦ä½¿ç”¨ä¸‹æ ‡ï¼Œå°±è¦è€ƒè™‘lengthå’Œæ’å…¥ä½ç½®éƒ½è¦å‡1ï¼Œè¿™å°±è¦ç‰µæ‰¯å‡ºä¸€äº›è¾¹ç•Œæ¡ä»¶ï¼Œå¯¹äºæ‹¿ä¸å‡†çš„æˆ‘æ¯”è¾ƒå–œæ¬¢ç®€å•ç”»ä¸€ä¸‹å›¾ï¼Œæˆ–è€…ä¸¾ä¸€ç‚¹æ•°æ®é‡å°çš„ä¾‹å­ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¡ºåºè¡¨åˆå¹¶</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MergeList</span><span class="params">(SqList La, SqList Lb, SqList&amp; Lc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> end_La = La.length;</span><br><span class="line"><span class="type">int</span> end_lb = Lb.length;</span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, c = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">Lc.elem = (ElemType*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(ElemType) * MAXSIZE);</span><br><span class="line">Lc.length = end_La + end_lb;</span><br><span class="line">Lc.listsize = MAXSIZE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (i &lt; end_La &amp;&amp; j &lt; end_lb) &#123;</span><br><span class="line"><span class="keyword">if</span> (La.elem[i] &lt; Lb.elem[j]) &#123;</span><br><span class="line">Lc.elem[c] = La.elem[i];</span><br><span class="line">c++;</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">Lc.elem[c] = Lb.elem[j];</span><br><span class="line">c++;</span><br><span class="line">j++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (i &lt; end_La) &#123;</span><br><span class="line"><span class="keyword">while</span> (La.elem[i]) &#123;</span><br><span class="line">Lc.elem[c] = La.elem[i];</span><br><span class="line">i++;</span><br><span class="line">c++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (j &lt; end_lb) &#123;</span><br><span class="line"><span class="keyword">while</span> (Lc.elem[j]) &#123;</span><br><span class="line">Lc.elem[c] = Lb.elem[j];</span><br><span class="line">j++;</span><br><span class="line">c++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸»å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å•é“¾è¡¨"><a href="#å•é“¾è¡¨" class="headerlink" title="å•é“¾è¡¨"></a>å•é“¾è¡¨</h2><p>å•é“¾è¡¨ç»“ç‚¹ç»“æ„ä½“:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">LNode</span> &#123;</span><br><span class="line">    <span class="comment">///===============è¡¥å……ä»£ç ======================== </span></span><br><span class="line">    ElemType data;</span><br><span class="line">    LNode* next;</span><br><span class="line"></span><br><span class="line">&#125;LNode, * LinkList;      <span class="comment">// å®šä¹‰èŠ‚ç‚¹ç±»å‹ä»¥åŠé“¾è¡¨ç±»å‹ï¼ˆé“¾è¡¨ç±»å‹å®é™…ä¸Šæ˜¯ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆç±»å‹ï¼‰</span></span><br></pre></td></tr></table></figure><p>å•é“¾è¡¨æœ‰ä¸¤ç§æ’å…¥æ–¹æ³•ï¼Œä¸€ç§å¤´æ’æ³•ï¼Œä¸€ç§å°¾æ’æ³•ï¼Œå‰è€…ç»“æœæ˜¯å€’åºï¼Œåè€…ä¸ºæ­£åº</p><p>å¤´æ’æ³•(iä¸º1æ—¶)ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">ListInsert_L</span><span class="params">(LinkList&amp; L, <span class="type">int</span> i, ElemType e)</span> </span>&#123; <span class="comment">// ç®—æ³•2.9</span></span><br><span class="line">    <span class="comment">// åœ¨å¸¦å¤´ç»“ç‚¹çš„å•é“¾çº¿æ€§è¡¨Lçš„ç¬¬iä¸ªå…ƒç´ ä¹‹å‰æ’å…¥å…ƒç´ e   </span></span><br><span class="line">  <span class="comment">///===============è¡¥å……ä»£ç ========================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    LNode* new_node = (LNode*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));</span><br><span class="line">    new_node-&gt;data = e;</span><br><span class="line">    new_node-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    LNode* per_node = L;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; i - <span class="number">1</span>; j++) &#123;</span><br><span class="line">        per_node = per_node-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    new_node-&gt;next = per_node-&gt;next;</span><br><span class="line">    per_node-&gt;next = new_node;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125; <span class="comment">// LinstInsert_L</span></span><br></pre></td></tr></table></figure><p>å°¾æ’æ³•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">ListInsert_N</span><span class="params">(LinkList&amp; L)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    LNode* per_node = L;</span><br><span class="line">    <span class="keyword">while</span> (per_node-&gt;next != <span class="literal">NULL</span> &amp;&amp; per_node != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        per_node = per_node-&gt; next;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cin &gt;&gt; n;</span><br><span class="line">    <span class="type">int</span> e;</span><br><span class="line">    <span class="keyword">while</span> (n) &#123;</span><br><span class="line">        std::cin &gt;&gt; e;</span><br><span class="line">        LNode* new_node = (LNode*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(LNode));</span><br><span class="line">        new_node-&gt;data = e;</span><br><span class="line">        new_node-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        per_node-&gt;next = new_node;</span><br><span class="line">        per_node = per_node-&gt;next;</span><br><span class="line">        n--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å•é“¾è¡¨æœ‰ä¸€ä¸ªå®¹æ˜“è¢«å¿½ç•¥çš„ç‚¹æ˜¯åœ¨new_nodeåˆ†é…å†…å­˜åä¸€å®šè¦ç»™å…¶ä¸­çš„dataï¼Œnextèµ‹åˆå€¼ï¼Œä¸ç„¶ä¼šè¶Šç•Œã€‚</p><h2 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h2><p>â€œå…ˆè¿›å…ˆå‡ºâ€</p><p>é˜Ÿåˆ—ç»“æ„ä½“ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></span><br><span class="line">&#123;</span><br><span class="line">ElemType* base;</span><br><span class="line"><span class="type">int</span> front;</span><br><span class="line"><span class="type">int</span> rear;</span><br><span class="line">&#125;SqQueue;</span><br></pre></td></tr></table></figure><p>è°ˆåŠé˜Ÿåˆ—ä¸€èˆ¬éƒ½æ˜¯æŒ‡å¾ªç¯é˜Ÿåˆ—ï¼Œå› ä¸ºæ™®é€šé˜Ÿåˆ—åœ¨ä½¿ç”¨æ—¶ï¼Œå¦‚æœå‘ç”Ÿå‡ºé˜Ÿæ“ä½œï¼Œé‚£å¯¹å¤´æ‰€åœ¨çš„ç©ºé—´å°±æ— æ³•å†è¿”å›ä½¿ç”¨äº†ï¼Œå¯¼è‡´ç©ºé—´çš„æµªè´¹ï¼Œè€Œä½¿ç”¨å¾ªç¯é˜Ÿåˆ—ï¼Œå½“é˜Ÿå°¾åˆ°è¾¾åˆ†é…çš„MAXSIZEä¸Šé™æ—¶ï¼Œé€šè¿‡å–ä½™æ“ä½œé‡æ–°åˆ©ç”¨åˆ°å·²ç»å‡ºé˜Ÿçš„ç©ºé—´ï¼Œå…·ä½“æ“ä½œåœ¨å…¥é˜Ÿï¼Œå‡ºé˜Ÿï¼Œä»¥åŠè®¡ç®—é˜Ÿé•¿ç­‰å‡æœ‰ä½“ç°ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ±‚é˜Ÿåˆ—çš„é•¿åº¦</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">QueueLength</span><span class="params">(SqQueue&amp; Q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (Q.rear - Q.front + MAXQSIZE) % MAXQSIZE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ’å…¥å…ƒç´ eä½œä¸ºQçš„æ–°çš„é˜Ÿå°¾å…ƒç´ ï¼Œé˜Ÿæ»¡åˆ™è¿”å›0ï¼Œå¦åˆ™è¿”å›1</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">EnQueue</span><span class="params">(SqQueue&amp; Q, ElemType e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> ((Q.rear + <span class="number">1</span>) % MAXQSIZE == Q.front) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">Q.base[Q.rear] = e;</span><br><span class="line">Q.rear = (Q.rear + <span class="number">1</span>) % MAXQSIZE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è‹¥é˜Ÿåˆ—ä¸ç©ºï¼Œåˆ™åˆ é™¤Qçš„é˜Ÿå¤´å…ƒç´ ï¼Œç”¨eè¿”å›å…¶å€¼ï¼Œå¹¶è¿”å›1,å¦åˆ™è¿”å›0</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">DeQueue</span><span class="params">(SqQueue&amp; Q, ElemType&amp; e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">QueueEmpty</span>(Q)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">e = Q.base[Q.front];</span><br><span class="line">Q.front = (Q.front + <span class="number">1</span>) % MAXQSIZE;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h2><p>â€œåè¿›å…ˆå‡ºâ€</p><p>æ ˆç»“æ„ä½“ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">STACK</span></span><br><span class="line">&#123;</span><br><span class="line">ElemType* base;</span><br><span class="line">ElemType* top;</span><br><span class="line"><span class="type">int</span> size;</span><br><span class="line">&#125;SqStack;</span><br></pre></td></tr></table></figure><p>æ ˆæ‰€æœ‰çš„æ“ä½œéƒ½åªå˜åŒ–topæŒ‡é’ˆï¼Œè¿™ç‚¹ä¸åŒäºé˜Ÿåˆ—ï¼Œå› ä¸ºå…¶åè¿›å…ˆå‡ºçš„æ€§è´¨ï¼Œæ ˆåœ¨å›æº¯ç®—æ³•åˆ©ç”¨çš„æ¯”è¾ƒå¤šï¼Œä»–å¯ä»¥å®ç°â€œåé€€â€æ“ä½œï¼Œæ¯”å¦‚å›åˆ°æ ‘çš„ä¸Šä¸€ç»“ç‚¹ã€‚æ ˆçš„æœ¬è´¨æˆ‘è®¤ä¸ºå°±æ˜¯ä¸ªåªèƒ½å¯¹æœ«å°¾æ“ä½œçš„æ•°ç»„ï¼ŒåŒç†é˜Ÿåˆ—å¯ä»¥ç†è§£ä¸ºå¯ä»¥ä¸¤è¾¹åŒæ—¶æ“ä½œçš„æ•°ç»„ã€‚</p><p>åˆ¤ç©ºæ“ä½œï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ¤æ ˆç©º</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">StackEmpty</span><span class="params">(SqStack S)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (S.top == S.base) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ˆä¸­å…ƒç´ ä¸ªæ•°ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ±‚æ ˆä¸­å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">StackLength</span><span class="params">(SqStack S)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (StackEmpty) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"> <span class="keyword">return</span> S.top - S.base ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒS.top - S.baseå°±èƒ½å¾—åˆ°æ ˆä¸­å…ƒç´ ä¸ªæ•°ï¼Œå› ä¸ºæŒ‡é’ˆå€¼ç›¸å‡çš„ç»“æœæ˜¯ä¸¤ä¸ªæŒ‡é’ˆä¹‹é—´çš„è·ç¦»ï¼Œå³å®ƒä»¬æ‰€æŒ‡å‘çš„å†…å­˜åœ°å€ä¹‹é—´çš„åç§»é‡ã€‚è¿™ä¸ªåç§»é‡çš„å•ä½å–å†³äºæŒ‡é’ˆæ‰€æŒ‡å‘çš„æ•°æ®ç±»å‹çš„å¤§å°ã€‚ä¾‹å¦‚ï¼Œåœ¨Cè¯­è¨€ä¸­ï¼Œå¦‚æœä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘ç›¸åŒç±»å‹çš„æ•°ç»„å…ƒç´ ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´çš„è·ç¦»å°±æ˜¯æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ä¹˜ä»¥æ¯ä¸ªå…ƒç´ çš„å¤§å°ã€‚</p><p>å…¥æ ˆï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Push</span><span class="params">(SqStack&amp; s, ElemType e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">StackLength</span>(s) == MAXSIZE) &#123;</span><br><span class="line">s.base = (ElemType*)<span class="built_in">realloc</span>(s.base, <span class="built_in">sizeof</span>(ElemType) * (s.size + STACKINCREMENT));</span><br><span class="line">s.size = s.size + STACKINCREMENT;</span><br><span class="line">&#125;</span><br><span class="line">*(s.top++) = e;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒåŠ äº†ä¸€ä¸ªæ‰©å®¹ï¼ˆå…¶å®ä¹‹å‰éƒ½å¯ä»¥åŠ ï¼Œä¸è¿‡æ‡’å¾—éƒ½æ²¡åŠ ï¼‰ï¼Œæ ˆçš„topä¸€èˆ¬éƒ½åœåœ¨æœ€è¿‘çš„ä¸€ä¸ªç©ºä½ï¼Œè€Œä¸æ˜¯æŒ‡å‘æ ˆå°¾ï¼Œå› æ­¤å…¥æ ˆåtopè¦åç§»ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‡ºæ ˆ</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Pop</span><span class="params">(SqStack&amp; s, ElemType&amp; e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">e = *(--s.top);</span><br><span class="line"><span class="keyword">return</span>  <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒç†å‡ºæ ˆtopå…ˆå‰ç§»ã€‚</p><h3 id="æ•°åˆ¶è½¬æ¢"><a href="#æ•°åˆ¶è½¬æ¢" class="headerlink" title="æ•°åˆ¶è½¬æ¢"></a>æ•°åˆ¶è½¬æ¢</h3><p>æ‰©å±•ä¸€ä¸‹æ ˆçš„ä¸€ä¸ªç”¨æ³•ï¼šæ•°åˆ¶è½¬æ¢</p><p>å› ä¸ºæ•°åˆ¶è½¬æ¢ä¸€èˆ¬æ˜¯ä½¿ç”¨çŸ­é™¤æ³•ï¼Œæœ€åå°†ä½™æ•°åå‘ç»„åˆï¼Œåå‘ç»„åˆå°±å¯ä»¥åˆ©ç”¨æ ˆåè¿›å…ˆå‡ºçš„æ€§è´¨ï¼Œé€šè¿‡å–æ•´å–ä½™æ“ä½œï¼Œå°±èƒ½å®ç°ç®€å•çš„è¿›åˆ¶è½¬æ¢</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ•°åˆ¶è½¬æ¢å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">conversion</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">ElemType e;</span><br><span class="line">SqStack S;</span><br><span class="line"><span class="built_in">InitStack</span>(S);</span><br><span class="line"><span class="type">int</span> num;</span><br><span class="line"><span class="type">int</span> jinzhi;</span><br><span class="line">std::cin &gt;&gt; num;</span><br><span class="line">std::cin &gt;&gt; jinzhi;</span><br><span class="line"><span class="keyword">while</span> (num) &#123;</span><br><span class="line"><span class="built_in">Push</span>(S, num % jinzhi);</span><br><span class="line">num = num / jinzhi;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (!<span class="built_in">StackEmpty</span>(S)) &#123;</span><br><span class="line"><span class="built_in">Pop</span>(S,num);</span><br><span class="line"><span class="keyword">if</span> (num &lt;= <span class="number">9</span>) &#123;</span><br><span class="line">std::cout &lt;&lt; num &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">std::cout &lt;&lt; (<span class="type">char</span>)(num - <span class="number">10</span> + <span class="number">65</span>) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º16è¿›åˆ¶æ¯”è¾ƒç‰¹æ®Šï¼Œä»–ä¼šå‡ºç°å¤§äºç­‰äº10çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µè¦è¾“å‡ºâ€œABCã€‚ã€‚ã€‚â€ï¼Œæ‰€ä»¥åœ¨è¾“å‡ºæ—¶åŠ äº†ä¸€ä¸ªåˆ¤æ–­ï¼Œ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">std::cout &lt;&lt; (<span class="type">char</span>)(num - <span class="number">10</span> + <span class="number">65</span>) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ ‘"><a href="#æ ‘" class="headerlink" title="æ ‘"></a>æ ‘</h2><p>äºŒå‰æ ‘ç»“æ„ä½“ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">BiTNode</span></span><br><span class="line">&#123;</span><br><span class="line">    ElemType data;</span><br><span class="line">    BiTNode* left;</span><br><span class="line">    BiTNode* right;</span><br><span class="line"></span><br><span class="line">&#125;BiTNode, * BiTree;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ ‘ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateBiTree</span><span class="params">(BiTree&amp; T)</span><span class="comment">//æŒ‰å…ˆåºæ¬¡åºè¾“å…¥ï¼Œä»¥&quot;#&quot;è¡¨ç¤ºç©ºæ ‘</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> input;</span><br><span class="line">    std::cin &gt;&gt; input;</span><br><span class="line">    <span class="keyword">if</span> (input != <span class="string">&#x27;#&#x27;</span>) &#123;</span><br><span class="line">        T = (BiTree)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(BiTNode));</span><br><span class="line">        T-&gt;data = input;</span><br><span class="line">        <span class="built_in">CreateBiTree</span>(T-&gt;left);</span><br><span class="line">        <span class="built_in">CreateBiTree</span>(T-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        T = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„ç‚¹å°±æ˜¯è®°å¾—ç»™ç©ºç»“ç‚¹èµ‹å€¼ä¸ºNULLï¼ˆå¹¶ä¸æ˜¯é»˜è®¤ä¸ºNULLï¼Œä»–ä¼šæŒ‡å‘0FFFFFã€‚ã€‚ã€‚ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">PreOrderTraverse</span><span class="params">(BiTree T)</span><span class="comment">//å…ˆåºéå†</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (T != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        cout &lt;&lt; T-&gt;data &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">PreOrderTraverse</span>(T-&gt;left);</span><br><span class="line">        <span class="built_in">PreOrderTraverse</span>(T-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">InOrderTraverse</span><span class="params">(BiTree T)</span><span class="comment">//ä¸­åºéå†</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (T != <span class="literal">NULL</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">InOrderTraverse</span>(T-&gt;left);</span><br><span class="line">        cout &lt;&lt; T-&gt;data &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">InOrderTraverse</span>(T-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PostOrderTraverse</span><span class="params">(BiTree T)</span><span class="comment">//ååºéå†</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (T != <span class="literal">NULL</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">PostOrderTraverse</span>(T-&gt;left);</span><br><span class="line">        <span class="built_in">PostOrderTraverse</span>(T-&gt;right);</span><br><span class="line">        cout &lt;&lt; T-&gt;data &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ±‚æ ‘æ·±ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">BTDepth</span><span class="params">(BiTree T)</span><span class="comment">//æ±‚äºŒå‰æ ‘çš„æ·±åº¦</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> Lheight;</span><br><span class="line">    <span class="type">int</span> Rheight;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (T != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        Lheight = <span class="built_in">BTDepth</span>(T-&gt;left);</span><br><span class="line">        Rheight = <span class="built_in">BTDepth</span>(T-&gt;right);    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Lheight &gt; Rheight ? Lheight + <span class="number">1</span> : Rheight + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡åˆ°çš„é—®é¢˜ï¼šåœ¨æ ‘ä¸ºNULLçš„æ—¶å€™å¿˜è®°return 0äº†ï¼Œåœ¨å‘ä¸Šå±‚returnçš„æ—¶å€™å¿˜è®°åœ¨å½“å‰æ·±åº¦çš„åŸºç¡€ä¸ŠåŠ 1</p><p>æ±‚å¶ç»“ç‚¹ä¸ªæ•°ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Leaf</span><span class="params">(BiTree T)</span><span class="comment">//æ±‚äºŒå‰æ ‘çš„å¶å­æ•°, ä½¿ç”¨å…¨å±€å˜é‡</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (T != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">Leaf</span>(T-&gt;right);</span><br><span class="line">        <span class="built_in">Leaf</span>(T-&gt;left);</span><br><span class="line">        <span class="keyword">if</span> (T-&gt;left == <span class="literal">NULL</span> &amp;&amp; T-&gt;right == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            LEAFCOUNT++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰ä¸¤ä¸ªé€’å½’è°ƒç”¨çš„ç»ˆç‚¹æ˜¯æ¯ä¸ªå¶èŠ‚ç‚¹ï¼Œåªéœ€è¦åˆ¤æ–­æ˜¯å¦é€’å½’åˆ°å¶èŠ‚ç‚¹ï¼Œæ¡ä»¶å°±æ˜¯å·¦å³å­æ ‘éƒ½æ˜¯ç©ºã€‚</p><p>æ±‚æ€»ç»“ç‚¹ä¸ªæ•°ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">NodeCount</span><span class="params">(BiTree T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    stack&lt;BiTree&gt; st;</span><br><span class="line">    <span class="keyword">while</span> (T || !st.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (T) &#123;</span><br><span class="line">            NODECOUNT++;</span><br><span class="line">            st.<span class="built_in">push</span>(T);</span><br><span class="line">            T = T-&gt;left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            T = st.<span class="built_in">top</span>();</span><br><span class="line">            st.<span class="built_in">pop</span>();</span><br><span class="line">            T = T-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ˆå’Œwhileå¾ªç¯æ­é…ä½¿ç”¨çš„æ–¹æ³•å¾ˆé€‚åˆéå†ï¼Œå¦‚æœæ ‘ä¸ä¸ºç©ºå°±å…¥æ ˆç»§ç»­éå†ï¼Œå¦‚æœæ ‘ä¸ºç©ºäº†é‚£å°±æ ˆé¡¶å‡ºæ ˆï¼Œç»§ç»­èµ°å³èŠ‚ç‚¹ï¼Œè¿™ç§éå†æ–¹å¼æˆ–è®¸è¿˜å¯ä»¥ç”¨åˆ°ä¸€äº›è¿·å®«å°æ¸¸æˆé‡Œã€‚</p><p>éé€’å½’çš„éå†ä¹Ÿæ˜¯ä½¿ç”¨è¿™ç§ç»“æ„ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Traverse_By_Stack</span><span class="params">(BiTree T)</span> </span>&#123;</span><br><span class="line">    stack&lt;BiTree&gt; sta;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (T || !sta.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (T) &#123;</span><br><span class="line">            cout &lt;&lt; T-&gt;data &lt;&lt; endl; <span class="comment">// å…ˆåºéå†</span></span><br><span class="line">            sta.<span class="built_in">push</span>(T);</span><br><span class="line">            T = T-&gt;left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            T = sta.<span class="built_in">top</span>();</span><br><span class="line">            <span class="comment">//cout &lt;&lt; T-&gt;data &lt;&lt; endl; // ååºéå†</span></span><br><span class="line">            sta.<span class="built_in">pop</span>();</span><br><span class="line">            T = T-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“å†…æ ¸å¼€å‘-åŸºç¡€åŸç†</title>
      <link href="/2023/07/31/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E6%A0%B8%E5%BC%80%E5%8F%91-%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/"/>
      <url>/2023/07/31/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E6%A0%B8%E5%BC%80%E5%8F%91-%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°æ®åº“å†…æ ¸å¼€å‘-åŸºç¡€åŸç†ç¯‡"><a href="#æ•°æ®åº“å†…æ ¸å¼€å‘-åŸºç¡€åŸç†ç¯‡" class="headerlink" title="æ•°æ®åº“å†…æ ¸å¼€å‘-åŸºç¡€åŸç†ç¯‡"></a>æ•°æ®åº“å†…æ ¸å¼€å‘-åŸºç¡€åŸç†ç¯‡</h1><h2 id="é¡¹ç›®æ¡†æ¶"><a href="#é¡¹ç›®æ¡†æ¶" class="headerlink" title="é¡¹ç›®æ¡†æ¶"></a>é¡¹ç›®æ¡†æ¶</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202307311742209.png" alt="image-20230731174232121"></p><p>sqlæ‰§è¡Œæµç¨‹ä»£ç </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">YY_BUFFER_STATE buf = <span class="built_in">yy_scan_string</span>(data_recv);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">yyparse</span>() == <span class="number">0</span>) &#123;</span><br><span class="line"> <span class="keyword">if</span> (ast::parse_tree != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// analyze and rewrite</span></span><br><span class="line">    std::shared_ptr&lt;Query&gt; query = analyze-&gt;<span class="built_in">do_analyze</span>(ast::parse_tree);</span><br><span class="line">             <span class="built_in">yy_delete_buffer</span>(buf);</span><br><span class="line">             finish_analyze = <span class="literal">true</span>;</span><br><span class="line">             <span class="built_in">pthread_mutex_unlock</span>(buffer_mutex);</span><br><span class="line">                    <span class="comment">// ä¼˜åŒ–å™¨</span></span><br><span class="line">    std::shared_ptr&lt;Plan&gt; plan = optimizer-&gt;<span class="built_in">plan_query</span>(query, context);</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// portal</span></span><br><span class="line">    std::shared_ptr&lt;PortalStmt&gt; portalStmt = portal-&gt;<span class="built_in">start</span>(plan, context);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    portal-&gt;<span class="built_in">run</span>(portalStmt, ql_manager.<span class="built_in">get</span>(), &amp;txn_id, context);</span><br><span class="line">                    </span><br><span class="line">              portal-&gt;<span class="built_in">drop</span>();</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p>ä¸€æ¡sqlè¯­å¥ä»è¾“å…¥åˆ°æ•°æ®åº“ç³»ç»Ÿï¼Œå†åˆ°æ‰§è¡Œä¸€èˆ¬éœ€è¦ç»å†å››ä¸ªé˜¶æ®µ</p><h3 id="è¯­æ³•è§£æé˜¶æ®µï¼ˆparserï¼‰"><a href="#è¯­æ³•è§£æé˜¶æ®µï¼ˆparserï¼‰" class="headerlink" title="è¯­æ³•è§£æé˜¶æ®µï¼ˆparserï¼‰"></a>è¯­æ³•è§£æé˜¶æ®µï¼ˆparserï¼‰</h3><p>åœ¨è¿™ä¸€é˜¶æ®µï¼Œç¨‹åºä¼šåˆ©ç”¨<strong>flex</strong>ï¼ˆè¯­æ³•åˆ†æç”Ÿæˆå™¨ï¼‰å’Œ<strong>bison</strong>ï¼ˆè¯­æ³•åˆ†æç”Ÿæˆå™¨ï¼‰å¯¹æˆ‘ä»¬è¾“å…¥çš„sqlè¯­å¥è¿›è¡Œè§£æï¼Œè§£é‡Šä¸€ä¸‹flexå’Œbison</p><blockquote><p>Flexå’ŒBisonæ˜¯ä¸¤ä¸ªç”¨äºå¤„ç†è¯­è¨€è§£æçš„å·¥å…·ï¼Œå¸¸å¸¸è¢«ç”¨äºç¼–è¯‘å™¨å’Œè§£é‡Šå™¨çš„å¼€å‘ä¸­ã€‚</p><ol><li><p><strong>Flex</strong>ï¼šFlexæ˜¯ä¸€ä¸ªè¯æ³•åˆ†æå™¨ç”Ÿæˆå™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯ä»¥æ ¹æ®ç”¨æˆ·å®šä¹‰çš„æ¨¡å¼ç”Ÿæˆä¸€ä¸ªè¯æ³•åˆ†æå™¨ï¼ˆæˆ–è€…å«åšæ‰«æå™¨ï¼‰ã€‚è¿™ä¸ªè¯æ³•åˆ†æå™¨å¯ä»¥å°†è¾“å…¥çš„å­—ç¬¦æµè½¬æ¢ä¸ºä¸€ç³»åˆ—çš„è¯æ³•å•å…ƒï¼ˆtokensï¼‰ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€æ¡SQLè¯­å¥ï¼Œè¯æ³•åˆ†æå™¨å¯ä»¥å°†å…¶åˆ†è§£ä¸ºä¸€ç³»åˆ—çš„å…³é”®å­—ã€æ ‡è¯†ç¬¦ã€è¿ç®—ç¬¦ç­‰ã€‚</p></li><li><p><strong>Bison</strong>ï¼šBisonæ˜¯ä¸€ä¸ªè¯­æ³•åˆ†æå™¨ç”Ÿæˆå™¨ï¼Œå®ƒå¯ä»¥æ ¹æ®ç”¨æˆ·å®šä¹‰çš„è¯­æ³•è§„åˆ™ç”Ÿæˆä¸€ä¸ªè¯­æ³•åˆ†æå™¨ã€‚è¿™ä¸ªè¯­æ³•åˆ†æå™¨å¯ä»¥å°†ç”±è¯æ³•åˆ†æå™¨ç”Ÿæˆçš„è¯æ³•å•å…ƒåºåˆ—è½¬æ¢ä¸ºä¸€ä¸ªè¯­æ³•ç»“æ„ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€æ¡SQLè¯­å¥ï¼Œè¯­æ³•åˆ†æå™¨å¯ä»¥å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæè¿°äº†è¿™æ¡SQLè¯­å¥ç»“æ„çš„ASTã€‚</p></li></ol></blockquote><p>åœ¨æµç¨‹ä»£ç ä¸­ï¼Œ</p><blockquote><p>YY_BUFFER_STATE buf &#x3D; yy_scan_string(data_recv);</p></blockquote><p> è¿™è¡Œä»£ç å°†æ¥æ”¶åˆ°çš„SQLè¯­å¥å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªç¼“å†²åŒºï¼Œç„¶å</p><blockquote><p> if (yyparse() &#x3D;&#x3D; 0) </p></blockquote><p>è¿™è¡Œä»£ç è°ƒç”¨è§£æå™¨å¯¹SQLè¯­å¥è¿›è¡Œè¯­æ³•è§£æã€‚å¦‚æœè§£ææˆåŠŸï¼Œast::parse_tree å°†åŒ…å«è§£æç”Ÿæˆçš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚</p><p>æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰æ˜¯æºä»£ç çš„æŠ½è±¡è¯­æ³•ç»“æ„çš„æ ‘çŠ¶è¡¨ç°å½¢å¼ï¼Œå®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚åœ¨æ•°æ®åº“ä¸­ï¼Œå½“æˆ‘ä»¬è¾“å…¥ä¸€æ¡SQLè¯­å¥æ—¶ï¼Œæ•°æ®åº“é¦–å…ˆéœ€è¦è§£æè¿™æ¡è¯­å¥ï¼Œè§£æçš„ç»“æœå°±æ˜¯ä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ã€‚ä¾‹å¦‚ï¼Œå¯¹äºSQLè¯­å¥ SELECT * FROM table WHERE id &#x3D; 1ï¼Œå…¶å¯¹åº”çš„æŠ½è±¡è¯­æ³•æ ‘å¯èƒ½å¦‚ä¸‹ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  SELECT</span><br><span class="line">   /   |   \</span><br><span class="line"> *   FROM  WHERE</span><br><span class="line">     /     /   \</span><br><span class="line">table   id   =   1</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ ‘ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä»£è¡¨ä¸€ä¸ªæ“ä½œæˆ–è€…ä¸€ä¸ªå€¼ï¼Œä¾‹å¦‚ â€œSELECTâ€ã€â€FROMâ€ã€â€WHEREâ€ã€â€&#x3D;â€ ç­‰ç­‰ã€‚è¿™ä¸ªæ ‘å½¢ç»“æ„æ¸…æ™°åœ°è¡¨ç¤ºäº†SQLè¯­å¥çš„ç»“æ„ï¼Œä½¿å¾—æ•°æ®åº“å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£å’Œæ‰§è¡Œè¿™æ¡SQLè¯­å¥ã€‚</p><p>åŒæ—¶åœ¨parserèƒ½è¿›è¡ŒåŸºæœ¬çš„sqlè¯­æ³•æ£€æŸ¥ã€‚</p><h3 id="è¯­ä¹‰åˆ†æï¼ˆanalyzeï¼‰"><a href="#è¯­ä¹‰åˆ†æï¼ˆanalyzeï¼‰" class="headerlink" title="è¯­ä¹‰åˆ†æï¼ˆanalyzeï¼‰"></a>è¯­ä¹‰åˆ†æï¼ˆanalyzeï¼‰</h3><blockquote><p>std::shared_ptr<Query> query &#x3D; analyze-&gt;do_analyze(ast::parse_tree);</p></blockquote><p>è¿™è¡Œä»£ç è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œå°†ASTè½¬æ¢ä¸ºä¸€ä¸ªæŸ¥è¯¢å¯¹è±¡ã€‚è¿™ä¸ªæŸ¥è¯¢å¯¹è±¡åŒ…å«äº†æ‰§è¡ŒæŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><p>ä¼ å…¥analyzeçš„parse_treeä¼šåœ¨é‡Œé¢è¿›è¡Œåˆ†ç±»ï¼Œé€šè¿‡</p><blockquote><p>auto x &#x3D; std::dynamic_pointer_cast&lt;ast::SelectStmt&gt;(parse)</p></blockquote><p>â€‹<strong>â†‘</strong></p><blockquote><p>SelectStmtï¼ŒUpdateStmtï¼ŒDeleteStmtï¼ŒInsertStmtåˆ†åˆ«ä»£è¡¨å¢åˆ æ”¹æŸ¥å‡ ç§sqlè¯­å¥</p></blockquote><p>åœ¨analyzeé˜¶æ®µï¼Œå¯ä»¥å¯¹è§£æå‡ºæ¥çš„parseè¿›è¡Œè¿›ä¸€æ­¥æ£€æŸ¥ï¼Œæ¯”å¦‚ç›®æ ‡è¡¨ï¼ˆåˆ—ï¼‰æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠå·¦æ“ä½œæ•°å’Œå³æ“ä½œæ•°ç§ç±»æ˜¯å¦åŒ¹é…ç­‰ï¼Œç„¶åæŠŠç»è¿‡æ£€æŸ¥åçš„parseä¸­çš„ä¿¡æ¯ï¼Œå°è£…æˆqueryæŸ¥è¯¢å¯¹è±¡ï¼Œé‡Œé¢åŒ…å«äº†æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><h3 id="æŸ¥è¯¢ä¼˜åŒ–ï¼ˆoptimizerï¼‰"><a href="#æŸ¥è¯¢ä¼˜åŒ–ï¼ˆoptimizerï¼‰" class="headerlink" title="æŸ¥è¯¢ä¼˜åŒ–ï¼ˆoptimizerï¼‰:"></a>æŸ¥è¯¢ä¼˜åŒ–ï¼ˆoptimizerï¼‰:</h3><p>å¯¹åº”æ‰§è¡Œæµç¨‹é‡Œçš„</p><blockquote><p>std::shared_ptr<Plan> plan &#x3D; optimizer-&gt;plan_query(query, context);</p></blockquote><p>å°†æŸ¥è¯¢å¯¹è±¡ä¼ é€’ç»™ä¼˜åŒ–å™¨ï¼Œä¼˜åŒ–å™¨ä¼šç”Ÿæˆä¸€ä¸ªæ‰§è¡Œè®¡åˆ’ã€‚æ‰§è¡Œè®¡åˆ’æ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œç»è¿‡ä¼˜åŒ–å™¨åçš„æ‰§è¡Œè®¡åˆ’è¦åšå‡ºä¸€å®šç¨‹åº¦çš„ä¼˜åŒ–ï¼Œæœ€ç»ˆç”Ÿæˆè®¡åˆ’æ ‘ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> col1, col2 <span class="keyword">FROM</span> table1, table2 <span class="keyword">WHERE</span> table1.id <span class="operator">=</span> table2.id <span class="keyword">AND</span> table1.id <span class="operator">&gt;</span> <span class="number">5</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> col2 <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure><p>è¿™æ¡sqlå¯¹åº”çš„æŸ¥è¯¢è®¡åˆ’æ ‘å¯èƒ½æ˜¯ä¸‹é¢ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SortPlan (col2 DESC)</span><br><span class="line">|</span><br><span class="line">ProjectionPlan (col1, col2)</span><br><span class="line">|</span><br><span class="line">JoinPlan (table1.id = table2.id)</span><br><span class="line">|   |</span><br><span class="line">|   ScanPlan (table2)</span><br><span class="line">|</span><br><span class="line">ScanPlan (table1, id &gt; 5)</span><br></pre></td></tr></table></figure><ol><li><p>æœ€åº•å±‚çš„ ScanPlan æ˜¯æ‰«ææ“ä½œï¼Œå®ƒä»¬åˆ†åˆ«æ‰«æ table1 å’Œ table2ã€‚å¯¹äº table1ï¼Œè¿˜æœ‰ä¸€ä¸ªè¿‡æ»¤æ¡ä»¶ id &gt; 5ã€‚</p></li><li><p>JoinPlan æ˜¯è¿æ¥æ“ä½œï¼Œå®ƒå°† table1 å’Œ table2 è¿æ¥åœ¨ä¸€èµ·ï¼Œè¿æ¥æ¡ä»¶æ˜¯ table1.id &#x3D; table2.idã€‚</p></li><li><p>ProjectionPlan æ˜¯æŠ•å½±æ“ä½œï¼Œå®ƒä»è¿æ¥ç»“æœä¸­é€‰æ‹© col1 å’Œ col2 ä¸¤åˆ—ã€‚</p></li><li><p>æœ€é¡¶å±‚çš„ SortPlan æ˜¯æ’åºæ“ä½œï¼Œå®ƒæŒ‰ç…§ col2 åˆ—çš„å€¼è¿›è¡Œé™åºæ’åºã€‚</p></li></ol><p>è¿™ä¸ªæŸ¥è¯¢è®¡åˆ’æ ‘è¡¨ç¤ºäº†å¦‚ä½•æ‰§è¡Œè¿™æ¡SQLæŸ¥è¯¢è¯­å¥ã€‚æ•°æ®åº“ä¼šä»æœ€åº•å±‚çš„æ‰«ææ“ä½œå¼€å§‹ï¼Œé€æ­¥å‘ä¸Šæ‰§è¡Œï¼Œæœ€åå¾—åˆ°æ’åºåçš„ç»“æœã€‚ </p><h3 id="æ‰§è¡Œè®¡åˆ’ï¼ˆrunï¼‰"><a href="#æ‰§è¡Œè®¡åˆ’ï¼ˆrunï¼‰" class="headerlink" title="æ‰§è¡Œè®¡åˆ’ï¼ˆrunï¼‰"></a>æ‰§è¡Œè®¡åˆ’ï¼ˆrunï¼‰</h3><blockquote><p>portal-&gt;run(portalStmt, ql_manager.get(), &amp;txn_id, context);</p></blockquote><p>æ‰§è¡Œè®¡åˆ’ä¹Ÿæœ‰äº†ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æŒ‰ç…§è®¡åˆ’è°ƒç”¨æ‰§è¡Œæ–¹æ³•ï¼Œæ“ä½œæ•°æ®åº“äº†</p><p>runçš„ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éå†ç®—å­æ ‘å¹¶æ‰§è¡Œç®—å­ç”Ÿæˆæ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">(std::shared_ptr&lt;PortalStmt&gt; portal, QlManager* ql, <span class="type">txn_id_t</span> *txn_id, Context *context)</span></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(portal-&gt;tag) &#123;</span><br><span class="line">        <span class="keyword">case</span> PORTAL_ONE_SELECT:</span><br><span class="line">        &#123;</span><br><span class="line">            ql-&gt;<span class="built_in">select_from</span>(std::<span class="built_in">move</span>(portal-&gt;root), std::<span class="built_in">move</span>(portal-&gt;sel_cols), context);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> PORTAL_DML_WITHOUT_SELECT:</span><br><span class="line">        &#123;</span><br><span class="line">            ql-&gt;<span class="built_in">run_dml</span>(std::<span class="built_in">move</span>(portal-&gt;root));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> PORTAL_MULTI_QUERY:</span><br><span class="line">        &#123;</span><br><span class="line">            ql-&gt;<span class="built_in">run_mutli_query</span>(portal-&gt;plan, context);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> PORTAL_CMD_UTILITY:</span><br><span class="line">        &#123;</span><br><span class="line">            ql-&gt;<span class="built_in">run_cmd_utility</span>(portal-&gt;plan, txn_id, context);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">InternalError</span>(<span class="string">&quot;Unexpected field type&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>sql â€“&gt; parserè§£æç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ â€“&gt; analyzeråˆ†æå™¨ç”Ÿæˆqueryæ‰§è¡Œè®¡åˆ’ â€“&gt; optimizerä¼˜åŒ–æŸ¥è¯¢è®¡åˆ’ â€“&gt; runæ‰§è¡ŒæŸ¥è¯¢è®¡åˆ’</p><p>ä»¥ä¸Šæ˜¯ä¸€èˆ¬æ•°æ®åº“å†…æ ¸æ‰§è¡Œä¸€æ¡sqlçš„å¤§ä½“æµç¨‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“å†…æ ¸å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“å†…æ ¸å¼€å‘ </tag>
            
            <tag> æ‰‹æ“æ•°æ®åº“ç³»åˆ— </tag>
            
            <tag> æ•°æ®åº“å¤§èµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“å†…æ ¸å¼€å‘-å­˜å‚¨æ¨¡å—</title>
      <link href="/2023/07/29/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E6%A0%B8%E5%BC%80%E5%8F%91-%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9D%97/"/>
      <url>/2023/07/29/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E6%A0%B8%E5%BC%80%E5%8F%91-%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°æ®åº“å†…æ ¸å¼€å‘-å­˜å‚¨æ¨¡å—"><a href="#æ•°æ®åº“å†…æ ¸å¼€å‘-å­˜å‚¨æ¨¡å—" class="headerlink" title="æ•°æ®åº“å†…æ ¸å¼€å‘-å­˜å‚¨æ¨¡å—"></a>æ•°æ®åº“å†…æ ¸å¼€å‘-å­˜å‚¨æ¨¡å—</h1><h2 id="ç›¸å…³ç›®å½•ç»“æ„"><a href="#ç›¸å…³ç›®å½•ç»“æ„" class="headerlink" title="ç›¸å…³ç›®å½•ç»“æ„"></a>ç›¸å…³ç›®å½•ç»“æ„</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202307290147743.png" alt="image-20230729014711696"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202307291746977.png" alt="image-20230729174614930"></p><p>disk_managerï¼š ä¸»è¦ç”¨äºæ•°æ®åº“å’Œç£ç›˜æ–‡ä»¶ä¹‹é—´äº¤æµï¼Œæ“ä½œå­˜å‚¨åœ¨ç£ç›˜ä¸­çš„æ•°æ®</p><p>buffer_pool_manager: ä¸»è¦ç”¨äºæ“ä½œæ•°æ®åº“ç¼“å†²æ± </p><p>rm_file_handleï¼šä¸»è¦ç”¨äºå¯¹è®°å½•çš„å¢åˆ æ”¹æŸ¥</p><p>ä»–ä»¬ä¸­å°è£…äº†å¾ˆå¤šå¯¹æ•°æ®è¿›è¡ŒåŸºæœ¬æ“ä½œçš„æ–¹æ³•</p><h2 id="æ•°æ®çš„å­˜å‚¨åŸç†"><a href="#æ•°æ®çš„å­˜å‚¨åŸç†" class="headerlink" title="æ•°æ®çš„å­˜å‚¨åŸç†"></a>æ•°æ®çš„å­˜å‚¨åŸç†</h2><p>ä¸€å¼ æœ€åŸºæœ¬çš„æ•°æ®åº“è¡¨ï¼Œå®ƒåŒ…å«ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯è¡¨å¤´(å…ƒæ•°æ®)ï¼Œå®ƒå­˜å‚¨å­—æ®µä¿¡æ¯ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯æ•°æ®</p><table><thead><tr><th>id</th><th>name</th></tr></thead><tbody><tr><td>1</td><td>xiaoming</td></tr><tr><td>2</td><td>xiaohong</td></tr></tbody></table><p>(ç¬¬ä¸€è¡Œä¸ºè¡¨å¤´ï¼Œ2ï¼Œ3è¡Œä¸ºæ•°æ®)</p><p>åƒè¿™æ ·çš„ï¼Œæ•°æ®åº“ä¸­çš„æ¯ä¸€è¡Œï¼Œåœ¨æ•°æ®åº“ç³»ç»Ÿä¸­æ˜¯ä»¥äºŒè¿›åˆ¶å½¢å¼ä½œä¸ºä¸€æ¡<strong>è®°å½•</strong>è¿›è¡Œå­˜å‚¨çš„ï¼Œè€Œæ•°æ®åº“å¯¹ç£ç›˜è¿›è¡Œæ“ä½œæ—¶å¹¶ä¸æ˜¯ä»¥è®°å½•ä¸ºå•ä½ï¼Œå¦‚æœæ¯æ“ä½œä¸€æ¬¡æ•°æ®å°±è¦å›ç£ç›˜ä¸­æ“ä½œè®°å½•ï¼Œè¿™æ ·åšçš„æ•ˆç‡æ˜¯æä½çš„ï¼Œæ‰€ä»¥æ•°æ®åº“ä¸­å¼•å…¥äº†å¦ä¸€ç§å…³ç³»æ¨¡å‹<strong>é¡µ</strong>ï¼Œä»¥é¡µä¸ºå•ä½ç®¡ç†è®°å½•ã€‚</p><p>å› ä¸ºä»»ä½•æ¶‰åŠåˆ°ç£ç›˜çš„è¯»å†™çš„æ“ä½œï¼Œå…¶æ•ˆç‡æ˜¯è¿œä¸å¦‚ç›´æ¥åœ¨å†…å­˜ä¸­è¿›è¡Œè¿ç®—çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æƒ³æé«˜æ•ˆç‡ï¼Œå°±å¿…é¡»è¦å‡å°‘ç£ç›˜è¯»å†™çš„æ¬¡æ•°ï¼Œé™¤äº†ä¸Šè¿°è¯´çš„ä»¥é¡µä¸ºå•ä½æ“ä½œæ•°æ®ï¼Œåœ¨æ•°æ®åº“ä¸­ä¸€èˆ¬è¿˜å­˜åœ¨<strong>ç¼“å†²æ± </strong>ï¼ˆbufferpoolï¼‰,ä»–å¯ä»¥å°†ä¸€æ¬¡ç£ç›˜è¯»å–çš„å¤šä¸ªé¡µæš‚æ—¶å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ¯ä¸ªé¡µå æ®ç¼“å†²æ± çš„ä¸€å—ç©ºé—´ï¼Œè¿™å—ç©ºé—´ç§°ä¸º<strong>å¸§</strong>ï¼Œè¿™æ ·ä¾¿èƒ½å¤§å¤§å‡å°‘ç£ç›˜æ“ä½œçš„æ¬¡æ•°ï¼Œå°†å¤§é‡å†…å­˜ä¸ç£ç›˜ä¹‹é—´çš„æ•°æ®æ“ä½œè½¬ä¸ºå†…å­˜ä¸å†…å­˜ä¹‹é—´è¿›è¡Œæ“ä½œï¼Œåœ¨å†…å­˜ä¸­è¢«ä¿®æ”¹çš„æ•°æ®æ‰€åœ¨çš„é¡µå°†è¢«æ ‡è¯†ä¸º<strong>è„é¡µ</strong>ï¼Œä¹‹ååªè¦å¯¹è„é¡µç»Ÿä¸€å†™å›ç£ç›˜ï¼Œæ•°æ®å°±èƒ½å®ç°æ›´æ–°ã€‚</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202307291645118.png" alt="å­˜å‚¨åŸç†"></p><h2 id="ç›¸å…³æ•°æ®ç»“æ„"><a href="#ç›¸å…³æ•°æ®ç»“æ„" class="headerlink" title="ç›¸å…³æ•°æ®ç»“æ„"></a>ç›¸å…³æ•°æ®ç»“æ„</h2><h3 id="è®°å½•ï¼š"><a href="#è®°å½•ï¼š" class="headerlink" title="è®°å½•ï¼š"></a>è®°å½•ï¼š</h3><h4 id="æ•°æ®ç»“æ„ï¼š"><a href="#æ•°æ®ç»“æ„ï¼š" class="headerlink" title="æ•°æ®ç»“æ„ï¼š"></a>æ•°æ®ç»“æ„ï¼š</h4><p>è®°å½•â½‚ä»¶ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œæ¯â¼€ä¸ªæ•°æ®åº“ä¸­çš„è¡¨å¯ä»¥åˆ†ä¸ºè¡¨çš„å…ƒæ•°æ®å’Œè¡¨çš„è®°å½•æ•°æ®ï¼Œè¡¨çš„å…ƒæ•°æ®ç»Ÿâ¼€å­˜ å‚¨åœ¨.metaæ–‡ä»¶ä¸­ï¼Œè¡¨çš„è®°å½•æ•°æ®å•ç‹¬å­˜å‚¨åœ¨åŒåâ½‚ä»¶ä¸­ï¼Œæˆ‘ä»¬ç§°è¯¥â½‚ä»¶ä¸ºè®°å½•â½‚ä»¶ï¼Œåœ¨RMDBä¸­ï¼Œ æˆ‘ä»¬â½¤RmFileHandleç±»æ¥å¯¹â¼€ä¸ªè®°å½•â½‚ä»¶è¿›â¾ç®¡ç†ï¼ŒRmFileHandleç±»ä¸­è®°å½•äº†â½‚ä»¶æè¿°ç¬¦å’Œâ½‚ä»¶å¤´ä¿¡æ¯ï¼Œæ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ¯ä¸ªRmFileHandleå¯¹åº”ä¸€ä¸ªè¡¨çš„æ•°æ®æ–‡ä»¶ï¼Œé‡Œé¢æœ‰å¤šä¸ªpageï¼Œæ¯ä¸ªpageçš„æ•°æ®å°è£…åœ¨RmPageHandleä¸­ */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RmFileHandle</span> &#123;      </span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">RmScan</span>;    </span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">RmManager</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span>:</span><br><span class="line">    DiskManager *disk_manager_; </span><br><span class="line">    BufferPoolManager *buffer_pool_manager_;</span><br><span class="line">    <span class="type">int</span> fd_;        <span class="comment">// æ‰“å¼€æ–‡ä»¶åäº§ç”Ÿçš„æ–‡ä»¶å¥æŸ„</span></span><br><span class="line">    RmFileHdr file_hdr_;    <span class="comment">// æ–‡ä»¶å¤´ï¼Œç»´æŠ¤å½“å‰è¡¨æ–‡ä»¶çš„å…ƒæ•°æ®</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>RmFileHdrçš„æ•°æ®ç»“æ„ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">RmFileHdr</span> &#123;</span><br><span class="line"> <span class="type">int</span> record_size; <span class="comment">// å…ƒç»„â¼¤â¼©ï¼ˆâ»“åº¦ä¸å›ºå®šï¼Œç”±ä¸Šå±‚è¿›â¾åˆå§‹åŒ–ï¼‰</span></span><br><span class="line"> <span class="type">int</span> num_pages; <span class="comment">// â½‚ä»¶ä¸­å½“å‰åˆ†é…çš„pageä¸ªæ•°ï¼ˆåˆå§‹åŒ–ä¸º1ï¼‰</span></span><br><span class="line"> <span class="type">int</span> num_records_per_page; <span class="comment">// æ¯ä¸ªpageæœ€å¤šèƒ½å­˜å‚¨çš„å…ƒç»„ä¸ªæ•°</span></span><br><span class="line"> <span class="type">int</span> first_free_page_no; <span class="comment">// â½‚ä»¶ä¸­å½“å‰ç¬¬â¼€ä¸ªå¯â½¤çš„page noï¼ˆåˆå§‹åŒ–ä¸º-1ï¼‰</span></span><br><span class="line"> <span class="type">int</span> bitmap_size; <span class="comment">// bitmapâ¼¤â¼©</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>file_hdrä¸­çš„num_pagesè®°å½•æ­¤â½‚ä»¶åˆ†é…çš„pageä¸ªæ•°ï¼Œpage_noèŒƒå›´ä¸º[0,file_hdr.num_pages)ï¼Œpage_noä»0å¼€å§‹ å¢åŠ ï¼Œå…¶ä¸­ç¬¬0â»šå­˜file_hdrï¼Œä»ç¬¬1é¡µå¼€å§‹å­˜æ”¾çœŸæ­£çš„è®°å½•æ•°æ®ã€‚</p><p>RmPageHandleçš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">RmPageHandle</span> &#123;</span><br><span class="line"> <span class="type">const</span> RmFileHdr *file_hdr; <span class="comment">// â½¤åˆ°äº†file_hdrçš„bitmap_size, record_size</span></span><br><span class="line"> Page *page; <span class="comment">// æŒ‡å‘å•ä¸ªpage</span></span><br><span class="line"> RmPageHdr *page_hdr; <span class="comment">// page-&gt;dataçš„ç¬¬â¼€éƒ¨åˆ†ï¼ŒæŒ‡é’ˆæŒ‡å‘â¾¸åœ°å€ï¼Œâ»“åº¦ä¸ºsizeof(RmPageHdr)</span></span><br><span class="line"> <span class="type">char</span> *bitmap; <span class="comment">// page-&gt;dataçš„ç¬¬â¼†éƒ¨åˆ†ï¼ŒæŒ‡é’ˆæŒ‡å‘â¾¸åœ°å€ï¼Œâ»“åº¦ä¸ºfile_hdr-&gt;bitmap_size</span></span><br><span class="line"> <span class="type">char</span> *slots; <span class="comment">// page-&gt;dataçš„ç¬¬ä¸‰éƒ¨åˆ†ï¼ŒæŒ‡é’ˆæŒ‡å‘â¾¸åœ°å€ï¼Œæ¯ä¸ªslotçš„â»“åº¦ä¸ºfile_hdr-&gt;record_size</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯¹äºå…·ä½“çš„æ¯â¼€ä¸ªè®°å½•ï¼Œä½¿â½¤RmRecordæ¥è¿›â¾ç®¡ç†ï¼Œæ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">RmRecord</span> &#123;</span><br><span class="line"> <span class="type">char</span> *data; <span class="comment">// ä¿å­˜è®°å½•çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œdataåˆå§‹åŒ–åˆ†é…sizeä¸ªå­—èŠ‚çš„ç©ºé—´</span></span><br><span class="line"> <span class="type">int</span> size; <span class="comment">// size = RmFileHdrçš„record_size</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œä½¿â½¤Ridæ¥å¯¹æ¯â¼€ä¸ªè®°å½•è¿›â¾å”¯â¼€çš„æ ‡è¯†ï¼Œæ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Rid</span> &#123;</span><br><span class="line"> <span class="type">int</span> page_no; <span class="comment">// è¯¥è®°å½•æ‰€åœ¨çš„æ•°æ®â»šçš„page_no</span></span><br><span class="line"> <span class="type">int</span> slot_no; <span class="comment">// è¯¥è®°å½•æ‰€åœ¨æ•°æ®â»šä¸­çš„å…·ä½“slot_no</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="å…³ç³»è§£è¯»ï¼š"><a href="#å…³ç³»è§£è¯»ï¼š" class="headerlink" title="å…³ç³»è§£è¯»ï¼š"></a>å…³ç³»è§£è¯»ï¼š</h4><p>- RmFileHandleï¼šè¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ç±»ï¼Œå®ƒç»´æŠ¤äº†ä¸€ä¸ªæ‰“å¼€çš„è¡¨æ–‡ä»¶çš„ä¿¡æ¯ã€‚å®ƒåŒ…å«ä¸€ä¸ªDiskManagerå¯¹è±¡å’Œä¸€ä¸ªBufferPoolManagerå¯¹è±¡ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡åˆ†åˆ«ç”¨äºç®¡ç†ç£ç›˜å’Œç¼“å†²æ± ã€‚å®ƒè¿˜åŒ…å«ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦fd_ï¼Œç”¨äºæ ‡è¯†æ‰“å¼€çš„æ–‡ä»¶ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜åŒ…å«ä¸€ä¸ªRmFileHdrå¯¹è±¡ï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶å¤´ä¿¡æ¯ã€‚</p><p>- RmFileHdrï¼šè¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤´ç»“æ„ï¼Œå®ƒå­˜å‚¨äº†è¡¨æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå¦‚è®°å½•å¤§å°ã€é¡µé¢æ•°é‡ã€æ¯é¡µçš„è®°å½•æ•°é‡ã€ç¬¬ä¸€ä¸ªåŒ…å«ç©ºé—²ç©ºé—´çš„é¡µé¢å·å’Œæ¯é¡µçš„bitmapå¤§å°ã€‚</p><p>- RmPageHandleï¼šè¿™æ˜¯ä¸€ä¸ªé¡µé¢å¥æŸ„ç»“æ„ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªé¡µé¢çš„æ‰€æœ‰ä¿¡æ¯ã€‚å®ƒåŒ…å«ä¸€ä¸ªRmFileHdrå¯¹è±¡çš„æŒ‡é’ˆï¼ŒæŒ‡å‘å½“å‰é¡µé¢æ‰€åœ¨æ–‡ä»¶çš„æ–‡ä»¶å¤´ã€‚å®ƒè¿˜åŒ…å«ä¸€ä¸ªPageå¯¹è±¡çš„æŒ‡é’ˆï¼ŒæŒ‡å‘é¡µé¢çš„å®é™…æ•°æ®ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜åŒ…å«ä¸€ä¸ªRmPageHdrå¯¹è±¡çš„æŒ‡é’ˆï¼ŒæŒ‡å‘é¡µé¢çš„é¡µå¤´ä¿¡æ¯ã€‚æœ€åï¼Œå®ƒè¿˜åŒ…å«ä¸¤ä¸ªå­—ç¬¦æŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘é¡µé¢çš„bitmapå’Œè®°å½•æ§½ã€‚</p><p>- RmPageHdrï¼šè¿™æ˜¯ä¸€ä¸ªé¡µé¢å¤´ç»“æ„ï¼Œå®ƒå­˜å‚¨äº†æ¯ä¸ªé¡µé¢çš„å…ƒæ•°æ®ï¼Œå¦‚ä¸‹ä¸€ä¸ªåŒ…å«ç©ºé—²ç©ºé—´çš„é¡µé¢å·å’Œå½“å‰é¡µé¢ä¸­çš„è®°å½•æ•°é‡ã€‚</p><p>- RmRecordï¼šè¿™æ˜¯ä¸€ä¸ªè®°å½•ç»“æ„ï¼Œå®ƒåŒ…å«äº†ä¸€æ¡è®°å½•çš„æ•°æ®å’Œå¤§å°ã€‚</p><p>- PageIdï¼šè¿™æ˜¯ä¸€ä¸ªé¡µé¢IDç»“æ„ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å’Œä¸€ä¸ªé¡µé¢å·ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªé¡µé¢ã€‚</p><h3 id="è¡¨çš„å…ƒæ•°æ®å­˜å‚¨"><a href="#è¡¨çš„å…ƒæ•°æ®å­˜å‚¨" class="headerlink" title="è¡¨çš„å…ƒæ•°æ®å­˜å‚¨"></a>è¡¨çš„å…ƒæ•°æ®å­˜å‚¨</h3><h4 id="æ•°æ®ç»“æ„ï¼š-1"><a href="#æ•°æ®ç»“æ„ï¼š-1" class="headerlink" title="æ•°æ®ç»“æ„ï¼š"></a>æ•°æ®ç»“æ„ï¼š</h4><p>è¡¨çš„å…ƒæ•°æ®ä¸»è¦é€šè¿‡TabMetaæ•°æ®ç»“æ„æ¥è¿›â¾ç®¡ç†ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TabMeta</span> &#123;</span><br><span class="line"> std::string name; <span class="comment">// è¡¨åç§°</span></span><br><span class="line"> std::vector&lt;ColMeta&gt; cols; <span class="comment">// è¡¨åŒ…å«çš„å­—æ®µ</span></span><br><span class="line"> std::vector&lt;IndexMeta&gt; indexes; <span class="comment">// è¡¨ä¸Šå»ºâ½´çš„ç´¢å¼•</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯¹äºæ¯ä¸ªå­—æ®µï¼Œè¿ç”¨ColMetaæ•°æ®ç»“æ„è¿›è¡Œç®¡ç†ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ColMeta</span> &#123;</span><br><span class="line"> std::string tab_name; <span class="comment">// è¡¨åç§°</span></span><br><span class="line"> std::string name; <span class="comment">// å­—æ®µåç§°</span></span><br><span class="line"> ColType type; <span class="comment">// å­—æ®µç±»å‹</span></span><br><span class="line"> <span class="type">int</span> len; <span class="comment">// å­—æ®µâ»“åº¦</span></span><br><span class="line"> <span class="type">int</span> offset; <span class="comment">// å­—æ®µæ‰€åœ¨è®°å½•ä¸­çš„åç§»é‡ï¼Œâ½¤äºæŸ¥è¯¢å­—æ®µçš„å…·ä½“å­˜å‚¨ä½ç½®</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯¹äºç´¢å¼•ç»“æ„ï¼Œé€šè¿‡IndexMetaæ•°æ®ç»“æ„æ¥è¿›â¾ç®¡ç†ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">IndexMeta</span> &#123;</span><br><span class="line"> std::string tab_name; <span class="comment">// ç´¢å¼•æ‰€å±è¡¨åç§°</span></span><br><span class="line"> <span class="type">int</span> col_tot_len; <span class="comment">// ç´¢å¼•å­—æ®µâ»“åº¦æ€»å’Œ</span></span><br><span class="line"> <span class="type">int</span> col_num; <span class="comment">// ç´¢å¼•å­—æ®µæ•°é‡</span></span><br><span class="line"> std::vector&lt;ColMeta&gt; cols; <span class="comment">// ç´¢å¼•åŒ…å«çš„å­—æ®µ</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="å…³ç³»è§£è¯»ï¼š-1"><a href="#å…³ç³»è§£è¯»ï¼š-1" class="headerlink" title="å…³ç³»è§£è¯»ï¼š"></a>å…³ç³»è§£è¯»ï¼š</h4><p>TabMetaæ˜¯è¡¨çš„å°è£…ï¼ŒåŒ…æ‹¬è¡¨åï¼Œå­—æ®µåï¼Œè¡¨ä¸Šçš„ç´¢å¼•ã€‚</p><p>ColMetaæ˜¯å­—æ®µçš„å°è£…ï¼ŒåŒ…æ‹¬å­—æ®µæ‰€åœ¨çš„è¡¨åï¼Œå­—æ®µåï¼Œå­—æ®µç±»å‹ï¼Œå­—æ®µé•¿åº¦ï¼Œå­—æ®µæ‰€åœ¨è®°å½•ä¸­çš„åç§»é‡ã€‚å…³äº<strong>åç§»é‡</strong>ï¼ˆoffsetï¼‰ï¼Œæ ¹æ®ä¹‹å‰è¯´çš„è®°å½•çš„å®šä¹‰ï¼Œæ¯ä¸€æ¡è®°å½•å³æ˜¯è¡¨çš„ä¸€è¡Œï¼Œä¸€è¡Œå¯èƒ½å­˜åœ¨å¤šä¸ªå­—æ®µï¼Œæ‰€ä»¥è¦ä¾é åç§»é‡æ¥å®šä½å­—æ®µåœ¨è®°å½•ä¸­çš„ä½ç½®ã€‚</p><p>IndexMetaæ˜¯å¯¹ç´¢å¼•çš„å°è£…ï¼ŒåŒ…æ‹¬ç´¢å¼•çš„åŸºæœ¬ä¿¡æ¯ã€‚</p><h2 id="æ“ä½œæ–¹æ³•å’Œéƒ¨åˆ†å®ç°æ€è·¯"><a href="#æ“ä½œæ–¹æ³•å’Œéƒ¨åˆ†å®ç°æ€è·¯" class="headerlink" title="æ“ä½œæ–¹æ³•å’Œéƒ¨åˆ†å®ç°æ€è·¯"></a>æ“ä½œæ–¹æ³•å’Œéƒ¨åˆ†å®ç°æ€è·¯</h2><h3 id="ç£ç›˜ç®¡ç†å™¨ï¼ˆdiskmanagerï¼‰"><a href="#ç£ç›˜ç®¡ç†å™¨ï¼ˆdiskmanagerï¼‰" class="headerlink" title="ç£ç›˜ç®¡ç†å™¨ï¼ˆdiskmanagerï¼‰:"></a>ç£ç›˜ç®¡ç†å™¨ï¼ˆdiskmanagerï¼‰:</h3><p>ä¸»è¦æ˜¯å¯¹ç£ç›˜æ–‡ä»¶å¼€å¯å…³é—­ï¼Œå†™å…¥è¯»å…¥ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é¡µæ“ä½œ</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description: å°†æ•°æ®å†™å…¥æ–‡ä»¶çš„æŒ‡å®šç£ç›˜é¡µé¢ä¸­</span></span><br><span class="line"><span class="comment"> * @param &#123;int&#125; fd ç£ç›˜æ–‡ä»¶çš„æ–‡ä»¶å¥æŸ„</span></span><br><span class="line"><span class="comment"> * @param &#123;page_id_t&#125; page_no å†™å…¥ç›®æ ‡é¡µé¢çš„page_id</span></span><br><span class="line"><span class="comment"> * @param &#123;char&#125; *offset è¦å†™å…¥ç£ç›˜çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * @param &#123;int&#125; num_bytes è¦å†™å…¥ç£ç›˜çš„æ•°æ®å¤§å°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">write_page</span><span class="params">(<span class="type">int</span> fd, <span class="type">page_id_t</span> page_no, <span class="type">const</span> <span class="type">char</span> *offset, <span class="type">int</span> num_bytes)</span></span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description: è¯»å–æ–‡ä»¶ä¸­æŒ‡å®šç¼–å·çš„é¡µé¢ä¸­çš„éƒ¨åˆ†æ•°æ®åˆ°å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment"> * @param &#123;int&#125; fd ç£ç›˜æ–‡ä»¶çš„æ–‡ä»¶å¥æŸ„</span></span><br><span class="line"><span class="comment"> * @param &#123;page_id_t&#125; page_no æŒ‡å®šçš„é¡µé¢ç¼–å·</span></span><br><span class="line"><span class="comment"> * @param &#123;char&#125; *offset è¯»å–çš„å†…å®¹å†™å…¥åˆ°offsetä¸­</span></span><br><span class="line"><span class="comment"> * @param &#123;int&#125; num_bytes è¯»å–çš„æ•°æ®é‡å¤§å°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">read_page</span><span class="params">(<span class="type">int</span> fd, <span class="type">page_id_t</span> page_no, <span class="type">char</span> *offset, <span class="type">int</span> num_bytes)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*ç›®å½•æ“ä½œ*/</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">is_dir</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">create_dir</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">destroy_dir</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*æ–‡ä»¶æ“ä½œ*/</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">is_file</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">create_file</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">destroy_file</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">open_file</span><span class="params">(<span class="type">const</span> std::string &amp;path)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">close_file</span><span class="params">(<span class="type">int</span> fd)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get_file_size</span><span class="params">(<span class="type">const</span> std::string &amp;file_name)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">get_file_name</span><span class="params">(<span class="type">int</span> fd)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get_file_fd</span><span class="params">(<span class="type">const</span> std::string &amp;file_name)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// æ–‡ä»¶æ‰“å¼€åˆ—è¡¨ï¼Œç”¨äºè®°å½•æ–‡ä»¶æ˜¯å¦è¢«æ‰“å¼€</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//path2fd_:é€šè¿‡æ–‡ä»¶è·¯å¾„æŸ¥æ‰¾å…¶æ–‡ä»¶å¥æŸ„ã€‚ç”¨äºæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²æ‰“å¼€,å¹¶è·å–å…¶å¥æŸ„ã€‚</span></span><br><span class="line">    <span class="comment">//fd2path_:é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æŸ¥æ‰¾å…¶æ–‡ä»¶è·¯å¾„ã€‚ç”¨äºé€šè¿‡æ–‡ä»¶å¥æŸ„è·å–å¯¹åº”çš„æ–‡ä»¶è·¯å¾„ã€‚</span></span><br><span class="line"></span><br><span class="line">    std::unordered_map&lt;std::string, <span class="type">int</span>&gt; path2fd_;  <span class="comment">//&lt;Pageæ–‡ä»¶ç£ç›˜è·¯å¾„,Page fd&gt;å“ˆå¸Œè¡¨</span></span><br><span class="line">    std::unordered_map&lt;<span class="type">int</span>, std::string&gt; fd2path_;  <span class="comment">//&lt;Page fd,Pageæ–‡ä»¶ç£ç›˜è·¯å¾„&gt;å“ˆå¸Œè¡¨</span></span><br></pre></td></tr></table></figure><p>write_page &amp; read_pageåˆ†åˆ«ä¸ºè¯»é¡µå’Œå†™é¡µï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºæ¶‰åŠåˆ°åœ¨æ–‡ä»¶çš„æŸä¸€ä½ç½®è¯»æˆ–è€…å†™ï¼Œæ‰€ä»¥è¦å…ˆå®šä½ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨c++è‡ªå¸¦çš„ioåº“ä¸­çš„lseekæ–¹æ³•</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">lseek</span>(fd,page_no * PAGE_SIZE,SEEK_SET); <span class="comment">//å®šä½åˆ°ç¬¬page_noä¸ªæ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼ŒSEEK_SET = 0</span></span><br></pre></td></tr></table></figure><p>è¯»å†™åŒæ ·è°ƒç”¨è‡ªå¸¦writeï¼Œreadæ–¹æ³•</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> bw = <span class="built_in">write</span>(fd,offset,num_bytes);</span><br><span class="line"><span class="type">ssize_t</span> br = <span class="built_in">read</span>(fd,offset,num_bytes);</span><br></pre></td></tr></table></figure><p>ç›®å½•æ“ä½œå’Œæ–‡ä»¶æ“ä½œéƒ½æ˜¯åŸºæœ¬çš„ioæ“ä½œï¼Œä¸åšè¯¦è§£äº†ã€‚</p><blockquote><p> &#x2F;&#x2F; æ–‡ä»¶æ‰“å¼€åˆ—è¡¨ï¼Œç”¨äºè®°å½•æ–‡ä»¶æ˜¯å¦è¢«æ‰“å¼€</p><p>std::unordered_map&lt;std::string, int&gt; path2fd_;  &#x2F;&#x2F;&lt;Pageæ–‡ä»¶ç£ç›˜è·¯å¾„,Page fd&gt;å“ˆå¸Œè¡¨<br>std::unordered_map&lt;int, std::string&gt; fd2path_;  &#x2F;&#x2F;&lt;Page fd,Pageæ–‡ä»¶ç£ç›˜è·¯å¾„&gt;å“ˆå¸Œè¡¨</p></blockquote><p>æ–‡ä»¶æ‰“å¼€åˆ—è¡¨æ˜¯ä¸¤ä¸ªmapç±»å‹ï¼Œè®°å½•äº†å½“å‰ç³»ç»Ÿä¸‹è¢«æ‰“å¼€çš„æ–‡ä»¶ï¼Œå³ä½¿ç”¨ä¸­çš„æ–‡ä»¶ï¼Œå¯ä»¥åˆ©ç”¨å®ƒé˜²æ­¢é‡å¤æ‰“å¼€ï¼Œå…³é—­æˆ–åˆ é™¤æ­£åœ¨ä½¿ç”¨ä¸­çš„æ–‡ä»¶ï¼ŒåŒæ—¶æˆ‘ä»¬åœ¨æ‰“å¼€å’Œå…³é—­æ–‡ä»¶æ—¶éƒ½è¦æ³¨æ„æ›´æ–°æ–‡ä»¶æ‰“å¼€åˆ—è¡¨ã€‚</p><h3 id="ç¼“å†²æ± ç®¡ç†å™¨ï¼ˆbuffer-pool-managerï¼‰ï¼š"><a href="#ç¼“å†²æ± ç®¡ç†å™¨ï¼ˆbuffer-pool-managerï¼‰ï¼š" class="headerlink" title="ç¼“å†²æ± ç®¡ç†å™¨ï¼ˆbuffer_pool_managerï¼‰ï¼š"></a>ç¼“å†²æ± ç®¡ç†å™¨ï¼ˆbuffer_pool_managerï¼‰ï¼š</h3><p>ç¼“å†²æ± ç®¡ç†å™¨ä¸»è¦æ˜¯å¯¹ç³»ç»Ÿçš„ç¼“å†²æ± è¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬ç»™é¡µåˆ†é…ç©ºé—²å¸§ï¼Œå¯¹ç¼“å†²æ± æ›´æ–°ï¼Œå°†ç¼“å†²æ± ä¸­çš„è„é¡µå†™å›ï¼Œå…¶ä¸­ç¼“å†²æ± çš„æ›´æ–°éœ€è¦å®ç°ä¸“é—¨çš„æ›´æ–°ç®—æ³•ï¼Œæ¯”è¾ƒé‡è¦ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @description: å°†ç›®æ ‡é¡µé¢æ ‡è®°ä¸ºè„é¡µ</span></span><br><span class="line"><span class="comment">  * @param &#123;Page*&#125; page è„é¡µ</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">mark_dirty</span><span class="params">(Page* page)</span> </span>&#123; page-&gt;is_dirty_ = <span class="literal">true</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>: </span><br><span class="line"> <span class="function">Page* <span class="title">fetch_page</span><span class="params">(PageId page_id)</span></span>;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="type">bool</span> <span class="title">unpin_page</span><span class="params">(PageId page_id, <span class="type">bool</span> is_dirty)</span></span>;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="type">bool</span> <span class="title">flush_page</span><span class="params">(PageId page_id)</span></span>;</span><br><span class="line"></span><br><span class="line"> <span class="function">Page* <span class="title">new_page</span><span class="params">(PageId* page_id)</span></span>;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="type">bool</span> <span class="title">delete_page</span><span class="params">(PageId page_id)</span></span>;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">flush_all_pages</span><span class="params">(<span class="type">int</span> fd)</span></span>;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">delete_pages_index</span><span class="params">(<span class="type">int</span> fd)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"> <span class="function"><span class="type">bool</span> <span class="title">find_victim_page</span><span class="params">(<span class="type">frame_id_t</span>* frame_id)</span></span>;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">update_page</span><span class="params">(Page* page, PageId new_page_id, <span class="type">frame_id_t</span> new_frame_id)</span></span>;</span><br></pre></td></tr></table></figure><p>find_victim_page:</p><blockquote><p> * @description: ä»free_listæˆ–replacerä¸­å¾—åˆ°å¯æ·˜æ±°å¸§é¡µçš„ *frame_id</p><p> * @return {bool} true: å¯æ›¿æ¢å¸§æŸ¥æ‰¾æˆåŠŸ , false: å¯æ›¿æ¢å¸§æŸ¥æ‰¾å¤±è´¥</p><p> * @param {frame_id_t*} frame_id å¸§é¡µidæŒ‡é’ˆ,è¿”å›æˆåŠŸæ‰¾åˆ°çš„å¯æ›¿æ¢å¸§id</p></blockquote><p>ä»ç©ºé—²å¸§é“¾è¡¨ä¸­è·å–å¸§idï¼Œå¹¶return trueï¼ŒåŒæ—¶å¦‚æœæ²¡æœ‰ç©ºé—²å¸§åˆ™éœ€è¦è°ƒç”¨æ·˜æ±°ç®—æ³•è¿›è¡Œæ·˜æ±°</p><p>update_page:</p><blockquote><p> * @description: æ›´æ–°é¡µé¢æ•°æ®, å¦‚æœä¸ºè„é¡µåˆ™éœ€å†™å…¥ç£ç›˜ï¼Œå†æ›´æ–°ä¸ºæ–°é¡µé¢ï¼Œæ›´æ–°pageå…ƒæ•°æ®(data, is_dirty, page_id)å’Œpage table</p><p> * @param {Page*} page å†™å›é¡µæŒ‡é’ˆ</p><p> * @param {PageId} new_page_id æ–°çš„page_id</p><p> * @param {frame_id_t} new_frame_id æ–°çš„å¸§frame_id</p></blockquote><p>æ›´æ–°ç¼“å†²æ± ä¸­çš„é¡µåˆ°ç£ç›˜ï¼Œå¦‚æœé¡µé¢æœªè¢«ä¿®æ”¹ï¼ˆéè„é¡µï¼‰ï¼Œåˆ™ç›´æ¥æ›´æ–°è¯¥é¡µçš„æ•°æ®ç»™æ–°é¡µï¼Œåˆ é™¤æ—§å¸§å·å’Œé¡µé¢å·ä¹‹é—´çš„æ˜ å°„ï¼Œå°†æ–°é¡µå·å’Œå¸§å·æ˜ å°„ï¼Œå¦‚æœæ˜¯è„é¡µï¼Œè¿˜éœ€è¦æå‰å†™å›ç£ç›˜ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">BufferPoolManager::update_page</span><span class="params">(Page *page, PageId new_page_id, <span class="type">frame_id_t</span> new_frame_id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1 å¦‚æœæ˜¯è„é¡µï¼Œå†™å›ç£ç›˜ï¼Œå¹¶ä¸”æŠŠdirtyç½®ä¸ºfalse</span></span><br><span class="line">    <span class="keyword">if</span> (page-&gt;<span class="built_in">is_dirty</span>()) &#123;</span><br><span class="line">        disk_manager_-&gt;<span class="built_in">write_page</span>(page-&gt;<span class="built_in">get_page_id</span>().fd, page-&gt;<span class="built_in">get_page_id</span>().page_no, page-&gt;<span class="built_in">get_data</span>(), PAGE_SIZE);</span><br><span class="line">        page-&gt;is_dirty_ = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2 æ›´æ–°page table</span></span><br><span class="line">    page_table_.<span class="built_in">erase</span>(page-&gt;<span class="built_in">get_page_id</span>());</span><br><span class="line">    page_table_[new_page_id] = new_frame_id;</span><br><span class="line">    <span class="comment">// 3 é‡ç½®pageçš„dataï¼Œæ›´æ–°page id</span></span><br><span class="line">    page-&gt;<span class="built_in">reset_memory</span>();</span><br><span class="line">    page-&gt;id_ = new_page_id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>fetch_page:</p><blockquote><ul><li>@description: ä»buffer poolè·å–éœ€è¦çš„é¡µã€‚</li><li><pre><code>         å¦‚æœé¡µè¡¨ä¸­å­˜åœ¨page_idï¼ˆè¯´æ˜è¯¥pageåœ¨ç¼“å†²æ± ä¸­ï¼‰ï¼Œå¹¶ä¸”pin_count++ã€‚</code></pre></li><li><pre><code>         å¦‚æœé¡µè¡¨ä¸å­˜åœ¨page_idï¼ˆè¯´æ˜è¯¥pageåœ¨ç£ç›˜ä¸­ï¼‰ï¼Œåˆ™æ‰¾ç¼“å†²æ± victim pageï¼Œå°†å…¶æ›¿æ¢ä¸ºç£ç›˜ä¸­è¯»å–çš„pageï¼Œpin_countç½®1ã€‚</code></pre></li><li>@return {Page*} è‹¥è·å¾—äº†éœ€è¦çš„é¡µåˆ™å°†å…¶è¿”å›ï¼Œå¦åˆ™è¿”å›nullptr</li><li>@param {PageId} page_id éœ€è¦è·å–çš„é¡µçš„PageId</li></ul></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Page* <span class="title">BufferPoolManager::fetch_page</span><span class="params">(PageId page_id)</span> </span>&#123;</span><br><span class="line">    latch_.<span class="built_in">lock</span>();</span><br><span class="line">    <span class="type">frame_id_t</span> frame_id;</span><br><span class="line">    <span class="comment">// 1.     ä»page_table_ä¸­æœå¯»ç›®æ ‡é¡µ</span></span><br><span class="line">    <span class="comment">// 1.1    è‹¥ç›®æ ‡é¡µæœ‰è¢«page_table_è®°å½•ï¼Œåˆ™å°†å…¶æ‰€åœ¨frameå›ºå®š(pin)ï¼Œå¹¶è¿”å›ç›®æ ‡é¡µã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (page_table_.<span class="built_in">find</span>(page_id) != page_table_.<span class="built_in">end</span>()) &#123;</span><br><span class="line">        frame_id = page_table_.<span class="built_in">at</span>(page_id);</span><br><span class="line">        Page* page = &amp;pages_[frame_id];</span><br><span class="line">        <span class="keyword">if</span> (++page-&gt;pin_count_ == <span class="number">1</span>) &#123;</span><br><span class="line">            replacer_-&gt;<span class="built_in">pin</span>(frame_id);</span><br><span class="line">        &#125;</span><br><span class="line">        latch_.<span class="built_in">unlock</span>();</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// 1.2    å¦åˆ™ï¼Œå°è¯•è°ƒç”¨find_victim_pageè·å¾—ä¸€ä¸ªå¯ç”¨çš„frameï¼Œè‹¥å¤±è´¥åˆ™è¿”å›nullptr</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">find_victim_page</span>(&amp;frame_id)) &#123;</span><br><span class="line">        latch_.<span class="built_in">unlock</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Page* page = &amp;pages_[frame_id];</span><br><span class="line">    <span class="comment">// 2.     è‹¥è·å¾—çš„å¯ç”¨frameå­˜å‚¨çš„ä¸ºdirty pageï¼Œåˆ™é¡»è°ƒç”¨updata_pageå°†pageå†™å›åˆ°ç£ç›˜</span></span><br><span class="line">    <span class="built_in">update_page</span>(page, page_id, frame_id);</span><br><span class="line">    <span class="comment">// 3.     è°ƒç”¨disk_manager_çš„read_pageè¯»å–ç›®æ ‡é¡µåˆ°frame</span></span><br><span class="line">    disk_manager_-&gt;<span class="built_in">read_page</span>(page_id.fd, page_id.page_no, page-&gt;<span class="built_in">get_data</span>(), PAGE_SIZE);</span><br><span class="line">    <span class="comment">// 4.     å›ºå®šç›®æ ‡é¡µï¼Œæ›´æ–°pin_count_</span></span><br><span class="line">    <span class="keyword">if</span> (++page-&gt;pin_count_ == <span class="number">1</span>) &#123;</span><br><span class="line">        replacer_-&gt;<span class="built_in">pin</span>(frame_id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.     è¿”å›ç›®æ ‡é¡µ</span></span><br><span class="line">    latch_.<span class="built_in">unlock</span>();</span><br><span class="line">    <span class="keyword">return</span> page;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>flush_pageï¼š</p><blockquote><p> * @description: å°†ç›®æ ‡é¡µå†™å›ç£ç›˜ï¼Œä¸è€ƒè™‘å½“å‰é¡µé¢æ˜¯å¦æ­£åœ¨è¢«ä½¿ç”¨</p><p> * @return {bool} æˆåŠŸåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false(åªæœ‰page_table_ä¸­æ²¡æœ‰ç›®æ ‡é¡µæ—¶)</p><p> * @param {PageId} page_id ç›®æ ‡é¡µçš„page_idï¼Œä¸èƒ½ä¸ºINVALID_PAGE_ID</p></blockquote><p>delete_pageï¼š</p><blockquote><p> * @description: ä»buffer_poolåˆ é™¤ç›®æ ‡é¡µ</p><p> * @return {bool} å¦‚æœç›®æ ‡é¡µä¸å­˜åœ¨äºbuffer_poolæˆ–è€…æˆåŠŸè¢«åˆ é™¤åˆ™è¿”å›trueï¼Œè‹¥å…¶å­˜åœ¨äºbuffer_poolä½†æ— æ³•åˆ é™¤åˆ™è¿”å›false</p><p> * @param {PageId} page_id ç›®æ ‡é¡µ</p></blockquote><p>flush_all_pagesï¼š</p><blockquote><p> * @description: å°†buffer_poolä¸­çš„æ‰€æœ‰é¡µå†™å›åˆ°ç£ç›˜</p><p> * @param {int} fd æ–‡ä»¶å¥æŸ„</p></blockquote><h3 id="è®°å½•æ“ä½œ-rm-file-handle"><a href="#è®°å½•æ“ä½œ-rm-file-handle" class="headerlink" title="è®°å½•æ“ä½œ(rm_file_handle):"></a>è®°å½•æ“ä½œ(rm_file_handle):</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* åˆ¤æ–­æŒ‡å®šä½ç½®ä¸Šæ˜¯å¦å·²ç»å­˜åœ¨ä¸€æ¡è®°å½•ï¼Œé€šè¿‡Bitmapæ¥åˆ¤æ–­ */</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">is_record</span><span class="params">(<span class="type">const</span> Rid &amp;rid)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    RmPageHandle page_handle = <span class="built_in">fetch_page_handle</span>(rid.page_no);</span><br><span class="line">    <span class="keyword">return</span> Bitmap::<span class="built_in">is_set</span>(page_handle.bitmap, rid.slot_no);  <span class="comment">// pageçš„slot_noä½ç½®ä¸Šæ˜¯å¦æœ‰record</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::unique_ptr&lt;RmRecord&gt; <span class="title">get_record</span><span class="params">(<span class="type">const</span> Rid &amp;rid, Context *context)</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Rid <span class="title">insert_record</span><span class="params">(<span class="type">char</span> *buf, Context *context)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert_record</span><span class="params">(<span class="type">const</span> Rid &amp;rid, <span class="type">char</span> *buf)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">delete_record</span><span class="params">(<span class="type">const</span> Rid &amp;rid, Context *context)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update_record</span><span class="params">(<span class="type">const</span> Rid &amp;rid, <span class="type">char</span> *buf, Context *context)</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>get_record:</p><ul><li>@description: è·å–å½“å‰è¡¨ä¸­è®°å½•å·ä¸ºridçš„è®°å½•</li><li>@param {Rid&amp;} rid è®°å½•å·ï¼ŒæŒ‡å®šè®°å½•çš„ä½ç½®</li><li>@param {Context*} context</li><li>@return {unique_ptr<RmRecord>} ridå¯¹åº”çš„è®°å½•å¯¹è±¡æŒ‡é’ˆ</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::unique_ptr&lt;RmRecord&gt; <span class="title">RmFileHandle::get_record</span><span class="params">(<span class="type">const</span> Rid&amp; rid, Context* context)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. è·å–æŒ‡å®šè®°å½•æ‰€åœ¨çš„page handle</span></span><br><span class="line">    <span class="comment">// 2. åˆå§‹åŒ–ä¸€ä¸ªæŒ‡å‘RmRecordçš„æŒ‡é’ˆï¼ˆèµ‹å€¼å…¶å†…éƒ¨çš„dataå’Œsizeï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŠ é”</span></span><br><span class="line">    <span class="keyword">if</span>(context!=<span class="literal">nullptr</span>)&#123;</span><br><span class="line">        context-&gt;lock_mgr_-&gt;<span class="built_in">lock_shared_on_record</span>(context-&gt;txn_,rid,fd_);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 6/29 è¡¥å……å¯èƒ½å‡ºç°çš„å¼‚å¸¸æŠ›å‡º</span></span><br><span class="line">    <span class="keyword">if</span>(rid.page_no &gt; handle.file_hdr-&gt;num_pages || rid.slot_no &gt; handle.file_hdr-&gt;num_records_per_page)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">RecordNotFoundError</span>(rid.page_no,rid.slot_no);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (!Bitmap::<span class="built_in">is_set</span>(handle.bitmap, rid.slot_no)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">RecordNotFoundError</span>(rid.page_no, rid.slot_no);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä»¥ä¸Š</span></span><br><span class="line">    RmPageHandle  handle = <span class="built_in">fetch_page_handle</span>(rid.page_no);</span><br><span class="line">    <span class="function">std::unique_ptr&lt;RmRecord&gt; <span class="title">record</span><span class="params">(<span class="keyword">new</span> RmRecord())</span></span>;</span><br><span class="line">    record-&gt;size = file_hdr_.record_size;</span><br><span class="line">    record-&gt;data = handle.<span class="built_in">get_slot</span>(rid.slot_no);</span><br><span class="line"></span><br><span class="line">    buffer_pool_manager_-&gt;<span class="built_in">unpin_page</span>(handle.page-&gt;<span class="built_in">get_page_id</span>(),<span class="literal">false</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> record;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="LRUæ›¿æ¢å™¨-lru-replacer"><a href="#LRUæ›¿æ¢å™¨-lru-replacer" class="headerlink" title="LRUæ›¿æ¢å™¨(lru_replacer):"></a>LRUæ›¿æ¢å™¨(lru_replacer):</h3><p>å› ä¸ºç¼“å†²ä¸­åªæ˜¯åœ¨å†…å­˜å¼€è¾Ÿå‡ºçš„ä¸€å°å—ç©ºé—´ï¼Œç”¨äºå¿«é€Ÿè®¿é—®ï¼Œå®ƒæœ¬èº«å¤§å°è‚¯å®šè¦è¿œå°äºç£ç›˜å‚¨å­˜å¤§å°ï¼Œæ‰€ä»¥ç¼“å†²æ± ä¸­ä¸å¯èƒ½æ°¸è¿œå­˜åœ¨ä½ æƒ³è¦çš„é¡µé¢ï¼Œå¦‚æœå‡ºç°è¦ç”¨çš„é¡µé¢åœ¨ç¼“å†²æ± ä¸­ä¸å­˜åœ¨çš„æƒ…å†µï¼Œé‚£å°±éœ€è¦ç¼“å†²æ± æ›¿æ¢ç­–ç•¥æ¥æ›¿æ¢æ‰è¿‘æœŸç”¨çš„æœ€å°‘çš„é¡µé¢ï¼Œè¿™æ ·æ•´ä¸ªç¼“å†²æ± å°±åŠ¨æ€èµ·æ¥äº†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LRUReplacer</span> : <span class="keyword">public</span> Replacer &#123;</span><br><span class="line">   <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description: åˆ›å»ºä¸€ä¸ªæ–°çš„LRUReplacer</span></span><br><span class="line"><span class="comment">     * @param &#123;size_t&#125; num_pages LRUReplaceræœ€å¤šéœ€è¦å­˜å‚¨çš„pageæ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">LRUReplacer</span><span class="params">(<span class="type">size_t</span> num_pages)</span></span>;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">LRUReplacer</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">victim</span><span class="params">(<span class="type">frame_id_t</span> *frame_id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pin</span><span class="params">(<span class="type">frame_id_t</span> frame_id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">unpin</span><span class="params">(<span class="type">frame_id_t</span> frame_id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">Size</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span>:</span><br><span class="line">   <span class="comment">// LRUhash_ :é¡µé¢idå’Œé¡µé¢åœ¨LRUlist_ä¸­çš„ä½ç½® LRUlist_ï¼šå¤´æœ€è¿‘è®¿é—®ï¼Œå°¾é•¿æ—¶é—´æœªè®¿é—®</span></span><br><span class="line">    std::mutex latch_;                  <span class="comment">// äº’æ–¥é”</span></span><br><span class="line">    std::list&lt;<span class="type">frame_id_t</span>&gt; LRUlist_;     <span class="comment">// æŒ‰åŠ å…¥çš„æ—¶é—´é¡ºåºå­˜æ”¾unpinned pagesçš„frame idï¼Œé¦–éƒ¨è¡¨ç¤ºæœ€è¿‘è¢«è®¿é—®</span></span><br><span class="line">    std::unordered_map&lt;<span class="type">frame_id_t</span>, std::list&lt;<span class="type">frame_id_t</span>&gt;::iterator&gt; LRUhash_;   <span class="comment">// frame_id_t -&gt;unpinned pagesçš„frame id</span></span><br><span class="line">    <span class="type">size_t</span> max_size_;   <span class="comment">// æœ€å¤§å®¹é‡ï¼ˆä¸ç¼“å†²æ± çš„å®¹é‡ç›¸åŒï¼‰</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>victim:</p><blockquote><p> * @description: ä½¿ç”¨LRUç­–ç•¥åˆ é™¤ä¸€ä¸ªvictim frameï¼Œå¹¶è¿”å›è¯¥frameçš„id</p><p> * @param {frame_id_t*} frame_id è¢«ç§»é™¤çš„frameçš„idï¼Œå¦‚æœæ²¡æœ‰frameè¢«ç§»é™¤è¿”å›nullptr</p><p> * @return {bool} å¦‚æœæˆåŠŸæ·˜æ±°äº†ä¸€ä¸ªé¡µé¢åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false</p></blockquote><p>å¯¹äºpinå’Œunpinï¼Œä»–ä»¬çš„ä¸»è¦ä½œç”¨æ˜¯å›ºå®šä½æŸä¸€é¡µé¢ï¼Œè¿™äº›é¡µé¢å¾€å¾€æ˜¯æ­£åœ¨ä½¿ç”¨çš„ï¼Œå¦‚æœè¯¥é¡µé¢å¤„äºpinçŠ¶æ€ï¼Œåˆ™ä¸ä¼šè¢«æ·˜æ±°ï¼Œunpinå°±æ˜¯è§£é™¤è¯¥çŠ¶æ€ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>DiskManagerï¼ŒBufferPoolManagerå’ŒRMFileHandleæ˜¯å®ç°å­˜å‚¨ç®¡ç†çš„å…³é”®ç»„ä»¶ï¼Œä»–ä»¬ä¹‹é—´çš„å…³ç³»å’Œè°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>DiskManagerï¼šè´Ÿè´£ç®¡ç†ç£ç›˜å­˜å‚¨ï¼ŒåŒ…æ‹¬è¯»å†™ç£ç›˜ä¸Šçš„é¡µé¢ï¼Œåˆ›å»ºå’Œåˆ é™¤ç£ç›˜æ–‡ä»¶ç­‰ã€‚</p></li><li><p>BufferPoolManagerï¼šè´Ÿè´£ç®¡ç†å†…å­˜ä¸­çš„ç¼“å†²æ± ï¼ŒåŒ…æ‹¬ä»ç£ç›˜ä¸­è¯»å–é¡µé¢åˆ°ç¼“å†²æ± ï¼Œå°†ç¼“å†²æ± ä¸­çš„é¡µé¢å†™å›ç£ç›˜ï¼Œé¡µé¢çš„æ›¿æ¢ç­–ç•¥ç­‰ã€‚</p></li><li><p>RMFileHandleï¼šè´Ÿè´£ç®¡ç†ä¸€ä¸ªç‰¹å®šçš„å…³ç³»ï¼ŒåŒ…æ‹¬è¯»å†™è¯¥å…³ç³»çš„è®°å½•ï¼Œæ’å…¥å’Œåˆ é™¤è®°å½•ç­‰ã€‚</p></li></ol><p>ä¸€ä¸ªé¡µé¢ä»ç£ç›˜ä¸­å–å‡ºåˆ°ä½¿ç”¨çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>å½“éœ€è¦è®¿é—®ä¸€ä¸ªé¡µé¢æ—¶ï¼Œé¦–å…ˆåœ¨BufferPoolManagerçš„ç¼“å†²æ± ä¸­æŸ¥æ‰¾è¯¥é¡µé¢ã€‚</p></li><li><p>å¦‚æœåœ¨ç¼“å†²æ± ä¸­æ‰¾åˆ°äº†è¯¥é¡µé¢ï¼Œå°±ç›´æ¥ä½¿ç”¨è¯¥é¡µé¢ã€‚</p></li><li><p>å¦‚æœåœ¨ç¼“å†²æ± ä¸­æ²¡æœ‰æ‰¾åˆ°è¯¥é¡µé¢ï¼Œå°±éœ€è¦ä»ç£ç›˜ä¸­è¯»å–è¯¥é¡µé¢ã€‚BufferPoolManagerä¼šè°ƒç”¨DiskManagerçš„read_pageæ–¹æ³•ï¼Œå°†è¯¥é¡µé¢ä»ç£ç›˜è¯»å–åˆ°ç¼“å†²æ± ä¸­ã€‚</p></li><li><p>å¦‚æœç¼“å†²æ± å·²æ»¡ï¼Œéœ€è¦é€‰æ‹©ä¸€ä¸ªé¡µé¢è¿›è¡Œæ›¿æ¢ã€‚BufferPoolManagerä¼šæ ¹æ®å…¶é¡µé¢æ›¿æ¢ç­–ç•¥ï¼Œé€‰æ‹©ä¸€ä¸ªé¡µé¢ï¼Œå¦‚æœè¯¥é¡µé¢è¢«ä¿®æ”¹è¿‡ï¼Œå°±è°ƒç”¨DiskManagerçš„write_pageæ–¹æ³•ï¼Œå°†è¯¥é¡µé¢å†™å›ç£ç›˜ï¼Œç„¶åå°†æ–°çš„é¡µé¢è¯»å–åˆ°è¿™ä¸ªä½ç½®ã€‚</p></li><li><p>RMFileHandleé€šè¿‡BufferPoolManagerè·å–åˆ°é¡µé¢åï¼Œå°±å¯ä»¥å¯¹è¯¥é¡µé¢è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚è¯»å–è®°å½•ï¼Œä¿®æ”¹è®°å½•ç­‰ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“å†…æ ¸å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“å†…æ ¸å¼€å‘ </tag>
            
            <tag> æ‰‹æ“æ•°æ®åº“ç³»åˆ— </tag>
            
            <tag> æ•°æ®åº“å¤§èµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>verilogå…¥é—¨å­¦ä¹ </title>
      <link href="/2023/06/16/verilog%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/06/16/verilog%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="é©´â€”â€”verilogå…¥é—¨ç¬”è®°"><a href="#é©´â€”â€”verilogå…¥é—¨ç¬”è®°" class="headerlink" title="é©´â€”â€”verilogå…¥é—¨ç¬”è®°"></a>é©´â€”â€”verilogå…¥é—¨ç¬”è®°</h1><blockquote><p>éƒ¨åˆ†æˆªå›¾æ¥è‡ªbç«™</p></blockquote><h2 id="1æ¨¡å—ç»“æ„"><a href="#1æ¨¡å—ç»“æ„" class="headerlink" title="1æ¨¡å—ç»“æ„"></a>1æ¨¡å—ç»“æ„</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306161001803.png" alt="å±å¹•æˆªå›¾(4)"></p><blockquote><p>è®°ä½è¿™ä¸ªç»“æ„ï¼Œå­¦ä¹ verilogçš„å‰ææ˜¯å…ˆçœ‹æ‡‚</p></blockquote><p>ä¸¾ä¾‹</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Full_adder(</span><br><span class="line">    <span class="keyword">output</span> Fi,</span><br><span class="line">    <span class="keyword">output</span> Cout,</span><br><span class="line"> <span class="keyword">input</span> Ai,</span><br><span class="line">    <span class="keyword">input</span> Bi,</span><br><span class="line">    <span class="keyword">input</span> Cin </span><br><span class="line">    );</span><br><span class="line"><span class="keyword">assign</span> &#123;Cout,Fi&#125;=Ai+Bi+Cin;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306161011439.png" alt="å±å¹•æˆªå›¾(5)"></p><h2 id="2assignèµ‹å€¼è¯­å¥"><a href="#2assignèµ‹å€¼è¯­å¥" class="headerlink" title="2assignèµ‹å€¼è¯­å¥"></a>2assignèµ‹å€¼è¯­å¥</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306161036736.png" alt="å±å¹•æˆªå›¾(6)"></p><h2 id="3alwaysè¯­å¥"><a href="#3alwaysè¯­å¥" class="headerlink" title="3alwaysè¯­å¥"></a>3alwaysè¯­å¥</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306161709025.png" alt="image-20230616170908710"></p><blockquote><p>ç±»ä¼¼äºIfï¼Œåé¢çš„æ¡ä»¶æ»¡è¶³æ—¶æ‰æ‰§è¡Œä¸‹é¢çš„è¯­å¥</p><p>alwaysåçš„æ¡ä»¶æœ‰ä¸¤ç§ï¼šè¾¹æ²¿æ•æ„Ÿï¼Œç”µå¹³æ•æ„Ÿ</p></blockquote><p>å†™æ³•ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306161712349.png" alt="image-20230616171228130"></p><blockquote><p>å¦å¤–å¦‚æœalwaysåæœ‰å¤šæ¡èµ‹å€¼è¯­å¥ï¼Œåˆ™éœ€è¦ç”¨begin endå›´èµ·æ¥</p></blockquote><p>ä¾‹å¦‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(a,b,cin)</span><br><span class="line"> <span class="keyword">begin</span></span><br><span class="line">     s...</span><br><span class="line">     count...</span><br><span class="line"> <span class="keyword">end</span></span><br></pre></td></tr></table></figure><h2 id="4æ¨¡å—è°ƒç”¨"><a href="#4æ¨¡å—è°ƒç”¨" class="headerlink" title="4æ¨¡å—è°ƒç”¨"></a>4æ¨¡å—è°ƒç”¨</h2><blockquote><p>åœ¨å…¶ä»–æ¨¡å—é‡Œè°ƒç”¨å·²ç»å†™å¥½çš„æ¨¡å—ï¼Œç±»ä¼¼äºæ–¹æ³•è°ƒç”¨ï¼Œéœ€è¦å¯¹è±¡åå’Œæ–¹æ³•å‚æ•°</p></blockquote><p>ä¸¾ä¾‹</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å·²å­˜åœ¨æ–¹æ³•A(CLK,I,O)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒç”¨A</span></span><br><span class="line">A a1(<span class="variable">.CLK</span>(clk),<span class="variable">.I</span>(i),<span class="variable">.O</span>(o))<span class="comment">//è¿™æ ·å†™å‚æ•°æ¯”è¾ƒè§„èŒƒ</span></span><br><span class="line">A a2(clk,i,o)<span class="comment">//è¿™æ ·ä¹Ÿè¡Œï¼ŒæŒ‰é¡ºåº</span></span><br></pre></td></tr></table></figure><h2 id="5é—¨åŸè¯­è°ƒç”¨"><a href="#5é—¨åŸè¯­è°ƒç”¨" class="headerlink" title="5é—¨åŸè¯­è°ƒç”¨"></a>5é—¨åŸè¯­è°ƒç”¨</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306161747958.png" alt="image-20230616174731732"></p><blockquote><p>è¾“å‡ºåœ¨å‰ï¼Œè¾“å…¥åœ¨å</p></blockquote><h1 id="6Ifè¯­å¥"><a href="#6Ifè¯­å¥" class="headerlink" title="6Ifè¯­å¥"></a>6Ifè¯­å¥</h1><blockquote><p>if +ï¼ˆæ¡ä»¶ï¼‰+ æ‰§è¡Œè¯­å¥ ï¼›</p><p>else</p></blockquote><h2 id="7caseè¯­å¥"><a href="#7caseè¯­å¥" class="headerlink" title="7caseè¯­å¥"></a>7caseè¯­å¥</h2><blockquote><p>caseï¼ˆè¡¨è¾¾å¼ï¼‰</p><p>å–å€¼1ï¼šè¯­å¥1ï¼›</p><p>å–å€¼2ï¼šè¯­å¥2ï¼›</p><p>â€¦</p><p>defaultï¼š é»˜è®¤ï¼›</p><p>endcase</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“å†…æ ¸å¼€å‘</title>
      <link href="/2023/06/15/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E6%A0%B8%E5%BC%80%E5%8F%91/"/>
      <url>/2023/06/15/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E6%A0%B8%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°æ®åº“å†…æ ¸å¼€å‘"><a href="#æ•°æ®åº“å†…æ ¸å¼€å‘" class="headerlink" title="æ•°æ®åº“å†…æ ¸å¼€å‘"></a>æ•°æ®åº“å†…æ ¸å¼€å‘</h1><h2 id="æ•°æ®åº“åŸºæœ¬æ¶æ„"><a href="#æ•°æ®åº“åŸºæœ¬æ¶æ„" class="headerlink" title="æ•°æ®åº“åŸºæœ¬æ¶æ„"></a>æ•°æ®åº“åŸºæœ¬æ¶æ„</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306151747696.png" alt="å±å¹•æˆªå›¾ 2023-06-15 173746"></p><h2 id="å…³ç³»æ•°æ®åº“ç»“æ„"><a href="#å…³ç³»æ•°æ®åº“ç»“æ„" class="headerlink" title="å…³ç³»æ•°æ®åº“ç»“æ„"></a>å…³ç³»æ•°æ®åº“ç»“æ„</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306151748578.png" alt="å±å¹•æˆªå›¾(1)"></p><h2 id="Buffer-POOLç¼“å­˜æœºåˆ¶"><a href="#Buffer-POOLç¼“å­˜æœºåˆ¶" class="headerlink" title="Buffer POOLç¼“å­˜æœºåˆ¶"></a>Buffer POOLç¼“å­˜æœºåˆ¶</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306202054690.png" alt="å±å¹•æˆªå›¾(8)"></p><p>å› ä¸ºæˆ‘ä»¬çš„æ•°æ®åº“ä¸­çš„æ•°æ®æ˜¯æ”¾åœ¨ç£ç›˜é‡Œçš„ï¼Œä½†æˆ‘ä»¬æ¯æ¬¡è¯»å–éƒ½å»è¯»ç£ç›˜ï¼Œæ˜¾ç„¶è¿™æ ·æ•ˆç‡å°±å¤§å¯„ç‰¹å¯„äº†ï¼Œæ‰€ä»¥ç±»ä¼¼äºcupä¸ä¸»å­˜ä¹‹é—´ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ä¸ªç¼“å†²åŒºæ¥åŠ å¿«è¯»å†™é€Ÿç‡ã€‚</p><h2 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B+Tree"></a>B+Tree</h2><blockquote><p>1.å¶ç»“ç‚¹å¤§å°å’Œå­˜å‚¨å•å…ƒå¤§å°ä¸€è‡´ï¼Œèƒ½èµ·åˆ°é¢„è¯»æ•°æ®æ•ˆæœ</p><p>2.å¶èŠ‚ç‚¹æœ‰é“¾æ¥å…³ç³»ï¼Œå¯ä»¥éå†</p><p>3.åªæœ‰å¶ç»“ç‚¹æ”¾æ•°æ®</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306221905892.png" alt="å±å¹•æˆªå›¾ 2023-06-22 185507"></p><p>B+treeæœç´¢è¿‡ç¨‹ï¼š</p><p>æ¯”å¦‚æœç´¢29ï¼Œåœ¨ç£ç›˜å—1ä¸­å¯ä»¥çœ‹å‡ºï¼Œ29åœ¨p2æ‰€æŒ‡åŒºåŸŸ</p><p>åœ¨p2åŒºåŸŸï¼Œå¯ä»¥çœ‹å‡º29å°äº36åœ¨p1åŒºåŸŸ</p><p>æœ€åæ‰¾åˆ°ç£ç›˜å—7ï¼Œæœç´¢åˆ°29</p><p>B+æ ‘çš„åˆ é™¤è¿‡ç¨‹</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306230119096.png" alt="å±å¹•æˆªå›¾(14)"></p><p>åˆ é™¤7</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306230122781.png" alt="å±å¹•æˆªå›¾(16)"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306230123531.png" alt="å±å¹•æˆªå›¾(17)"></p><p>åˆ é™¤11</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306230123390.png" alt="å±å¹•æˆªå›¾(18)"></p><p>B+æ ‘æ’å…¥è¿‡ç¨‹</p><p>æ’å…¥40</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306230123645.png" alt="å±å¹•æˆªå›¾(15)"></p><h2 id="LSM-Treeæ¶æ„"><a href="#LSM-Treeæ¶æ„" class="headerlink" title="LSM-Treeæ¶æ„"></a>LSM-Treeæ¶æ„</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306222256466.png" alt="å±å¹•æˆªå›¾(9)"></p><blockquote><p>ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¼šå…ˆå­˜æ”¾åœ¨memorytableä¸­ï¼Œå½“memorytableä¸­çš„æ•°æ®è¾¾åˆ°ä¸€å®šé˜ˆå€¼ï¼Œmemorytableå°±ä¼šå˜æˆä¸€ä¸ªFrozen~(åªè¯»)ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªæ–°çš„memorytable,æŠŠForzenå†™å…¥ç£ç›˜</p></blockquote><h2 id="Compaction"><a href="#Compaction" class="headerlink" title="Compaction"></a>Compaction</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306222305784.png" alt="å±å¹•æˆªå›¾(10)"></p><blockquote><p>Compactionæ“ä½œæ˜¯å°†å¤šä¸ªSSTableåˆæˆä¸€ä¸ªï¼Œèƒ½æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä½†æé«˜äº†èƒ½è€—</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306222306198.png" alt="å±å¹•æˆªå›¾(11)"></p><blockquote><p>Compactionä¸‰ä¸ªæ¦‚å¿µï¼š1.å¯¹å†™æ”¾å¤§2.ç©ºé—´æ”¾å¤§3.è¯»æ”¾å¤§</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306222317586.png" alt="å±å¹•æˆªå›¾(12)"></p><p>æ¯”è¾ƒå¸¸ç”¨çš„ç­–ç•¥</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306222319045.png" alt="å±å¹•æˆªå›¾(13)"></p><blockquote><p>ä¸‰ç§ç­–ç•¥å¯¹æ¯”</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“å†…æ ¸å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLåŸºç¡€</title>
      <link href="/2023/05/31/MySQL%E5%9F%BA%E7%A1%80/"/>
      <url>/2023/05/31/MySQL%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="MySQL-amp-JavaWebã®é©´"><a href="#MySQL-amp-JavaWebã®é©´" class="headerlink" title="MySQL&amp;JavaWebã®é©´"></a>MySQL&amp;JavaWebã®é©´</h1><h2 id="1-åŸºæœ¬è¯­æ³•"><a href="#1-åŸºæœ¬è¯­æ³•" class="headerlink" title="1.åŸºæœ¬è¯­æ³•"></a>1.åŸºæœ¬è¯­æ³•</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305312200700.png" alt="å±å¹•æˆªå›¾ 2023-03-06 203314"></p><h3 id="SQLåˆ†ç±»"><a href="#SQLåˆ†ç±»" class="headerlink" title="SQLåˆ†ç±»"></a>SQLåˆ†ç±»</h3><blockquote><p>DDL:é’ˆå¯¹æ•°æ®åº“å’Œè¡¨çš„å¢åˆ æ”¹</p><p>DMLï¼šå¯¹å•ä¸ªè¡¨çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹</p><p>DQLï¼šæŸ¥è¯¢è¡¨ä¸­æ•°æ®</p><p>DCLï¼šå¯¹æ•°æ®åº“è¿›è¡Œæƒé™æ§åˆ¶</p></blockquote><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE db1(##åˆ›å»ºè¡¨</span><br><span class="line">id int,##æ³¨æ„ååœ¨å‰ï¼Œå˜é‡ç±»å‹åœ¨å</span><br><span class="line">name varchar(10),</span><br><span class="line">age int,</span><br><span class="line">birth DATE);</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM db1;</span><br><span class="line">##SELECT `name` FROM db1;ä¹Ÿå¯ä»¥å•ç‹¬æŸ¥è¯¢ä¸€åˆ—</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE db1;</span><br><span class="line">##å› ä¸ºæ— æ³•ç¡®å®šè¦åˆ é™¤çš„è¡¨æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥æœ‰æ›´è§„èŒƒçš„å†™æ³•ï¼š</span><br><span class="line">DROP TABLE if EXISTS db1ï¼›</span><br></pre></td></tr></table></figure><h3 id="è¡¨ï¼Œåˆ—æ“ä½œ"><a href="#è¡¨ï¼Œåˆ—æ“ä½œ" class="headerlink" title="è¡¨ï¼Œåˆ—æ“ä½œ"></a>è¡¨ï¼Œåˆ—æ“ä½œ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE db1 RENAME TO stu;##è¡¨é‡å‘½å</span><br><span class="line">ALTER TABLE stu ADD gender char(1);##æ·»åŠ åˆ—</span><br><span class="line">ALTER TABLE stu CHANGE gender sex char(1);##æ”¹åˆ—å</span><br><span class="line">ALTER TABLE stu DROP sex;##åˆ é™¤åˆ—</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢æ‰€æœ‰"><a href="#æŸ¥è¯¢æ‰€æœ‰" class="headerlink" title="æŸ¥è¯¢æ‰€æœ‰"></a>æŸ¥è¯¢æ‰€æœ‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM stu;</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ æ•°æ®"><a href="#æ·»åŠ æ•°æ®" class="headerlink" title="æ·»åŠ æ•°æ®"></a>æ·»åŠ æ•°æ®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT into stu VALUES(1,&#x27;æ—å³°&#x27;,20,&#x27;2002-12-17&#x27;);##å…¨æ·»åŠ ä¸ç”¨æ ‡</span><br><span class="line">INSERT INTO stu(id,name,age) VALUES (1,&#x27;å°æ˜&#x27;,20);##æŒ‡æ˜æ·»åŠ ä½ç½®</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹æ•°æ®"><a href="#ä¿®æ”¹æ•°æ®" class="headerlink" title="ä¿®æ”¹æ•°æ®"></a>ä¿®æ”¹æ•°æ®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE stu set birth = &#x27;1999-10-15&#x27; WHERE name = &#x27;å°æ˜&#x27;;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="headerlink" title="åˆ é™¤æ•°æ®"></a>åˆ é™¤æ•°æ®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from db1 where name = &#x27;å°æ˜&#x27;;</span><br></pre></td></tr></table></figure><h2 id="2-æŸ¥è¯¢"><a href="#2-æŸ¥è¯¢" class="headerlink" title="2.æŸ¥è¯¢"></a>2.æŸ¥è¯¢</h2><h3 id="åŸºç¡€æŸ¥è¯¢"><a href="#åŸºç¡€æŸ¥è¯¢" class="headerlink" title="åŸºç¡€æŸ¥è¯¢"></a>åŸºç¡€æŸ¥è¯¢</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--åŸºç¡€æŸ¥è¯¢</span><br><span class="line">SELECT name FROM stu;</span><br></pre></td></tr></table></figure><h3 id="å»é‡"><a href="#å»é‡" class="headerlink" title="å»é‡"></a>å»é‡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--å»é‡</span><br><span class="line">SELECT DISTINCT name FROM stu;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305312201120.png" alt="å±å¹•æˆªå›¾ 2023-03-07 195316"></p><h3 id="è¾“å‡ºç»“æœæ—¶èµ·åˆ«å"><a href="#è¾“å‡ºç»“æœæ—¶èµ·åˆ«å" class="headerlink" title="è¾“å‡ºç»“æœæ—¶èµ·åˆ«å"></a>è¾“å‡ºç»“æœæ—¶èµ·åˆ«å</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--åˆ«åï¼Œaså¯çœç•¥</span><br><span class="line">SELECT id,name,age as å¹´é¾„,birth ç”Ÿæ—¥ FROM stu;</span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶æŸ¥è¯¢"><a href="#æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="æ¡ä»¶æŸ¥è¯¢"></a>æ¡ä»¶æŸ¥è¯¢</h3><p>æ¡ä»¶ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305312202759.png" alt="å±å¹•æˆªå›¾ 2023-03-07 200024-1678190500305"></p><p>ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--è¾“å‡ºå¹´é¾„å¤§äºç­‰äº20çš„äºº</span><br><span class="line">SELECT name FROM stu where age &gt;= 20;</span><br></pre></td></tr></table></figure><h3 id="x3D-x3D-æ¨¡ç³ŠæŸ¥è¯¢-x3D-x3D"><a href="#x3D-x3D-æ¨¡ç³ŠæŸ¥è¯¢-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;æ¨¡ç³ŠæŸ¥è¯¢&#x3D;&#x3D;"></a>&#x3D;&#x3D;æ¨¡ç³ŠæŸ¥è¯¢&#x3D;&#x3D;</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--æ¨¡ç³ŠæŸ¥è¯¢</span><br><span class="line">--_:ä»£è¡¨ä»»æ„ä¸€ä¸ªå­—ç¬¦</span><br><span class="line">--%:ä»£è¡¨ä»»æ„å¤šä¸ªå­—ç¬¦</span><br><span class="line">SELECT * FROM stu WHERE name like &#x27;%å°%&#x27;;</span><br></pre></td></tr></table></figure><h3 id="æ’åºæŸ¥æ‰¾"><a href="#æ’åºæŸ¥æ‰¾" class="headerlink" title="æ’åºæŸ¥æ‰¾"></a>æ’åºæŸ¥æ‰¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--æ’åºæŸ¥æ‰¾</span><br><span class="line">SELECT * FROM stu ORDER BY age ASC;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305312203834.png" alt="å±å¹•æˆªå›¾ 2023-03-07 201909"></p><h3 id="èšåˆå‡½æ•°å’ŒæŸ¥æ‰¾"><a href="#èšåˆå‡½æ•°å’ŒæŸ¥æ‰¾" class="headerlink" title="èšåˆå‡½æ•°å’ŒæŸ¥æ‰¾"></a>èšåˆå‡½æ•°å’ŒæŸ¥æ‰¾</h3><p>èšåˆå‡½æ•°ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305312204496.png" alt="å±å¹•æˆªå›¾ 2023-03-07 203958"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">--ç»Ÿè®¡æ•°é‡,æœ€å¥½æ˜¯ç”¨ *</span><br><span class="line">SELECT count(*) FROM stu;</span><br><span class="line">--æœ€å¤§å€¼</span><br><span class="line">SELECT max(age) FROM stu;</span><br><span class="line">--æœ€å°å€¼</span><br><span class="line">SELECT min(age) FROM stu;</span><br><span class="line">--å¹³å‡å€¼</span><br><span class="line">SELECT avg(age) FROM stu;</span><br><span class="line">--æ€»å’Œ</span><br><span class="line">SELECT sum(age) FROM stu;</span><br></pre></td></tr></table></figure><h3 id="åˆ†ç»„æŸ¥è¯¢"><a href="#åˆ†ç»„æŸ¥è¯¢" class="headerlink" title="åˆ†ç»„æŸ¥è¯¢"></a>åˆ†ç»„æŸ¥è¯¢</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305312205772.png" alt="å±å¹•æˆªå›¾ 2023-03-07 205749"></p><h3 id="åˆ†é¡µæŸ¥è¯¢"><a href="#åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢"></a>åˆ†é¡µæŸ¥è¯¢</h3><blockquote><p>æ ¼å¼ï¼šselect å­—æ®µåˆ—è¡¨ from è¡¨å LIMIT èµ·å§‹ç´¢å¼• ï¼ŒæŸ¥è¯¢æ¡ç›®æ•°</p><p>è®¡ç®—å…¬å¼ï¼šèµ·å§‹ç´¢å¼• &#x3D; ï¼ˆå½“å‰é¡µç -1ï¼‰* æ¯é¡µæ¡ç›®æ•°</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM stu LIMIT 3,3;</span><br></pre></td></tr></table></figure><h3 id="çº¦æŸ"><a href="#çº¦æŸ" class="headerlink" title="çº¦æŸ"></a>çº¦æŸ</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305312206756.png" alt="69337116782767212.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">##å»ºè¡¨æ—¶ï¼š</span><br><span class="line">create table db1(</span><br><span class="line">    id int çº¦æŸåç§°</span><br><span class="line">    ...</span><br><span class="line">)</span><br><span class="line">##å»ºè¡¨å</span><br><span class="line">alter table db1 modify</span><br></pre></td></tr></table></figure><h3 id="å¤–é”®"><a href="#å¤–é”®" class="headerlink" title="å¤–é”®"></a>å¤–é”®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">##åˆ›å»ºè¡¨æ—¶</span><br><span class="line">constraint é”®å foreign key(ä½œä¸ºä»é”®çš„åˆ—)</span><br><span class="line">##åˆ›å»ºè¡¨å</span><br><span class="line">alter table emp add constraint é”®å foreign key(ä½œä¸ºä»é”®çš„åˆ—)  referances ä¸»é”®</span><br></pre></td></tr></table></figure><h3 id="å†…å¤–é“¾æ¥"><a href="#å†…å¤–é“¾æ¥" class="headerlink" title="å†…å¤–é“¾æ¥"></a>å†…å¤–é“¾æ¥</h3><p>éšå¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select è¦æŸ¥è¯¢çš„ä¸œè¥¿ from è¡¨1ï¼Œè¡¨2... where æ¡ä»¶</span><br></pre></td></tr></table></figure><p>æ˜¾å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select è¦æŸ¥è¯¢çš„ä¸œè¥¿ from  è¡¨1 join è¡¨2 on æ¡ä»¶</span><br></pre></td></tr></table></figure><blockquote><p>å†…è¿æ¥ç›¸å½“äºå‡ ä¸ªè¡¨çš„äº¤é›†</p></blockquote><p>å¤–è¿æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å·¦/å³ï¼š</span><br><span class="line">select å­—æ®µ from è¡¨1 left/right join è¡¨2 on æ¡ä»¶</span><br></pre></td></tr></table></figure><blockquote><p>å¤–è¿æ¥ç›¸å½“äºè¡¨1æˆ–è¡¨2å…¨éƒ¨åŠ äº¤é›†</p></blockquote><h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305312206866.png" alt="9A1C63D3EC824C450120034C619A175A"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305312207013.png" alt="å±å¹•æˆªå›¾ 2023-03-09 175024"></p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootå®æˆ˜â€”â€”ç‘å‰å¤–å–</title>
      <link href="/2023/05/20/SpringBoot%E5%AE%9E%E6%88%98%E2%80%94%E2%80%94%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96/"/>
      <url>/2023/05/20/SpringBoot%E5%AE%9E%E6%88%98%E2%80%94%E2%80%94%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootå®æˆ˜â€”â€”ç‘å‰å¤–å–"><a href="#SpringBootå®æˆ˜â€”â€”ç‘å‰å¤–å–" class="headerlink" title="SpringBootå®æˆ˜â€”â€”ç‘å‰å¤–å–"></a>SpringBootå®æˆ˜â€”â€”ç‘å‰å¤–å–</h1><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305212218088.png" alt="å±å¹•æˆªå›¾ 2023-05-21 221758"></p><h3 id="æ•°æ®åº“åˆ›å»ºï¼š"><a href="#æ•°æ®åº“åˆ›å»ºï¼š" class="headerlink" title="æ•°æ®åº“åˆ›å»ºï¼š"></a>æ•°æ®åº“åˆ›å»ºï¼š</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305212036703.png" alt="å±å¹•æˆªå›¾ 2023-05-21 203358"></p><blockquote><p>è¡¨åŠŸèƒ½ï¼š</p><p>address_bookï¼šåœ°å€è¡¨</p><p>categoryï¼šèœå“å’Œå¥—é¤è¡¨</p><p>dish: èœå“è¡¨</p><p>dish_flavor: èœå“å£å‘³å…³ç³»è¡¨</p><p>employee: å‘˜å·¥è¡¨</p><p>order_detail: è®¢å•æ˜ç»†</p><p>ordersï¼šè®¢å•è¡¨</p><p>setmealï¼šå¥—é¤è¡¨</p><p>setmeal_dishï¼šå¥—é¤èœå“å…³ç³»è¡¨</p><p>shopping_cartï¼šè´­ç‰©è½¦</p><p>userï¼šç”¨æˆ·è¡¨</p></blockquote><h3 id="é¡¹ç›®åˆ›å»º"><a href="#é¡¹ç›®åˆ›å»º" class="headerlink" title="é¡¹ç›®åˆ›å»º"></a>é¡¹ç›®åˆ›å»º</h3><p>ä¸å¿…å¤šè¨€</p><h3 id="pomé…ç½®ï¼š"><a href="#pomé…ç½®ï¼š" class="headerlink" title="pomé…ç½®ï¼š"></a>pomé…ç½®ï¼š</h3><p>è¿™é‡Œå…¶å®ç‰ˆæœ¬å·ä¸ä¸€å®šæ˜¯æˆ‘çš„è¿™ä¸ªï¼Œå„ä½å¯ä»¥è‡ªè¡Œåœ¨mavené‡Œå¯¼å…¥é€‚åˆè‡ªå·±çš„</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    springbootç»„ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.Lf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>reggie_take_out<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    jdkç‰ˆæœ¬--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--webç»„ä»¶--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--MP--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Lombook--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--fastjson--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.76<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æ•°æ®åº“è¿æ¥--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--druid--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="application-ymlé…ç½®"><a href="#application-ymlé…ç½®" class="headerlink" title="application.ymlé…ç½®"></a>application.ymlé…ç½®</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç«¯å£å·</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">81</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line"><span class="comment">#    åº”ç”¨åç§°ï¼Œä¸æ˜¯å¿…é¡»</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">reggie_take_out</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line"><span class="comment">#      æ•°æ®åº“è¿æ¥ä¿¡æ¯</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment">#ä½ è‡ªå·±çš„æ•°æ®åº“é“¾æ¥ä¿¡æ¯ï¼Œåˆ«å†™æˆ‘çš„</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/reggie?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#åœ¨æ˜ å°„å®ä½“æˆ–è€…å±æ€§æ—¶ï¼Œå°†æ•°æ®åº“ä¸­è¡¨åå’Œå­—æ®µåä¸­çš„ä¸‹åˆ’çº¿å»æ‰ï¼ŒæŒ‰ç…§é©¼å³°å‘½åæ³•æ˜ å°„</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">ASSIGN_ID</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºå¯åŠ¨ç±»ï¼š"><a href="#åˆ›å»ºå¯åŠ¨ç±»ï¼š" class="headerlink" title="åˆ›å»ºå¯åŠ¨ç±»ï¼š"></a>åˆ›å»ºå¯åŠ¨ç±»ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lf.reggie;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReggieApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ReggieApplication.class,args);</span><br><span class="line">        log.info(<span class="string">&quot;åŸç¥ï¼Œå¯åŠ¨ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯¼å…¥é™æ€é¡µé¢ï¼š"><a href="#å¯¼å…¥é™æ€é¡µé¢ï¼š" class="headerlink" title="å¯¼å…¥é™æ€é¡µé¢ï¼š"></a>å¯¼å…¥é™æ€é¡µé¢ï¼š</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305212312778.png" alt="image-20230521231237689"></p><blockquote><p>æœ¬æ¬¡å®æˆ˜ä¸è¦æ±‚å‰ç«¯é¡µé¢ç¼–å†™ï¼Œæ‰€ä»¥ç›´æ¥å¯¼å…¥ï¼Œèµ„æ–™æ¥æºä¸é»‘é©¬ç¨‹åºå‘˜</p></blockquote><h2 id="åŠŸèƒ½å¼€å‘"><a href="#åŠŸèƒ½å¼€å‘" class="headerlink" title="åŠŸèƒ½å¼€å‘"></a>åŠŸèƒ½å¼€å‘</h2><h3 id="ç™»å½•åŠŸèƒ½ï¼š"><a href="#ç™»å½•åŠŸèƒ½ï¼š" class="headerlink" title="ç™»å½•åŠŸèƒ½ï¼š"></a>ç™»å½•åŠŸèƒ½ï¼š</h3><p>ç™»å½•é¡µé¢ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305212321998.png" alt="image-20230521232141953"></p><blockquote><p>å‰ç«¯å‘é€æ•°æ® -&gt; controlleræ¥æ”¶ -&gt; è°ƒç”¨service -&gt;Mapper -&gt; æ•°æ®åº“</p></blockquote><p>æµç¨‹è¿˜æ˜¯è€æ ·å­ï¼Œä¸äº†è§£çš„å¯ä»¥çœ‹æœ¬ç½‘ç«™springbootå…¥é—¨ç¬”è®°</p><h4 id="åˆ›å»ºå®ä½“ç±»"><a href="#åˆ›å»ºå®ä½“ç±»" class="headerlink" title="åˆ›å»ºå®ä½“ç±»"></a>åˆ›å»ºå®ä½“ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lf.reggie.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘˜å·¥å®ä½“ç±»</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String idNumber;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="mapper"><a href="#mapper" class="headerlink" title="mapper"></a>mapper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.lf.reggie.domain.Employee;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Employee&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.lf.reggie.domain.Employee;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Employee&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="serviceå®ç°ç±»"><a href="#serviceå®ç°ç±»" class="headerlink" title="serviceå®ç°ç±»"></a>serviceå®ç°ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.lf.reggie.domain.Employee;</span><br><span class="line"><span class="keyword">import</span> com.lf.reggie.mapper.EmployeeMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;EmployeeMapper, Employee&gt; <span class="keyword">implements</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é€šç”¨è¿”å›ç±»å‹R"><a href="#é€šç”¨è¿”å›ç±»å‹R" class="headerlink" title="é€šç”¨è¿”å›ç±»å‹R"></a>é€šç”¨è¿”å›ç±»å‹R</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€šç”¨è¿”å›ç±»å‹ï¼Œ</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code; <span class="comment">//ç¼–ç ï¼š1æˆåŠŸï¼Œ0å’Œå…¶å®ƒæ•°å­—ä¸ºå¤±è´¥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data; <span class="comment">//æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>(); <span class="comment">//åŠ¨æ€æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¿«é€Ÿè¿”å›ä¸€ä¸ªæˆåŠŸRå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">success</span><span class="params">(T object)</span> &#123;</span><br><span class="line">        R&lt;T&gt; r = <span class="keyword">new</span> <span class="title class_">R</span>&lt;T&gt;();</span><br><span class="line">        r.data = object;</span><br><span class="line">        r.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¿«é€Ÿè¿”å›ä¸€ä¸ªé”™è¯¯Rå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">error</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">R</span>();</span><br><span class="line">        r.msg = msg;</span><br><span class="line">        r.code = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> R&lt;T&gt; <span class="title function_">add</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.map.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç™»å½•åŠŸèƒ½controller"><a href="#ç™»å½•åŠŸèƒ½controller" class="headerlink" title="ç™»å½•åŠŸèƒ½controller"></a>ç™»å½•åŠŸèƒ½controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lf.reggie.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/employee&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç™»å½•controller</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="comment">//å› ä¸ºå‰ç«¯å‘è¿‡æ¥æ˜¯Jsonæ•°æ®ï¼Œæ‰€ä»¥éœ€è¦åŠ  @RequestBodyæ¥æ”¶æ•°æ®</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Employee&gt; <span class="title function_">login</span><span class="params">(HttpServletRequest request, <span class="meta">@RequestBody</span> Employee employee)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@Params</span>: [request, employee]</span></span><br><span class="line"><span class="comment">         * request ä¹‹åç”¨æ¥è·å–session</span></span><br><span class="line"><span class="comment">         * employee å‰ç«¯ä¼ å…¥çš„è´¦å·å¯†ç </span></span><br><span class="line"><span class="comment">         * <span class="doctag">@Return</span> com.lf.reggie.domain.R&lt;com.lf.reggie.domain.Employee&gt;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        1.å‰ç«¯æäº¤çš„passowrdè¿›è¡ŒåŠ å¯†å¤„ç†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> employee.getPassword();</span><br><span class="line">        password = DigestUtils.md5DigestAsHex(password.getBytes());</span><br><span class="line"><span class="comment">//        2.æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line"><span class="comment">//        é¦–å…ˆéœ€è¦åˆ›å»ºæ¡ä»¶æ„é€ å™¨ï¼Œè¯¦æƒ…è§SpringBootå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼Œæ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line">        LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//        æ„é€ æ¡ä»¶,åˆ—å + å€¼</span></span><br><span class="line">        queryWrapper.eq(Employee::getUsername, employee.getUsername());</span><br><span class="line"></span><br><span class="line">        <span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> employeeService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        3.å¦‚æœå€¼ä¸ºç©ºï¼Œè¯´æ˜ç”¨æˆ·åä¸å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (emp == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;ç”¨æˆ·åä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        4.å€¼ä¸ä¸ºç©ºï¼Œåˆ™æ¯”å¯¹å¯†ç </span></span><br><span class="line">        <span class="keyword">if</span> (!emp.getPassword().equals(password)) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        5.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦è¢«ç¦ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (emp.getStatus() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;è¯¥ç”¨æˆ·å·²è¢«ç¦ç”¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        6.ä¸Šé¢éƒ½é€šè¿‡äº†ï¼Œè¯´æ˜å¯ä»¥ç™»å½•,æŠŠempå¯¹è±¡æ”¾å…¥sessionï¼Œæ–¹ä¾¿å…¶ä»–è°ƒç”¨</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;employee&quot;</span>, emp.getId());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(emp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é€€å‡ºåŠŸèƒ½"><a href="#é€€å‡ºåŠŸèƒ½" class="headerlink" title="é€€å‡ºåŠŸèƒ½"></a>é€€å‡ºåŠŸèƒ½</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line">    <span class="comment">//å‘˜å·¥é€€å‡º</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">logout</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [request]</span></span><br><span class="line"><span class="comment">         * request ç”¨äºè·å–sesssion</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> com.lf.reggie.domain.R&lt;java.lang.String&gt;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"><span class="comment">//        ä»sessioné‡Œé¢ç§»é™¤ä¹‹å‰å­˜çš„ç™»å½•ä¿¡æ¯</span></span><br><span class="line">        request.removeAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;é€€å‡ºæˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å‘˜å·¥æ“ä½œ"><a href="#å‘˜å·¥æ“ä½œ" class="headerlink" title="å‘˜å·¥æ“ä½œ"></a>å‘˜å·¥æ“ä½œ</h2><h3 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h3><blockquote><p>è¿‡æ»¤å™¨æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·ä¸ç™»å½•è€Œæ˜¯é€šè¿‡ç½‘é¡µurlç›´æ¥è®¿é—®é¡µé¢ï¼Œæœ‰å®‰å…¨é£é™©</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lf.reggie.filter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * è¿‡æ»¤å™¨ï¼Œæ£€æŸ¥æ˜¯å¦ç™»å½•</span></span><br><span class="line"><span class="comment"> * å…³äºè¿‡æ»¤å™¨è¯¦æƒ…è¯·è§æœ¬ç½‘ç«™å­¦ä¹ ç¬”è®°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;loginCheckFilter&quot;, urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    è·¯å¾„åŒ¹é…å™¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AntPathMatcher</span> <span class="variable">PATH_MATCHER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        1.è·å–è®¿é—®url</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">requestURI</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">        System.out.println(<span class="string">&quot;è®¿é—®è·¯å¾„&quot;</span> + requestURI);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        2.è®¾ç½®æ”¾è¡Œè·¯å¾„,å…¶ä¸­çš„è·¯å¾„ä¸éœ€è¦å¤„ç†</span></span><br><span class="line">        String[] urls = &#123;<span class="string">&quot;/employee/login&quot;</span>, <span class="string">&quot;/employee/logout&quot;</span>, <span class="string">&quot;/backend/**&quot;</span>, <span class="string">&quot;/front/**&quot;</span>,<span class="string">&quot;/favicon.ico&quot;</span>&#125;;</span><br><span class="line"><span class="comment">//        3.åˆ¤æ–­æ˜¯å¦æ”¾è¡Œ</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> checkUrl(urls, requestURI);</span><br><span class="line">        System.out.println(b);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (b) &#123;</span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        4.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">employee</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line"><span class="comment">//        5.æˆåŠŸåˆ™æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (employee != <span class="literal">null</span>) &#123;</span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//        6.ç”¨æˆ·æœªç™»å½•ï¼Œç»™å‰ç«¯è¿”å›é”™è¯¯ä¿¡æ¯           </span></span><br><span class="line">       </span><br><span class="line">            response.getWriter().write((JSON.toJSONString(R.error(<span class="string">&quot;NOTLOGIN&quot;</span>))));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">checkUrl</span><span class="params">(String[] urls, String requestUrl)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@Params</span>: [urls, requestUrl]</span></span><br><span class="line"><span class="comment">         * urls:æ”¾è¡Œè·¯å¾„</span></span><br><span class="line"><span class="comment">         * requestUrlï¼š è¯·æ±‚è·¯å¾„</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@Return</span> boolean</span></span><br><span class="line"><span class="comment">         * åˆ¤æ–­æ˜¯å¦æ”¾è¡Œ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (String url :</span><br><span class="line">                urls) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">match</span> <span class="operator">=</span> PATH_MATCHER.match(url, requestUrl);</span><br><span class="line">            <span class="keyword">if</span> (match) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ å‘˜å·¥æ“ä½œ"><a href="#æ·»åŠ å‘˜å·¥æ“ä½œ" class="headerlink" title="æ·»åŠ å‘˜å·¥æ“ä½œ"></a>æ·»åŠ å‘˜å·¥æ“ä½œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="comment">//    æ–°å¢å‘˜å·¥ä»£ç </span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(HttpServletRequest request,<span class="meta">@RequestBody</span> Employee employee)</span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [request, employee]</span></span><br><span class="line"><span class="comment">         * request è·å–sessionå¾—åˆ°æ“ä½œäººä¿¡æ¯ï¼Œ</span></span><br><span class="line"><span class="comment">         * employee å‰ç«¯ä¼ çš„å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> com.lf.reggie.domain.R&lt;java.lang.String&gt;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        log.info(<span class="string">&quot;æ–°å¢å‘˜å·¥ä¿¡æ¯&#123;&#125;&quot;</span>,employee);</span><br><span class="line"><span class="comment">//        md5åŠ å¯†å¯†ç ï¼Œåˆå§‹å¯†ç ä¸º123456</span></span><br><span class="line">        employee.setPassword(DigestUtils.md5DigestAsHex(<span class="string">&quot;123456&quot;</span>.getBytes()));</span><br><span class="line"></span><br><span class="line"><span class="comment">//       ç»™æˆ‘ä»¬æ–°å¢çš„ä¿¡æ¯åŠ ç‚¹æ–™ï¼š åˆ›å»ºæ—¶é—´ï¼Œæ›´æ–°æ—¶é—´ï¼Œåˆ›å»ºäººï¼Œæ›´æ–°äºº</span></span><br><span class="line">        employee.setCreateTime(LocalDateTime.now());</span><br><span class="line">        employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> (Long) session.getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line"></span><br><span class="line">        employee.setCreateUser(id);</span><br><span class="line">        employee.setUpdateUser(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        è°ƒç”¨æ–¹æ³•ä¿å­˜æ•°æ®åº“</span></span><br><span class="line">        employeeService.save(employee);</span><br><span class="line"><span class="comment">//        System.out.println(employee);</span></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;æ–°å¢å‘˜å·¥æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…³äºcontrollerçš„è®¿é—®urlä½ å¾—çœ‹å‰ç«¯htmlé¡µé¢è®¿é—®çš„urlï¼Œæ ¹æ®å®ƒå†™æˆ‘ä»¬åç«¯çš„@Post&#x2F;Getmapping </p><h3 id="å…¨å±€å¼‚å¸¸æ•è·"><a href="#å…¨å±€å¼‚å¸¸æ•è·" class="headerlink" title="å…¨å±€å¼‚å¸¸æ•è·"></a>å…¨å±€å¼‚å¸¸æ•è·</h3><p>å½“æˆ‘ä»¬é‡å¤æ·»åŠ å‘˜å·¥ä¿¡æ¯ï¼Œæ•°æ®åº“å°±ä¼šç»™æˆ‘ä»¬æŠ¥é”™ï¼Œå› ä¸ºæˆ‘ä»¬çš„usernameå­—æ®µæ˜¯å”¯ä¸€çš„</p><p>è¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥é€‰æ‹©åˆ©ç”¨try - catchç»“æ„æ¥æ•è·å¼‚å¸¸ï¼Œä½†è¿™æ ·æˆ‘ä»¬è¦åœ¨æ¯ä¸€ä¸ªå¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç ä¸Šå†™ä¸€éï¼Œæœªå…å¤ªè¿‡éº»çƒ¦ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€‰æ‹©å…¨å±€å¼‚å¸¸æ•è·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * å…¨å±€å¼‚å¸¸æ•è·</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//è¿™ä¸ªå¼‚å¸¸æ•è·ç±»å¯ä»¥æ•è·åŠ äº†å“ªäº›æ³¨è§£çš„å¼‚å¸¸</span></span><br><span class="line"><span class="meta">@ControllerAdvice(annotations = &#123;RestController.class, Controller.class&#125;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(SQLIntegrityConstraintViolationException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">exceptionHandler</span><span class="params">(SQLIntegrityConstraintViolationException ex)</span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ•è·å¼‚å¸¸åçš„å¼‚å¸¸å¤„ç†æ–¹æ³•</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        log.error(ex.getMessage());</span><br><span class="line">        <span class="keyword">if</span>(ex.getMessage().contains(<span class="string">&quot;Duplicate entry&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;å‘˜å·¥å·²å­˜åœ¨ï¼Œæ·»åŠ å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;æœªçŸ¥é”™è¯¯&quot;</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ†é¡µæŸ¥è¯¢æ“ä½œ"><a href="#åˆ†é¡µæŸ¥è¯¢æ“ä½œ" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢æ“ä½œ"></a>åˆ†é¡µæŸ¥è¯¢æ“ä½œ</h3><p>è¦æƒ³å®ç°åˆ†é¡µæŸ¥è¯¢ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªMPé…ç½®ç±»ï¼Œç”¨æ¥é…ç½®åˆ†é¡µæŸ¥è¯¢æ‹¦æˆªå™¨ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼Œåœ¨æˆ‘ä¹‹å‰çš„å­¦ä¹ ç¬”è®°ä¸­ä¹Ÿæœ‰ç›¸å…³ä»‹ç»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * MPé…ç½®åˆ†é¡µæ’ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‹¦æˆªå™¨</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">//é…ç½®åˆ†é¡µæ‹¦æˆªå™¨</span></span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controllerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//    åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        åˆ†é¡µæ„é€ å™¨ï¼š</span></span><br><span class="line">        <span class="type">Page</span> <span class="variable">pageInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(page, pageSize);</span><br><span class="line"><span class="comment">//        æ¡ä»¶æ„é€ å™¨ï¼š</span></span><br><span class="line">        LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//        åŠ æ¡ä»¶ï¼š</span></span><br><span class="line">        queryWrapper.like(StringUtils.isNotEmpty(name), Employee::getName, name);</span><br><span class="line"><span class="comment">//        æ’åºæ¡ä»¶ï¼š</span></span><br><span class="line">        queryWrapper.orderByDesc(Employee::getUpdateTime);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        è°ƒç”¨serviceæ‰§è¡ŒæŸ¥è¯¢,è‡ªåŠ¨å°è£…åˆ°pageInfo</span></span><br><span class="line">        employeeService.page(pageInfo, queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(pageInfo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305262243130.png" alt="å±å¹•æˆªå›¾ 2023-05-26 224332"></p><h3 id="ç”¨æˆ·ç¦ç”¨å¯ç”¨"><a href="#ç”¨æˆ·ç¦ç”¨å¯ç”¨" class="headerlink" title="ç”¨æˆ·ç¦ç”¨å¯ç”¨"></a>ç”¨æˆ·ç¦ç”¨å¯ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    ä¿®æ”¹å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">updata</span><span class="params">(HttpServletRequest request,<span class="meta">@RequestBody</span> Employee employee)</span>&#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">empID</span> <span class="operator">=</span> (Long)session.getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line"><span class="comment">//        æ›´æ–°æ—¶é—´ï¼Œå’Œæ“ä½œäºº</span></span><br><span class="line">        employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        employee.setUpdateUser(empID);</span><br><span class="line"><span class="comment">//        è°ƒç”¨service</span></span><br><span class="line">        employeeService.updateById(employee);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å†™ä¼šæœ‰ç‚¹å°é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬ä¿®æ”¹æ˜¯æŒ‰ç…§å‰ç«¯ä¼ æ¥çš„idæ¥å®šä½å¯¹å“ªä¸€è¡Œä¿®æ”¹çš„ï¼Œä½†æ˜¯å‰ç«¯ä¼ æ¥çš„idå¦‚æœæœ¬èº«å¤ªé•¿ï¼Œä¼šé€ æˆå¤±çœŸï¼Œä¹Ÿå°±æ˜¯idä¼šæ˜¾ç¤ºä¸æ­£ç¡®ï¼Œä¸æ­£ç¡®çš„idè‡ªç„¶ä¹Ÿä¸èƒ½æ­£ç¡®æ‰¾åˆ°è¦ä¿®æ”¹çš„æ•°æ®ï¼Œæ‰€ä»¥å¦‚æœåªå†™ä¸Šé¢çš„controlleræ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦é…ç½®æ–°çš„jsonè½¬æ¢å™¨</p><p>è½¬æ¢å™¨ï¼ˆJacksonObjectMapperï¼‰ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lf.reggie.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.<span class="keyword">module</span>.SimpleModule;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.std.ToStringSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateTimeDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalTimeDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateTimeSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalTimeSerializer;</span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.fasterxml.jackson.databind.DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹è±¡æ˜ å°„å™¨:åŸºäºjacksonå°†Javaå¯¹è±¡è½¬ä¸ºjsonï¼Œæˆ–è€…å°†jsonè½¬ä¸ºJavaå¯¹è±¡</span></span><br><span class="line"><span class="comment"> * å°†JSONè§£æä¸ºJavaå¯¹è±¡çš„è¿‡ç¨‹ç§°ä¸º [ä»JSONååºåˆ—åŒ–Javaå¯¹è±¡]</span></span><br><span class="line"><span class="comment"> * ä»Javaå¯¹è±¡ç”ŸæˆJSONçš„è¿‡ç¨‹ç§°ä¸º [åºåˆ—åŒ–Javaå¯¹è±¡åˆ°JSON]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JacksonObjectMapper</span> <span class="keyword">extends</span> <span class="title class_">ObjectMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DATE_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DATE_TIME_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_TIME_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;HH:mm:ss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JacksonObjectMapper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="comment">//æ”¶åˆ°æœªçŸ¥å±æ€§æ—¶ä¸æŠ¥å¼‚å¸¸</span></span><br><span class="line">        <span class="built_in">this</span>.configure(FAIL_ON_UNKNOWN_PROPERTIES, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ååºåˆ—åŒ–æ—¶ï¼Œå±æ€§ä¸å­˜åœ¨çš„å…¼å®¹å¤„ç†</span></span><br><span class="line">        <span class="built_in">this</span>.getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">SimpleModule</span> <span class="variable">simpleModule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleModule</span>()</span><br><span class="line">                .addDeserializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .addDeserializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .addDeserializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)))</span><br><span class="line"></span><br><span class="line">                .addSerializer(BigInteger.class, ToStringSerializer.instance)</span><br><span class="line">                .addSerializer(Long.class, ToStringSerializer.instance)</span><br><span class="line">                .addSerializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .addSerializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .addSerializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ³¨å†ŒåŠŸèƒ½æ¨¡å— ä¾‹å¦‚ï¼Œå¯ä»¥æ·»åŠ è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨</span></span><br><span class="line">        <span class="built_in">this</span>.registerModule(simpleModule);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬éœ€è¦è®¾ç½®é…ç½®ç±»ï¼Œå°†æˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®è½¬æ¢å™¨åŠ åˆ°mvcé»˜è®¤çš„æ•°æ®è½¬æ¢å™¨é›†åˆä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lf.reggie.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lf.reggie.common.JacksonObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: æ‰©å±•æ¶ˆæ¯è½¬æ¢å™¨</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> void</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//      åˆ›å»ºæ¶ˆæ¯è½¬æ¢å™¨å¯¹è±¡</span></span><br><span class="line">        <span class="type">MappingJackson2HttpMessageConverter</span> <span class="variable">mjhmc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//      è®¾ç½®å¯¹è±¡è½¬æ¢å™¨ï¼ŒæŠŠæˆ‘ä»¬è‡ªå®šä¹‰å¥½çš„è½¬æ¢å™¨ä¼ è¿›å»</span></span><br><span class="line">        mjhmc.setObjectMapper(<span class="keyword">new</span> <span class="title class_">JacksonObjectMapper</span>());</span><br><span class="line"><span class="comment">//       å°†è®¾ç½®å¥½çš„å¯¹è±¡è½¬æ¢å™¨åŠ å…¥åˆ°æˆ‘ä»¬mvcæ¡†æ¶çš„è½¬æ¢å™¨é›†åˆä¸­</span></span><br><span class="line">        converters.add(<span class="number">0</span>,mjhmc);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ‰ç®—å¤§åŠŸå‘Šæˆ</p><blockquote><p>æ³¨æ„ï¼Œè¿™é‡Œä½ å¦‚æœè·Ÿç€è¯¾ç¨‹èµ°ï¼Œä»–çš„é…ç½®ç±»å¯èƒ½æ˜¯ç»§æ‰¿äº† WebMvcConfigurationSupport è¿™ä¸ªç±»ï¼Œç„¶åä½ å¯èƒ½å‡ºç°404é”™è¯¯ï¼Œå› ä¸ºWebMvcConfigurationSupportå­˜åœ¨æ—¶ä¼šè‡ªåŠ¨æ— æ•ˆåŒ–mvcçš„é»˜è®¤é™æ€èµ„æºè·¯å¾„ï¼ˆæˆ‘ç”¨çš„æ˜¯implements WebMvcConfigurer ä¸è¦†ç›–é»˜è®¤ï¼‰ï¼Œä½†å®é™…ä¸Šåªè¦ä½ æŠŠé™æ€è·¯å¾„æ”¾åˆ°&#x2F;resources&#x2F;staticä¸‹ï¼Œè¿™é‡Œæ˜¯é»˜è®¤é™æ€è®¿é—®è·¯å¾„ï¼Œæ ¹æœ¬å°±ä¸éœ€è¦è‡ªå·±ç”¨WebMvcConfigurationSupporté…ç½®ï¼Œæˆ‘ä¸å¤ªç†è§£ä¸ºä»€ä¹ˆè¯¾ç¨‹è¦è‡ªå·±é…ç½®ï¼Œå¤šäº†å¾ˆå¤šéº»çƒ¦</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305291955089.png" alt="å±å¹•æˆªå›¾ 2023-05-29 195515"></p><h3 id="å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"><a href="#å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……" class="headerlink" title="å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"></a>å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> Long updateUser;</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘ä»¬çš„employeeå®ä½“ç±»ä¸Šï¼Œå¯ä»¥çœ‹åˆ°æœ‰è¿™ä¹ˆå‡ æ¡å±æ€§ï¼Œä¸Šé¢çš„æ³¨è§£@TableField(fill &#x3D; FieldFill.INSERT)&amp;</p><p>@TableField(fill &#x3D; FieldFill.INSERT_UPDATE) æ˜¯MPåŒ…ä¸ºæˆ‘ä»¬æä¾›çš„å¯ä»¥å¯¹å…¬å…±å­—æ®µæ’å…¥æˆ–æ›´æ–°æ—¶ï¼Œç»Ÿä¸€è¿›è¡Œæ“ä½œï¼Œè€Œä¸ç”¨æˆ‘ä»¬å•ç‹¬è®¾ç½®æ¯ä¸ªå¯¹è±¡çš„å…¬å…±å±æ€§ï¼Œä¾‹å¦‚æ›´æ–°æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ³¨è§£åœ¨è¿›è¡Œæ•°æ®åº“æ›´æ–°æ—¶ï¼Œè‡ªåŠ¨ä¸ºæ›´æ–°åçš„æ•°æ®åŠ å…¥æ›´æ–°æ—¶é—´</p><p>å†™æˆ‘ä»¬è‡ªå®šä¹‰çš„å­—æ®µè¡¥å…¨ç±»ï¼Œå®ç°æ¥å£ï¼šimplements MetaObjectHandler</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰å…ƒå¯¹è±¡æ•°æ®å¤„ç†å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjecthandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">        System.out.println(BaseContext.getCurrentId());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createUser&quot;</span>, BaseContext.getCurrentId());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>, BaseContext.getCurrentId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>, BaseContext.getCurrentId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œæ³¨æ„ï¼Œæˆ‘ä»¬åœ¨å†™controlleræ—¶å¯ä»¥åˆ©ç”¨requestè·å¾—sessionè¿›è€Œè·å¾—å…±äº«çš„æ•°æ®ï¼Œä½†åœ¨æ™®é€šjavaç±»ä¸­æ²¡æ³•è¿™ä¹ˆæ“ä½œï¼Œä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çº¿ç¨‹å…±äº«ï¼Œä¸”æ•°æ®åªèƒ½åœ¨åŒä¸€çº¿ç¨‹ä¸­ä½¿ç”¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * çº¿ç¨‹å†…å…±äº«æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//    è®¾ç½®æ•°æ®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">setCurrentId</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        threadLocal.set(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    å–æ•°æ®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  Long <span class="title function_">getCurrentId</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå†åœ¨filterä¸­åŠ å…¥å·²ç™»å½•ç”¨æˆ·çš„id</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        5.æˆåŠŸåˆ™æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (employee != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//            å°†ç”¨æˆ·ç™»å½•idå­˜å…¥çº¿ç¨‹</span></span><br><span class="line">            BaseContext.setCurrentId(employee);</span><br><span class="line">            filterChain.doFilter(request, response);</span><br></pre></td></tr></table></figure><p>æˆåŠŸï¼Œç°åœ¨æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®æ—¶é—´ï¼Œæ“ä½œäººç­‰ï¼Œä»–ä¼šè‡ªåŠ¨è®¾ç½®</p><h2 id="èœå“æ“ä½œ"><a href="#èœå“æ“ä½œ" class="headerlink" title="èœå“æ“ä½œ"></a>èœå“æ“ä½œ</h2><h3 id="å®ä½“ç±»-amp-mapper-amp-æœåŠ¡æ¥å£-amp-æ¥å£å®ç°"><a href="#å®ä½“ç±»-amp-mapper-amp-æœåŠ¡æ¥å£-amp-æ¥å£å®ç°" class="headerlink" title="å®ä½“ç±»&amp;mapper&amp;æœåŠ¡æ¥å£&amp;æ¥å£å®ç°"></a>å®ä½“ç±»&amp;mapper&amp;æœåŠ¡æ¥å£&amp;æ¥å£å®ç°</h3><p>å®ä½“ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç±»å‹ 1 èœå“åˆ†ç±» 2 å¥—é¤åˆ†ç±»</span></span><br><span class="line">    <span class="keyword">private</span> Integer type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ†ç±»åç§°</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//é¡ºåº</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºæ—¶é—´</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ›´æ–°æ—¶é—´</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºäºº</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¿®æ”¹äºº</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ˜¯å¦åˆ é™¤</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mapperï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Category&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Category&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥å£å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CategoryMapper, Category&gt; <span class="keyword">implements</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–°å¢èœå“"><a href="#æ–°å¢èœå“" class="headerlink" title="æ–°å¢èœå“"></a>æ–°å¢èœå“</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    æ–°å¢åˆ†ç±»</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;category:&#123;&#125;&quot;</span>,category);</span><br><span class="line"></span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;æ–°å¢æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305302256590.png" alt="image-20230530225627454"></p><p>æˆåŠŸ</p><h3 id="åˆ†é¡µæ“ä½œ"><a href="#åˆ†é¡µæ“ä½œ" class="headerlink" title="åˆ†é¡µæ“ä½œ"></a>åˆ†é¡µæ“ä½œ</h3><p>å¯ä»¥ç±»æ¯”ç€ä¹‹å‰çš„å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//    åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page,<span class="type">int</span> pageSize)</span>&#123;</span><br><span class="line"></span><br><span class="line">        Page&lt;Category&gt; p = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line"><span class="comment">//        æ¡ä»¶æ„é€ å™¨</span></span><br><span class="line">        LambdaQueryWrapper&lt;Category&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        lambdaQueryWrapper.orderByDesc(Category::getSort);</span><br><span class="line">        categoryService.page(p,lambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(p);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305302253744.png" alt="image-20230530225337619"></p><p>å®Œæˆ</p><h3 id="åˆ é™¤åˆ†ç±»"><a href="#åˆ é™¤åˆ†ç±»" class="headerlink" title="åˆ é™¤åˆ†ç±»"></a>åˆ é™¤åˆ†ç±»</h3><blockquote><p>è¿™ä¸ªåˆ é™¤è‚¯å®šä¸èƒ½ç›´æ¥removeè¿™ä¹ˆç®€å•äº†ï¼ŒæŒ‰ç…§ä¸šåŠ¡éœ€æ±‚ï¼Œå¦‚æœè¯¥åˆ†ç±»ä¸‹æœ‰ä¸œè¥¿ï¼Œé‚£æˆ‘ä»¬å°±ä¸èƒ½ç›´æ¥å°†å…¶åˆ é™¤ï¼Œæ‰€ä»¥åœ¨åˆ é™¤ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥æŸ¥è¯¢è¯¥åˆ†ç±»ä¸‹æœ‰æ²¡æœ‰èœå“ï¼ˆå¥—é¤ï¼‰</p></blockquote><p>serviceè‡ªå®šä¹‰åˆ é™¤æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Category&gt; &#123;</span><br><span class="line"><span class="comment">//    æŒ‰åˆ†ç±»æŸ¥è¯¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CategoryMapper, Category&gt; <span class="keyword">implements</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetMealService setMealService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Params</span>: [id]</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢ä¼ è¿›æ¥çš„id</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Return</span> void</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰ä¸€ä¸ªæŸ¥è¯¢ï¼Œå› ä¸ºä¸šåŠ¡è¦æ±‚æˆ‘ä»¬å¦‚æœåˆ é™¤é¡¹å’Œå…¶ä»–é¡¹æœ‰å…³è”ï¼Œå°±ä¸èƒ½åˆ é™¤</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//      æŸ¥è¯¢æ¡ä»¶ï¼šçœ‹æ˜¯å¦æœ‰å…³è”èœå“</span></span><br><span class="line">        LambdaQueryWrapper&lt;Dish&gt; dishLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        dishLambdaQueryWrapper.eq(Dish::getCategoryId,id);</span><br><span class="line"><span class="comment">//      å¦‚æœæ•°é‡å¤§äº0åˆ™è¯´æ˜æœ‰å…³è”</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count1</span> <span class="operator">=</span> dishService.count(dishLambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(count1 &gt; <span class="number">0</span>)&#123;</span><br><span class="line"><span class="comment">//            æŠ›å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;åˆ é™¤å¤±è´¥ï¼Œåˆ†ç±»åŒ…å«èœå“&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        æŸ¥è¯¢æ¡ä»¶ï¼Œçœ‹æ˜¯å¦å…³è”å¥—é¤</span></span><br><span class="line">        LambdaQueryWrapper&lt;Setmeal&gt; setmealLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        setmealLambdaQueryWrapper.eq(Setmeal::getCategoryId,id);</span><br><span class="line"><span class="comment">//      æ•°é‡å¤§äº0è¯´æ˜æœ‰å…³è”</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count2</span> <span class="operator">=</span> setMealService.count(setmealLambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(count2 &gt; <span class="number">0</span>)&#123;</span><br><span class="line"><span class="comment">//            æŠ›å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;åˆ é™¤å¤±è´¥ï¼Œåˆ†ç±»åŒ…å«å¥—é¤&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//     å¦‚æœåˆ†ç±»ä¸‹ä¸ºç©ºï¼Œåˆ™æ­£å¸¸åˆ é™¤</span></span><br><span class="line">        <span class="built_in">super</span>.removeById(id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰åˆ é™¤å¼‚å¸¸ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰åˆ é™¤å¼‚å¸¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomException</span><span class="params">(String message)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜éœ€è¦ç”¨åˆ°æˆ‘ä»¬ä¹‹å‰ä¸ºäº†æ•è·ç”¨æˆ·é‡å¤åŠ å…¥å†™çš„å…¨å±€å¼‚å¸¸æ•æ‰ï¼ˆåŠ ä¸€ä¸ªæ–°çš„æ•æ‰æ–¹æ³•ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    æ•è·å…³è”åˆ é™¤å¼‚å¸¸</span></span><br><span class="line"><span class="meta">@ExceptionHandler(CustomException.class)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">exceptionHandler</span><span class="params">(CustomException ex)</span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ•è·å¼‚å¸¸åçš„å¼‚å¸¸å¤„ç†æ–¹æ³•</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    log.error(ex.getMessage());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.error(ex.getMessage());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305302253203.png" alt="å±å¹•æˆªå›¾ 2023-05-30 225252"></p><p>å®Œæˆ</p><h3 id="ä¿®æ”¹åˆ†ç±»"><a href="#ä¿®æ”¹åˆ†ç±»" class="headerlink" title="ä¿®æ”¹åˆ†ç±»"></a>ä¿®æ”¹åˆ†ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    ä¿®æ”¹åˆ†ç±»ä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [category]</span></span><br><span class="line"><span class="comment">         * å‰ç«¯ä¼ å…¥çš„åˆ†ç±»ä¿¡æ¯ï¼ŒåŒ…æ‹¬id</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> com.lf.reggie.domain.R&lt;java.lang.String&gt;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        log.info(<span class="string">&quot;ä¿®æ”¹åˆ†ç±»ä¿¡æ¯ï¼š&#123;&#125;&quot;</span>,category);</span><br><span class="line"></span><br><span class="line">        categoryService.updateById(category);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;ä¿®æ”¹åˆ†ç±»æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œä¸åšå¤ªå¤šè¯´æ˜</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306012214880.png" alt="image-20230601221451747"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306012215791.png" alt="image-20230601221513715"></p><p>OK</p><h3 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h3><p>æ–‡ä»¶ä¸Šä¼ çš„åç«¯å¤„ç†å…¶å®åœ¨springbootä¸­å¾—åˆ°äº†æå¤§ç®€åŒ–ï¼Œåªéœ€è¦ç”¨åˆ°MultipartFile</p><p>å…·ä½“ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">upload</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line"><span class="comment">//       æ­¤å¤„æ¥æ”¶åˆ°çš„fileæ˜¯ä¸´æ—¶æ–‡ä»¶ï¼Œéœ€è¦å°†å…¶è½¬å­˜</span></span><br><span class="line">        log.info(file.toString());</span><br><span class="line"></span><br><span class="line"><span class="comment">//        åˆ©ç”¨UUIDé‡æ–°ç”Ÿæˆæ–‡ä»¶å,é˜²æ­¢æ–‡ä»¶åé‡å¤</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//            ä¸Šä¼ çš„æ–‡ä»¶è½¬å­˜</span></span><br><span class="line">            file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(basepath + filename));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            R.error(<span class="string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.success(filename);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ä¸­çš„åŸºç¡€è·¯å¾„ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">reggie:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">D:\java\reggie_take_out\src\main\img\</span></span><br></pre></td></tr></table></figure><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202306012322871.png" alt="image-20230601232242744"></p><h3 id="æ–‡ä»¶ä¸‹è½½ï¼ˆä¸Šä¼ å›æ˜¾ï¼‰"><a href="#æ–‡ä»¶ä¸‹è½½ï¼ˆä¸Šä¼ å›æ˜¾ï¼‰" class="headerlink" title="æ–‡ä»¶ä¸‹è½½ï¼ˆä¸Šä¼ å›æ˜¾ï¼‰"></a>æ–‡ä»¶ä¸‹è½½ï¼ˆä¸Šä¼ å›æ˜¾ï¼‰</h3><p>å®ç°äº†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½åï¼Œä¸€èˆ¬è¿˜ä¼šè¿½åŠ ä¸€ä¸ªä¸Šä¼ å›æ˜¾åŠŸèƒ½ï¼Œèƒ½å¤Ÿè®©ç”¨æˆ·ç›´æ¥çœ‹åˆ°è‡ªå·±ä¸Šä¼ çš„å›¾ç‰‡å‡ºç°åœ¨ä¸Šä¼ æ¡†å†…ï¼Œè¿˜èƒ½è®©å…¶ä»–ç”¨æˆ·ä¹Ÿçœ‹åˆ°ä¸Šä¼ çš„å›¾ç‰‡ã€‚</p><p>ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@GetMapping(&quot;/download&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">download</span><span class="params">(String name, HttpServletResponse response)</span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [name, response]</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> void</span></span><br><span class="line"><span class="comment">         * æ–‡ä»¶ä¸‹è½½</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//            è¾“å…¥æµï¼Œè·å–å›¾ç‰‡</span></span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(basepath + name));</span><br><span class="line"><span class="comment">//            è¾“å‡ºæµï¼Œå›æ˜¾å›¾ç‰‡</span></span><br><span class="line">            <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line"></span><br><span class="line">            response.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>((len = fileInputStream.read(bytes)) != -<span class="number">1</span>)&#123;</span><br><span class="line"><span class="comment">//                å›æ˜¾</span></span><br><span class="line">                outputStream.write(bytes,<span class="number">0</span>,len);</span><br><span class="line">                outputStream.flush();</span><br><span class="line">            &#125;</span><br><span class="line">            outputStream.close();</span><br><span class="line">            fileInputStream.close();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼ å…¥çš„nameå…¶å®æ˜¯æˆ‘ä»¬ä¸Šä¼ åè¿”å›ç»™é¡µé¢çš„æ–‡ä»¶åï¼Œç„¶ååˆ©ç”¨fileInputStreamå°†æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°å¹¶å›æ˜¾ï¼Œæœ€åå…³é—­æµã€‚</p><h3 id="æ–°å¢èœå“-1"><a href="#æ–°å¢èœå“-1" class="headerlink" title="æ–°å¢èœå“"></a>æ–°å¢èœå“</h3><p>ç”±äºæ–°å¢èœå“æ¶‰åŠåˆ°å¯¹ä¸¤å¼ è¡¨ï¼ˆèœå“ï¼Œå£å‘³ï¼‰è¿›è¡Œä¿®æ”¹ï¼Œå› æ­¤æˆ‘ä»¬å¸¸è§„çš„èœå“å’Œå£å‘³å®ä½“ç±»æ— æ³•åŒæ—¶å°è£…æ–°å¢çš„èœå“ä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç”¨çš„ä¸€ä¸ªæ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆdtoï¼‰æ¥æ”¯æŒå‰ç«¯åˆ°åç«¯çš„æ•°æ®ä¼ è¾“ï¼Œç±»ä¼¼äºè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishDto</span> <span class="keyword">extends</span> <span class="title class_">Dish</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;DishFlavor&gt; flavors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer copies;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™ä¸ªæ•´åˆäº†dishå’Œdishflavorä¸¤ä¸ªç±»çš„æ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†å‰ç«¯ä¼ å…¥çš„æ•°æ®å®Œå…¨å°è£…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> DishDto dishDto)</span>&#123;</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Params</span>: [dishDto]</span></span><br><span class="line"><span class="comment">      * æ–°çš„dtoï¼Œå¯ä»¥å°è£…èœå“ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Return</span> com.lf.reggie.domain.R&lt;java.lang.String&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     log.info(dishDto.toString());</span><br><span class="line">     dishService.saveWithFlavor(dishDto);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;æ–°å¢èœå“æˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è®°å¾—åŠ @RequestBody</p></blockquote><p>ç„¶åæˆ‘ä»¬éœ€è¦æ–°å¢ä¸€æ¡æ–°çš„ä¸šåŠ¡æ–¹æ³•ï¼Œèƒ½å¤Ÿæ”¯æŒåŒæ—¶ä¿®æ”¹dishå’Œflavorä¸¤å¼ è¡¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    è¿™é‡Œæ¶‰åŠäº†å¤šå¼ è¡¨ï¼Œéœ€è¦æ·»åŠ äº‹åŠ¡</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDto dishDto)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>: å®ç°åŒæ—¶æ·»åŠ èœå“å’Œå£å‘³</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [dishDto]</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> void</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"><span class="comment">//        ä¿å­˜èœå“</span></span><br><span class="line">        <span class="built_in">this</span>.save(dishDto);</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> dishDto.getId();</span><br><span class="line"></span><br><span class="line">        List&lt;DishFlavor&gt; flavors = dishDto.getFlavors();</span><br><span class="line"><span class="comment">//      æ·»åŠ èœå“id</span></span><br><span class="line">        <span class="keyword">for</span> (DishFlavor item:flavors</span><br><span class="line">             ) &#123;</span><br><span class="line">            item.setDishId(id);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        ä¿å­˜å£å‘³</span></span><br><span class="line">        dishFlavorService.saveBatch(flavors);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="è¡¥å……POã€VOã€DAOã€BOã€DTOã€POJOè§£é‡Š"><a href="#è¡¥å……POã€VOã€DAOã€BOã€DTOã€POJOè§£é‡Š" class="headerlink" title="è¡¥å……POã€VOã€DAOã€BOã€DTOã€POJOè§£é‡Š"></a>è¡¥å……POã€VOã€DAOã€BOã€DTOã€POJOè§£é‡Š</h3><h4 id="PO"><a href="#PO" class="headerlink" title="PO"></a>PO</h4><p>POæ˜¯â€œPersistent Objectâ€çš„ç¼©å†™ï¼Œæ„ä¸ºâ€œæŒä¹…åŒ–å¯¹è±¡â€ã€‚å®ƒé€šå¸¸ç”¨äºè¡¨ç¤ºæ•°æ®åº“ä¸­çš„ä¸€æ¡è®°å½•ï¼Œå³ä¸€ç»„ç›¸å…³çš„æ•°æ®ã€‚POæ˜¯ç”±ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ç”Ÿæˆæˆ–æ‰‹åŠ¨åˆ›å»ºçš„Javaå¯¹è±¡ï¼Œå®ƒä»¬é€šå¸¸å…·æœ‰ä¸æ•°æ®åº“ä¸­çš„è¡¨ç›¸åŒçš„å­—æ®µå’Œæ•°æ®ç±»å‹ã€‚åœ¨Javaå¼€å‘ä¸­ï¼ŒPOå¸¸å¸¸è¢«ç”¨ä½œDAOï¼ˆæ•°æ®è®¿é—®å¯¹è±¡ï¼‰å±‚çš„æ•°æ®æ¨¡å‹ï¼Œä»¥åŠå’Œæ•°æ®åº“äº¤äº’çš„å¯¹è±¡ã€‚POå¯¹è±¡ä¸­çš„å­—æ®µä¸æ•°æ®åº“ä¸­çš„åˆ—ç›¸å¯¹åº”ï¼Œæ¯ä¸€è¡Œæ•°æ®å¯¹åº”ä¸€ä¸ªPOå¯¹è±¡ï¼ŒPOå¯¹è±¡ä¸­çš„å­—æ®µå€¼å°±æ˜¯å¯¹åº”åˆ—çš„å€¼ã€‚</p><h4 id="VO"><a href="#VO" class="headerlink" title="VO"></a>VO</h4><p>VOæ˜¯â€œValue Objectâ€çš„ç¼©å†™ï¼Œæ„ä¸ºâ€œå€¼å¯¹è±¡â€ã€‚VOé€šå¸¸ç”¨äºè¡¨ç¤ºç¨‹åºä¸­çš„æŸä¸ªå€¼æˆ–è€…ä¸€ç»„ç›¸å…³çš„å€¼ï¼Œä¾‹å¦‚ç”¨æˆ·çš„å§“åã€å¹´é¾„ã€åœ°å€ç­‰ç­‰ã€‚VOé€šå¸¸æ˜¯ä¸€ä¸ªä¸å¯å˜å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒçš„å€¼åœ¨åˆ›å»ºä¹‹åå°±ä¸èƒ½å†ä¿®æ”¹ã€‚åœ¨Javaå¼€å‘ä¸­ï¼ŒVOå¯¹è±¡é€šå¸¸ç”¨äºåœ¨ä¸åŒå±‚ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œä¾‹å¦‚åœ¨Controllerå±‚å’ŒServiceå±‚ä¹‹é—´ä¼ é€’æ•°æ®ã€‚VOå¯¹è±¡å’ŒPOå¯¹è±¡ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒä»¬çš„ä½œç”¨ä¸åŒã€‚VOé€šå¸¸æ˜¯ä»POå¯¹è±¡ä¸­æå–å‡ºæ¥çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œç”¨äºå±•ç¤ºå’Œä¼ é€’ç»™å‰ç«¯ç•Œé¢ã€‚</p><h4 id="DAO"><a href="#DAO" class="headerlink" title="DAO"></a>DAO</h4><p>DAOæ˜¯â€œData Access Objectâ€çš„ç¼©å†™ï¼Œæ„ä¸ºâ€œæ•°æ®è®¿é—®å¯¹è±¡â€ã€‚DAOå±‚æ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä¸æ•°æ®åº“äº¤äº’çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚DAOå±‚è´Ÿè´£å°†æ•°æ®åº“ä¸­çš„æ•°æ®è½¬æ¢æˆJavaå¯¹è±¡ï¼Œå¹¶å°†Javaå¯¹è±¡çš„æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚DAOå±‚çš„ä¸»è¦ä½œç”¨æ˜¯éš”ç¦»ä¸Šå±‚ä¸šåŠ¡é€»è¾‘å’Œä¸‹å±‚æ•°æ®è®¿é—®ç»†èŠ‚ã€‚åœ¨Javaå¼€å‘ä¸­ï¼Œé€šå¸¸ä½¿ç”¨Hibernateç­‰ORMæ¡†æ¶æ¥å®ç°DAOå±‚ã€‚DAOå±‚çš„ä¸»è¦ä»»åŠ¡æ˜¯å®ç°æ•°æ®çš„å¢åˆ æ”¹æŸ¥ç­‰åŸºæœ¬æ“ä½œï¼ŒåŒæ—¶æä¾›ä¸€äº›é«˜çº§æŸ¥è¯¢åŠŸèƒ½ã€‚</p><h4 id="BO"><a href="#BO" class="headerlink" title="BO"></a>BO</h4><p>BOæ˜¯â€œBusiness Objectâ€çš„ç¼©å†™ï¼Œæ„ä¸ºâ€œä¸šåŠ¡å¯¹è±¡â€ã€‚BOé€šå¸¸ç”¨äºè¡¨ç¤ºæŸä¸ªä¸šåŠ¡é€»è¾‘çš„å®ä½“æˆ–è€…æ¨¡å‹ã€‚BOé€šå¸¸åŒ…å«ä¸€äº›ä¸šåŠ¡é€»è¾‘å’Œæ–¹æ³•ï¼Œä¾‹å¦‚è®¡ç®—æŸäº›å€¼ã€éªŒè¯æ•°æ®ã€è°ƒç”¨å…¶ä»–æœåŠ¡ç­‰ç­‰ã€‚åœ¨Javaå¼€å‘ä¸­ï¼ŒBOå¯¹è±¡é€šå¸¸ç”±Serviceå±‚æˆ–è€…Facadeå±‚æ¥åˆ›å»ºï¼Œå¹¶ä¸”å®ƒä»¬é€šå¸¸åŒ…å«ä¸€äº›ä¸šåŠ¡é€»è¾‘çš„å®ç°ï¼Œä»¥åŠå¯¹æ•°æ®çš„æ“ä½œã€‚BOé€šå¸¸æ˜¯é’ˆå¯¹å…·ä½“çš„ä¸šåŠ¡åœºæ™¯è€Œè®¾è®¡çš„ï¼Œå®ƒä»¬æ˜¯å…·æœ‰ä¸šåŠ¡å«ä¹‰çš„å®ä½“ã€‚</p><h4 id="DTO"><a href="#DTO" class="headerlink" title="DTO"></a>DTO</h4><p>DTOæ˜¯â€œData Transfer Objectâ€çš„ç¼©å†™ï¼Œæ„ä¸ºâ€œæ•°æ®ä¼ è¾“å¯¹è±¡â€ã€‚DTOé€šå¸¸ç”¨äºåœ¨ä¸åŒå±‚ä¹‹é—´ä¼ è¾“æ•°æ®ï¼Œä¾‹å¦‚åœ¨Controllerå±‚å’ŒServiceå±‚ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚DTOå¯¹è±¡é€šå¸¸åŒ…å«ä¸€äº›ç®€å•çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•´æ•°ã€å¸ƒå°”å€¼ç­‰ç­‰ã€‚åœ¨Javaå¼€å‘ä¸­ï¼ŒDTOå¯¹è±¡é€šå¸¸ç”±Controllerå±‚æˆ–è€…Serviceå±‚æ¥åˆ›å»ºï¼Œå¹¶ä¸”å®ƒä»¬é€šå¸¸æ˜¯ä¸å¯å˜çš„ã€‚</p><h4 id="POJO"><a href="#POJO" class="headerlink" title="POJO"></a>POJO</h4><p>POJOæ˜¯â€œPlain Old Java Objectâ€çš„ç¼©å†™ï¼Œæ„ä¸ºâ€œç®€å•çš„Javaå¯¹è±¡â€ã€‚POJOé€šå¸¸æŒ‡çš„æ˜¯ä¸€ä¸ªæ²¡æœ‰ä»»ä½•é™åˆ¶ã€ç»§æ‰¿æˆ–å®ç°ç‰¹å®šæ¥å£çš„æ™®é€šJavaå¯¹è±¡ã€‚POJOå¯¹è±¡é€šå¸¸æ˜¯ä¸€ç§è½»é‡çº§çš„Javaå¯¹è±¡ï¼Œæ²¡æœ‰ä»»ä½•æ¡†æ¶æˆ–è€…æ³¨è§£çš„ä¾èµ–ã€‚åœ¨Javaå¼€å‘ä¸­ï¼ŒPOJOå¯¹è±¡é€šå¸¸ç”¨äºè¡¨ç¤ºç®€å•çš„æ•°æ®æ¨¡å‹æˆ–è€…æ•°æ®ä¼ è¾“å¯¹è±¡ã€‚</p><h3 id="ä¿®æ”¹èœå“"><a href="#ä¿®æ”¹èœå“" class="headerlink" title="ä¿®æ”¹èœå“"></a>ä¿®æ”¹èœå“</h3><p>é¦–å…ˆé¡µé¢ä¿¡æ¯çš„ä¿®æ”¹ä¸€å®šç¦»ä¸å¼€çš„å°±æ˜¯å›æ˜¾æ•°æ®</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202309142208417.png" alt="image-20230914220847306"></p><p>åªæœ‰å›æ˜¾æ•°æ®ï¼Œæ‰èƒ½çœ‹åˆ°æˆ‘ä»¬å³å°†ä¿®æ”¹çš„ä¿¡æ¯</p><p>å›æ˜¾çš„å®ç°å¹¶ä¸å›°éš¾ï¼Œä»å‰ç«¯è§’åº¦æ¥è¯´ï¼Œåªéœ€è¦åœ¨é¡µé¢åŠ è½½å®Œæ¯•åè‡ªåŠ¨å‘åç«¯å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè°ƒç”¨åç«¯çš„getæ–¹æ³•è·å¾—å•†å“æ•°æ®ï¼Œç„¶åé€šè¿‡jsonå‘å›å‰ç«¯è¿›è¡Œæ˜¾ç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> DishDto <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishService.getById(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        æ‹¦æˆªå™¨</span></span><br><span class="line">        LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        queryWrapper.eq(DishFlavor::getDishId,id);</span><br><span class="line"></span><br><span class="line">        List&lt;DishFlavor&gt; flavors = dishFlavorService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        BeanUtils.copyProperties(dish,dishDto);</span><br><span class="line">        dishDto.setFlavors(flavors);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dishDto;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä»£ç å®ç°ä¹Ÿéƒ½æ˜¯ä¹‹å‰å­¦è¿‡çš„å†…å®¹</p><p>ä¿®æ”¹çš„ä»£ç ä¹Ÿæ²¡ä»€ä¹ˆå¥½è¯´çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  æ›´æ–°èœå“ä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDto dishdto)</span> &#123;</span><br><span class="line"><span class="comment">//        æ›´æ–°dishè¡¨</span></span><br><span class="line">        dishService.updateById(dishdto);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        åˆ é™¤åŸå…ˆå£å‘³è¡¨é‡Œå­˜åœ¨çš„å£å‘³æ•°æ®</span></span><br><span class="line">        LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(DishFlavor::getDishId,dishdto.getId());</span><br><span class="line"></span><br><span class="line">        dishFlavorService.remove(queryWrapper);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        é‡æ–°æ·»åŠ å£å‘³ä¿¡æ¯</span></span><br><span class="line">        dishFlavorService.saveBatch(dishdto.getFlavors());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ–¹æ³•å‡æ–°å¢åœ¨serviceæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Dish&gt; &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    æ–°å¢æ–¹æ³•ï¼ŒåŒæ—¶ä¿å­˜èœå“å’Œå£å‘³</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDto dishDto)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//   æ–°å¢æ–¹æ³•ï¼ŒæŸ¥è¯¢èœå“ä¿¡æ¯å’Œå£å‘³</span></span><br><span class="line">    <span class="keyword">public</span> DishDto <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    æ–°å¢æ–¹æ³•ï¼Œæ›´æ–°èœå“ä¿¡æ¯å’Œå£å‘³</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDto dishdto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¥—é¤"><a href="#å¥—é¤" class="headerlink" title="å¥—é¤"></a>å¥—é¤</h2><h3 id="æ–°å¢å¥—é¤"><a href="#æ–°å¢å¥—é¤" class="headerlink" title="æ–°å¢å¥—é¤"></a>æ–°å¢å¥—é¤</h3><p>ç”±äºæ–°å¢å¥—é¤è®¾è®¡åˆ°å¤šè¡¨æ“ä½œï¼Œæ‰€ä»¥å…ˆåœ¨æ¥å£ä¸­å®šä¹‰æ–°çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    ä¿å­˜èœå“å’Œå¥—é¤</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithMeal</span><span class="params">(SetmealDto setmealDto)</span>;</span><br></pre></td></tr></table></figure><p>å¹¶åœ¨æ¥å£å®ç°ç±»ä¸­æ‰‹åŠ¨å®ç°è¯¥æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithMeal</span><span class="params">(SetmealDto setmealDto)</span> &#123;</span><br><span class="line"><span class="comment">//        ä¿å­˜å¥—é¤åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">this</span>.save(setmealDto);</span><br><span class="line"><span class="comment">//        ä¿å­˜èœå“å’Œå¥—é¤å…³ç³»</span></span><br><span class="line">        List&lt;SetmealDish&gt; setmealDishes = setmealDto.getSetmealDishes();</span><br><span class="line">        <span class="keyword">for</span>(SetmealDish i:setmealDishes)&#123;</span><br><span class="line">            i.setSetmealId(setmealDto.getId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        setMealDishService.saveBatch(setmealDishes);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åœ¨controllerä¸­ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå°±èƒ½å®ç°æ–°å¢å¥—é¤å¹¶å°†å¥—é¤å’Œé¤å“è”ç³»èµ·æ¥ã€‚</p><h3 id="åˆ†é¡µå±•ç¤ºå¥—é¤"><a href="#åˆ†é¡µå±•ç¤ºå¥—é¤" class="headerlink" title="åˆ†é¡µå±•ç¤ºå¥—é¤"></a>åˆ†é¡µå±•ç¤ºå¥—é¤</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page,<span class="type">int</span> pageSize,String name)</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Params</span>: [page, pageSize] é¡µç å’Œé¡µå¤§å°</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Return</span> com.lf.reggie.domain.R&lt;com.baomidou.mybatisplus.extension.plugins.pagination.Page&gt;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    Page&lt;Setmeal&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page,pageSize);</span><br><span class="line">    Page&lt;SetmealDto&gt; dtopage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    lambdaQueryWrapper.like(name != <span class="literal">null</span>,Setmeal::getName,name);</span><br><span class="line">    lambdaQueryWrapper.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line"></span><br><span class="line">    setMealService.page(pageInfo,lambdaQueryWrapper);</span><br><span class="line">    BeanUtils.copyProperties(pageInfo,dtopage,<span class="string">&quot;records&quot;</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;Setmeal&gt; pageInfoRecords = pageInfo.getRecords();</span><br><span class="line"></span><br><span class="line">    ArrayList&lt;SetmealDto&gt; records = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Setmeal item :</span><br><span class="line">            pageInfoRecords) &#123;</span><br><span class="line">        <span class="type">SetmealDto</span> <span class="variable">sd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SetmealDto</span>();</span><br><span class="line">        BeanUtils.copyProperties(item,sd);</span><br><span class="line"></span><br><span class="line">        sd.setCategoryName( categoryService.getById(item.getCategoryId()).getName());</span><br><span class="line">        records.add(sd);</span><br><span class="line">    &#125;</span><br><span class="line">    dtopage.setRecords(records);</span><br><span class="line">    <span class="keyword">return</span> R.success(dtopage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†é¡µæ“ä½œæˆ‘ä»¬ä¹‹å‰å·²ç»è¿›è¡Œè¿‡å¾ˆå¤šæ¬¡äº†ï¼Œå…·ä½“æ“ä½œä¸å†èµ˜è¿°ï¼Œä½†æ­¤å¤„æœ‰ä¸€ä¸ªç»†èŠ‚ï¼Œå› ä¸ºå‰ç«¯é¡µé¢è¦æ±‚æ˜¾ç¤ºå¥—é¤åˆ†ç±»ï¼Œè€Œæ™®é€šçš„</p><p>Setmealç±»ä¸­æ²¡æœ‰å¥—é¤åˆ†ç±»å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦setmealdtoã€‚</p><p>æ•ˆæœå±•ç¤ºï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202310010156613.png" alt="image-20231001015601525"></p><h2 id="ç”¨æˆ·æ‰‹æœºç«¯æ“ä½œ"><a href="#ç”¨æˆ·æ‰‹æœºç«¯æ“ä½œ" class="headerlink" title="ç”¨æˆ·æ‰‹æœºç«¯æ“ä½œ"></a>ç”¨æˆ·æ‰‹æœºç«¯æ“ä½œ</h2><h3 id="éªŒè¯ç ç™»å½•åŠŸèƒ½"><a href="#éªŒè¯ç ç™»å½•åŠŸèƒ½" class="headerlink" title="éªŒè¯ç ç™»å½•åŠŸèƒ½"></a>éªŒè¯ç ç™»å½•åŠŸèƒ½</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@PostMapping(&quot;/sendMsg&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@RequestBody</span> User user, HttpSession session)</span>&#123;</span><br><span class="line"><span class="comment">//      è·å–æ‰‹æœºå·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> user.getPhone();</span><br><span class="line"></span><br><span class="line"><span class="comment">//       ç”ŸæˆéšæœºéªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> ValidateCodeUtils.generateValidateCode(<span class="number">4</span>).toString();</span><br><span class="line"><span class="comment">//        å‘é€çŸ­ä¿¡(ç”±äºå‘é€çŸ­ä¿¡éœ€è¦é¢å¤–ç”³è¯·äº’è”ç½‘æœåŠ¡ï¼Œéœ€è¦èŠ±é’±ï¼Œæ­¤å¤„ä»…ä½œæ¼”ç¤º)</span></span><br><span class="line">        log.info(<span class="string">&quot;éªŒè¯ç &#123;&#125;&quot;</span>,code);</span><br><span class="line"><span class="comment">//       session ä¿å­˜éªŒè¯ç </span></span><br><span class="line">        session.setAttribute(phone,code);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;çŸ­ä¿¡å‘é€æˆåŠŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;User&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> Map map,HttpSession session)</span>&#123;</span><br><span class="line"></span><br><span class="line">        log.info(map.toString());</span><br><span class="line"></span><br><span class="line"><span class="comment">//        è·å–æ‰‹æœºå·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> map.get(<span class="string">&quot;phone&quot;</span>).toString();</span><br><span class="line"><span class="comment">//        è·å–éªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> map.get(<span class="string">&quot;code&quot;</span>).toString();</span><br><span class="line"><span class="comment">//        å–sessionéªŒè¯ç </span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">session_code</span> <span class="operator">=</span> session.getAttribute(phone);</span><br><span class="line">        <span class="keyword">if</span>(session_code != <span class="literal">null</span> &amp;&amp; session_code.equals(code))&#123;</span><br><span class="line">            LambdaQueryWrapper&lt;User&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            lambdaQueryWrapper.eq(User::getPhone,phone);</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getOne(lambdaQueryWrapper);</span><br><span class="line">            <span class="keyword">if</span>(user != <span class="literal">null</span>)&#123;</span><br><span class="line"><span class="comment">//                è™šæ™ƒ</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">                user.setPhone(phone);</span><br><span class="line">                user.setStatus(<span class="number">1</span>);</span><br><span class="line">                userService.save(user);</span><br><span class="line">            &#125;</span><br><span class="line">            session.setAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">            <span class="keyword">return</span> R.success(user);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        æ¯”å¯¹</span></span><br><span class="line"><span class="comment">//        å¦å¤–åˆ¤æ–­æ˜¯å¦æ–°ç”¨æˆ·ï¼ˆè‡ªåŠ¨æ³¨å†Œï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆéšæœºç å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lf.reggie.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éšæœºç”ŸæˆéªŒè¯ç å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidateCodeUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éšæœºç”ŸæˆéªŒè¯ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length é•¿åº¦ä¸º4ä½æˆ–è€…6ä½</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">generateValidateCode</span><span class="params">(<span class="type">int</span> length)</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(length == <span class="number">4</span>)&#123;</span><br><span class="line">            code = <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">9999</span>);<span class="comment">//ç”Ÿæˆéšæœºæ•°ï¼Œæœ€å¤§ä¸º9999</span></span><br><span class="line">            <span class="keyword">if</span>(code &lt; <span class="number">1000</span>)&#123;</span><br><span class="line">                code = code + <span class="number">1000</span>;<span class="comment">//ä¿è¯éšæœºæ•°ä¸º4ä½æ•°å­—</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(length == <span class="number">6</span>)&#123;</span><br><span class="line">            code = <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">999999</span>);<span class="comment">//ç”Ÿæˆéšæœºæ•°ï¼Œæœ€å¤§ä¸º999999</span></span><br><span class="line">            <span class="keyword">if</span>(code &lt; <span class="number">100000</span>)&#123;</span><br><span class="line">                code = code + <span class="number">100000</span>;<span class="comment">//ä¿è¯éšæœºæ•°ä¸º6ä½æ•°å­—</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åªèƒ½ç”Ÿæˆ4ä½æˆ–6ä½æ•°å­—éªŒè¯ç &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éšæœºç”ŸæˆæŒ‡å®šé•¿åº¦å­—ç¬¦ä¸²éªŒè¯ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length é•¿åº¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateValidateCode4String</span><span class="params">(<span class="type">int</span> length)</span>&#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rdm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">hash1</span> <span class="operator">=</span> Integer.toHexString(rdm.nextInt());</span><br><span class="line">        <span class="type">String</span> <span class="variable">capstr</span> <span class="operator">=</span> hash1.substring(<span class="number">0</span>, length);</span><br><span class="line">        <span class="keyword">return</span> capstr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç®€å•è¯´å°±æ˜¯ï¼šå‰ç«¯æ”¶åˆ°å‘é€éªŒè¯ç è¯·æ±‚åï¼Œåç«¯è°ƒç”¨ä¸“é—¨çš„apiæ¥é€šç½‘ç»œæœåŠ¡ç»™å‰ç«¯ä¼ å…¥çš„æ‰‹æœºå·å‘çŸ­ä¿¡éªŒè¯ç ï¼ˆæ­¤å¤„ç”¨logä»£æ›¿äº†ï¼‰,ç”¨æˆ·æ”¶åˆ°åï¼Œå°†éªŒè¯ç å¡«å…¥å‰ç«¯çš„éªŒè¯ç çª—å¹¶ç‚¹å‡»ç™»å½•ï¼Œåç«¯çš„ç™»å½•æ–¹æ³•æ¥æ”¶åˆ°phoneå’Œcodeåå…ˆæ˜¯æ ¹æ®phoneä»sessionï¼ˆäº‹å…ˆå­˜å…¥çš„ï¼‰ä¸­å–å¾—å¯¹åº”codeï¼Œç„¶åè¿›è¡Œå¯¹æ¯”ï¼Œä¸€è‡´çš„è¯åœ¨è¿›è¡Œä¹‹åçš„æ“ä½œï¼ˆåˆ¤æ–­æ˜¯å¦æ–°ç”¨æˆ·ç­‰ï¼‰</p><h1 id="è¯´æ˜ï¼šåé¢çš„åŠŸèƒ½åŸºæœ¬ä¸Šå’Œä¹‹å‰çš„å¥—è·¯ä¸€è‡´ï¼Œç¬”è®°å…ˆä¸åšäº†ï¼Œä¹‹åçœ‹çœ‹æœ‰æ—¶é—´å¤ä¹ çš„æ—¶å€™åšã€‚"><a href="#è¯´æ˜ï¼šåé¢çš„åŠŸèƒ½åŸºæœ¬ä¸Šå’Œä¹‹å‰çš„å¥—è·¯ä¸€è‡´ï¼Œç¬”è®°å…ˆä¸åšäº†ï¼Œä¹‹åçœ‹çœ‹æœ‰æ—¶é—´å¤ä¹ çš„æ—¶å€™åšã€‚" class="headerlink" title="è¯´æ˜ï¼šåé¢çš„åŠŸèƒ½åŸºæœ¬ä¸Šå’Œä¹‹å‰çš„å¥—è·¯ä¸€è‡´ï¼Œç¬”è®°å…ˆä¸åšäº†ï¼Œä¹‹åçœ‹çœ‹æœ‰æ—¶é—´å¤ä¹ çš„æ—¶å€™åšã€‚"></a>è¯´æ˜ï¼šåé¢çš„åŠŸèƒ½åŸºæœ¬ä¸Šå’Œä¹‹å‰çš„å¥—è·¯ä¸€è‡´ï¼Œç¬”è®°å…ˆä¸åšäº†ï¼Œä¹‹åçœ‹çœ‹æœ‰æ—¶é—´å¤ä¹ çš„æ—¶å€™åšã€‚</h1><h2 id="é¡¹ç›®ä¼˜åŒ–ï¼ˆredisï¼‰"><a href="#é¡¹ç›®ä¼˜åŒ–ï¼ˆredisï¼‰" class="headerlink" title="é¡¹ç›®ä¼˜åŒ–ï¼ˆredisï¼‰"></a>é¡¹ç›®ä¼˜åŒ–ï¼ˆredisï¼‰</h2><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>pomï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--redisé…ç½®--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>applicationï¼ˆredisè¿æ¥ä¿¡æ¯ï¼‰ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">redis:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">*</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">*</span></span><br><span class="line">  <span class="attr">database:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="ç¼“å­˜éªŒè¯ç "><a href="#ç¼“å­˜éªŒè¯ç " class="headerlink" title="ç¼“å­˜éªŒè¯ç "></a>ç¼“å­˜éªŒè¯ç </h2><p>ä¹‹å‰çš„éªŒè¯ç æ˜¯ä¿å­˜åœ¨sessionä¸­çš„</p><p>ä¼˜åŒ–ä¸€ä¸‹ï¼Œå°†å…¶ä¿å­˜åœ¨redisä¸­</p><ol><li>è·å–éªŒè¯ç åï¼Œé€šè¿‡setå­˜å…¥redis</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        ä½¿ç”¨rediså­˜å‚¨éªŒè¯ç ï¼Œå¹¶è®¾ç½®æœ‰æ•ˆæœŸä¸º5åˆ†é’Ÿ</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(phone,code,<span class="number">5</span>, TimeUnit.MINUTES);</span><br></pre></td></tr></table></figure><ol><li>ç™»å½•æ—¶getè·å–éªŒè¯ç </li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">////        å–sessionéªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">session_code</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(phone);</span><br></pre></td></tr></table></figure><ol><li>ç™»é™†æˆåŠŸåˆ é™¤</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redisTemplate.delete(phone);</span><br></pre></td></tr></table></figure><h2 id="ç¼“å­˜èœå“"><a href="#ç¼“å­˜èœå“" class="headerlink" title="ç¼“å­˜èœå“"></a>ç¼“å­˜èœå“</h2><p>å½“é«˜å¹¶å‘æ¨¡å¼ä¸‹ï¼Œæ¯æ¬¡è°ƒç”¨èœå“çš„listæ–¹æ³•éƒ½è¦æŸ¥è¯¢æ•°æ®åº“ï¼Œè¿™æ ·æ— ç–‘å¢åŠ äº†èµ„æºæ¶ˆè€—ï¼Œå¦‚æœå°†</p><p>æŸ¥å‡ºçš„èœå“æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œåœ¨æŸ¥æ‰¾å‰å…ˆæ‰¾ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸­å­˜åœ¨éœ€è¦çš„ï¼Œåˆ™ç›´æ¥è°ƒç”¨ï¼Œå¦å¤–ç¼“å­˜ä¸­çš„æ•°æ®åœ¨ä¿®æ”¹æˆ–å¢åŠ çš„æ—¶å€™éœ€è¦åˆ é™¤ï¼Œä¸ºçš„æ˜¯åœ¨ä¸‹æ¬¡æŸ¥æ‰¾æ—¶æ”¾å…¥æ–°æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        æ„é€ ä¸€ä¸ªkey</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;key&quot;</span> + dish.getCategoryId() + <span class="string">&quot;_&quot;</span> + dish.getStatus();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        å…ˆä»redisä¸­æŸ¥è¯¢æ•°æ®</span></span><br><span class="line">        dishDtos = (List&lt;DishDto&gt;) redisTemplate.opsForValue().get(key);</span><br></pre></td></tr></table></figure><h2 id="SpringCache"><a href="#SpringCache" class="headerlink" title="SpringCache"></a>SpringCache</h2><p>è¿™æ˜¯ä¸€ä¸ªé æ³¨è§£å°±èƒ½å®ç°ç¼“å­˜çš„æ¡†æ¶ï¼ˆä¸ç”¨è‡ªå·±æ‰‹åŠ¨å­˜å…¥redisï¼‰</p><p>å¸¸ç”¨æ³¨è§£ï¼š<br><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202312062017391.png" alt="image-20231206201708239"></p><p>@EnableCaching æ”¾åœ¨å¯åŠ¨ç±»ä¸Šï¼Œä»£è¡¨å¼€å¯ç¼“å­˜æ³¨é‡ŠåŠŸèƒ½</p><p>@Cacheable æœ‰ç¼“å­˜ç›´æ¥è¿”å›ï¼Œä¸è°ƒç”¨æ–¹æ³•ï¼ˆæŸ¥æ‰¾ï¼‰ å®ƒè¿˜æœ‰ä¸ªcondition &#x3D; â€œâ€ï¼Œé‡Œé¢å¯ä»¥å¡åˆ¤æ–­æ¡ä»¶ï¼Œæ¯”å¦‚åœ¨æŸ¥æ‰¾æ•°æ®æ—¶åœ¨æ•°æ®åº“æ‰¾ä¸åˆ°ï¼Œè¿™æ ·ç¼“å­˜é‡Œé¢å°±ä¼šç•™ä¸‹ä¸€ä¸ªæŸ¥è¯¢æ¡ä»¶çš„keyè¿˜æœ‰ä¸ªä¸ºnullçš„valueï¼Œæ‰€ä»¥å¯ä»¥condition&#x3D;â€™â€™#result !&#x3D; nullâ€™</p><p>@CachePut æ”¾åœ¨æ–¹æ³•ä¸Šï¼ˆä¸€èˆ¬æ˜¯ä¿å­˜æ•°æ®ï¼ŒæŠŠæ–°å¢çš„æ•°æ®åŠ åˆ°ç¼“å­˜ä¸­ï¼‰</p><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CachePut(value = &quot;&quot;,key = &quot;&quot;)</span></span><br></pre></td></tr></table></figure><p>value: ç¼“å­˜åç§°ï¼ˆç›¸å½“äºä¸€ä¸ªåˆ†ç±»ï¼Œæ¯ä¸ªåˆ†ç±»ä¸‹å¯ä»¥æœ‰å¤šä¸ªkeyï¼Œæ¯”å¦‚ç”¨æˆ·ç¼“å­˜ï¼Œä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªç”¨æˆ·ï¼‰</p><p>keyï¼šå°±æ˜¯keyå€¼ï¼Œç”¨æ¥æŸ¥æ‰¾value</p><blockquote><p>è¿™ä¸ªkeyå€¼å¯ä»¥é€šè¿‡ä¸€äº›ç‰¹æ®Šæ–¹æ³•æ¥å–æ¯”å¦‚ï¼š#result ä»£è¡¨å½“å‰æ–¹æ³•çš„è¿”å›å€¼ï¼ˆæ¯”å¦‚è¿”å›ä¸€ä¸ªuserå¯¹è±¡ï¼Œä½ å¯ä»¥#result.idï¼‰#rooté€šè¿‡è¿™ä¸ªä½ å¯ä»¥å–åˆ°å½“å‰çš„æ–¹æ³•åï¼Œæ¯”å¦‚ï¼ˆ#root.methodNameï¼‰è¿˜å¯ä»¥</p><p>#+å‚æ•°åï¼Œç„¶åç”¨å‚æ•°åé‡Œé¢çš„å±æ€§å€¼ æ¯”å¦‚å‚æ•°é‡Œé¢æœ‰ä¸ªuserï¼ˆéœ€è¦æ·»åŠ çš„æ–°æ•°æ®ï¼‰,ä½ å°±å¯ä»¥è¿™æ ·å†™ï¼škey &#x3D; #user.idï¼ŒæŠŠç”¨æˆ·idä½œä¸ºkey</p></blockquote><p>@CacheEvict åŒç†åˆ é™¤å“ªä¸ªï¼Œå…ˆæŒ‡å®šnameï¼Œå†æŒ‡å®škeyï¼ˆ#user.idï¼‰ï¼ˆæ›´æ–°æ•°æ®ï¼‰</p><h2 id="åˆ‡æ¢ç¼“å­˜äº§å“"><a href="#åˆ‡æ¢ç¼“å­˜äº§å“" class="headerlink" title="åˆ‡æ¢ç¼“å­˜äº§å“"></a>åˆ‡æ¢ç¼“å­˜äº§å“</h2><p>ä¸Šä¸€ä¸ªè¯´çš„springcacheæ˜¯springè‡ªå¸¦çš„ï¼Œä»–ä¸éœ€è¦å¼•å…¥é™¤springåŸå§‹jaråŒ…ä¹‹å¤–çš„åŒ…ï¼Œè€Œæˆ‘ä»¬å¦‚æœæƒ³ç”¨redisä½œä¸ºæˆ‘ä»¬çš„ç¼“å­˜æœåŠ¡äº§å“(springCacheå¦‚æœé¡¹ç›®é‡å¯ï¼Œåˆ™ç¼“å­˜æ¸…ç©ºï¼Œrediså¯ä»¥ä¿å­˜æœ¬åœ°ä¸€æ®µæ—¶é—´)ï¼Œå°±éœ€è¦å¼•å…¥ä¸“é—¨çš„jaråŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥åœ¨é…ç½®ä¸­è®¾ç½®è¿‡æœŸæ—¶é—´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cache:</span><br><span class="line">redis:</span><br><span class="line">time-to-live: ***(å•ä½ms)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<br>ç”¨åˆ°cacheableå°†æ–¹æ³•è¿”å›å€¼ç¼“å­˜æ—¶ï¼Œæ–¹æ³•è¿”å›å€¼éœ€è¦èƒ½è¢«åºåˆ—åŒ–ï¼ˆä¸€èˆ¬è¿”å›çš„æ˜¯è‡ªæ‹Ÿç±»çš„è¯å°±ä¸å¯ä»¥ï¼Œéœ€è¦åœ¨ç±»ä¸Šç»§æ‰¿ implements Serializable ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®å®æˆ˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBootå…¥é—¨ </tag>
            
            <tag> é¡¹ç›®å®æˆ˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„åšå®¢</title>
      <link href="/2023/05/08/helloworld/"/>
      <url>/2023/05/08/helloworld/</url>
      
        <content type="html"><![CDATA[<h1 id="æ­¤é—´å¥¥ç§˜éƒ½åœ¨åšå®¢é‡Œäº†"><a href="#æ­¤é—´å¥¥ç§˜éƒ½åœ¨åšå®¢é‡Œäº†" class="headerlink" title="æ­¤é—´å¥¥ç§˜éƒ½åœ¨åšå®¢é‡Œäº†"></a>æ­¤é—´å¥¥ç§˜éƒ½åœ¨åšå®¢é‡Œäº†</h1>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é©´ã®SpringBootå­¦ä¹ ç¬”è®°</title>
      <link href="/2023/03/30/SpringBoot%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2023/03/30/SpringBoot%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="é©´ã®SpringBootå­¦ä¹ ç¬”è®°"><a href="#é©´ã®SpringBootå­¦ä¹ ç¬”è®°" class="headerlink" title="é©´ã®SpringBootå­¦ä¹ ç¬”è®°"></a>é©´ã®SpringBootå­¦ä¹ ç¬”è®°</h1><blockquote><p>éƒ¨åˆ†èµ„æ–™æ¥è‡ªäºé»‘é©¬ç¨‹åºå‘˜</p></blockquote><h2 id="1-SpringBootå…¥é—¨"><a href="#1-SpringBootå…¥é—¨" class="headerlink" title="1.SpringBootå…¥é—¨"></a>1.SpringBootå…¥é—¨</h2><h3 id="1-1åœ¨ideaåˆ›å»ºSpringBoot"><a href="#1-1åœ¨ideaåˆ›å»ºSpringBoot" class="headerlink" title="1.1åœ¨ideaåˆ›å»ºSpringBoot"></a>1.1åœ¨ideaåˆ›å»ºSpringBoot</h3><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/image-20211116125259385.png"></p><blockquote><p>å¦‚å›¾æ‰€ç¤ºåœ¨é¡¹ç›®ä¸­åˆ›å»ºæ–°çš„æ¨¡å—ï¼Œæ¨¡å—é€‰æ‹©Spring Init ,ç‰¹åˆ«æé†’æ³¨æ„è‡ªå·±çš„SDKç‰ˆæœ¬å·ï¼ˆæˆ‘æ˜¯jdk8ï¼‰ï¼Œç„¶åæ­£å¸¸çš„èµ·åå­—ï¼Œtypeé€‰æ‹©mavenï¼Œjavaç‰ˆæœ¬é€‰æ‹©ä½ çš„ç‰ˆæœ¬ï¼ˆæˆ‘æ˜¯8ï¼‰ç„¶ånext</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/image-20211116125615728.png"></p><p>è¿™é‡Œå‹¾é€‰Webï¼Œä¸Šæ–¹çš„springbooté»˜è®¤å°±å¥½</p><h3 id="1-2å°è¯•åˆ›å»ºä¸€ä¸ªå¼€å‘æ§åˆ¶å™¨"><a href="#1-2å°è¯•åˆ›å»ºä¸€ä¸ªå¼€å‘æ§åˆ¶å™¨" class="headerlink" title="1.2å°è¯•åˆ›å»ºä¸€ä¸ªå¼€å‘æ§åˆ¶å™¨"></a>1.2å°è¯•åˆ›å»ºä¸€ä¸ªå¼€å‘æ§åˆ¶å™¨</h3><p>åˆ›å»ºjavaæ–‡ä»¶ï¼ˆSBæ˜¯springBootç¼©å†™ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-03-30%20175742.png"></p><p>å°è¯•å†™ä¸€æ®µä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SB</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3è¿è¡Œ"><a href="#1-3è¿è¡Œ" class="headerlink" title="1.3è¿è¡Œ"></a>1.3è¿è¡Œ</h3><h4 id="å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼š"><a href="#å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼š" class="headerlink" title="å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼š"></a>å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼š</h4><p>æ— æ•ˆçš„å‘è¡Œç‰ˆï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304021100900.png"></p><p>[^æ­¤å›¾æ¥è‡ªcsdnï¼š<a href="https://blog.csdn.net/booker009/article/details/129648180]">https://blog.csdn.net/booker009/article/details/129648180]</a>: </p><p>æ„å‘³ç€ä½ ideaä¸­çš„javaç‰ˆæœ¬è®¾ç½®ä¸springbootä¸ä¸€è‡´ï¼Œéœ€è¦åšä¸¤æ­¥ï¼š</p><p>1.Project Structure Modules&#x2F;Projecté€‰æ‹©ä½ çš„é¡¹ç›®ï¼ˆä»¥åŠçˆ¶çº§é¡¹ç›®ï¼Œå¦‚æœæœ‰çš„è¯ï¼‰-&gt;é€‰æ‹©8ï¼ˆä½ çš„jdkç‰ˆæœ¬ï¼‰ï¼Œå¦‚å›¾</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304021101792.png"></p><p>2.Settingï¼š 2.æŸ¥æ‰¾java compiler-&gt;Target bytecode version</p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-03-30%20180532.png"></p><p>å†æ¬¡è¿è¡Œå°±å¥½äº†</p><p>å¦å¤–å¦‚æœæŠ¥é”™è¯´ä½ çš„8080æ¥å£è¢«å ç”¨ï¼Œå¯ä»¥åœ¨application.propertiesä¸­é‡æ–°é…ç½®TomCatç«¯å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¾“å…¥ä»¥ä¸‹ä»£ç </span></span><br><span class="line">server.port:ä½ æƒ³è¦çš„ç«¯å£å·</span><br></pre></td></tr></table></figure><p>æˆåŠŸï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-03-30%20181438.png"></p><p>ç„¶ååœ¨æµè§ˆå™¨çš„åœ°å€æ é‡Œè¾“å…¥ï¼š</p><blockquote><p>localhost&#x2F;books</p></blockquote><p>å³å¯è®¿é—®åˆšåˆšç¼–å†™çš„æ§åˆ¶å™¨</p><h2 id="2-å…¥é—¨æ¡ˆä¾‹"><a href="#2-å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="2.å…¥é—¨æ¡ˆä¾‹"></a>2.å…¥é—¨æ¡ˆä¾‹</h2><blockquote><p>æ³¨æ„ï¼Œæ­¤æ¡ˆä¾‹æ˜¯å»ºç«‹åœ¨å·²ç»å­¦ä¹ è¿‡javawebç­‰ç›¸å…³çŸ¥è¯†çš„æ¡ˆä¾‹</p></blockquote><h3 id="1-åˆ›å»ºæ–°æ¨¡ç»„å¹¶åˆæ­¥åˆ›å»ºé¡¹ç›®ç›¸å…³ç›®å½•"><a href="#1-åˆ›å»ºæ–°æ¨¡ç»„å¹¶åˆæ­¥åˆ›å»ºé¡¹ç›®ç›¸å…³ç›®å½•" class="headerlink" title="1.åˆ›å»ºæ–°æ¨¡ç»„å¹¶åˆæ­¥åˆ›å»ºé¡¹ç›®ç›¸å…³ç›®å½•"></a>1.åˆ›å»ºæ–°æ¨¡ç»„å¹¶åˆæ­¥åˆ›å»ºé¡¹ç›®ç›¸å…³ç›®å½•</h3><p>å¦‚ä¸‹</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304021104075.png" alt="å±å¹•æˆªå›¾ 2023-04-02 110419"></p><blockquote><p>å…¶ä¸­ï¼š</p><p>configï¼šç”¨äºæ”¾ç½®ä¸€äº›é¡¹ç›®ä¸­è‡ªå·±é…åˆ¶çš„MPé…ç½®</p><p>daoï¼šMapperæ–‡ä»¶ï¼ˆjavawebçŸ¥è¯†ï¼‰</p><p>domainï¼š å®ä½“ç±»</p><p>resources&amp;testï¼šå‡ä¸ºè‡ªåŠ¨ç”Ÿæˆï¼Œtestä¸­æˆ‘è‡ªå»ºäº†ä¸€ä¸ªtestç±»ç”¨æ¥åˆæ­¥æµ‹è¯•ä»£ç åŠŸèƒ½</p></blockquote><h3 id="2-pom-xmlæ‰‹åŠ¨é…ç½®"><a href="#2-pom-xmlæ‰‹åŠ¨é…ç½®" class="headerlink" title="2.pom.xmlæ‰‹åŠ¨é…ç½®"></a>2.pom.xmlæ‰‹åŠ¨é…ç½®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ç”±äºmybatis-plusï¼ˆå›½äººå¼€å‘ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼ï¼‰ï¼Œ druid ï¼Œlombookåœ¨springbootä¸­å¹¶æ²¡æœ‰é»˜è®¤é…ç½®ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨å¯¼å…¥--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>jaråŒ…åŠŸèƒ½ç”¨åˆ°æ—¶ä¼šè®²</p><h3 id="3-application-ymlé…ç½®"><a href="#3-application-ymlé…ç½®" class="headerlink" title="3.application.ymlé…ç½®"></a>3.application.ymlé…ç½®</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304021227711.png" alt="å±å¹•æˆªå›¾ 2023-04-02 122706"></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ•°æ®åº“é“¾æ¥åŸºæœ¬é…ç½®</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql:///db2</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"><span class="comment">#ä¸»è¦é…ç½®é“¾æ¥æ•°æ®åº“åè¿˜æœ‰è‡ªå¢å±æ€§</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span>   <span class="comment">#å› ä¸ºMPæ˜¯æ ¹æ®ä½ çš„å®ä½“ç±»åå¯»æ‰¾æ•°æ®åº“è¡¨ï¼Œä¸è®¾ç½®çš„è¯åç§°ä¸ä¸€è‡´ä¼šæ‰¾ä¸åˆ°</span></span><br><span class="line">      <span class="comment">#ä¾‹å¦‚ï¼šæ•°æ®åº“è¡¨åï¼štb_stu å®ä½“ç±»ï¼šstu è¿™æ ·å°±ä¼šä¸è¯†åˆ«ï¼Œå¯ä»¥åœ¨è¿™é‡Œå†™ db-config: tb_</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span> <span class="comment">#æ­¤å¤„è®¾ç½®idä¸ºè‡ªå¢ï¼Œä¸ç„¶ä¼šå’ŒMPå†²çª</span></span><br><span class="line"><span class="comment">#å¼€å¯MPæ—¥å¿—</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><h3 id="4-domainç›®å½•"><a href="#4-domainç›®å½•" class="headerlink" title="4.domainç›®å½•"></a>4.domainç›®å½•</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304021110482.png" alt="å±å¹•æˆªå›¾ 2023-04-02 110930"></p><blockquote><p>æœ¬æ¡ˆä¾‹è°ƒç”¨çš„æ˜¯æœ¬åœ°çš„è´¦å·å¯†ç æ•°æ®åº“</p><p>å®ä½“ç±»ç”¨æ¥ä½œä¸ºæ•°æ®åº“å†…å®¹çš„å°è£…ï¼Œå…¶ä¸­çš„å±æ€§åè¦å’Œæ•°æ®åº“çš„åˆ—åä¸€è‡´ï¼Œä¸ä¸€è‡´å¯ä»¥é€šè¿‡æ³¨è§£å•ç‹¬ç»‘å®šåç§°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Column(name = &quot;release_status&quot;)</span></span><br></pre></td></tr></table></figure></blockquote><blockquote><p>@Data:æ¥è‡ªlombokåŒ…ï¼Œå¯ä»¥è‡ªåŠ¨ç»™å¯¼å…¥çš„ç±»ä¸­æ·»åŠ getterï¼Œsetterç­‰æ–¹æ³•ï¼Œç®€åŒ–å¼€å‘</p></blockquote><blockquote><p>@TableName:ç”¨äºæŒ‡å®šé“¾æ¥å“ªä¸ªæ•°æ®åº“,å¦‚æœå®ä½“ç±»åå’Œæ•°æ®åº“è¡¨åä¸€è‡´å¯ä»¥ä¸å†™ï¼ˆå­˜ç–‘ï¼‰</p></blockquote><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span><span class="comment">//æ¥è‡ªlombok  è‡ªåŠ¨ä¸ºå®ä½“ç±»æ·»åŠ getter,setter,toStringç­‰æ–¹æ³•</span></span><br><span class="line"><span class="meta">@TableName(&quot;users&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Users</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-daoç›®å½•"><a href="#5-daoç›®å½•" class="headerlink" title="5.daoç›®å½•"></a>5.daoç›®å½•</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304021126263.png" alt="å±å¹•æˆªå›¾ 2023-04-02 112646"></p><blockquote><p>è¯¥ç›®å½•ä¸­çš„mapperæ¥å£ç”¨äºå®ç°ä»£ç ä¸æ•°æ®åº“ä¹‹é—´çš„äº¤äº’ï¼Œåº•å±‚æ˜¯sqlè¯­å¥çš„æ‰è°ƒç”¨</p></blockquote><blockquote><p>@Repository: Repositoryå®ƒç”¨äºå°†æ•°æ®è®¿é—®å±‚ (DAO å±‚ ) çš„ç±»æ ‡è¯†ä¸º Spring Bean,ä½¿ä¹‹èƒ½å¤Ÿè¢«æ‰«æ</p></blockquote><blockquote><p>@Mapperï¼šç”¨æ¥æ ‡è¯†è¿™æ˜¯Mapperç±»</p></blockquote><blockquote><p>extends BaseMapper<Users>ï¼šBaseMapperæ¥è‡ªMPï¼Œé‡Œé¢å®šä¹‰äº†å¾ˆå¤šç°æˆçš„æ–¹æ³•ï¼Œå¯ä»¥ä¸ç”¨è‡ªå·±å†™sqlè¯­å¥äº†ï¼ˆå›½äº§å°±æ˜¯ç‰›é€¼ï¼‰</p><p>&lt;&gt;ä¸­æ”¾å®ä½“ç±»ï¼Œè¿™æ ·ä»æ•°æ®åº“è¯»åˆ°çš„æ•°æ®ä¼šé»˜è®¤å°è£…æˆå®ä½“ç±»</p></blockquote><h3 id="6-Applicationè‡ªå¸¦çš„å¯åŠ¨å™¨"><a href="#6-Applicationè‡ªå¸¦çš„å¯åŠ¨å™¨" class="headerlink" title="6.Applicationè‡ªå¸¦çš„å¯åŠ¨å™¨"></a>6.Applicationè‡ªå¸¦çš„å¯åŠ¨å™¨</h3><blockquote><p>æ³¨è§£ï¼š@SpringBootApplication</p></blockquote><h3 id="7-testç›®å½•"><a href="#7-testç›®å½•" class="headerlink" title="7.testç›®å½•"></a>7.testç›®å½•</h3><p>ç³»ç»Ÿè‡ªå¸¦çš„æˆ‘å…ˆä¸è®²ï¼Œè¯´ä¸€è¯´è‡ªå·±é…çš„ï¼ˆå…¶å®éƒ½ä¸€æ ·ï¼Œåªä¸è¿‡æ˜¯ç…§ç€è‘«èŠ¦ç”»ç“¢ï¼‰</p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304021211877.png" alt="å±å¹•æˆªå›¾ 2023-04-02 121048" style="zoom:67%;" /><blockquote><p>@SpringBootTestï¼šç”¨æ¥è¡¨ç¤ºè¿™æ˜¯springbootæµ‹è¯•ç±»ï¼Œè¿™æ ·æ‰èƒ½è¢«æ‰«æåˆ°</p></blockquote><blockquote><p>@Autowiredï¼šè‡ªåŠ¨å¯¼å…¥ï¼Œå¦‚æœè¿™åœ°æ–¹æŠ¥é”™ï¼Œå°±è¯´æ˜å‰é¢Mapperæ²¡åŠ æ³¨è§£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserMapper userMapper;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªuserMapperå¯¹è±¡å¯ä»¥è°ƒç”¨å¾ˆå¤šæ•°æ®åº“æ“ä½œæ–¹æ³•</p></blockquote><blockquote><p>è®²ä¸€ä¸‹testçš„è§„åˆ™ï¼Œåªè¦åŠ ä¸Š@Testå°±è¯´æ˜è¿™æ˜¯æµ‹è¯•æ–¹æ³•ï¼Œæµ‹è¯•æ–¹æ³•åªæ˜¯å•çº¯æµ‹è¯•æ–¹æ³•ä¸­çš„ä»£ç é€»è¾‘å’Œè¾“å‡ºæ˜¯å¦æŠ¥é”™ï¼Œæ˜¯å¦ç¬¦åˆæˆ‘ä»¬æ‰€æœŸå¾…çš„è¾“å‡ºï¼Œæ‰€ä»¥æµ‹è¯•æ–¹æ³•æ˜¯ä¸éœ€è¦è¿”å›å€¼å’Œå‚æ•°çš„</p></blockquote><p>é¢å¤–è¯´ä¸€ä¸‹åˆ†é¡µæ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ†é¡µæ“ä½œ</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getPage</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">IPage</span> <span class="variable">page</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç›´æ¥è¿™æ ·å†™æ˜¯ä¸å¯¹çš„,å› ä¸ºMPä¸­çš„æ‹¦æˆªå™¨æ²¡æœ‰é…ç½®</span></span><br><span class="line">        userMapper.selectPage(page,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ‹¦æˆªå™¨åœ¨configä¸­é…ç½®</p><h3 id="8-configé…ç½®"><a href="#8-configé…ç½®" class="headerlink" title="8.configé…ç½®"></a>8.configé…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//ç”¨æ¥æ”¾MPçš„æŸäº›é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span><span class="comment">//æ³¨é‡Šæˆé…ç½®ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MPConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//é…ç½®Beanæ‰èƒ½è¢«æ‰«æåˆ°</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//ä¸¤ä»¶äº‹ï¼š1.æŠŠæ‹¦æˆªå™¨é…ç½®å‡ºæ¥ 2.returnå‡ºå»</span></span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();<span class="comment">//æ‹¦æˆªå™¨çš„å£³</span></span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬çš„åˆ†é¡µæ“ä½œå°±å¯ä»¥ç”¨äº†</p><h3 id="9-å…³äºæ¡ä»¶æŸ¥è¯¢æ“ä½œ"><a href="#9-å…³äºæ¡ä»¶æŸ¥è¯¢æ“ä½œ" class="headerlink" title="9.å…³äºæ¡ä»¶æŸ¥è¯¢æ“ä½œ"></a>9.å…³äºæ¡ä»¶æŸ¥è¯¢æ“ä½œ</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304031654519.png"></p><blockquote><p>MPä¸‹çš„æ¡ä»¶æŸ¥è¯¢éœ€è¦é…ç½®æ¡ä»¶æ„é€ å™¨ï¼Œç„¶åæŠŠæ„é€ å™¨æ”¾åœ¨æŸ¥è¯¢è¯­å¥ä¸­ï¼Œåœ¨åå°sqlè¯­å¥ä¸Šä¼šè‡ªåŠ¨åŠ ä¸Šæ„é€ å™¨ä¸­çš„æ¡ä»¶</p></blockquote><p>ä¸€äº›æ„é€ å™¨æ¡ä»¶ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304031656245.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">queryWrapper.eq(Employee::getUsername,employee.getUsername());</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•°æ®åº“çš„åˆ—åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æŸ¥è¯¢æ¡ä»¶ï¼ˆä¸¤ä¸ªå‚æ•°åˆèµ·æ¥ï¼Œå°±æ˜¯sqlè¯­å¥ä¸­çš„whereï¼‰</p><p><strong>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯</strong>ï¼šå¦‚æœæŸ¥è¯¢æ¡ä»¶çš„å€¼è®¾ç½®ä¸ºnullï¼Œåˆ™nullä¼šè¢«è¯†åˆ«ä¸ºå­—ç¬¦ä¸²ï¼Œè¦é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œéœ€è¦è¦åœ¨è®¾ç½®æŸ¥è¯¢æ¡ä»¶æ—¶å°±åŠ å…¥åˆ¤æ–­ä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lqw1.like(tiaojian != <span class="literal">null</span>,Users::getUsername,tiaojian);</span><br></pre></td></tr></table></figure><p>è‹¥ä¸ºtrueåˆ™æ‹¼æ¥æ¡ä»¶ï¼Œfalseåˆ™ä¸æ‹¼æ¥</p><h3 id="10-ä¸€èˆ¬å¼€å‘æµç¨‹"><a href="#10-ä¸€èˆ¬å¼€å‘æµç¨‹" class="headerlink" title="10.ä¸€èˆ¬å¼€å‘æµç¨‹"></a>10.ä¸€èˆ¬å¼€å‘æµç¨‹</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304031830849.png" alt="å±å¹•æˆªå›¾ 2023-04-03 183026"></p><ol><li>é¦–å…ˆç¼–å†™å®ä½“ç±»ï¼Œæ–¹ä¾¿åé¢å°è£…</li><li>å†™å®ç°ç±»ï¼ˆmapperï¼‰ï¼Œåœ¨javawebä¸­è¯¥ç±»è¦æ˜ å°„.xmlæ–‡æ¡£æ¥ç¼–å†™sqlè¯­å¥æ“ä½œæ•°æ®åº“ï¼ŒSpringBootç®€åŒ–äº†è¿™ä¸€è¿‡ç¨‹ï¼Œå¯ä»¥ç›´æ¥ç»§æ‰¿ç°æœ‰çš„ç±»</li><li>å†™æœåŠ¡ç«¯æ¥å£ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾çš„UserServiceï¼Œé‡Œé¢å®šä¹‰äº†å¾ˆå¤šä¸šåŠ¡æ–¹æ³•</li><li>å†™implæ¥å£å®ç°ç±»ï¼Œå®ç°å®šä¹‰çš„æœåŠ¡ç«¯æ¥å£ï¼Œå¹¶å®ç°å…¶ä¸­çš„æ–¹æ³•ï¼Œjavawebä¸­éœ€è¦è·å¾—mapperæ¥è°ƒç”¨æ–¹æ³•ï¼ŒSpringBootä¸­åŒæ ·ä¹Ÿéœ€è¦</li><li>è¡¨ç°å±‚ï¼ˆå‰ç«¯ï¼‰</li></ol><h3 id="11-MPå¿«é€Ÿå¼€å‘"><a href="#11-MPå¿«é€Ÿå¼€å‘" class="headerlink" title="11.MPå¿«é€Ÿå¼€å‘"></a>11.MPå¿«é€Ÿå¼€å‘</h3><blockquote><p>ä¸Šæ–‡ä¸­æåˆ°çš„3,4æ­¥åœ¨MPä¸­å¾—åˆ°äº†ç®€åŒ–å¼€å‘</p></blockquote><p>é¦–å…ˆæ˜¯æœåŠ¡ç«¯æ¥å£ï¼Œç°åœ¨ä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨å†™ä¸€äº›åŸºç¡€æ“ä½œçš„æ–¹æ³•ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304031905363.png" alt="å±å¹•æˆªå›¾ 2023-04-03 190530"></p><p>ç›´æ¥ç»§æ‰¿å®˜æ–¹æä¾›çš„æ¥å£ç±»ï¼Œé‡Œé¢æœ‰å¾ˆå¤šåŸºç¡€çš„æ–¹æ³•ï¼Œä¼ å…¥æ³›å‹ä¸ºå®ä½“ç±»</p><p>å…¶æ¬¡æ˜¯æ¥å£å®ç°ç±»</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304031906252.png"></p><p>ä¹Ÿæ˜¯ç»§æ‰¿å®˜æ–¹æä¾›çš„ServiceImplç±»ï¼Œä¼ å…¥çš„ä¸¤ä¸ªæ³›å‹ï¼Œä¸€ä¸ªæ˜¯å®ç°ç±»Mapperï¼Œå¦ä¸€ä¸ªæ˜¯å®ä½“ç±»ï¼Œè™½ç„¶ç®€åŒ–å¼€å‘äº†ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦mapperï¼ˆåªæ˜¯æŠŠæˆ‘ä»¬ä¸€èˆ¬å¼€å‘çš„è¿‡ç¨‹ç»™å°è£…æˆç±»ï¼Œåœ¨åå°æ‰§è¡Œï¼Œå…·ä½“æµç¨‹å…¶å®ä¸å˜ï¼‰</p><p><strong>æ³¨æ„ä¸è¦å¿˜äº†ç»§æ‰¿æ¥å£</strong></p><p>å¦å¤–MPåªæ˜¯æä¾›äº†æŸäº›åŸºç¡€æ–¹æ³•ï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰æˆ–é‡å†™ï¼Œè¿˜æ˜¯å¾—æŒ‰è€æµç¨‹ï¼Œç°åœ¨æ¥å£ä¸­å®šä¹‰ï¼Œç„¶ååœ¨å®ç°ç±»ä¸­å®ç°</p><h3 id="12-å®ŒæˆController"><a href="#12-å®ŒæˆController" class="headerlink" title="12.å®ŒæˆController"></a>12.å®ŒæˆController</h3><p>åœ¨å®Œæˆä¸Šé¢çš„ä¸€ç³»åˆ—æœåŠ¡ç«¯ä»£ç å¹¶æµ‹è¯•å®Œä¹‹åï¼Œå°±å¯ä»¥å†™controlleräº†</p><p>ä¾‹å¦‚ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304041711846.png" alt="å±å¹•æˆªå›¾ 2023-04-04 171055"></p><blockquote><p>@RequestMapping()ï¼šè¿™é‡Œå®šä¹‰çš„æ˜¯è®¿é—®è·¯å¾„ï¼Œå¦‚æœè¦è®¿é—®ä½ çš„springbootï¼Œåˆ™éœ€è¦åœ¨æµè§ˆå™¨ä¸­è¾“å…¥â€<a href="http://localhost/">http://localhost/</a>  + ä½ åœ¨RequestMapping()å†™çš„è·¯å¾„â€</p></blockquote><p>ä¸‹é¢çš„æ³¨è§£éƒ½æ˜¯springå®šä¹‰å¥½çš„ï¼Œä¾‹å¦‚GetMappingå°±æ˜¯ä»¥getæ–¹å¼å‘é€è¯·æ±‚ï¼ŒPostMappingæ˜¯Postè¯·æ±‚</p><p>åœ¨è¿™é‡Œå¼•ç”¨ä¸€ç¯‡çŸ¥ä¹æ–‡ç« ï¼Œæˆ‘è®¤ä¸ºè®²å¾—å¾ˆå…¨é¢ï¼Œå¯ä»¥ç»™ä¹‹å‰æ²¡äº†è§£è¿‡çš„åŒå­¦è¡¥è¡¥è¯¾ï¼š<a href="https://zhuanlan.zhihu.com/p/137507309">https://zhuanlan.zhihu.com/p/137507309</a></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304041717729.png" alt="å±å¹•æˆªå›¾ 2023-04-03 211123"></p><h3 id="13-å¯åŠ¨æˆ‘ä»¬çš„Spring"><a href="#13-å¯åŠ¨æˆ‘ä»¬çš„Spring" class="headerlink" title="13.å¯åŠ¨æˆ‘ä»¬çš„Spring"></a>13.å¯åŠ¨æˆ‘ä»¬çš„Spring</h3><p>springbooté¡¹ç›®åœ¨åˆ›å»ºæ—¶è‡ªå¸¦å¯åŠ¨å™¨ï¼Œå°±æ˜¯æ ¹ç›®å½•ä¸‹çš„XXXApplicationï¼Œå³é”®å¯åŠ¨å®ƒ</p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-03-30%20181438.png"></p><p>å¯åŠ¨æˆåŠŸ</p><h3 id="14-åˆ©ç”¨APIæ¥å£è°ƒè¯•å·¥å…·æ¥æ£€æµ‹æˆ‘ä»¬çš„ä»£ç "><a href="#14-åˆ©ç”¨APIæ¥å£è°ƒè¯•å·¥å…·æ¥æ£€æµ‹æˆ‘ä»¬çš„ä»£ç " class="headerlink" title="14.åˆ©ç”¨APIæ¥å£è°ƒè¯•å·¥å…·æ¥æ£€æµ‹æˆ‘ä»¬çš„ä»£ç "></a>14.åˆ©ç”¨APIæ¥å£è°ƒè¯•å·¥å…·æ¥æ£€æµ‹æˆ‘ä»¬çš„ä»£ç </h3><p>å¾ˆå¤šè€å¸ˆæ¨èpostmanï¼Œä½†è¿™ç©æ„å„¿æ”¶è´¹ï¼Œæˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸ªå«Apifoxçš„ç½‘ç«™ï¼Œå¯ä»¥å®ç°åœ¨çº¿è°ƒè¯•ï¼Œæˆ‘ç”¨äº†ä¸€ä¸‹ï¼Œæ„Ÿjioè¿˜ä¸é”™ï¼ˆå»ºè®®ä½¿ç”¨edgeæµè§ˆå™¨ï¼Œä»–è‡ªå¸¦æ’ä»¶ï¼‰<img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304041724161.png" alt="å±å¹•æˆªå›¾ 2023-04-04 172359"></p><p>è°ƒè¯•çª—å£ï¼Œè¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ï¼Œå…·ä½“æ“ä½œå¯ä»¥åˆ°apifoxä¸»é¡µï¼Œé‡Œé¢æœ‰æ•™ç¨‹ã€‚</p><h3 id="15-å‰åç«¯æ•°æ®ä¸€è‡´æ€§å¤„ç†ï¼ˆå°ä¼˜åŒ–ï¼‰"><a href="#15-å‰åç«¯æ•°æ®ä¸€è‡´æ€§å¤„ç†ï¼ˆå°ä¼˜åŒ–ï¼‰" class="headerlink" title="15.å‰åç«¯æ•°æ®ä¸€è‡´æ€§å¤„ç†ï¼ˆå°ä¼˜åŒ–ï¼‰"></a>15.å‰åç«¯æ•°æ®ä¸€è‡´æ€§å¤„ç†ï¼ˆå°ä¼˜åŒ–ï¼‰</h3><blockquote><p>æˆ‘ä»¬åœ¨å®Œæˆäº†ä¸Šé¢çš„æ‰€æœ‰æ­¥éª¤ï¼Œå¹¶èƒ½åœ¨è°ƒè¯•å·¥å…·ä¸­çœ‹åˆ°è¿”å›å€¼æ—¶ï¼Œå°±è¯´æ˜æˆ‘ä»¬çš„å¼€å‘å·²ç»å®Œæˆä¸€å¤§éƒ¨åˆ†äº†ï¼Œä½†è¿™é‡Œæœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œæˆ‘ä»¬åç«¯çš„è¿”å›å€¼ç±»å‹ä¸ä¸€è‡´ï¼Œä¾‹å¦‚getAllè¿”å›çš„æ˜¯liståˆ—è¡¨ï¼ŒgetByIdè¿”å›çš„æ˜¯å•ä¸ªå®ä½“ç±»ï¼Œå¢åˆ æ”¹æŸ¥è¿”å›çš„æ˜¯booleanï¼Œè¿™äº›è¿”å›ç±»å‹ä¼šå¯¹å‰ç«¯å¼€å‘é€ æˆä¸€å®šéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»Ÿä¸€è¿”å›ç±»å‹</p></blockquote><p>listï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304041731578.png" alt="å±å¹•æˆªå›¾ 2023-04-04 173019"></p><p>booleanï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304041731850.png" alt="å±å¹•æˆªå›¾ 2023-04-04 173046"></p><p>å®ä½“ç±»ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304041731850.png" alt="å±å¹•æˆªå›¾ 2023-04-04 173059"></p><blockquote><p>è¿”å›ç±»å‹å¾ˆå¤š</p></blockquote><p>ç»Ÿä¸€è¿”å›ç±»å‹ï¼š</p><p>æ–°å»ºè¿”å›ç±»å‹çš„å°è£…ç±»ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304041733872.png" alt="å±å¹•æˆªå›¾ 2023-04-04 173344"></p><blockquote><p>flagï¼šåç«¯ä»£ç æ˜¯å¦æ­£å¸¸æ‰§è¡Œï¼ˆä¸ºäº†åŒºåˆ†æ˜¯æ‰¾ä¸åˆ°è¿”å›nullè¿˜æ˜¯å‡ºé”™è¿”å›nullï¼‰</p><p>dataï¼šæ•°æ®å†…å®¹</p></blockquote><p>æŠŠä¹‹å‰å†™å¥½çš„controllerä¸­çš„æ–¹æ³•ï¼Œè¿”å›å€¼éƒ½æ”¹æˆR</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304041740430.png" alt="å±å¹•æˆªå›¾ 2023-04-04 174024"></p><p>è¿™æ ·è¿”å›çš„å°±æ˜¯ç»Ÿä¸€çš„Rç±»å‹äº†</p><h2 id="ï¼ï¼ˆè¡¥å……ï¼‰å¸¸ç”¨æ³¨è§£-ä¸€èˆ¬æˆ‘åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°ä¸ç†è§£çš„éƒ½ä¼šåœ¨è¿™é‡Œæ›´æ–°-ï¼š"><a href="#ï¼ï¼ˆè¡¥å……ï¼‰å¸¸ç”¨æ³¨è§£-ä¸€èˆ¬æˆ‘åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°ä¸ç†è§£çš„éƒ½ä¼šåœ¨è¿™é‡Œæ›´æ–°-ï¼š" class="headerlink" title="ï¼ï¼ˆè¡¥å……ï¼‰å¸¸ç”¨æ³¨è§£(ä¸€èˆ¬æˆ‘åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°ä¸ç†è§£çš„éƒ½ä¼šåœ¨è¿™é‡Œæ›´æ–°)ï¼š"></a>ï¼ï¼ˆè¡¥å……ï¼‰å¸¸ç”¨æ³¨è§£(ä¸€èˆ¬æˆ‘åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°ä¸ç†è§£çš„éƒ½ä¼šåœ¨è¿™é‡Œæ›´æ–°)ï¼š</h2><h3 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h3><blockquote><p>è¿™æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£</p></blockquote><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br></pre></td></tr></table></figure></blockquote><blockquote><p>@SpringBootConfiguration,è¿™ä¸ªæ³¨è§£å¯ä»¥æ ‡æ³¨é…ç½®æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­å¯ä»¥å£°æ˜Beanå¯¹è±¡</p><p>@EnableAutoConfiguration è‡ªåŠ¨é…ç½®</p><p>@ComponentScan ç»„ä»¶æ‰«æï¼Œé€šè¿‡å®ƒèƒ½æ‰¾åˆ°æ³¨è§£@Component</p></blockquote><h3 id="Controller"><a href="#Controller" class="headerlink" title="@Controller"></a>@Controller</h3><blockquote><p>æ³¨è§£æ§åˆ¶ç±»ï¼Œå¯ä»¥åœ¨é‡Œé¢å†™ä¸šåŠ¡æ–¹æ³•</p></blockquote><h3 id="Value-â€œ-â€"><a href="#Value-â€œ-â€" class="headerlink" title="@Value(â€œ${}â€)"></a>@Value(â€œ${}â€)</h3><blockquote><p>å¯ä»¥è·å–é…ç½®æ–‡ä»¶é‡Œçš„å€¼</p></blockquote><blockquote><p>å¦å¤–å¦‚æœæˆ‘ä»¬æƒ³å°†é…ç½®æ–‡ä»¶é‡Œçš„æ•°æ®æ‹¿å‡ºæ¥å•ç‹¬å°è£…æˆä¸€ä¸ªç±»ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;&quot;)</span></span><br></pre></td></tr></table></figure></blockquote><p>è¿™ä¸ªæ³¨è§£å¯ä»¥ä»é…ç½®æ–‡ä»¶é‡Œå–å€¼ç»™ç±»ä¸­çš„å±æ€§èµ‹å€¼ï¼Œprefixè¿™ç©æ„å„¿åé¢å¯ä»¥ç»™å®šä¸€ä¸ªåç§°å‰ç¼€ï¼Œæ¯”å¦‚æˆ‘é…ç½®æ–‡ä»¶ä¸­æœ‰å±æ€§ï¼šuser.usernameï¼Œuser.passwordâ€¦,æˆ‘æƒ³è¦å–å€¼ï¼Œç»™æˆ‘å°è£…ç±»é‡Œçš„å±æ€§usernameï¼Œpasswordèµ‹å€¼ï¼Œæˆ‘å°±éœ€è¦å†™prefix &#x3D; â€œuserâ€,è¿™æ ·å°±å¯ä»¥å®ç°ï¼Œæ³¨æ„å±æ€§åç§°è¦ä¸€è‡´</p><h3 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h3><blockquote><p>å€˜è‹¥å‰ç«¯ä¼ çš„æ•°æ®ä¸ºjsonæ ¼å¼ï¼Œé‚£å°±å†å‚æ•°å‰åŠ è¿™ä¸ªæ³¨è§£</p></blockquote><h3 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h3><p>ä¸€èˆ¬è·¯å¾„ä¸­ä¼ é”®å€¼å¯¹æ—¶ï¼Œæˆ‘ä»¬æ˜¯ä¸éœ€è¦å†™è¿™æ¡æ³¨è§£çš„ï¼Œä½†å¦‚æœæ˜¯è·¯å¾„ä¸­ç›´æ¥å¸¦å€¼</p><h3 id="ResponseBody"><a href="#ResponseBody" class="headerlink" title="@ResponseBody"></a>@ResponseBody</h3><blockquote><p>ä¸€èˆ¬å†™åœ¨æœåŠ¡æ–¹æ³•ä¸Šï¼Œå°†æ–¹æ³•è¿”å›çš„ä¸œè¥¿è½¬æ¢ä¸ºjsonå­—ç¬¦ä¸²ä¾›å‰ç«¯æ¥å—</p></blockquote><h3 id="Mapper"><a href="#Mapper" class="headerlink" title="@Mapper"></a>@Mapper</h3><blockquote><p>æ”¾åœ¨daoæ¥å£ä¸Šé¢</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Mapper</span>: å‘Šè¯‰Mybatisè¿™æ˜¯daoæ¥å£ï¼Œåˆ›å»ºæ­¤æ¥å£çš„ä»£ç†å¯¹è±¡  ä½ç½®ï¼šç±»çš„ä¸Šé¢</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; <span class="title function_">getAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¦å¤–å¦‚æœå°†æ¥daoå¤ªå¤šï¼Œä¸€ä¸ªä¸€ä¸ªåŠ @Mapperå¤ªç´¯ï¼Œå¯ä»¥é€‰æ‹©åœ¨Applicationä¸ŠåŠ @MapperScan</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.lf.dao&quot;)</span></span><br><span class="line"><span class="comment">//è¿™æ ·å°±å¯ä»¥æŠŠdaoåŒ…ä¸‹çš„æ‰€æœ‰çš„daoæ‰«æè¿›å»</span></span><br></pre></td></tr></table></figure><h3 id="Resté£æ ¼"><a href="#Resté£æ ¼" class="headerlink" title="Resté£æ ¼"></a>Resté£æ ¼</h3><h4 id="GetMapping"><a href="#GetMapping" class="headerlink" title="@GetMapping()"></a>@GetMapping()</h4><blockquote><p>è·å–å‰ç«¯å‚æ•°ï¼Œé¦–å…ˆéœ€è¦åœ¨GetMappingåŠ å ä½ç¬¦ï¼Œæ¯”å¦‚@GetMapping(&#x2F;user&#x2F;{id})</p><p>ç„¶åå°±æ˜¯è·å–è·¯å¾„ä¸­çš„æ•°æ®</p><p>å‡å¦‚æœ‰å¦‚ä¸‹æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Interger id)</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·è®¿é—®è·¯å¾„é‡Œçš„å‚æ•°å°±èµ‹å€¼ç»™äº†æ–¹æ³•å‚æ•°id</p></blockquote><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="3-é…ç½®æ–‡ä»¶4çº§åˆ†ç±»"><a href="#3-é…ç½®æ–‡ä»¶4çº§åˆ†ç±»" class="headerlink" title="3.é…ç½®æ–‡ä»¶4çº§åˆ†ç±»"></a>3.é…ç½®æ–‡ä»¶4çº§åˆ†ç±»</h2><blockquote><p>æˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­ç”¨çš„é…ç½®æ–‡ä»¶éƒ½æ˜¯æˆ‘ä»¬ç¨‹åºå‘˜æ–¹ä¾¿å¼€å‘æµ‹è¯•çš„ï¼Œç­‰å¼€å‘ç»“æŸé¡¹ç›®ç»ç†ä¼šæœ‰è‡ªå·±çš„é…ç½®ï¼Œç”²æ–¹ä¹Ÿæœ‰åˆ«çš„è¦æ±‚ï¼Œè¿˜æœ‰æ¶‰åŠåˆ°ä¿å¯†çš„è¡Œä¸šï¼ˆä¾‹å¦‚ï¼šé“¶è¡Œï¼‰ï¼Œæ˜¯ä¸ä¼šå‘Šè¯‰ä½ é…ç½®çš„ï¼Œæ‰€ä»¥bootå°±æä¾›äº†é…ç½®è¦†ç›–çš„æ“ä½œï¼Œä¸€å…±æœ‰å››ä¸ªç­‰çº§ï¼Œé«˜ç­‰çº§çš„é…ç½®å¯ä»¥è¦†ç›–ä½ç­‰çº§çš„</p></blockquote><p>å¦‚å›¾ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304102236486.png" alt="å±å¹•æˆªå›¾ 2023-04-10 222707"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304102236181.png" alt="å±å¹•æˆªå›¾ 2023-04-10 222808"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304102236256.png" alt="å±å¹•æˆªå›¾ 2023-04-10 222527"></p><h2 id="4-å¤šç¯å¢ƒå¼€å‘"><a href="#4-å¤šç¯å¢ƒå¼€å‘" class="headerlink" title="4.å¤šç¯å¢ƒå¼€å‘"></a>4.å¤šç¯å¢ƒå¼€å‘</h2><p>yamlç‰ˆ</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304112025532.png" alt="å±å¹•æˆªå›¾ 2023-04-11 202140"></p><p>ä¹Ÿå¯ä»¥å°†å¤šä¸ªç¯å¢ƒå†™æˆæ–‡ä»¶</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304112026772.png" alt="å±å¹•æˆªå›¾ 2023-04-11 202346"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304112026765.png" alt="å±å¹•æˆªå›¾ 2023-04-11 202333"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304112030977.png" alt="å±å¹•æˆªå›¾ 2023-04-11 203047"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304112032784.png" alt="å±å¹•æˆªå›¾ 2023-04-11 203149"></p><p>mavené…ç½®bootç¯å¢ƒï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304112038457.png" alt="å±å¹•æˆªå›¾ 2023-04-11 203846"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304112039895.png" alt="å±å¹•æˆªå›¾ 2023-04-11 203914"></p><p>ä¼šè‡ªåŠ¨è¯»å–mavené…ç½®</p><h2 id="5-æ—¥å¿—"><a href="#5-æ—¥å¿—" class="headerlink" title="5.æ—¥å¿—"></a>5.æ—¥å¿—</h2><h3 id="1-æ—¥å¿—å¯¹è±¡åˆ›å»º"><a href="#1-æ—¥å¿—å¯¹è±¡åˆ›å»º" class="headerlink" title="1.æ—¥å¿—å¯¹è±¡åˆ›å»º"></a>1.æ—¥å¿—å¯¹è±¡åˆ›å»º</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304112040169.png" alt="å±å¹•æˆªå›¾ 2023-04-11 201956"></p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304112040281.png" alt="å±å¹•æˆªå›¾ 2023-04-11 202045"></p><h3 id="3-lombokç®€åŒ–æ—¥å¿—å¼€å‘"><a href="#3-lombokç®€åŒ–æ—¥å¿—å¼€å‘" class="headerlink" title="3.lombokç®€åŒ–æ—¥å¿—å¼€å‘"></a>3.lombokç®€åŒ–æ—¥å¿—å¼€å‘</h3><p>å½“æˆ‘ä»¬å¯¼å…¥äº†lombokåŒ…åï¼Œå°±ä¸ç”¨éº»çƒ¦åœ¨æ¯ä¸€ä¸ªç±»ä¸­éƒ½åŠ ä¸€ä¸ªlogçš„å£°æ˜äº†ã€‚åªéœ€è¦åœ¨ç±»ä¸ŠåŠ æ³¨é‡Š@Slf4j,ç„¶åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨æ³¨é‡Šäº†</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304112219768.png" alt="å±å¹•æˆªå›¾ 2023-04-11 221942"></p><h3 id="4-æ—¥å¿—è¾“å‡ºæ ¼å¼æ§åˆ¶"><a href="#4-æ—¥å¿—è¾“å‡ºæ ¼å¼æ§åˆ¶" class="headerlink" title="4.æ—¥å¿—è¾“å‡ºæ ¼å¼æ§åˆ¶"></a>4.æ—¥å¿—è¾“å‡ºæ ¼å¼æ§åˆ¶</h3><p>ä¸€æ¡æ—¥å¿—ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304112223057.png" alt="å±å¹•æˆªå›¾ 2023-04-11 222307"></p><p>è§£è¯»</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304112225446.png" alt="å±å¹•æˆªå›¾ 2023-04-11 222457"></p><blockquote><p>æ—¶é—´ï¼šè¿™ä¸ªä¸ç”¨å¤šè®²</p><p>çº§åˆ«ï¼šè¿™ä¸ªæ—¥å¿—çš„çº§åˆ«ï¼Œä¹Ÿæ²¡ä»€ä¹ˆå¥½è¯´çš„</p><p>PIDï¼šè¿›ç¨‹IDï¼Œè¡¨ç¤ºå½“å‰æ“ä½œæ‰€å¤„çš„è¿›ç¨‹ï¼Œå½“å¤šæœåŠ¡åŒæ—¶è®°å½•æ—¶ï¼Œæ–¹ä¾¿è°ƒè¯•</p><p>æ‰€å±ç±»ï¼šå‘å‡ºæ—¥å¿—çš„ç±»åï¼Œé•¿çš„ç±»åbootä¼šè‡ªåŠ¨ç®€åŒ–</p><p>æ—¥å¿—ä¿¡æ¯ï¼šè‡ªå®šä¹‰</p></blockquote><h3 id="5-æ—¥å¿—è¾“å‡ºä¸ºæ–‡ä»¶ï¼ˆå¾ˆå¸¸ç”¨ï¼‰"><a href="#5-æ—¥å¿—è¾“å‡ºä¸ºæ–‡ä»¶ï¼ˆå¾ˆå¸¸ç”¨ï¼‰" class="headerlink" title="5.æ—¥å¿—è¾“å‡ºä¸ºæ–‡ä»¶ï¼ˆå¾ˆå¸¸ç”¨ï¼‰"></a>5.æ—¥å¿—è¾“å‡ºä¸ºæ–‡ä»¶ï¼ˆå¾ˆå¸¸ç”¨ï¼‰</h3><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304112259741.png" alt="å±å¹•æˆªå›¾ 2023-04-11 225916"></p><h2 id="6-ç¬¬ä¸‰æ–¹Beanå±æ€§ç»‘å®š"><a href="#6-ç¬¬ä¸‰æ–¹Beanå±æ€§ç»‘å®š" class="headerlink" title="6.ç¬¬ä¸‰æ–¹Beanå±æ€§ç»‘å®š"></a>6.ç¬¬ä¸‰æ–¹Beanå±æ€§ç»‘å®š</h2><h3 id="1-æ³¨è§£"><a href="#1-æ³¨è§£" class="headerlink" title="1.æ³¨è§£"></a>1.æ³¨è§£</h3><blockquote><p>@ConfigurationProperties</p><p>@EnableConfigurationProperties</p></blockquote><p>@EnableConfigurationPropertiesæ³¨è§£å¯ä»¥å°†ä½¿ç”¨@ConfigurationPropertiesæ³¨è§£çš„ç±»åŠ å…¥Springå®¹å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(ServerConfig.class)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;ç¬¬ä¸‰æ–¹beanå&quot;)</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯@EnableConfigurationPropertiesæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€æ˜¯å¼€å¯å¼•ç”¨ç±»çš„ç¬¬ä¸‰æ–¹beanæ•°æ®ç»‘å®šï¼ŒäºŒæ˜¯å°†å¼•ç”¨ç±»åŠ å…¥Springå®¹å™¨ï¼ˆå’Œ@Componentä½œç”¨ç›¸åŒï¼‰ï¼Œæ‰€ä»¥ä¸¤è€…ä¸èƒ½å…±å­˜ï¼Œåˆ‡è®°ï¼</p><h2 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h2><blockquote><p>ymlæ–‡ä»¶é‡Œintçš„è§£æç±»å‹æ”¯æŒäºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶</p><p>ç°æœ‰ä¸€æƒ…æ™¯ï¼šä¸€ä½åŒå­¦åœ¨ymlä¸­é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯æ—¶ï¼Œå°†passwordè®¾ç½®ä¸ºï¼š0127ï¼Œç„¶åè¿æ¥æ•°æ®åº“æ—¶ä¸€ç›´æŠ¥é”™å¯†ç é”™è¯¯ï¼ˆæ­£ç¡®å¯†ç å°±æ˜¯0127ï¼‰ï¼ŒåŸå› æ˜¯ä»€ä¹ˆ</p></blockquote><p>å› ä¸ºymlä¸­å¯¹intè§£ææ”¯æŒå…«è¿›åˆ¶ï¼Œè€Œå…«è¿›åˆ¶æ˜¯ä»¥0å¼€å¤´ï¼Œæ‰€ä»¥ymlä¸­å°†0127è¯†åˆ«ä¸ºå…«è¿›åˆ¶ï¼Œæœ€ç»ˆè¯»å–çš„å¯†ç ä¸º87ï¼ˆ0127å…«è¿›åˆ¶è½¬åè¿›åˆ¶ï¼‰ï¼Œæ•…å‡ºé”™ï¼Œè§£å†³æ–¹æ³•å…¶å®åªè¦å°†ymlé…ç½®æ–‡ä»¶é‡Œçš„intå±æ€§å˜æˆå­—ç¬¦ä¸²ï¼Œå³password: â€œ0127â€ï¼Œå³å¯è§£å†³ã€‚</p><h2 id="7-æµ‹è¯•ç±»æµ‹è¯•webï¼ˆå‰ç«¯ï¼‰"><a href="#7-æµ‹è¯•ç±»æµ‹è¯•webï¼ˆå‰ç«¯ï¼‰" class="headerlink" title="7.æµ‹è¯•ç±»æµ‹è¯•webï¼ˆå‰ç«¯ï¼‰"></a>7.æµ‹è¯•ç±»æµ‹è¯•webï¼ˆå‰ç«¯ï¼‰</h2><p>1.è™šæ‹Ÿä¸€ä¸ªwebç¯å¢ƒ</p><blockquote><p>æµ‹è¯•ç±»æ³¨è§£@SpringBootTest()</p><p>å¦‚æœç›´æ¥å¯åŠ¨æµ‹è¯•ç±»ï¼Œè¿™æ ·åªæ˜¯å¯åŠ¨äº†ä¸€ä¸ªæ™®é€šçš„javaç±»ï¼Œè€Œä¸æ˜¯webç±»ï¼Œè¿™æ ·æ— æ³•åšåˆ°æµ‹è¯•è¡¨ç°å±‚ï¼ˆå‰ç«¯ï¼‰</p></blockquote><blockquote><p>è§£å†³ï¼š@SpringBootTest(webEnviroment &#x3D; SpringBootTest.webEnvironment.RANDOM_PORT)</p></blockquote><p>2.å¼€å¯è™šæ‹ŸMVCè°ƒç”¨</p><blockquote><p>@AutoconfigureMockMvcæ³¨è§£ï¼Œç”¨æ¥å¼€å¯è™šæ‹ŸMVC</p><p>ç„¶åæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè™šæ‹ŸMvcå¯¹è±¡ï¼š</p><p>@Autowired MockMvc mvc;</p><p>ç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿè¯·æ±‚buiderï¼š</p><p>MockHttpServletRequestBuilder builder &#x3D; MockRequestBuilders.get&#x2F;put&#x2F;post&#x2F;deleteç­‰ï¼ˆâ€&#x2F;è®¿é—®è·¯å¾„â€ï¼‰</p><p>ç”¨mvcå¯¹è±¡è°ƒç”¨performæ–¹æ³•ï¼Œæ”¾å…¥æˆ‘ä»¬çš„builder</p><p>mvc.perform(buider)å³å¯</p></blockquote><h2 id="8-ä»å®¹å™¨ä¸­æ‰‹åŠ¨è·å–å¯¹è±¡"><a href="#8-ä»å®¹å™¨ä¸­æ‰‹åŠ¨è·å–å¯¹è±¡" class="headerlink" title="8.ä»å®¹å™¨ä¸­æ‰‹åŠ¨è·å–å¯¹è±¡"></a>8.ä»å®¹å™¨ä¸­æ‰‹åŠ¨è·å–å¯¹è±¡</h2><p>å‡å¦‚ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªæœåŠ¡ç±»ï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304261738177.png" alt="å±å¹•æˆªå›¾ 2023-04-26 173816"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;userService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ€æ ·æ‰èƒ½åœ¨ç±»ä¸­é€šè¿‡æ‰‹åŠ¨æ–¹æ³•è·å¾—è¯¥æœåŠ¡ç±»çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œè°ƒç”¨æˆ‘ä»¬çš„æœåŠ¡æ–¹æ³•</p><p>å³åˆ©ç”¨æˆ‘ä»¬SpringBootä¸»æ–¹æ³•é‡Œçš„runæ–¹æ³•ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå®¹å™¨å¯¹è±¡ï¼Œä¹‹åå¯ä»¥ç”¨getBeanè·å¾—æˆ‘ä»¬éœ€è¦çš„å¯¹è±¡äº†</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304261739227.png" alt="å±å¹•æˆªå›¾ 2023-04-26 173947"></p><h2 id="Webï¼š"><a href="#Webï¼š" class="headerlink" title="Webï¼š"></a>Webï¼š</h2><h2 id="1-æ‹¦æˆªå™¨"><a href="#1-æ‹¦æˆªå™¨" class="headerlink" title="1.æ‹¦æˆªå™¨"></a>1.æ‹¦æˆªå™¨</h2><blockquote><p>æ‹¦æˆªå™¨æ˜¯SpringMvcä¸­çš„ä¸€ç§å¯¹è±¡ï¼Œä»–å¯ä»¥æ‹¦æˆªå¯¹åç«¯çš„è¯·æ±‚ï¼Œå¯ä»¥è‡ªå®šä¹‰æ‹¦æˆªå™¨</p></blockquote><h3 id="1-è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼š"><a href="#1-è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼š" class="headerlink" title="1.è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼š"></a>1.è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼š</h3><blockquote><p>1.åˆ›å»ºç±»å®ç°SpringMVCæ¡†æ¶çš„HandlerInterceptoræ¥å£</p></blockquote><p>ä½ å¯ä»¥åœ¨æ‹¦æˆªå™¨é‡Œå†™éªŒè¯æˆ–è€…æ˜¯å¯¹æ•°æ®ç­›é€‰è¿‡æ»¤ï¼Œæ­¤å¤„åªåšæµ‹è¯•ï¼Œæ‰€ä»¥å°±è¾“å‡ºäº†ä¸€å¥è¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * è¿™é‡Œé…ç½®äº†ä¸€ä¸ªè‡ªå®šä¹‰æ‹¦æˆªå™¨ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInter</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                             HttpServletResponse response,</span></span><br><span class="line"><span class="params">                             Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [request, response, handler]</span></span><br><span class="line"><span class="comment">         * handler:è¢«æ‹¦æˆªçš„æ§åˆ¶å™¨å¯¹è±¡</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> boolean</span></span><br><span class="line"><span class="comment">         * true:æ”¾è¡Œ</span></span><br><span class="line"><span class="comment">         * falseï¼šæˆªæ–­</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†æ‹¦æˆªå™¨&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>2.åˆ›å»ºé…ç½®ç±»ï¼Œå°†æˆ‘ä»¬è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨æ³¨å†Œåˆ°å®¹å™¨é‡Œ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * è¿™é‡Œç”¨æ¥é…ç½®æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="comment">//æ·»åŠ æ‹¦æˆªå™¨å¯¹è±¡ï¼Œæ³¨å…¥å®¹å™¨ä¸­</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Params</span>: [registry]</span></span><br><span class="line"><span class="comment">         * InterceptorRegistry registry: è¿™ç©æ„æ˜¯ä¸ªæ³¨å†Œå™¨ï¼ŒæŠŠä½ è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨å¡é‡Œé¢å°±</span></span><br><span class="line"><span class="comment">         * å¯ä»¥æ³¨å†Œäº†ï¼ˆç›¸å½“äºä¹‹å‰åœ¨xmlæ³¨å†Œï¼Œspringç®€åŒ–å’¯ï¼‰</span></span><br><span class="line"><span class="comment">        * <span class="doctag">@Return</span> void</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºæ‹¦æˆªå™¨å¯¹è±¡</span></span><br><span class="line">        <span class="type">LoginInter</span> <span class="variable">loginInter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoginInter</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿™ç§è·¯å¾„ä¸€èˆ¬éƒ½æŒ‡å®šä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œæ¯”è¾ƒæ–¹ä¾¿</span></span><br><span class="line">        <span class="comment">//æ‹¦æˆª</span></span><br><span class="line">        String[] path = &#123;<span class="string">&quot;/user/**&quot;</span>&#125;;</span><br><span class="line">        <span class="comment">//ä¸æ‹¦æˆª</span></span><br><span class="line">        String[] excludepath = &#123;<span class="string">&quot;/user/Login&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//addPathPatterns() é…ç½®æ‹¦æˆªè·¯å¾„</span></span><br><span class="line">        <span class="comment">//excludePathPatterns() é…ç½®æ”¾è¡Œè·¯å¾„</span></span><br><span class="line">        registry.addInterceptor(loginInter)</span><br><span class="line">                .addPathPatterns(path)</span><br><span class="line">                .excludePathPatterns(excludepath);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ç»“æœï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202304261901992.png" alt="å±å¹•æˆªå›¾ 2023-04-26 190115"></p><p>å…ˆè®¿é—®äº†user&#x2F;Login</p><p>å› ä¸ºæ²¡æœ‰æ‹¦æˆªè¿™ä¸ªurlï¼Œæ‰€ä»¥ç›´æ¥è®¿é—®äº†æˆ‘ä»¬çš„controller</p><p>ç„¶åè®¿é—®&#x2F;user&#x2F;a</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå…ˆè¿›å…¥äº†æˆ‘ä»¬çš„æ‹¦æˆªå™¨ï¼Œè§¦å‘äº†æ‹¦æˆªå™¨çš„è¾“å‡ºï¼Œåªä¸è¿‡æ‹¦æˆªå™¨æ”¾è¡Œäº†ï¼Œæ‰€ä»¥ä¾æ—§å¯ä»¥æ­£å¸¸è®¿é—®controller</p><h2 id="2-ä½¿ç”¨Servlet"><a href="#2-ä½¿ç”¨Servlet" class="headerlink" title="2.ä½¿ç”¨Servlet"></a>2.ä½¿ç”¨Servlet</h2><blockquote><p>1.åˆ›å»ºServletç±»ã€‚ç»§æ‰¿HttpServlet</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºServletç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doPost(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line"></span><br><span class="line">        out.println(<span class="string">&quot;Servletæ‰§è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>2.æ³¨å†ŒServletï¼Œæ”¾å…¥SpringBootæ¡†æ¶é‡Œ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Myconfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//public ServletRegistrationBean(T servlet, String... urlMappings)</span></span><br><span class="line">    <span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Servletå¯¹è±¡ ï¼Œç¬¬äºŒä¸ªæ˜¯urlåœ°å€</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®šä¹‰æ–¹æ³•ï¼Œæ³¨å†ŒServlet</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">servletRegistrationBean</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ServletRegistrationBean</span> <span class="variable">bean</span></span><br><span class="line">                <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(<span class="keyword">new</span> <span class="title class_">MyServlet</span>(),<span class="string">&quot;/myservlet&quot;</span>);</span><br><span class="line">        <span class="comment">//        ä¹Ÿå¯ä»¥è¿™æ ·è®¾ç½®</span></span><br><span class="line"><span class="comment">//        bean.setServlet();</span></span><br><span class="line"><span class="comment">//        bean.setUrlMappings();</span></span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸€å®šè¦åŠ @Bean</p><h2 id="3-Filterè¿‡æ»¤å™¨"><a href="#3-Filterè¿‡æ»¤å™¨" class="headerlink" title="3.Filterè¿‡æ»¤å™¨"></a>3.Filterè¿‡æ»¤å™¨</h2><p>Filteræ˜¯Servletè§„èŒƒçš„è¿‡æ»¤å™¨ï¼Œä¸€èˆ¬ç”¨æ¥å¤„ç†å­—ç¬¦ç¼–ç </p><blockquote><p>1.åˆ›å»ºè‡ªå®šä¹‰è¿‡æ»¤å™¨ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Myfilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œè¿‡æ»¤å™¨&quot;</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>2.æ³¨å†ŒFilterå¯¹è±¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ³¨å†ŒFilteræ‹¦æˆªå™¨</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> FilterRegistrationBean <span class="title function_">filterRegistrationBean</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">FilterRegistrationBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line"></span><br><span class="line">    bean.setFilter(<span class="keyword">new</span> <span class="title class_">Myfilter</span>());</span><br><span class="line">    bean.addUrlPatterns(<span class="string">&quot;/user/*&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œé¡ºä¾¿æä¸€ä¸ªFilterçš„æœ€å¸¸ç”¨åº”ç”¨æ–¹å¼ï¼šå­—ç¬¦é›†è¿‡æ»¤å™¨</strong>ï¼ˆæ¡†æ¶è‡ªå¸¦ï¼‰</p><p>ä½œç”¨ï¼šè§£å†³postè¯·æ±‚ä¹±ç é—®é¢˜</p><blockquote><p>ç”±äºæ˜¯æ¡†æ¶è‡ªå¸¦çš„ï¼Œæ‰€ä»¥åªéœ€è¦è‡ªå·±æ³¨å†Œï¼Œå°†ç³»ç»Ÿè‡ªå¸¦çš„è¿‡æ»¤å™¨æ”¾åˆ°æ³¨å†ŒBeanä¸­</p></blockquote><blockquote><p>1.åœ¨å®¹å™¨ä¸­æ³¨å†Œè¿‡æ»¤å™¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> FilterRegistrationBean <span class="title function_">filterRegistrationBean</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">FilterRegistrationBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ˜¯ç”¨è‡ªå¸¦çš„è¿‡æ»¤å™¨å¯¹è±¡</span></span><br><span class="line">    <span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CharacterEncodingFilter</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŒ‡å®šä½¿ç”¨çš„ç¼–ç æ–¹å¼</span></span><br><span class="line">    filter.setEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŒ‡å®šreqï¼Œrespéƒ½ä½¿ç”¨è®¾å®šçš„ç¼–ç </span></span><br><span class="line">    filter.setForceEncoding(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    bean.setFilter(filter);</span><br><span class="line">    bean.addUrlPatterns(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>2.è®¾ç½®è¿‡æ»¤å™¨ä½¿ç”¨ç¼–ç ç­‰</p></blockquote><p>å› ä¸ºè¿™æ˜¯ä¸“ç”¨çš„å­—ç¬¦è¿‡æ»¤å™¨ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è®¾ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŒ‡å®šä½¿ç”¨çš„ç¼–ç æ–¹å¼</span></span><br><span class="line">filter.setEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‡å®šreqï¼Œrespéƒ½ä½¿ç”¨è®¾å®šçš„ç¼–ç </span></span><br><span class="line">filter.setForceEncoding(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><blockquote><p>3.åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">  <span class="comment">#    å°†booté»˜è®¤é…ç½®çš„è¿‡æ»¤å™¨å…³é—­</span></span><br><span class="line">    <span class="attr">encoding:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>å…¶å®ä¸Šé¢çš„æ–¹æ³•ç•¥æœ‰è„±è£¤æ”¾pä¹‹æ„ğŸ˜†</p><p>æ—¢ç„¶ç³»ç»Ÿæœ‰è‡ªå¸¦çš„è¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹é»˜è®¤è¿‡æ»¤å™¨çš„ç¼–ç ï¼Œä»¥æ­¤æ¥å®ç°æˆ‘ä»¬è‡ªå·±æƒ³è¦çš„æ•ˆæœ</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">encoding:</span></span><br><span class="line">      <span class="attr">charset:</span> <span class="string">utf-8</span></span><br><span class="line"><span class="comment">#      æŠŠresï¼Œreqéƒ½é…ç½®æˆæˆ‘ä»¬çš„ç¼–ç </span></span><br><span class="line">      <span class="attr">force:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="9-ORMæ“ä½œæ•°æ®åº“ï¼ˆMysqlï¼‰"><a href="#9-ORMæ“ä½œæ•°æ®åº“ï¼ˆMysqlï¼‰" class="headerlink" title="9.ORMæ“ä½œæ•°æ®åº“ï¼ˆMysqlï¼‰"></a>9.ORMæ“ä½œæ•°æ®åº“ï¼ˆMysqlï¼‰</h2><p>å¤§ä½“æ­¥éª¤ï¼š</p><ol><li>mybatisèµ·æ­¥ä¾èµ–ï¼šå®Œæˆmybatiså¯¹è±¡è‡ªåŠ¨é…ç½®</li><li>åˆ›å»ºå®ä½“ç±»ï¼ˆå¯¹åº”æ•°æ®åº“å±æ€§ï¼‰</li><li>åˆ›å»ºDaoæ¥å£ï¼Œåœ¨æ¥å£ä¸­å†™æ–¹æ³•å</li><li>å†™Daoæ¥å£å¯¹åº”çš„mapperæ–‡ä»¶ï¼Œåœ¨mapperä¸­å†™sqlè¯­å¥æ“ä½œæ•°æ®åº“</li><li>é…ç½®pomæ–‡ä»¶ï¼Œå°†mapper.xmlåŒ…å«åˆ°ç±»è·¯å¾„ä¸­</li><li>åˆ›å»ºServiceæ¥å£å’Œå®ç°ç±»ï¼Œè°ƒç”¨daoæ–¹æ³•</li><li>åˆ›å»ºControllerï¼Œè®¿é—®service</li><li>å†™é…ç½®ç±»æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶é‡Œé…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯</li></ol><p>å…·ä½“å®ç°ï¼š</p><ol><li><p>èµ·æ­¥ä¾èµ–ï¼š</p><blockquote><p>SpringBooté‡Œæ•´åˆäº†mybatis,åªéœ€è¦åœ¨åˆ›å»ºé¡¹ç›®æ—¶é€‰æ‹©å°±å¯ä»¥</p></blockquote></li></ol><p>â€‹<img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305072154180.png"/></p><p>2.å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;username=&#x27;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, password=&#x27;&quot;</span> + password + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.daoæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Mapper</span>: å‘Šè¯‰Mybatisè¿™æ˜¯daoæ¥å£ï¼Œåˆ›å»ºæ­¤æ¥å£çš„ä»£ç†å¯¹è±¡  ä½ç½®ï¼šç±»çš„ä¸Šé¢</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; <span class="title function_">getAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®°å¾—åŠ @Mapperï¼Œ@Mapperåœ¨ä¸Šé¢ä¸“é—¨è®²æ³¨è§£çš„ç« èŠ‚é‡Œæœ‰</p><p>4.mapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lf.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lf.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from users</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„daoå’Œmapperçš„åˆ†ç¦»ï¼Œç¬¦åˆè§„èŒƒ</strong></p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305072159329.png"/><p>è¿™æ ·éœ€è¦é…ç½®ä¸¤å¤„åœ°æ–¹ï¼š</p><p>ä¸€æ˜¯ï¼šé…ç½®æ–‡ä»¶ä¸­</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line"><span class="comment">#Mapperæ–‡ä»¶ä½ç½®</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure><p>äºŒæ˜¯ï¼šåœ¨pomæ–‡ä»¶ä¸­è®¾ç½®,æŠŠmapperæ”¾å…¥èµ„æºä¸­</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--resourceæ’ä»¶--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>6.Serviceæ¥å£å’Œå®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; <span class="title function_">getAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.getAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ç±»ï¼Œ@Serviceç”¨æ¥æ ‡è¯†æœåŠ¡ç±»</p><p>7.Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mycontroller</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">AllUser</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userService.getAll();</span><br><span class="line">        System.out.println(users);</span><br><span class="line">        <span class="keyword">return</span> users.toString();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>8.é…ç½®æ–‡ä»¶</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql:///db2?useSSL=false&amp;useServerPrepStmts=true&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">*****</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line"><span class="comment">#Mapperæ–‡ä»¶ä½ç½®</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="comment">#æ—¥å¿—</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³åœ¨æ§åˆ¶å°çœ‹åˆ°sqlè¯­å¥ï¼Œå°±éœ€è¦é…ç½®æ—¥å¿—</p><h2 id="10-äº‹åŠ¡å¼€å¯"><a href="#10-äº‹åŠ¡å¼€å¯" class="headerlink" title="10.äº‹åŠ¡å¼€å¯"></a>10.äº‹åŠ¡å¼€å¯</h2><blockquote><p>ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼šç®€å•è¯´äº‹åŠ¡å°±æ˜¯æŠŠå¤šæ¡è¯­å¥ç»‘åœ¨ä¸€èµ·ï¼Œè¦æ‰§è¡ŒæˆåŠŸå°±ä¸€èµ·æˆåŠŸï¼Œå¦‚æœå…¶ä¸­æœ‰ä¸€æ¡å¤±è´¥ï¼ˆå‡ºé”™ï¼‰å°±ä¼šå›æ»š</p></blockquote><p>Springbootä¸­ä½¿ç”¨äº‹åŠ¡ï¼š</p><p>1ï¼‰åœ¨ä¸šåŠ¡æ–¹æ³•ä¸Šé¢åŠ @Transactional,åŠ ä¸Šåå°±æœ‰äº‹åŠ¡åŠŸèƒ½äº†</p><p>2ï¼‰æ˜ç¡®åœ¨ä¸»å¯åŠ¨ç±»ä¸Šé¢åŠ @EnableTransactionManager</p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> java </tag>
            
            <tag> SpringBootå…¥é—¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é©´ã®SpringBootå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰</title>
      <link href="/2023/03/30/SpringBoot%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2023/03/30/SpringBoot%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="é©´ã®SpringBootå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰"><a href="#é©´ã®SpringBootå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰" class="headerlink" title="é©´ã®SpringBootå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰"></a>é©´ã®SpringBootå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰</h1><blockquote><p>éƒ¨åˆ†ç¬”è®°æ¥è‡ªäºé»‘é©¬æ•™è‚²</p></blockquote><h1 id="1-NoSQL"><a href="#1-NoSQL" class="headerlink" title="1.NoSQL"></a>1.NoSQL</h1><h2 id="1-1Redisæ•°æ®åº“"><a href="#1-1Redisæ•°æ®åº“" class="headerlink" title="1.1Redisæ•°æ®åº“"></a>1.1Redisæ•°æ®åº“</h2><blockquote><p>Rediså’ŒMySQLä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§æ•°æ®åº“ç±»å‹ï¼Œä½†å’ŒMySQLç›¸æ¯”æœ‰ç€ä¸€äº›ä¸åŒï¼š</p><ol><li>MySQLæ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œè€ŒRedisæ˜¯éå…³ç³»å‹æ•°æ®åº“ï¼ˆNoSQLï¼‰ã€‚</li><li>MySQLç”¨äºæŒä¹…åŒ–å­˜å‚¨æ•°æ®åˆ°ç¡¬ç›˜ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œä½†æ˜¯é€Ÿåº¦ç¼“æ…¢ï¼›è€ŒRedisç”¨äºå­˜å‚¨ä½¿ç”¨è¾ƒä¸ºé¢‘ç¹çš„æ•°æ®åˆ°ç¼“å­˜ä¸­ï¼Œè¯»å–é€Ÿåº¦å¿«ã€‚</li><li>MySQLçš„æ•°æ®å­˜æ”¾åœ¨ç£ç›˜ä¸­ï¼›è€ŒRedisçš„æ•°æ®å­˜æ”¾åœ¨å†…å­˜ä¸­ã€‚</li></ol></blockquote><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/tporadowski/redis/releases">https://github.com/tporadowski/redis/releases</a> ï¼ˆç§‘å­¦ä¸Šç½‘ï¼‰</p><h3 id="1-1-1Redisæ•°æ®åº“ç®€å•ä½¿ç”¨"><a href="#1-1-1Redisæ•°æ®åº“ç®€å•ä½¿ç”¨" class="headerlink" title="1.1.1Redisæ•°æ®åº“ç®€å•ä½¿ç”¨"></a>1.1.1Redisæ•°æ®åº“ç®€å•ä½¿ç”¨</h3><p>ä¸‹è½½å®Œæˆåæ–‡ä»¶ç›®å½•ï¼š</p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305092210779.png"/><p>åœ¨è¯¥ç›®å½•ä¸‹å¯åŠ¨cmdï¼Œå¹¶è¾“å…¥  redis-cli.exe ï¼Œä½ ä¼šçœ‹åˆ°è¿™ç©æ„</p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305092212119.png"/><p>è¿™é‡Œå…ˆä¸è¦æ“ä½œï¼Œå…ˆè¾“å…¥shutdownï¼Œå†exit</p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305092214533.png"/><p>æ‰§è¡Œå®Œä¸Šè¿°æ“ä½œåï¼Œå†è¾“å…¥ redis-server.exe redis.windows.confï¼Œå°±å¯ä»¥è¿è¡Œæˆ‘ä»¬çš„redisäº†</p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305092216621.png"/><p>å†é‡æ–°æ‰“å¼€ redis-cli.exeï¼Œå°è¯•ä¸€æ¬¡ç®€å•çš„å­˜å–</p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305092219511.png"/><p>okï¼Œç°åœ¨ä½ å·²ç»ä¼šäº†redisäº†ğŸ‘</p><h2 id="1-2Mongodbæ•°æ®åº“"><a href="#1-2Mongodbæ•°æ®åº“" class="headerlink" title="1.2Mongodbæ•°æ®åº“"></a>1.2Mongodbæ•°æ®åº“</h2><blockquote><p>Mongodbæ˜¯ä¸€ä¸ªå¼€æºæ–‡æ¡£å‹æ•°æ®åº“ï¼Œæ˜¯NoSQLæ•°æ®åº“äº§å“çš„ä¸€ç§ï¼Œæ˜¯æœ€åƒå…³ç³»å‹æ•°æ®åº“çš„éå…³ç³»å‹æ•°æ®åº“</p><p>ç‰¹ç‚¹ï¼š</p><p>ä¸´æ—¶æ€§å­˜å‚¨ç›¸ç»“åˆï¼Œä¸”ä¿®æ”¹é¢‘ç‡é«˜ï¼ˆç±»ä¼¼äºæ¸¸æˆé“å…·ï¼Œç›´æ’­é—´åœ¨çº¿äººæ•°ï¼‰ï¼Œåº”ç”¨åœºæ™¯æ•°æ®å˜åŒ–è¾ƒå¿«</p></blockquote><h1 id="2-SpringBootæ•´åˆRedis"><a href="#2-SpringBootæ•´åˆRedis" class="headerlink" title="2.SpringBootæ•´åˆRedis"></a>2.SpringBootæ•´åˆRedis</h1><h2 id="2-1åˆ›å»ºæ•´åˆRedisçš„æ–°é¡¹ç›®"><a href="#2-1åˆ›å»ºæ•´åˆRedisçš„æ–°é¡¹ç›®" class="headerlink" title="2.1åˆ›å»ºæ•´åˆRedisçš„æ–°é¡¹ç›®"></a>2.1åˆ›å»ºæ•´åˆRedisçš„æ–°é¡¹ç›®</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305092254632.png" alt="å±å¹•æˆªå›¾ 2023-05-09 222955"></p><h2 id="2-2ç®€å•ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»"><a href="#2-2ç®€å•ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»" class="headerlink" title="2.2ç®€å•ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»"></a>2.2ç®€å•ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootRedisDemoApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™æ˜¯redisçš„æ“ä½œæ¥å£å¯¹è±¡</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisTemplate redisTemplate;<span class="comment">//è¿™ä¸ªç©æ„å„¿æ˜¯é¢å‘å¯¹è±¡çš„ï¼Œä½†æˆ‘ä»¬åœ¨æœ¬åœ°cmdæ‰§è¡Œçš„æ˜¯é¢å‘å­—ç¬¦ä¸²ï¼Œ</span></span><br><span class="line">    <span class="comment">//StringRedisTemplate redisTemplate;è¿™ç©æ„å°±æ˜¯é¢å‘å­—ç¬¦ä¸²çš„</span></span><br><span class="line"><span class="comment">//è¿™æ ·å°±å¯ä»¥ä¿è¯æˆ‘ä»¬ideaå’Œcmdæ“ä½œä¸€è‡´äº†</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">set</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ValueOperations</span> <span class="variable">ops</span> <span class="operator">=</span> redisTemplate.opsForValue();</span><br><span class="line">        ops.set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;hello world!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ValueOperations</span> <span class="variable">ops</span> <span class="operator">=</span> redisTemplate.opsForValue();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">name</span> <span class="operator">=</span> ops.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305092257992.png" alt="å±å¹•æˆªå›¾ 2023-05-09 225708"></p><p>æˆåŠŸgetåˆ°äº†</p><h1 id="3-å¸¸ç”¨ç¬¬ä¸‰æ–¹æŠ€æœ¯æ•´åˆ"><a href="#3-å¸¸ç”¨ç¬¬ä¸‰æ–¹æŠ€æœ¯æ•´åˆ" class="headerlink" title="3.å¸¸ç”¨ç¬¬ä¸‰æ–¹æŠ€æœ¯æ•´åˆ"></a>3.å¸¸ç”¨ç¬¬ä¸‰æ–¹æŠ€æœ¯æ•´åˆ</h1><h2 id="3-1å…³äºç¼“å­˜"><a href="#3-1å…³äºç¼“å­˜" class="headerlink" title="3.1å…³äºç¼“å­˜"></a>3.1å…³äºç¼“å­˜</h2><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305101750772.png" alt="å±å¹•æˆªå›¾ 2023-05-10 174952"></p><h2 id="3-2ä½¿ç”¨ç¼“å­˜"><a href="#3-2ä½¿ç”¨ç¼“å­˜" class="headerlink" title="3.2ä½¿ç”¨ç¼“å­˜"></a>3.2ä½¿ç”¨ç¼“å­˜</h2><p>1.å¯¼å…¥ç¼“å­˜ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        ç¼“å­˜--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.å¯ç”¨ç¼“å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCaching</span><span class="comment">//åŠ å…¥è¿™ä¸ªæ³¨è§£ï¼Œå¯ç”¨ç¼“å­˜</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.ä½¿ç”¨ç¼“å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>: åœ¨éœ€è¦ç¼“å­˜çš„æ–¹æ³•ä¸ŠåŠ å…¥æ³¨è§£ï¼Œå°†æ–¹æ³•å¾—åˆ°çš„æ•°æ®å­˜å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Params</span>: </span></span><br><span class="line"><span class="comment"> * value = &quot;cacheSpace&quot; cacheSpaceç»™ç¼“å­˜ç©ºé—´èµ·ä¸ªå</span></span><br><span class="line"><span class="comment"> * key = &quot;All&quot;  Allç»™ç¼“å­˜çš„æ•°æ®èµ·åï¼Œæ–¹ä¾¿å–ï¼ˆå”¯ä¸€ï¼‰</span></span><br><span class="line"><span class="comment"> * å¦å¤–ä¾‹å¦‚ä»¥idå–æ•°æ®ï¼Œå°±éœ€è¦ä»¥idå‘½åï¼Œæ–¹ä¾¿ï¼Œè¿™ç§keyå°±å¯ä»¥è¿™æ ·å†™key=â€œ#idâ€</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Return</span> </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Cacheable(value = &quot;cacheSpace&quot;,key = &quot;All&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getAll</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userDao.getAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-3å…³äºç¼“å­˜çš„å®ä¾‹ï¼šæ‰‹æœºéªŒè¯ç æ¨¡æ‹Ÿ"><a href="#3-3å…³äºç¼“å­˜çš„å®ä¾‹ï¼šæ‰‹æœºéªŒè¯ç æ¨¡æ‹Ÿ" class="headerlink" title="3.3å…³äºç¼“å­˜çš„å®ä¾‹ï¼šæ‰‹æœºéªŒè¯ç æ¨¡æ‹Ÿ"></a>3.3å…³äºç¼“å­˜çš„å®ä¾‹ï¼šæ‰‹æœºéªŒè¯ç æ¨¡æ‹Ÿ</h2><p>å…³äºåœ¨pomé‡Œæ•´åˆcacheï¼Œè¿˜æœ‰å¯åŠ¨ç±»çš„æ³¨è§£åœ¨ä¸Šé¢è®²è¿‡äº†ï¼Œè¿™é‡Œå°±çœç•¥</p><p>åŒ…è£…ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSCode</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String tele;<span class="comment">//ç”µè¯</span></span><br><span class="line">    <span class="keyword">private</span> String code;<span class="comment">//éªŒè¯ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>serviceæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SMSCodeService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¥å—æ‰‹æœºå·ï¼Œç”ŸæˆéªŒè¯ç ï¼Œåº•å±‚å†ä»¥æ‰‹æœºå·ä¸ºkeyç¼“å­˜éªŒè¯ç </span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendCodeToSMS</span><span class="params">(String tele)</span>;</span><br><span class="line"><span class="comment">//æ£€æŸ¥è¾“å…¥éªŒè¯ç å’Œç¼“å­˜é‡Œçš„éªŒè¯ç æ˜¯å¦ä¸€è‡´</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥å£å®ç°ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSCodeServviceImpl</span> <span class="keyword">implements</span> <span class="title class_">SMSCodeService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CodeUtil codeUtil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//ç”µè¯å·ç ä½œä¸ºkeyå­˜å‚¨ç¼“å­˜</span></span><br><span class="line">    <span class="comment">//CachePutåªç®¡å‘ç¼“å­˜é‡Œæ”¾ï¼Œå¦‚æœç¼“å­˜é‡Œæœ‰keyç›¸åŒçš„ï¼Œåˆ™ä¼šè¦†ç›–</span></span><br><span class="line">    <span class="comment">//@Cacheable å¦‚æœç¼“å­˜é‡Œæœ‰ï¼Œå°±ä¸ä¼šæ›´æ–°äº†</span></span><br><span class="line">    <span class="meta">@CachePut(value = &quot;smsCode&quot;,key = &quot;#tele&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendCodeToSMS</span><span class="params">(String tele)</span> &#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨å·¥å…·ç±»ï¼Œç”ŸæˆéªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">generator</span> <span class="operator">=</span> codeUtil.generator(tele);</span><br><span class="line">        <span class="keyword">return</span> generator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">tele</span> <span class="operator">=</span> smsCode.getTele();</span><br><span class="line">        <span class="comment">//è°ƒç”¨å·¥å…·ç±»ï¼Œè·å–ç¼“å­˜é‡Œçš„éªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> codeUtil.get(tele);</span><br><span class="line"><span class="comment">//æ¯”è¾ƒ</span></span><br><span class="line">        <span class="keyword">return</span> smsCode.getCode().equals(code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·¥å…·ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String[] patch = &#123;<span class="string">&quot;000000&quot;</span>, <span class="string">&quot;00000&quot;</span>, <span class="string">&quot;0000&quot;</span>, <span class="string">&quot;000&quot;</span>, <span class="string">&quot;00&quot;</span>, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¯¥æ–¹æ³•ç”¨æ¥éšæœºç”ŸæˆéªŒè¯ç ï¼Œä¸å¤šåšè§£é‡Š</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generator</span><span class="params">(String tele)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> tele.hashCode();</span><br><span class="line">        <span class="type">int</span> <span class="variable">encryption</span> <span class="operator">=</span> <span class="number">2023510</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> code ^ encryption;</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        result = result ^ now;</span><br><span class="line">        <span class="type">long</span> <span class="variable">pwcode</span> <span class="operator">=</span> result % <span class="number">1000000</span>;</span><br><span class="line">        <span class="comment">//è´Ÿå˜æ­£</span></span><br><span class="line">        pwcode = pwcode &lt; <span class="number">0</span> ? -pwcode : pwcode;</span><br><span class="line">        <span class="comment">//éªŒè¯ç è¡¥é½</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">codestr</span> <span class="operator">=</span> pwcode + <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> codestr.length();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  patch[length] + codestr;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//è¯¥æ–¹æ³•ç”¨æ¥æ ¹æ®keyè·å–ç¼“å­˜é‡Œçš„éªŒè¯ç </span></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;smsCode&quot;,key = &quot;#tele&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(String tele)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controlç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/sms&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSCodeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SMSCodeService smsCodeService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">(String tel)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> smsCodeService.sendCodeToSMS(tel);</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> smsCodeService.checkCode(smsCode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå®ç°ï¼š</p><p>å¯åŠ¨å’±ä»¬çš„apifoxï¼Œå˜¿ï¼Œå‘é€ä¸ªgetè¯·æ±‚ï¼Œå˜¿ï¼š</p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305102202711.png"/><p>å˜¿ï¼Œå’±å†å‘é€ä¸ªpostè¯·æ±‚ï¼ŒéªŒè¯éªŒè¯æˆ‘ä»¬çš„æ‰‹æœºå·å’ŒéªŒè¯ç </p><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305102204522.png" alt="å±å¹•æˆªå›¾ 2023-05-10 220322"></p><p>trueäº†ğŸ˜†</p><h1 id="4-Quartzè§¦å‘å™¨"><a href="#4-Quartzè§¦å‘å™¨" class="headerlink" title="4.Quartzè§¦å‘å™¨"></a>4.Quartzè§¦å‘å™¨</h1><blockquote><p>Quartzæ˜¯ä¸€ä¸ªè§¦å‘å™¨æ¡†æ¶ï¼Œä¸»è¦åŠŸèƒ½å°±æ˜¯é…ç½®ç¨‹åºçš„ä¸€ä¸ªè§¦å‘å™¨ï¼Œæ¯”å¦‚ï¼ˆé›¶ç‚¹ç§’æ€ï¼Œå°±éœ€è¦ä¸€ä¸ªåœ¨é›¶ç‚¹è‡ªåŠ¨å¯åŠ¨çš„ç¨‹åºï¼‰</p></blockquote><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305102258375.png" alt="å±å¹•æˆªå›¾ 2023-05-10 225648"></p><p>æ­¥éª¤ï¼š</p><p>1.åœ¨pomé‡Œæ•´åˆQuartz</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Quartzå®šæ—¶è§¦å‘å™¨--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.åˆ›å»ºquartzç±»ï¼Œæ³¨æ„ï¼Œè¯¥ç±»å¿…é¡»ç»§æ‰¿ QuartzJobBeanæ‰èƒ½ç”Ÿæ•ˆ(ä¹Œé¾Ÿçš„å±è‚¡â€”â€”é¾Ÿè…š)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyQuartz</span> <span class="keyword">extends</span> <span class="title class_">QuartzJobBean</span> &#123;</span><br><span class="line">    <span class="comment">//ç»§æ‰¿ä¹‹åé‡å†™å…¶ä¸­çš„æŠ½è±¡æ–¹æ³•</span></span><br><span class="line">    <span class="comment">//è¯¥æ–¹æ³•å°±å®šä¹‰äº†ä½ çš„å·¥ä½œï¼Œä¸Šå›¾ç¬¬ä¸€æ­¥</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;quartz is running...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.åˆ›å»ºé…ç½®ç±»æ¥é…ç½®å·¥ä½œæ˜ç»†ï¼Œè§¦å‘å™¨</p><p>è¿™é‡Œé¢é—¨é“æœ‰ç‚¹å¤šï¼Œå»ºè®®å„ä½è‡ªå·±æ‰¾èµ„æ–™æ·±å…¥äº†è§£äº†è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuartzConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> JobDetail <span class="title function_">jobDetail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å·¥ä½œæ˜ç»†,ç»‘å®šå…·ä½“å·¥ä½œ</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºè¯¥ç±»å¯¹åº”çš„å…·ä½“å·¥ä½œ</span></span><br><span class="line">        <span class="keyword">return</span> JobBuilder.newJob(MyQuartz.class).storeDurably().build();</span><br><span class="line">        <span class="comment">//.storeDurablyæ˜¯ç”¨æ¥æŒä¹…åŒ–å¤„ç†çš„ï¼Œå› ä¸ºå¦‚æœä½ ç”¨ä¸åˆ°ï¼Œjavaä¼šæŠŠä»–å½“åƒåœ¾å¤„ç†äº†ï¼Œè®°å¾—åŠ </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Trigger <span class="title function_">jobTrigger</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿™ç©æ„æ¯”è¾ƒæ·±å¥¥ï¼Œæˆ‘ä¸æ‡‚</span></span><br><span class="line">        <span class="type">CronScheduleBuilder</span> <span class="variable">schedule</span> <span class="operator">=</span> CronScheduleBuilder.cronSchedule(<span class="string">&quot;0/5 * * * * ?&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šå¯¹åº”å·¥ä½œæ˜ç»†</span></span><br><span class="line">        <span class="keyword">return</span> TriggerBuilder.newTrigger().forJob(jobDetail()).withSchedule(schedule).build();</span><br><span class="line">        <span class="comment">//forJob:ç»‘å®šå·¥ä½œæ˜ç»†</span></span><br><span class="line">        <span class="comment">//withSchedule:ç»‘å®šè§¦å‘æ—¶é—´</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç®€è€Œè¨€ä¹‹ï¼šå·¥ä½œæ˜ç»†ï¼Œè‚¯å®šéœ€è¦ä½ æŠŠå…·ä½“å·¥ä½œä¼ è¿›æ¥ï¼Œæ‰€ä»¥å®ƒçš„ä½œç”¨å°±æ˜¯å°†å·¥ä½œä¼ å…¥Quartzï¼Œè§¦å‘å™¨è‚¯å®šè¦çŸ¥é“ä½ çš„å·¥ä½œæ˜ç»†æ‰çŸ¥é“ä½ åšä»€ä¹ˆï¼Œæ‰€ä»¥å®ƒéœ€è¦ä½ ä¼ å…¥å·¥ä½œæ˜ç»†ï¼Œå†æŠŠå®ƒä¼ å…¥Quartzï¼Œè§¦å‘å™¨è‚¯å®šä¹Ÿéœ€è¦ä¸€ä¸ªè§¦å‘æ—¶é—´ï¼Œé‚£ä¹ˆå°±è¿˜éœ€è¦ä¸€ä¸ªCronScheduleBuilderå¯¹è±¡æ¥è®¾ç½®æ—¶é—´</p><p>å·¥ä½œï¼Œå·¥ä½œæ˜ç»†ï¼Œè§¦å‘å™¨ä¸€ç¯æ‰£ä¸€ç¯ï¼Œä¹Ÿä½“ç°å‡ºQuartzç»“æ„æ¯”è¾ƒä¸¥è°¨</p></blockquote><h1 id="5-springç®€åŒ–å®šæ—¶ä»»åŠ¡"><a href="#5-springç®€åŒ–å®šæ—¶ä»»åŠ¡" class="headerlink" title="5.springç®€åŒ–å®šæ—¶ä»»åŠ¡"></a>5.springç®€åŒ–å®šæ—¶ä»»åŠ¡</h1><p>ä¸Šé¢çš„æ­¥éª¤æ¯”è¾ƒç¹çï¼Œè¿˜æœ‰æ›´ç®€å•çš„æ–¹æ³•</p><p>1.é¦–å…ˆåœ¨å¯åŠ¨ç±»ä¸ŠåŠ ä¸Šå¼€å¯å®šæ—¶ä»»åŠ¡åŠŸèƒ½çš„æ³¨è§£</p><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableScheduling</span></span><br></pre></td></tr></table></figure></blockquote><p>2.å¦å¤–ç¼–å†™ä¸€ä¸ªç±»ï¼Œä¸“é—¨å†™å®šæ—¶ä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> æ—å³°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">task</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™ä¸ªæ³¨è§£å°±ä»£æ›¿äº†æˆ‘ä»¬åŸæ¥çš„é…ç½®ç±»</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/1 * * * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¦æ³¨æ„åŠ @Component</p><h1 id="6-ç›‘æ§"><a href="#6-ç›‘æ§" class="headerlink" title="6.ç›‘æ§"></a>6.ç›‘æ§</h1><p><img src="https://lf-pictures.oss-cn-beijing.aliyuncs.com/img1/202305192140412.png" alt="å±å¹•æˆªå›¾ 2023-05-19 214013"></p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> java </tag>
            
            <tag> SpringBootå…¥é—¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaå…¥é—¨ç¬”è®°</title>
      <link href="/2023/03/27/java/"/>
      <url>/2023/03/27/java/</url>
      
        <content type="html"><![CDATA[<h1 id="é©´ã®JAVAâ€”â€”å¥‡å¦™ä¹‹æ—…"><a href="#é©´ã®JAVAâ€”â€”å¥‡å¦™ä¹‹æ—…" class="headerlink" title="é©´ã®JAVAâ€”â€”å¥‡å¦™ä¹‹æ—…"></a>é©´ã®JAVAâ€”â€”å¥‡å¦™ä¹‹æ—…</h1><blockquote><p>éƒ¨åˆ†ç¬”è®°æ¥è‡ªéŸ©é¡ºå¹³æ•™è‚²</p></blockquote><h3 id="Markdownå¿«æ·é”®"><a href="#Markdownå¿«æ·é”®" class="headerlink" title="Markdownå¿«æ·é”®"></a>Markdownå¿«æ·é”®</h3><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-16%20194630.png"></p><h3 id="IDEAå¿«æ·é”®"><a href="#IDEAå¿«æ·é”®" class="headerlink" title="IDEAå¿«æ·é”®"></a>IDEAå¿«æ·é”®</h3><p>1.åˆ é™¤è¡Œï¼šCtrl + D</p><p>2.å¤åˆ¶è¡Œï¼šCtrl + Alt + å‘ä¸‹ç®­å¤´</p><p>3.è¡¥å…¨ä»£ç ï¼šAlt + &#x2F;</p><p>4.å¯¼å…¥è¯¥è¡Œéœ€è¦çš„ç±»ï¼šAlt + Enter</p><p>5.ç”Ÿæˆæ„é€ å™¨å¿«æ·é”®ï¼šAlt + insert</p><p>6.å¿«é€Ÿå®šä½æ–¹æ³•Ctrl + B</p><p>7.è‡ªåŠ¨åˆ†é…å˜é‡åï¼š.var</p><h2 id="1-ç±»ä¸å¯¹è±¡"><a href="#1-ç±»ä¸å¯¹è±¡" class="headerlink" title="1.ç±»ä¸å¯¹è±¡"></a>1.ç±»ä¸å¯¹è±¡</h2><h3 id="1-å¯¹è±¡çš„å†…å­˜å¸ƒå±€"><a href="#1-å¯¹è±¡çš„å†…å­˜å¸ƒå±€" class="headerlink" title="1.å¯¹è±¡çš„å†…å­˜å¸ƒå±€"></a>1.å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h3><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-16%20200010-16686960745503.png" style="zoom:50%;" />)</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Cat</span> <span class="variable">cat1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br></pre></td></tr></table></figure><p>â€‹cat1æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œä»–æŒ‡å‘ä¸€å—å†…å­˜åœ°å€ï¼Œé‚£å—å†…å­˜åœ°å€é‡Œæœ‰ç±»çš„&#x3D;&#x3D;å±æ€§ä¿¡æ¯&#x3D;&#x3D;</p><p>ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²å‹çš„å±æ€§ä¿¡æ¯ï¼Œä¼šæ”¾åœ¨&#x3D;&#x3D;æ–¹æ³•åŒº&#x3D;&#x3D;ä¸­çš„&#x3D;&#x3D;å¸¸é‡æ± &#x3D;&#x3D;é‡Œï¼Œåªåœ¨ç±»çš„å†…å­˜åœ°å€ä¸­ä¿å­˜ä¸€ä¸ªå­—ç¬¦ä¸²çš„åœ°å€ï¼ˆå¦‚å›¾ï¼‰ã€‚</p><p>â€‹å½“Catç±»è¢«newæ—¶ï¼ŒåŒæ—¶ä¼šåœ¨æ–¹æ³•åŒºå¯¹ç±»çš„ä¿¡æ¯è¿›è¡Œä¸€ä¸ªåŠ è½½ï¼ŒåŠ è½½å†…å®¹æ˜¯&#x3D;&#x3D;å±æ€§ä¿¡æ¯&#x3D;&#x3D;å’Œ&#x3D;&#x3D;æ–¹æ³•&#x3D;&#x3D;ã€‚</p><h3 id="2-ç±»ä¸å¯¹è±¡çš„å†…å­˜åˆ†é…æœºåˆ¶"><a href="#2-ç±»ä¸å¯¹è±¡çš„å†…å­˜åˆ†é…æœºåˆ¶" class="headerlink" title="2.ç±»ä¸å¯¹è±¡çš„å†…å­˜åˆ†é…æœºåˆ¶"></a>2.ç±»ä¸å¯¹è±¡çš„å†…å­˜åˆ†é…æœºåˆ¶</h3><p>å…ˆçœ‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Person</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">p1.age = <span class="number">10</span>;</span><br><span class="line"><span class="type">Person</span> <span class="variable">p2</span> <span class="operator">=</span> p1;</span><br><span class="line"><span class="comment">//p1.age = 20;</span></span><br><span class="line">System.out.println(<span class="string">&quot;p2.age = &quot;</span> + p2.age);</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å…ˆnewäº†ä¸€ä¸ªå¯¹è±¡p1ï¼Œå¹¶ç»™p1çš„å±æ€§èµ‹äº†å€¼ï¼Œå¦‚æœè¿™æ—¶å†å°†p1èµ‹å€¼ç»™p2ï¼Œå¹¶è¾“å‡ºp2çš„å±æ€§ï¼Œä¼šå‡ºç°ä»€ä¹ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p2.age = 10</span><br></pre></td></tr></table></figure><p>å’Œp1çš„å€¼ä¸€è‡´ï¼Œé‚£å¦‚æœæˆ‘ä»¬åœ¨è¾“å‡ºä¹‹å‰ä¿®æ”¹p1çš„å±æ€§ï¼Œç»“æœè¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p2.age = 20</span><br></pre></td></tr></table></figure><p>è¿™è¯´æ˜p1ï¼Œp2æŒ‡å‘äº†åŒä¸€å—å†…å­˜åœ°å€ï¼Œç›¸å½“äºp1,p2æ˜¯ä¸€ä¸ªäººçš„ä¸¤ä¸ªåå­—ï¼Œä½†éƒ½æ˜¯æŒ‡å‘è¯¥äººã€‚</p><h3 id="ï¼ˆè¡¥å……ï¼‰JAVAçš„å†…å­˜ç»“æ„"><a href="#ï¼ˆè¡¥å……ï¼‰JAVAçš„å†…å­˜ç»“æ„" class="headerlink" title="ï¼ˆè¡¥å……ï¼‰JAVAçš„å†…å­˜ç»“æ„"></a>ï¼ˆè¡¥å……ï¼‰JAVAçš„å†…å­˜ç»“æ„</h3><h5 id="Javaå†…å­˜ç»“æ„åˆ†æï¼š"><a href="#Javaå†…å­˜ç»“æ„åˆ†æï¼š" class="headerlink" title="Javaå†…å­˜ç»“æ„åˆ†æï¼š"></a>Javaå†…å­˜ç»“æ„åˆ†æï¼š</h5><ul><li>1.æ ˆï¼šå­˜æ”¾åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå±€éƒ¨å˜é‡ï¼‰</li><li>2.å †ï¼šå­˜æ”¾å¯¹è±¡</li><li>3.æ–¹æ³•åŒºï¼šå¸¸é‡æ± ï¼ˆå¸¸é‡ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ï¼‰ï¼Œç±»åŠ è½½ä¿¡æ¯</li></ul><h5 id="Javaåˆ›å»ºå¯¹è±¡æµç¨‹çš„ç®€å•åˆ†æï¼š"><a href="#Javaåˆ›å»ºå¯¹è±¡æµç¨‹çš„ç®€å•åˆ†æï¼š" class="headerlink" title="Javaåˆ›å»ºå¯¹è±¡æµç¨‹çš„ç®€å•åˆ†æï¼š"></a>Javaåˆ›å»ºå¯¹è±¡æµç¨‹çš„ç®€å•åˆ†æï¼š</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person p1 = new Person();</span><br></pre></td></tr></table></figure><ul><li>1.å…ˆåŠ è½½ç±»ä¿¡æ¯ï¼ˆå±æ€§ï¼Œæ–¹æ³•ï¼‰&#x3D;&#x3D;ä¸€ä¸ªç±»åªåŠ è½½ä¸€æ¬¡&#x3D;&#x3D;</li><li>2.åœ¨å †ä¸­åˆ†é…ç©ºé—´ï¼Œå¹¶é»˜è®¤åˆå§‹åŒ–</li><li>3.æŠŠç©ºé—´çš„åœ°å€åˆ†é…ç»™p1,p1æŒ‡å‘è¯¥åœ°å€</li><li>4.è¿›è¡ŒæŒ‡å®šåˆå§‹åŒ–</li></ul><h2 id="2-JAVAæ–¹æ³•è°ƒç”¨æœºåˆ¶"><a href="#2-JAVAæ–¹æ³•è°ƒç”¨æœºåˆ¶" class="headerlink" title="2.JAVAæ–¹æ³•è°ƒç”¨æœºåˆ¶"></a>2.JAVAæ–¹æ³•è°ƒç”¨æœºåˆ¶</h2><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-16%20211200.png"  />)</p><h2 id="3-å°è£…"><a href="#3-å°è£…" class="headerlink" title="3.å°è£…"></a>3.å°è£…</h2><p>æ­¥éª¤ï¼š</p><p>1ï¼‰å±æ€§ç§æœ‰åŒ–</p><p>2ï¼‰å…¬å…±çš„get setæ–¹æ³•ï¼Œgetç”¨äºè·å–ï¼Œsetç”¨äºèµ‹å€¼å¹¶åˆ¤æ–­å…¶åˆç†æ€§</p><p>å°è£…ä¸æ„é€ å™¨ï¼šå¯ä»¥åœ¨æ„é€ å™¨å†…è°ƒç”¨getï¼Œsetï¼ŒåŒæ ·å¯ä»¥åˆ¤æ–­å…¶åˆç†æ€§ï¼Œå¦‚å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-18%20010355.png"></p><h2 id="4-å¤šæ€"><a href="#4-å¤šæ€" class="headerlink" title="4.å¤šæ€"></a>4.å¤šæ€</h2><h4 id="å‘ä¸Šè½¬å‹"><a href="#å‘ä¸Šè½¬å‹" class="headerlink" title="å‘ä¸Šè½¬å‹"></a>å‘ä¸Šè½¬å‹</h4><p>çˆ¶ç±»çš„å¼•ç”¨æŒ‡å‘å­ç±»çš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Animal</span> <span class="variable">animal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line"><span class="comment">//Dogæ˜¯Animalç±»çš„å­ç±»</span></span><br></pre></td></tr></table></figure><p>åŒæ—¶æ»¡è¶³ï¼š**&#x3D;&#x3D;ç¼–è¯‘ç±»å‹çœ‹å·¦è¾¹ï¼Œè¿è¡Œç±»å‹çœ‹å³è¾¹&#x3D;&#x3D;**ï¼ˆå¯ä»¥è°ƒç”¨çˆ¶ç±»æ‰€æœ‰æˆå‘˜ï¼ˆçœ‹æƒé™ï¼‰ï¼Œä¸èƒ½è°ƒç”¨å­ç±»ç‰¹æœ‰æˆå‘˜ï¼Œå› ä¸ºè°ƒç”¨æ˜¯ç”±ç¼–è¯‘ç±»å‹å†³å®šçš„ï¼Œè°ƒç”¨æ–¹æ³•æ—¶ï¼Œå…ˆä»å­ç±»å¼€å§‹æ‰¾ï¼Œå¦‚æœæœ‰åˆ™è¿è¡Œå­ç±»çš„æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯æœ‰æ–¹æ³•é‡å†™çš„æ—¶å€™ï¼‰</p><h4 id="å‘ä¸‹è½¬å‹"><a href="#å‘ä¸‹è½¬å‹" class="headerlink" title="å‘ä¸‹è½¬å‹"></a>å‘ä¸‹è½¬å‹</h4><p>å¦‚æœç”¨å‘ä¸Šè½¬å‹å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£å°±ä¼šå‡ºç°æ— æ³•è°ƒç”¨å­ç±»ç‰¹æœ‰å¯¹è±¡çš„æƒ…å†µï¼Œå¦‚æœè¦è°ƒç”¨ï¼Œåˆ™éœ€è¦è¿›è¡Œå‘ä¸‹è½¬å‹ï¼Œæˆ‘ä¹ æƒ¯äºçœ‹åšå¼ºåˆ¶ç±»å‹è½¬æ¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> (Dog) animal;</span><br><span class="line"><span class="comment">//animal.pop();è¿™æ ·æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºpopæ–¹æ³•æ˜¯Dogç±»ç‰¹æœ‰</span></span><br><span class="line">dog.pop();</span><br></pre></td></tr></table></figure><h4 id="åŠ¨æ€ç»‘å®šæœºåˆ¶"><a href="#åŠ¨æ€ç»‘å®šæœºåˆ¶" class="headerlink" title="åŠ¨æ€ç»‘å®šæœºåˆ¶"></a>åŠ¨æ€ç»‘å®šæœºåˆ¶</h4><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-19%20021737.png"></p><p>ç®€å•è¯´ï¼Œåªè¦è°ƒç”¨äº†æŸä¸ªç±»çš„æ–¹æ³•ï¼Œé‚£å°±ä¼šåŠ¨æ€ç»‘å®šåˆ°è¯¥ç±»ï¼ˆç”¨è¯¥ç±»çš„å±æ€§ï¼‰</p><h4 id="å¤šæ€æ•°ç»„"><a href="#å¤šæ€æ•°ç»„" class="headerlink" title="å¤šæ€æ•°ç»„"></a>å¤šæ€æ•°ç»„</h4><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-19%20022812.png"></p><p>instanceofç”¨äºåˆ¤æ–­è¿è¡Œç±»å‹ï¼Œç„¶åå°±å¯ä»¥æ ¹æ®è¿è¡Œç±»å‹é€šè¿‡å‘ä¸‹è½¬å‹æ¥è°ƒç”¨ç‰¹æœ‰æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(persons[i] <span class="keyword">instanceof</span> Student)&#123;</span><br><span class="line">    ((Student)person[i]).study();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠ¨æ€å‚æ•°"><a href="#åŠ¨æ€å‚æ•°" class="headerlink" title="åŠ¨æ€å‚æ•°"></a>åŠ¨æ€å‚æ•°</h4><p>å³å¦‚æœæ–¹æ³•å†…çš„å‚æ•°ç±»å‹ä¸ºçˆ¶ç±»ï¼Œè°ƒç”¨æ—¶å¯ä»¥ä¼ å…¥å­ç±»å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚</p><h2 id="5-ç±»å˜é‡ç±»æ–¹æ³•"><a href="#5-ç±»å˜é‡ç±»æ–¹æ³•" class="headerlink" title="5.ç±»å˜é‡ç±»æ–¹æ³•"></a>5.ç±»å˜é‡ç±»æ–¹æ³•</h2><p>ç±»å˜é‡æ˜¯æŒ‡å±äºè¿™ä¸ªç±»çš„å˜é‡ï¼Œè¢«æ‰€æœ‰è¯¥ç±»çš„å¯¹è±¡æ‰€å…±æœ‰ï¼Œæ‰€ä»¥æ˜¯é™æ€çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> n;</span><br></pre></td></tr></table></figure><p>ç±»æ–¹æ³•æ˜¯æŒ‡ä¸€ä¸ªè¢«æ‰€æœ‰è¯¥ç±»çš„å¯¹è±¡å…±æœ‰çš„æ–¹æ³•ï¼Œå®ƒåªèƒ½è®¿é—®é™æ€å‚æ•°ï¼Œå¦å¤–é™æ€æ–¹æ³•å¯ä»¥å®ç°ç±»å.æ–¹æ³•åï¼ˆï¼‰ç›´æ¥è°ƒç”¨ï¼Œä¸éœ€è¦å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">A</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><h2 id="6-ä»£ç å—"><a href="#6-ä»£ç å—" class="headerlink" title="6.ä»£ç å—"></a>6.ä»£ç å—</h2><h4 id="å®šä¹‰ï¼š"><a href="#å®šä¹‰ï¼š" class="headerlink" title="å®šä¹‰ï¼š"></a>å®šä¹‰ï¼š</h4><p>ä»£ç å—åˆç§°åˆå§‹åŒ–å—ï¼Œå±äºç±»ä¸­çš„æˆå‘˜ï¼Œç±»ä¼¼ä¸æ–¹æ³•ï¼Œå°†é€»è¾‘è¯­å¥å°è£…åœ¨æ–¹æ³•ä½“é‡ï¼Œç”¨{}åŒ…å›´ï¼Œå¯ä»¥ç”¨åšå¯¹è±¡åˆå§‹åŒ–</p><h4 id="åŸºæœ¬è¯­æ³•ï¼š"><a href="#åŸºæœ¬è¯­æ³•ï¼š" class="headerlink" title="åŸºæœ¬è¯­æ³•ï¼š"></a>åŸºæœ¬è¯­æ³•ï¼š</h4><p><strong>[ä¿®é¥°ç¬¦]{</strong>&#x2F;&#x2F;ä¿®é¥°ç¬¦å¯å†™å¯ä¸å†™ï¼Œä½†è¦å†™åªèƒ½å†™static</p><p><strong>ä»£ç </strong></p><p><strong>}ï¼›</strong></p><h4 id="ä½¿ç”¨ç»†èŠ‚ï¼š"><a href="#ä½¿ç”¨ç»†èŠ‚ï¼š" class="headerlink" title="ä½¿ç”¨ç»†èŠ‚ï¼š"></a>ä½¿ç”¨ç»†èŠ‚ï¼š</h4><p>1.é™æ€ä»£ç å—åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ™®é€šä»£ç å—ä¸€ä¸ªå¯¹è±¡ä¸€æ¬¡</p><p>2.ç±»ä½•æ—¶è¢«åŠ è½½ <strong>&#x3D;&#x3D;é‡è¦&#x3D;&#x3D;</strong></p><p> 1ï¼‰åˆ›å»ºå¯¹è±¡</p><p> 2ï¼‰åˆ›å»ºå­ç±»å¯¹è±¡</p><p> 3ï¼‰ä½¿ç”¨é™æ€æˆå‘˜</p><p>3.<img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-20%20010025.png"></p><p>å…ˆè°ƒç”¨é™æ€ï¼Œåœ¨è°ƒç”¨æ™®é€š</p><p>4.<img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-20%20010350.png"></p><h2 id="7-å•ä¾‹è®¾è®¡æ¨¡å¼"><a href="#7-å•ä¾‹è®¾è®¡æ¨¡å¼" class="headerlink" title="7.å•ä¾‹è®¾è®¡æ¨¡å¼"></a>7.å•ä¾‹è®¾è®¡æ¨¡å¼</h2><p>è§£é‡Šï¼šè¿™ä¸ªæ¨¡å¼çš„ç±»åªå…è®¸æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œç§°ä¸ºå•ä¾‹ï¼Œè¦ç¬¦åˆè¿™ä¸ªè¦æ±‚ï¼Œå¿…é¡»è¦æŠŠæ„é€ å™¨&#x3D;&#x3D;ç§æœ‰åŒ–&#x3D;&#x3D;ï¼Œè¿™æ ·ç”¨æˆ·å°±ä¸èƒ½è‡ªå·±newå¯¹è±¡äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¾‹å­(é¥¿æ±‰å¼)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GirlFriend</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">GirlFriend</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//æ„é€ å™¨ç§æœ‰åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">GirlFriend</span> <span class="variable">gf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GirlFriend</span>(<span class="string">&quot;xiaohong&quot;</span>);<span class="comment">//åœ¨ç±»çš„å†…éƒ¨å®ä¾‹åŒ–å¯¹è±¡//è¿™ä¸ªå¯¹è±¡ä¸€å®šæ˜¯ç§æœ‰ä¸”é™æ€çš„ï¼Œä¸æ˜¯é™æ€çš„è¯æˆ‘ä»¬çš„é™æ€æ–¹æ³•è¿”å›ä¸äº†ã€‚</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> GirlFriend <span class="title function_">getGirlF</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gf;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‡’æ±‰å¼å’Œé¥¿æ±‰å¼çš„åŒºåˆ«åœ¨äºï¼Œé¥¿æ±‰å¼æ˜¯ä¸ç®¡ä½ ç”¨æ²¡ç”¨ï¼Œä»–éƒ½åˆ›å»ºä¸€ä¸ªå¯¹è±¡ç­‰ä½ ï¼Œæ‡’æ±‰å¼æ˜¯ä½ ä¸è°ƒç”¨ä¸åˆ›å»ºã€‚ä»£ç ä¸Šçš„åŒºåˆ«å°±åœ¨äºï¼Œæ‡’æ±‰å¼æŠŠå¯¹è±¡çš„åˆ›å»ºæ”¾åœ¨äº†Getå‡½æ•°é‡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Girl</span>&#123;<span class="comment">//æ‡’æ±‰å¼</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Girl girl;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Girl</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> Girl <span class="title function_">getGirl</span><span class="params">(String name)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(girl == <span class="literal">null</span>)&#123;</span><br><span class="line">girl = <span class="keyword">new</span> <span class="title class_">Girl</span>(<span class="string">&quot;æŸæŸæŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> girl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-finalå…³é”®å­—"><a href="#8-finalå…³é”®å­—" class="headerlink" title="8.finalå…³é”®å­—"></a>8.finalå…³é”®å­—</h2><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-21%20195759.png"></p><h2 id="9-æŠ½è±¡ç±»"><a href="#9-æŠ½è±¡ç±»" class="headerlink" title="9.æŠ½è±¡ç±»"></a>9.æŠ½è±¡ç±»</h2><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-21%20201134.png"></p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-21%20202300.png"></p><h2 id="10-å†…éƒ¨ç±»"><a href="#10-å†…éƒ¨ç±»" class="headerlink" title="10.å†…éƒ¨ç±»"></a>10.å†…éƒ¨ç±»</h2><h3 id="å±€éƒ¨å†…éƒ¨ç±»"><a href="#å±€éƒ¨å†…éƒ¨ç±»" class="headerlink" title="å±€éƒ¨å†…éƒ¨ç±»"></a>å±€éƒ¨å†…éƒ¨ç±»</h3><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-21%20204456.png"></p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-21%20204441.png"></p><h3 id="åŒ¿åå†…éƒ¨ç±»"><a href="#åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»"></a>åŒ¿åå†…éƒ¨ç±»</h3><p>ç›®çš„ï¼šç®€åŒ–å¼€å‘ï¼Œå½“æŸä¸ªç±»ç»§æ‰¿æŸä¸ªç±»ï¼Œæˆ–è€…è¯´ä¸€ä¸ªæ¥å£ï¼Œä½ åªä¼šä½¿ç”¨å®ƒä»¬ä¸€æ¬¡ï¼Œå¦‚æœä¸“é—¨ä¸ºä»–ä»¬å†™ä¸€ä¸ªæ–°çš„ç±»æˆ–è€…æ¥å£ï¼Œå¤ªè¿‡ç¹çï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨åŒ¿åå†…éƒ¨ç±»å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¾‹å­ï¼š</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">A</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">A</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">A</span>()&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;<span class="comment">//åˆ†å·åˆ«å¿˜äº†</span></span><br><span class="line">a.say();</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŠ½è±¡ç±»ä¸èƒ½å®ä¾‹åŒ–ï¼Œä½†å¯ä»¥é€šè¿‡åŒ¿åå†…éƒ¨ç±»</span></span><br><span class="line"><span class="keyword">abstract</span> A&#123;</span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">A</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">A</span>()&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//è¾“å‡º</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;ä½ ç”šè‡³å¯ä»¥ï¼š&#x3D;&#x3D;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//è¾“å‡º</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;.say();<span class="comment">//ç›´æ¥è°ƒç”¨æ–¹æ³•</span></span><br></pre></td></tr></table></figure><h3 id="æˆå‘˜å†…éƒ¨ç±»"><a href="#æˆå‘˜å†…éƒ¨ç±»" class="headerlink" title="æˆå‘˜å†…éƒ¨ç±»"></a>æˆå‘˜å†…éƒ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">AA</span>&#123;<span class="comment">//æˆå‘˜å†…éƒ¨ç±»</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="comment">//è¾“å‡º</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤–éƒ¨ç±»è°ƒç”¨æˆå‘˜å†…éƒ¨ç±»çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–¹æ³•ä¸€</span></span><br><span class="line">A.a å¯¹è±¡å = A.<span class="keyword">new</span> <span class="title class_">a</span>();</span><br></pre></td></tr></table></figure><p>æ³•äºŒï¼šåœ¨å¤–éƒ¨ç±»é‡Œæä¾›è¿”å›å†…éƒ¨ç±»å¯¹è±¡çš„æ–¹æ³•ï¼Œæ¥å—ç±»å‹ä»ç„¶æ˜¯A.a</p><h2 id="11-æšä¸¾ç±»"><a href="#11-æšä¸¾ç±»" class="headerlink" title="11.æšä¸¾ç±»"></a>11.æšä¸¾ç±»</h2><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-24%20144955.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸¾ä¾‹</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">    XM(<span class="string">&quot;å°æ˜&quot;</span>ï¼Œ<span class="string">&quot;18&quot;</span>),XH(<span class="string">&quot;å°çº¢&quot;</span>ï¼Œ<span class="number">18</span>)ï¼›<span class="comment">//ä¸€å®šæ”¾åœ¨ç¬¬ä¸€æ’ï¼Œå¤šä¸ªç”¨é€—å·é—´éš”</span></span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="comment">//æ„é€ å™¨ï¼Œgetï¼Œsetçœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æšä¸¾ç±»å¸¸ç”¨æ–¹æ³•"><a href="#æšä¸¾ç±»å¸¸ç”¨æ–¹æ³•" class="headerlink" title="æšä¸¾ç±»å¸¸ç”¨æ–¹æ³•"></a>æšä¸¾ç±»å¸¸ç”¨æ–¹æ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-24%20152339.png"></p><h3 id="å¢å¼º-x3D-x3D-forå¾ªç¯-x3D-x3D"><a href="#å¢å¼º-x3D-x3D-forå¾ªç¯-x3D-x3D" class="headerlink" title="å¢å¼º&#x3D;&#x3D;forå¾ªç¯&#x3D;&#x3D;"></a>å¢å¼º&#x3D;&#x3D;forå¾ªç¯&#x3D;&#x3D;</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i : A)&#123;</span><br><span class="line">    <span class="comment">//è¾“å‡ºi</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼åªèƒ½éå†ä¸èƒ½èµ‹å€¼ï¼Œå› ä¸ºiæ˜¯ä¸ªä¸´æ—¶å˜é‡ï¼Œä¸æ”¹å˜åŸæ¥çš„å€¼ã€‚</p><h2 id="12-é›†åˆ"><a href="#12-é›†åˆ" class="headerlink" title="12.é›†åˆ"></a>12.é›†åˆ</h2><h3 id="é›†åˆä½“ç³»å›¾"><a href="#é›†åˆä½“ç³»å›¾" class="headerlink" title="é›†åˆä½“ç³»å›¾"></a><em>é›†åˆä½“ç³»å›¾</em></h3><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-25%20113243.png"></p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-25%20113621.png"></p><h3 id="Listå¸¸ç”¨æ–¹æ³•"><a href="#Listå¸¸ç”¨æ–¹æ³•" class="headerlink" title="Listå¸¸ç”¨æ–¹æ³•"></a>Listå¸¸ç”¨æ–¹æ³•</h3><p>é¦–å…ˆå®ç°Listæ¥å£çš„ç±»ï¼Œé‡Œé¢çš„å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œå¯é‡å¤çš„</p><h3 id="éå†collectionç±»çš„æ–¹æ³•"><a href="#éå†collectionç±»çš„æ–¹æ³•" class="headerlink" title="éå†collectionç±»çš„æ–¹æ³•"></a>éå†collectionç±»çš„æ–¹æ³•</h3><p>æ³•ä¸€ï¼šè¿­ä»£å™¨ï¼ˆ**&#x3D;&#x3D;å¿«æ·é”®ï¼šitit + å›è½¦&#x3D;&#x3D;**ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‡è®¾æœ‰é›†åˆï¼Œåå­—ä¸ºcol</span></span><br><span class="line"><span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> col.iterator();<span class="comment">//è·å–è¯¥é›†åˆçš„è¿­ä»£å™¨</span></span><br><span class="line"><span class="keyword">while</span>(iterator.hasNext())&#123;<span class="comment">//æ‹¬å·é‡Œçš„ç”¨æ¥åˆ¤æ–­ä¸‹ä¸€ä¸ªåœ°å€æœ‰æ— å…ƒç´ </span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">next</span> <span class="operator">=</span> iterator.next();<span class="comment">//Objectæ¥å—</span></span><br><span class="line">    <span class="comment">//è¾“å‡ºnext</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³•äºŒï¼šå¢å¼ºfor</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(Object obj:col)&#123;</span><br><span class="line">    <span class="comment">//è¾“å‡º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ArrayListå¸¸ç”¨æ–¹æ³•"><a href="#ArrayListå¸¸ç”¨æ–¹æ³•" class="headerlink" title="ArrayListå¸¸ç”¨æ–¹æ³•"></a>ArrayListå¸¸ç”¨æ–¹æ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-25%20112951.png"></p><h3 id="setæ¥å£ï¼šæ— åºï¼Œä¸èƒ½æœ‰é‡å¤çš„ï¼Œå¯ä»¥å­˜æ”¾null"><a href="#setæ¥å£ï¼šæ— åºï¼Œä¸èƒ½æœ‰é‡å¤çš„ï¼Œå¯ä»¥å­˜æ”¾null" class="headerlink" title="setæ¥å£ï¼šæ— åºï¼Œä¸èƒ½æœ‰é‡å¤çš„ï¼Œå¯ä»¥å­˜æ”¾null"></a>setæ¥å£ï¼šæ— åºï¼Œä¸èƒ½æœ‰é‡å¤çš„ï¼Œå¯ä»¥å­˜æ”¾null</h3><h2 id="13-åº”ç”¨è¿‡ç¨‹å¦‚ä½•é€‰æ‹©é›†åˆç±»"><a href="#13-åº”ç”¨è¿‡ç¨‹å¦‚ä½•é€‰æ‹©é›†åˆç±»" class="headerlink" title="13.åº”ç”¨è¿‡ç¨‹å¦‚ä½•é€‰æ‹©é›†åˆç±»"></a>13.åº”ç”¨è¿‡ç¨‹å¦‚ä½•é€‰æ‹©é›†åˆç±»</h2><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-26%20222402.png"></p><h3 id="collectionç±»çš„ä¸€äº›å·¥å…·"><a href="#collectionç±»çš„ä¸€äº›å·¥å…·" class="headerlink" title="collectionç±»çš„ä¸€äº›å·¥å…·"></a>collectionç±»çš„ä¸€äº›å·¥å…·</h3><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-26%20222606.png"></p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-26%20222752.png"></p><h2 id="14-ä½¿ç”¨JUnitå¿«æ·æµ‹è¯•ä»£ç "><a href="#14-ä½¿ç”¨JUnitå¿«æ·æµ‹è¯•ä»£ç " class="headerlink" title="14.ä½¿ç”¨JUnitå¿«æ·æµ‹è¯•ä»£ç "></a>14.ä½¿ç”¨JUnitå¿«æ·æµ‹è¯•ä»£ç </h2><p>JUnitå¯ä»¥ç”¨æ¥å¿«é€Ÿæµ‹è¯•ç±»æ–¹æ³•ï¼Œä¸ç”¨æå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span><span class="comment">//åœ¨éœ€è¦æµ‹è¯•çš„æ–¹æ³•å‰åŠ è¿™ä¸ªï¼Œç„¶åAlt + enter å¯¼å…¥åŒ…ä¹‹ç±»çš„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">A</span><span class="params">()</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="15-javaä½œå›¾"><a href="#15-javaä½œå›¾" class="headerlink" title="15.javaä½œå›¾"></a>15.javaä½œå›¾</h2><h3 id="javaåæ ‡å›¾"><a href="#javaåæ ‡å›¾" class="headerlink" title="javaåæ ‡å›¾"></a>javaåæ ‡å›¾</h3><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-12-28%20164246.png"></p><h3 id="ç”»æ¿å…·ä½“åˆ›å»ºè¿‡ç¨‹"><a href="#ç”»æ¿å…·ä½“åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="ç”»æ¿å…·ä½“åˆ›å»ºè¿‡ç¨‹"></a>ç”»æ¿å…·ä½“åˆ›å»ºè¿‡ç¨‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">myPaint</span> <span class="keyword">extends</span> <span class="title class_">JFrame</span>&#123;<span class="comment">//ç»§æ‰¿äº†ä¸€ä¸ªçª—å£</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">myP</span> <span class="variable">mp</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//ç”»æ¿ç±»å‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">myPaint</span>();<span class="comment">//ç”»æ¿å¯¹è±¡</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">myPaint</span><span class="params">()</span>&#123;</span><br><span class="line">        mp = <span class="keyword">new</span> <span class="title class_">myP</span>();<span class="comment">//åœ¨æ„é€ å™¨é‡Œå¯¹ç”»æ¿åˆå§‹åŒ–</span></span><br><span class="line">        <span class="built_in">this</span>.add(mp);<span class="comment">//å°†ç”»æ¿åŠ å…¥çª—å£</span></span><br><span class="line">        <span class="built_in">this</span>.setSize(<span class="number">300</span>,<span class="number">300</span>);<span class="comment">//è®¾ç½®çª—å£å¤§å°</span></span><br><span class="line">        <span class="built_in">this</span>.setVisible(<span class="literal">true</span>);<span class="comment">//çª—å£å¯è§†åŒ–</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">myP</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span>&#123;<span class="comment">//ç›¸å½“äºä¸€ä¸ªç”»æ¿ç±»å‹</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(g);<span class="comment">//gç›¸å½“äºä¸€ä¸ªç”»ç¬”ï¼Œæä¾›äº†å¾ˆå¤šæ–¹æ³•ï¼Œå¯ä»¥ä½œå›¾</span></span><br><span class="line">        g.drawOval(<span class="number">20</span>,<span class="number">20</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="16-çº¿ç¨‹"><a href="#16-çº¿ç¨‹" class="headerlink" title="16.çº¿ç¨‹"></a>16.çº¿ç¨‹</h2><h3 id="å®ç°çº¿ç¨‹çš„æ–¹æ³•"><a href="#å®ç°çº¿ç¨‹çš„æ–¹æ³•" class="headerlink" title="å®ç°çº¿ç¨‹çš„æ–¹æ³•"></a>å®ç°çº¿ç¨‹çš„æ–¹æ³•</h3><p>1.ç»§æ‰¿Thread é‡å†™runæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AoLG</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AoLG</span>();</span><br><span class="line">        a.start();<span class="comment">//ä¸æ˜¯run</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AoLG</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;åŠ æ²¹ï¼Œå¥¥åˆ©ç»™ï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//å¿«æ·try-catchï¼šctrl + alt + t</span></span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.å®ç°Runableæ¥å£ é‡å†™runæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">main&#123;</span><br><span class="line">    <span class="type">AOlg</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AOlg</span>();</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(a);<span class="comment">//è¿™ä¸ªè°ƒç”¨å¾ˆé‡è¦</span></span><br><span class="line">    t.start();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AOlg</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹æ’é˜Ÿ"><a href="#çº¿ç¨‹æ’é˜Ÿ" class="headerlink" title="çº¿ç¨‹æ’é˜Ÿ"></a>çº¿ç¨‹æ’é˜Ÿ</h3><blockquote><p>çº¿ç¨‹å . join();</p></blockquote><p>æ³¨ï¼šæ’é˜Ÿæœ¬è´¨æ˜¯è®©è°ƒç”¨æ’é˜Ÿå‡½æ•°çš„çº¿ç¨‹ä¼‘çœ ï¼Œä¾‹å¦‚åœ¨mainçº¿ç¨‹ä¸­è°ƒç”¨å­çº¿ç¨‹æ’é˜Ÿï¼Œåˆ™ä¼šä¼‘çœ mainè®©å­çº¿ç¨‹å…ˆæ‰§è¡Œå®Œã€‚</p><h3 id="å®ˆæŠ¤çº¿ç¨‹"><a href="#å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="å®ˆæŠ¤çº¿ç¨‹"></a>å®ˆæŠ¤çº¿ç¨‹</h3><blockquote><p>çº¿ç¨‹å . setDaemon(true);</p><p>æœ¬çº¿ç¨‹ç»“æŸï¼Œè°ƒç”¨çš„å­çº¿ç¨‹ï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰ä¹Ÿç»“æŸ</p></blockquote><h3 id="çº¿ç¨‹åŒæ­¥æœºåˆ¶"><a href="#çº¿ç¨‹åŒæ­¥æœºåˆ¶" class="headerlink" title="çº¿ç¨‹åŒæ­¥æœºåˆ¶"></a>çº¿ç¨‹åŒæ­¥æœºåˆ¶</h3><blockquote><p>åŒä¸€æ—¶é—´å†…åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å†…å­˜è¿›è¡Œæ“ä½œ</p></blockquote><p>å®ç°æ–¹æ³•ï¼š</p><blockquote><p>synchronizedå…³é”®å­—</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">m</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="Javaç½‘ç»œéƒ¨åˆ†"><a href="#Javaç½‘ç»œéƒ¨åˆ†" class="headerlink" title="Javaç½‘ç»œéƒ¨åˆ†"></a>Javaç½‘ç»œéƒ¨åˆ†</h2><h3 id="1-IPåœ°å€"><a href="#1-IPåœ°å€" class="headerlink" title="1.IPåœ°å€"></a>1.IPåœ°å€</h3><blockquote><p>1.IPV4ä¸€å…±æœ‰32ä½ï¼Œå››ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå­—èŠ‚8ä½ï¼Œæ¯ä¸ªéƒ½èƒ½æ˜¾ç¤º0~255ä¹‹é—´çš„æ•°</p><p>2.IPåœ°å€ï¼šå”¯ä¸€æ ‡è¯†ä¸»æœº</p></blockquote><h3 id="InetAddressç±»"><a href="#InetAddressç±»" class="headerlink" title="InetAddressç±»"></a>InetAddressç±»</h3><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-01-04%20001611.png"></p><h3 id="2-Socketä»‹ç»"><a href="#2-Socketä»‹ç»" class="headerlink" title="2.Socketä»‹ç»"></a>2.Socketä»‹ç»</h3><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-01-04%20225717.png"></p><p>ç®€å•è®²å°±æ˜¯ä¸€ä¸ªæ¡¥æ¢ï¼Œå¯ä»¥åœ¨ä¸¤ä¸ªç½‘ç»œä¹‹é—´è¿›è¡ŒIOæµä¼ é€’</p><h2 id="3-TCPç¼–ç¨‹"><a href="#3-TCPç¼–ç¨‹" class="headerlink" title="3.TCPç¼–ç¨‹"></a>3.<strong>TCPç¼–ç¨‹</strong></h2><h3 id="å­—èŠ‚å‹"><a href="#å­—èŠ‚å‹" class="headerlink" title="å­—èŠ‚å‹"></a>å­—èŠ‚å‹</h3><p>æ€è·¯ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-01-04%20230020.png"></p><p>&#x3D;&#x3D;æœåŠ¡å™¨ç«¯&#x3D;&#x3D;ä»£ç ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-01-04%20230606.png"></p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-01-04%20230656.png"></p><p>&#x3D;&#x3D;ä¸»æœºç«¯&#x3D;&#x3D;ä»£ç ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-01-04%20230812.png"></p><h3 id="ç»“æŸæ ‡å¿—"><a href="#ç»“æŸæ ‡å¿—" class="headerlink" title="ç»“æŸæ ‡å¿—"></a>ç»“æŸæ ‡å¿—</h3><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-01-04%20234110.png"></p><p>ç”¨äºè¡¨ç¤ºå†™å…¥ç»“æŸï¼Œä¸åŠ ä¼šå¯¼è‡´ç¨‹åºä¸çŸ¥é“æ˜¯å¦å†™å…¥ç»“æŸï¼Œä¼šä¸€ç›´å¡åœ¨é‚£é‡Œ</p><h3 id="å­—ç¬¦å‹"><a href="#å­—ç¬¦å‹" class="headerlink" title="å­—ç¬¦å‹"></a>å­—ç¬¦å‹</h3><p>è¾“å‡º</p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/QQ%E6%88%AA%E5%9B%BE20230105211644.jpg"></p><p>è¯»å…¥</p><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/QQ%E6%88%AA%E5%9B%BE20230105212901jpg"></p><h3 id="4-åˆ©ç”¨TCPå®ç°æ–‡ä»¶ä¸Šä¼ "><a href="#4-åˆ©ç”¨TCPå®ç°æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="4.åˆ©ç”¨TCPå®ç°æ–‡ä»¶ä¸Šä¼ "></a>4.åˆ©ç”¨TCPå®ç°æ–‡ä»¶ä¸Šä¼ </h3><p><img src="https://cdn.jsdelivr.net/gh/linfengshow/pictures@main/QQ%E6%88%AA%E5%9B%BE20230105230612.jpg"></p><h3 id="5-å®ç°å¤šçº¿ç¨‹æ–‡ä»¶ä¸Šä¼ "><a href="#5-å®ç°å¤šçº¿ç¨‹æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="5.å®ç°å¤šçº¿ç¨‹æ–‡ä»¶ä¸Šä¼ "></a>5.å®ç°å¤šçº¿ç¨‹æ–‡ä»¶ä¸Šä¼ </h3><blockquote><p>å€˜è‹¥è¦æé«˜æ•ˆç‡ï¼Œå¯ä»¥è°ƒç”¨çº¿ç¨‹ï¼Œå®ç°æ¯è®¿é—®ä¸€æ¬¡å°±å¼€ä¸€ä¸ªçº¿ç¨‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runable</span>)&#123;</span><br><span class="line">    é‡å†™runæ–¹æ³•</span><br><span class="line">&#125;).start;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š1.æœåŠ¡ç«¯åº”è¯¥æå‰ç”¨æ­»å¾ªç¯æ‹¬èµ·æ¥ï¼Œè®©ä»–ä¸€ç›´ç›‘å¬</p><p>2.æ–‡ä»¶ååº”è¯¥è‡ªå®šä¹‰ä¸€ä¸ªç”Ÿæˆæ¨¡å¼ï¼Œé˜²æ­¢æ–‡ä»¶åé‡å¤</p><h2 id="Javaåå°„"><a href="#Javaåå°„" class="headerlink" title="Javaåå°„"></a>Javaåå°„</h2><h3 id="1-è·å–ç±»çš„classæ–¹æ³•"><a href="#1-è·å–ç±»çš„classæ–¹æ³•" class="headerlink" title="1.è·å–ç±»çš„classæ–¹æ³•"></a>1.è·å–ç±»çš„classæ–¹æ³•</h3><p>1.ç±»å + class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;Student&gt; s = Student.class;</span><br></pre></td></tr></table></figure><p>2.è°ƒç”¨å¯¹è±¡çš„classæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        Class&lt;? <span class="keyword">extends</span> <span class="title class_">Student</span>&gt; studentClass = student.getClass();</span><br></pre></td></tr></table></figure><p>3.ä½¿ç”¨classç±»é™æ€æ–¹æ³•Class.forName(æŸä¸ªç±»çš„å…¨è·¯å¾„)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; aClass = Class.forName(<span class="string">&quot;com.Lfs_code.Student&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="2-é€šè¿‡åå°„è·å–classç±»çš„æ„é€ æ–¹æ³•"><a href="#2-é€šè¿‡åå°„è·å–classç±»çš„æ„é€ æ–¹æ³•" class="headerlink" title="2.é€šè¿‡åå°„è·å–classç±»çš„æ„é€ æ–¹æ³•"></a>2.é€šè¿‡åå°„è·å–classç±»çš„æ„é€ æ–¹æ³•</h3><p>1.è·å–å•ä¸ªæ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Constructor&lt;Student&gt; constructor = s.getConstructor();<span class="comment">//æ— å‚</span></span><br><span class="line">Constructor&lt;?&gt; constructor = aClass.getConstructor(<span class="type">int</span>.class,String.class);<span class="comment">//æœ‰å‚</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨è·å–æœ‰å‚æ„é€ æ–¹æ³•æ—¶ï¼Œéœ€è¦ç”¨åˆ°æ•°æ®ç±»å‹çš„â€œ.classâ€å½¢å¼</strong></p><p>2.å¦å¤–å¦‚æœéœ€è¦è®¿é—®ç§æœ‰æ„é€ æ–¹æ³•éœ€è¦ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Constructor&lt;?&gt; constructor = aClass.getDeclaredConstructor(<span class="type">int</span>.class,String.class);<span class="comment">//ç§æœ‰å…¬æœ‰éƒ½èƒ½è®¿é—®</span></span><br><span class="line"><span class="comment">//è°ƒç”¨æ˜¯å¿…é¡»æå‰è®¾ç½®è®¿é—®æƒ</span></span><br><span class="line">constructor.setAccessible(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><h3 id="3-è®¿é—®æˆå‘˜å˜é‡"><a href="#3-è®¿é—®æˆå‘˜å˜é‡" class="headerlink" title="3.è®¿é—®æˆå‘˜å˜é‡"></a>3.è®¿é—®æˆå‘˜å˜é‡</h3><p>1.è·å–å…¨éƒ¨æˆå‘˜å˜é‡ï¼Œé¡ºä¾¿éå†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Field[] declaredFields = aClass.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field f:declaredFields</span><br><span class="line">             ) &#123;</span><br><span class="line">            System.out.println(f);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>2.è·å–å•ä¸ªæˆå‘˜å˜é‡ï¼Œå¹¶ä¿®æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">name</span> <span class="operator">=</span> aClass.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        name.setAccessible(<span class="literal">true</span>);<span class="comment">//å¦‚æœè¯¥å˜é‡æ˜¯ç§æœ‰çš„ï¼Œå°±è®¾ç½®å®ƒçš„è®¿é—®æƒ</span></span><br><span class="line">        name.set(o,<span class="string">&quot;æ—å³°&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="4-åå°„è·å–æˆå‘˜æ–¹æ³•"><a href="#4-åå°„è·å–æˆå‘˜æ–¹æ³•" class="headerlink" title="4.åå°„è·å–æˆå‘˜æ–¹æ³•"></a>4.åå°„è·å–æˆå‘˜æ–¹æ³•</h3><p>1.è·å–å…¨éƒ¨æ–¹æ³•ï¼ˆå’Œä¸Šé¢å¤§å·®ä¸å·®ï¼ŒåŸºæœ¬ä¸ç”¨ï¼‰</p><p>2.è·å–å•ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">study</span> <span class="operator">=</span> aClass.getMethod(<span class="string">&quot;study&quot;</span>);</span><br></pre></td></tr></table></figure><p>3.<strong>æ–¹æ³•çš„è°ƒç”¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">study.invoke(o);<span class="comment">//æ–¹æ³•ç±»å‹ + invoke + (è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡)</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
